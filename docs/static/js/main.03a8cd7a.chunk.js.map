{"version":3,"sources":["reducers/medias.ts","reducers/messages.ts","reducers/modals.ts","reducers/player.ts","reducers/room.ts","reducers/user.ts","utils/users.ts","reducers/index.ts","components/Common/Icon.tsx","components/Common/IconButton.tsx","utils/history.ts","utils/clipboard.ts","components/Room/Head.tsx","selectors/room.ts","actions/index.ts","actions/modals.ts","actions/messages.ts","containers/Room/Head.ts","components/Room/Cover.tsx","components/Room/Medias.tsx","components/Room/QueueItem.tsx","components/Room/Queue.tsx","selectors/medias.ts","config/firebase.ts","utils/index.ts","utils/firebase.ts","utils/messages.ts","actions/medias.ts","actions/room.ts","actions/queue.ts","utils/colorpicker.ts","actions/player.ts","containers/Room/Queue.ts","components/Room/Progress.tsx","containers/Room/Progress.ts","components/Room/Controls.tsx","containers/Room/Controls.ts","components/Room/index.tsx","containers/Room/index.ts","components/Splash/index.tsx","selectors/user.ts","actions/user.ts","containers/Splash/index.ts","components/Modals/Modal.tsx","containers/Modals/Modal.ts","components/Modals/FormModal.tsx","components/Modals/ConfirmModal.tsx","containers/Modals/ConfirmModal.ts","components/Users/ConnectUserModal.tsx","containers/Users/ConnectUserModal.ts","components/Modals/SecretField.tsx","containers/Modals/SecretField.ts","components/Room/CreateRoomModal.tsx","containers/Room/CreateRoomModal.ts","components/Users/CreateUserModal.tsx","containers/Users/CreateUserModal.ts","utils/deezer.ts","utils/medias.ts","components/Room/SearchResultCategory.tsx","components/Room/SearchModal.tsx","containers/Room/SearchModal.ts","components/Room/UnlockRoomModal.tsx","containers/Room/UnlockRoomModal.ts","components/Modals/index.tsx","containers/Modals/index.ts","components/App/Messages.tsx","selectors/messages.ts","containers/App/Messages.ts","components/App/index.tsx","containers/App/index.ts","utils/player.ts","locales/en.ts","locales/fr.ts","utils/i18n.ts","index.tsx"],"names":["INITIAL_STATE","fetching","error","medias","album","playlist","track","initialState","stack","playing","track_percent","room","access","id","secret","color","fg","r","g","b","bg","info","position","user","res","s","localStorage","getItem","d","JSON","parse","atob","i","console","debug","err","loadUserAccess","rootReducer","combineReducers","state","action","type","payload","copy","media","messages","filter","other","modals","pop","player","setItem","btoa","stringify","saveUserAccess","removeItem","Icon","Component","render","this","props","className","icon","size","title","classNames","name","style","LoadingIcon","IconButton","disabled","displayTitle","kind","onClick","aria-label","clickable","_CancelButton","t","CancelButton","withTranslation","createHashHistory","copyToClipboard","value","a","Promise","resolve","elem","document","createElement","setAttribute","left","body","appendChild","selection","getSelection","selected","rangeCount","getRangeAt","select","execCommand","removeAllRanges","addRange","removeChild","Head","onCopyLink","onExit","onMessage","location","href","split","onConfirm","history","push","extractRoom","isRoomLoaded","isRoomLocked","createAction","openModal","prereq","popModal","confirmModal","question","onConfirmed","onCanceled","window","confirm","MESSAGE_ID_GENERATOR","displayMessage","text","duration","dispatch","stamp","Date","getTime","setTimeout","removeMessage","displayError","connect","message","Cover","playable","image","onPlay","onStop","backgroundImage","_Media","actions","mediaType","cover_small","link","target","rel","artist","picture_small","preview","QueueItem","locked","onRemove","Queue","loaded","playingIndex","onSearch","length","map","index","key","extractMedias","mediaAccesses","mediaAccess","config","appIDs","process","sleep","delay","onlyUnique","self","indexOf","getFromDictOrList","dict","list","getFromDict","find","item","getFromList","APPS","forEach","appId","databaseURL","app","firebase","database","members","ref","rooms","users","DEFAULT_APP","Object","values","FirebaseRoom","_room","child","_info","_members","_secret","_values","queue","queue_position","timestamp","getInfo","isLocked","setSecret","newSecret","oldSecret","wait","reject","once","snapshot","newValues","val","Error","subscribeInfo","cb","on","subscribeMembers","cbAdded","cbRemoved","unsubscribeInfo","off","unsubscribeMembers","update","set","ServerValue","TIMESTAMP","FirebaseUser","_user","_membership","online","room_id","status","installDisconnect","onDisconnect","cancel","enter","remove","exit","extractErrorMessage","response","data","loadMedias","provider","mediaIds","enqueue","getState","deezer","previewPlayer","oldTracks","newTrackIds","trackId","newTracks","loadTracks","appendInQueue","play","oldContainers","newContainerIds","containerId","newContainers","loadContainers","newContainersAndTracks","container","tracks","setRoom","createRoom","v4","enterRoom","FIREBASE_CB","exitRoom","newRoom","newInfo","entries","sort","media1","media2","Number","lockRoom","unlockRoom","clearQueue","trackIds","queueMedias","removeFromQueue","oldIndex","splice","setQueuePosition","newPosition","oldPosition","moveBackward","moveForward","CACHE","DEFAULT_COLOR","pickColor","url","jimp","resize","getPixelColor","pixel","setPlayer","startPlayer","queuePlayer","PLAYER_TIMER1","PLAYER_TIMER2","_installTimer1","_installTimer2","stopPlayer","_","clearTimeout","stop","stopPreview","_1","_2","_computeNextPosition","queueTrackPosition","nextPosition","playingTrackID","getPlayingTrackID","playingTrackPosition","getPlayingTrackPosition","isPlaying","nextTrackPosition","nextIndex","nextTrack","all","getPlayingTrackPercent","Progress","max","Controls","onMoveBackward","onMoveForward","onUnlock","tracksCount","onClear","onLock","Room","componentDidMount","onEnter","componentWillUnmount","backgroundColor","withRouter","ownProps","qs","search","substr","match","params","Splash","loggedIn","onCreateRoom","onConnectUser","to","src","height","alt","onDisconnectUser","extractUser","setUser","createUser","connectUser","disconnectUser","newUser","reconnectUser","Modal","children","renderFoot","onClose","onPop","has_prev_modal","onSubmit","hidden","event","preventDefault","FormModal","renderButtons","ConfirmModal","onCancel","ConnectUserModal","idRef","createRef","onConnect","htmlFor","placeholder","maxLength","minLength","required","onChange","e","setState","onToggle","onError","trim","current","focus","SecretField","label","display","flexDirection","justifyContent","flexGrow","marginRight","onCopyToClipboard","ROOM_COUNTER","CreateRoomModal","nameRef","onCreate","USER_COUNTER","CreateUserModal","ConvertAlbum","toString","picture_big","cover_big","readable","ConvertTrack","ConvertPlaylist","DEFAULT_API","_asyncJsonp","jsonp","_call","path","fullpath","_search","query","encodeURIComponent","_load","ids","_loadWithRetry","first","includes","subIds","subIndexes","subMedias","subIndex","_searchAlbums","_searchPlaylists","_searchTracks","public","loadAlbums","albums","loadPlaylists","playlists","creator","DeezerApi","MEDIA_TYPE_DEFINITIONS","SearchResultCategory","items","slice","SearchModal","queryRef","playingMediaId","playingMediaType","results","renderInputs","renderResults","onSelect","onStartPreview","onStopPreview","mediaId","UnlockRoomModal","secretRef","Modals","curr_prereq","prev_prereq","addEventListener","onKeyDown","removeEventListener","componentDidUpdate","prevProps","oldPrereq","newPrereq","modal","getModal","in","timeout","unmountOnExit","onClickOverlay","role","onClickWrapper","stopPropagation","onCloseModal","keyCode","Messages","renderMessage","extractMessages","m1","m2","App","onReconnect","exact","component","AUDIO_CONTEXT","getContext","AudioContext","webkitAudioContext","decodeAudioData","encodedBuffer","loadAudioBuffer","req","XMLHttpRequest","open","responseType","send","AUDIO_BUFFER_CACHES","loadAudioBufferWithCache","buffer","findIndex","fixAudioContext","context","createBuffer","source","createBufferSource","destination","start","Player","chainPlay","analyserNode","gainNode","_node","_buffer","_sourceNode","_sourceNodeStartTime","_trackId","_trackPosition","getOrCreateNode","createGain","gain","createAnalyser","fftSize","trackPosition","trackUrl","offset","loop","loopStart","loopEnd","onended","playbackRate","currentTime","splash","CGU","powered_with","errors","invalid","confirm_disconnect","connection","create","disconnect","user_creation","id_is_invalid","id_placeholder","user_id","name_is_invalid","name_placeholder","secret_is_invalid","secret_placeholder","clear","confirm_clear","confirm_exit","confirm_lock","copy_link","empty","key_placeholder","link_copied_to_clipboard","loading","name_placeholderl","room_creation","room_unlocking","unlock","unlocked","by","add","search_placeholder","medias_search","cannot_decode_audio_data","cannot_load_audio_buffer","backward","forward","secret_copied_to_clipboard","initLocales","navigator","language","userLanguage","i18next","use","initReactI18next","init","fallbackLng","lng","resources","en","translation","fr","interpolation","escapeValue","format","composeEnhancers","compose","store","createStore","applyMiddleware","thunk","withExtraArgument","then","ReactDOM","getElementById"],"mappings":"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","file":"static/js/main.03a8cd7a.chunk.js","sourcesContent":["import { Reducer } from \"redux\";\nimport { AxiosError } from \"axios\";\nimport { MediasAction } from \"../actions/medias\";\nimport { Track, Album, Playlist } from \"../utils/medias\";\n\n// ------------------------------------------------------------------\n\nexport type State = {\n\tfetching: boolean;\n\terror: null | AxiosError;\n\tmedias: {\n\t\t// keys are MediaType\n\t\talbum: { [id: string]: Album };\n\t\tplaylist: { [id: string]: Playlist };\n\t\ttrack: { [id: string]: Track };\n\t};\n};\n\nconst INITIAL_STATE: State = {\n\tfetching: false,\n\terror: null,\n\tmedias: {\n\t\t// keys are MediaType\n\t\talbum: {},\n\t\tplaylist: {},\n\t\ttrack: {}\n\t}\n};\n\n// ------------------------------------------------------------------\n\nexport const mediasReducer: Reducer<State, MediasAction> = (\n\tstate = INITIAL_STATE,\n\taction: MediasAction\n): State => {\n\tswitch (action.type) {\n\t\tcase \"medias/FETCHING\":\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tfetching: true,\n\t\t\t\terror: null\n\t\t\t};\n\t\tcase \"medias/FETCHED\": {\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tfetching: false,\n\t\t\t\terror: null\n\t\t\t};\n\t\t}\n\t\tcase \"medias/ERROR\":\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tfetching: false,\n\t\t\t\terror: action.payload\n\t\t\t};\n\t\tcase \"medias/SET\": {\n\t\t\tconst copy = {\n\t\t\t\t...state,\n\t\t\t\tmedias: {\n\t\t\t\t\talbum: { ...state.medias.album },\n\t\t\t\t\tplaylist: { ...state.medias.playlist },\n\t\t\t\t\ttrack: { ...state.medias.track }\n\t\t\t\t}\n\t\t\t};\n\t\t\tfor (const media of action.payload) {\n\t\t\t\tcopy.medias[media.type][media.id] = media;\n\t\t\t}\n\t\t\treturn copy;\n\t\t}\n\t\tcase \"medias/RESET\":\n\t\t\treturn INITIAL_STATE;\n\t\tdefault:\n\t\t\treturn state;\n\t}\n};\n","import { Reducer } from \"redux\";\nimport { MessagesAction } from \"../actions/messages\";\nimport { Message } from \"../utils/messages\";\n\n// ------------------------------------------------------------------\n\nexport type State = Message[];\n\nexport const INITIAL_STATE: State = [];\n\n// ------------------------------------------------------------------\n\nexport const messagesReducer: Reducer<State, MessagesAction> = (\n\tstate = INITIAL_STATE,\n\taction\n): State => {\n\tswitch (action.type) {\n\t\tcase \"message/ADD\":\n\t\t\treturn [action.payload, ...state];\n\t\tcase \"message/REMOVE\":\n\t\t\treturn state.filter(other => other.id !== action.payload);\n\t\tcase \"message/RESET\":\n\t\t\treturn INITIAL_STATE;\n\t\tdefault:\n\t\t\treturn state;\n\t}\n};\n","import { Reducer } from \"redux\";\nimport { ModalsAction, ModalPrereq } from \"../actions/modals\";\n\n// ------------------------------------------------------------------\n\nexport type ModalsState = {\n\tstack: ModalPrereq[];\n};\n\n// ------------------------------------------------------------------\n\nexport const initialState: ModalsState = {\n\tstack: []\n};\n\n// ------------------------------------------------------------------\n\nexport const modalsReducer: Reducer<ModalsState, ModalsAction> = (\n\tstate = initialState,\n\taction\n): ModalsState => {\n\tswitch (action.type) {\n\t\tcase \"modals/OPEN\":\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tstack: [action.payload]\n\t\t\t};\n\t\tcase \"modals/CLOSE\":\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tstack: []\n\t\t\t};\n\t\tcase \"modals/PUSH\":\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tstack: [...state.stack, action.payload]\n\t\t\t};\n\t\tcase \"modals/POP\":\n\t\t\tconst copy = [...state.stack];\n\t\t\tcopy.pop();\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tstack: copy\n\t\t\t};\n\t\tdefault:\n\t\t\treturn state;\n\t}\n};\n","import { Reducer } from \"redux\";\nimport { PlayerAction } from \"../actions/player\";\n\n// ------------------------------------------------------------------\n\nexport type State = {\n\tplaying: boolean;\n\ttrack_percent: number;\n};\n\nexport const INITIAL_STATE: State = {\n\tplaying: false,\n\ttrack_percent: 0\n};\n\n// ------------------------------------------------------------------\n\nexport const playerReducer: Reducer<State, PlayerAction> = (\n\tstate = INITIAL_STATE,\n\taction\n): State => {\n\tswitch (action.type) {\n\t\tcase \"player/SET\":\n\t\t\treturn { ...state, ...action.payload };\n\t\tcase \"player/RESET\":\n\t\t\treturn INITIAL_STATE;\n\t\tdefault:\n\t\t\treturn state;\n\t}\n};\n","import { Reducer } from \"redux\";\nimport { AxiosError } from \"axios\";\nimport { RoomAction } from \"../actions/room\";\nimport { RoomAccess, RoomInfo } from \"../utils/rooms\";\nimport { CombinedColor } from \"../utils/colorpicker\";\nimport { FirebaseRoom } from \"../utils/firebase\";\nimport { MediaAccess } from \"../utils/medias\";\n\n// ------------------------------------------------------------------\n\nexport type RoomData = {\n\troom: ReturnType<typeof FirebaseRoom> | null;\n\taccess: RoomAccess;\n\tcolor: CombinedColor;\n\tinfo: RoomInfo | null;\n\tmedias: MediaAccess[];\n\tplaying: boolean;\n\tposition: number;\n};\n\nexport type State = RoomData & {\n\tfetching: boolean;\n\terror: null | AxiosError;\n};\n\nconst INITIAL_STATE: State = {\n\tfetching: false,\n\terror: null,\n\troom: null,\n\taccess: { id: \"\", secret: \"\" },\n\tcolor: { fg: { r: 0, g: 0, b: 0 }, bg: { r: 255, g: 255, b: 255 } },\n\tinfo: null,\n\tmedias: [],\n\tplaying: false,\n\tposition: 0\n};\n\n// ------------------------------------------------------------------\n\nexport const roomReducer: Reducer<State, RoomAction> = (\n\tstate = INITIAL_STATE,\n\taction: RoomAction\n): State => {\n\tswitch (action.type) {\n\t\tcase \"room/FETCHING\":\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tfetching: true,\n\t\t\t\terror: null\n\t\t\t};\n\t\tcase \"room/FETCHED\": {\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tfetching: false,\n\t\t\t\terror: null\n\t\t\t};\n\t\t}\n\t\tcase \"room/ERROR\":\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tfetching: false,\n\t\t\t\terror: action.payload\n\t\t\t};\n\t\tcase \"room/SET\": {\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\t...action.payload\n\t\t\t};\n\t\t}\n\t\tcase \"room/RESET\":\n\t\t\treturn INITIAL_STATE;\n\t\tdefault:\n\t\t\treturn state;\n\t}\n};\n","import { Reducer } from \"redux\";\nimport { AxiosError } from \"axios\";\nimport { UserAction } from \"../actions/user\";\nimport {\n\tdeleteUserAccess,\n\tsaveUserAccess,\n\tloadUserAccess,\n\tUserAccess,\n\tUserInfo\n} from \"../utils/users\";\nimport { FirebaseUser } from \"../utils/firebase\";\n\n// ------------------------------------------------------------------\n\nexport type UserData = {\n\tuser: ReturnType<typeof FirebaseUser> | null;\n\taccess: UserAccess;\n\tinfo: UserInfo | null;\n};\n\nexport type State = UserData & {\n\tfetching: boolean;\n\terror: null | AxiosError;\n};\n\nconst INITIAL_STATE: State = {\n\tfetching: false,\n\terror: null,\n\tuser: null,\n\taccess: loadUserAccess(),\n\tinfo: null\n};\n\n// ------------------------------------------------------------------\n\nexport const userReducer: Reducer<State, UserAction> = (\n\tstate = INITIAL_STATE,\n\taction: UserAction\n): State => {\n\tswitch (action.type) {\n\t\tcase \"user/FETCHING\":\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tfetching: true,\n\t\t\t\terror: null\n\t\t\t};\n\t\tcase \"user/FETCHED\": {\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tfetching: false,\n\t\t\t\terror: null\n\t\t\t};\n\t\t}\n\t\tcase \"user/ERROR\":\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tfetching: false,\n\t\t\t\terror: action.payload\n\t\t\t};\n\t\tcase \"user/SET\": {\n\t\t\tconst copy = {\n\t\t\t\t...state,\n\t\t\t\t...action.payload\n\t\t\t};\n\t\t\tsaveUserAccess(copy.access);\n\t\t\treturn copy;\n\t\t}\n\t\tcase \"user/RESET\":\n\t\t\tdeleteUserAccess();\n\t\t\treturn INITIAL_STATE;\n\t\tdefault:\n\t\t\treturn state;\n\t}\n};\n","export type UserInfo = {\n\tname: string;\n\tonline: boolean;\n\troom_id: string;\n\tstatus: string;\n\ttimestamp: number;\n};\n\nexport type UserAccess = {\n\tid: string;\n\tsecret: string;\n};\n\n// ------------------------------------------------------------------\n\nexport const loadUserAccess = (): UserAccess => {\n\tconst res: UserAccess = {\n\t\tid: \"\",\n\t\tsecret: \"\"\n\t};\n\tconst s = localStorage.getItem(\"U\");\n\tif (s) {\n\t\ttry {\n\t\t\tconst d = JSON.parse(atob(s));\n\t\t\tif (typeof d.i === \"string\" && typeof d.s === \"string\") {\n\t\t\t\tres.id = d.i;\n\t\t\t\tres.secret = d.s;\n\t\t\t\tconsole.debug(\"Loaded user access: \", res);\n\t\t\t}\n\t\t} catch (err) {}\n\t}\n\treturn res;\n};\n\nexport const deleteUserAccess = () => {\n\tlocalStorage.removeItem(\"U\");\n};\n\nexport const saveUserAccess = ({ id, secret }: UserAccess) => {\n\tlocalStorage.setItem(\n\t\t\"U\",\n\t\tbtoa(\n\t\t\tJSON.stringify({\n\t\t\t\ti: id,\n\t\t\t\ts: secret\n\t\t\t})\n\t\t)\n\t);\n};\n","import { combineReducers } from \"redux\";\nimport { mediasReducer as medias } from \"./medias\";\nimport { messagesReducer as messages } from \"./messages\";\nimport { modalsReducer as modals } from \"./modals\";\nimport { playerReducer as player } from \"./player\";\nimport { roomReducer as room } from \"./room\";\nimport { userReducer as user } from \"./user\";\n\nexport type RootState = ReturnType<typeof rootReducer>;\n\nexport const rootReducer = combineReducers({\n\tmedias,\n\tmessages,\n\tmodals,\n\tplayer,\n\troom,\n\tuser\n});\n","import React, { Component } from \"react\";\nimport FontAwesome from \"react-fontawesome\";\nimport classNames from \"classnames\";\n//\nimport \"./Icon.scss\";\n\n// ------------------------------------------------------------------\n\nexport type Props = {\n\tclassName?: string;\n\tcolor?: string;\n\ticon: string;\n\tsize?: \"S\" | \"M\" | \"L\";\n\ttitle?: string;\n};\n\nclass Icon extends Component<Props> {\n\tpublic render = () => {\n\t\tconst { className, color, icon, size = \"M\", title } = this.props;\n\t\treturn (\n\t\t\t<FontAwesome\n\t\t\t\tclassName={classNames(\"Icon\", className, size)}\n\t\t\t\tname={icon}\n\t\t\t\tstyle={{ color }}\n\t\t\t\ttitle={title}\n\t\t\t/>\n\t\t);\n\t};\n}\n\nexport default Icon;\n\n// ------------------------------------------------------------------\n\nexport const LoadingIcon = ({ size }: { size?: \"S\" | \"M\" | \"L\" }) => (\n\t<Icon\n\t\tclassName=\"rotating\"\n\t\ticon=\"circle-o-notch\"\n\t\tsize={size}\n\t\ttitle=\"Loading\"\n\t/>\n);\n","import React, { Component } from \"react\";\nimport { withTranslation, WithTranslation } from \"react-i18next\";\nimport classNames from \"classnames\";\n//\nimport Icon from \"./Icon\";\nimport \"./IconButton.scss\";\n\n// ------------------------------------------------------------------\n\ntype ButtonType = \"button\" | \"submit\";\n\nexport type Props = {\n\tclassName?: string;\n\tcolor?: string;\n\tdisabled?: boolean;\n\tdisplayTitle?: boolean;\n\ticon: string;\n\tkind?: \"default\" | \"primary\" | \"danger\" | \"special\";\n\tonClick?: () => void;\n\tsize?: \"S\" | \"M\" | \"L\";\n\ttitle: string;\n\ttype?: ButtonType;\n};\n\nclass IconButton extends Component<Props> {\n\tpublic render = () => {\n\t\tconst {\n\t\t\tclassName,\n\t\t\tcolor,\n\t\t\tdisabled = false,\n\t\t\tdisplayTitle = false,\n\t\t\ticon,\n\t\t\tkind = \"default\",\n\t\t\tonClick,\n\t\t\tsize,\n\t\t\ttitle,\n\t\t\ttype = \"button\"\n\t\t} = this.props;\n\t\treturn (\n\t\t\t<button\n\t\t\t\ttype={type}\n\t\t\t\taria-label={title}\n\t\t\t\tclassName={classNames(\"IconButton\", className, kind, size, {\n\t\t\t\t\tclickable: !disabled && (!!onClick || type === \"submit\")\n\t\t\t\t})}\n\t\t\t\tonClick={disabled ? void 0 : onClick}\n\t\t\t\ttitle={title}>\n\t\t\t\t<Icon color={color} icon={icon} size={size} />\n\t\t\t\t{displayTitle && (\n\t\t\t\t\t<div className={classNames(\"IconButtonTitle\", size)}>\n\t\t\t\t\t\t{title}\n\t\t\t\t\t</div>\n\t\t\t\t)}\n\t\t\t</button>\n\t\t);\n\t};\n}\n\nexport default IconButton;\n\n// ------------------------------------------------------------------\n\ntype CancelButtonProps = {\n\tonClick: () => void;\n};\n\nclass _CancelButton extends Component<CancelButtonProps & WithTranslation> {\n\tpublic render = () => {\n\t\tconst { onClick, t } = this.props;\n\t\treturn (\n\t\t\t<IconButton\n\t\t\t\tonClick={onClick}\n\t\t\t\ttitle={t(\"cancel\")}\n\t\t\t\tkind=\"default\"\n\t\t\t\ticon=\"ban\"\n\t\t\t/>\n\t\t);\n\t};\n}\n\nexport const CancelButton = withTranslation()(_CancelButton);\n","import { createHashHistory } from \"history\";\n\nexport default createHashHistory();\n","// https://hackernoon.com/copying-text-to-clipboard-with-javascript-df4d4988697f\nexport const copyToClipboard = async (value: string): Promise<void> =>\n\tawait new Promise(resolve => {\n\t\tconst elem = document.createElement(\"textarea\");\n\t\telem.value = value;\n\t\telem.setAttribute(\"readonly\", \"\");\n\t\telem.style.position = \"absolute\";\n\t\telem.style.left = \"-9999px\";\n\n\t\tdocument.body.appendChild(elem);\n\t\tconst selection = document.getSelection();\n\t\tif (selection !== null) {\n\t\t\tconst selected =\n\t\t\t\tselection.rangeCount > 0 ? selection.getRangeAt(0) : false;\n\t\t\telem.select();\n\t\t\tdocument.execCommand(\"copy\");\n\t\t\tif (selected !== false) {\n\t\t\t\tselection.removeAllRanges();\n\t\t\t\tselection.addRange(selected);\n\t\t\t}\n\t\t}\n\t\tdocument.body.removeChild(elem);\n\t\tresolve();\n\t});\n","import React, { Component } from \"react\";\nimport { withTranslation, WithTranslation } from \"react-i18next\";\n//\nimport IconButton from \"../Common/IconButton\";\nimport { MappedProps } from \"../../containers/Room/Head\";\nimport history from \"../../utils/history\";\nimport { copyToClipboard } from \"../../utils/clipboard\";\nimport \"./Head.scss\";\n\n// ------------------------------------------------------------------\n\nclass Head extends Component<MappedProps & WithTranslation> {\n\tpublic render = () => {\n\t\tconst { room, t } = this.props;\n\t\treturn (\n\t\t\t<div className=\"Head\">\n\t\t\t\t<div className=\"RoomLink\">\n\t\t\t\t\t<IconButton\n\t\t\t\t\t\ticon=\"link\"\n\t\t\t\t\t\tonClick={this.onCopyLink}\n\t\t\t\t\t\tsize=\"M\"\n\t\t\t\t\t\ttitle={t(\"rooms.copy_link\")}\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div className=\"RoomName\">{room ? room.name : \"\"}</div>\n\t\t\t\t<div className=\"RoomExit\">\n\t\t\t\t\t<IconButton\n\t\t\t\t\t\tonClick={this.onExit}\n\t\t\t\t\t\ticon=\"sign-out\"\n\t\t\t\t\t\tsize=\"M\"\n\t\t\t\t\t\ttitle={t(\"rooms.exit\")}\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t);\n\t};\n\n\tprivate onCopyLink = async () => {\n\t\tconst { onMessage, t } = this.props;\n\t\tawait copyToClipboard(document.location.href.split(\"?\")[0]);\n\t\tonMessage(t(\"rooms.link_copied_to_clipboard\"));\n\t};\n\n\tprivate onExit = () => {\n\t\tconst { onConfirm, t } = this.props;\n\t\tonConfirm(t(\"rooms.confirm_exit\"), () => {\n\t\t\thistory.push(\"/\");\n\t\t});\n\t};\n}\n\nexport default withTranslation()(Head);\n","import { RootState } from \"../reducers\";\n\nexport const extractRoom = (state: RootState) => state.room.info;\n\nexport const isRoomLoaded = (state: RootState) => !!state.room.room;\n\nexport const isRoomLocked = (state: RootState) => !state.room.access.secret;\n","import { AnyAction } from \"redux\";\nimport { ThunkAction, ThunkDispatch } from \"redux-thunk\";\n//\nimport { RootState } from \"../reducers\";\nimport { Player } from \"../utils/player\";\nimport { DeezerApi } from \"../utils/deezer\";\n\n// ------------------------------------------------------------------\n\nexport type Action<T extends string> = {\n\ttype: T;\n};\n\nexport type ActionWithPayload<T extends string, P> = {\n\ttype: T;\n\tpayload: P;\n};\n\nexport type Extended = {\n\tdeezer: ReturnType<typeof DeezerApi>;\n\tpreviewPlayer: ReturnType<typeof Player>;\n\tqueuePlayer: ReturnType<typeof Player>;\n};\n\nexport type Dispatch = ThunkDispatch<RootState, Extended, AnyAction>;\n\nexport type AsyncAction = ThunkAction<void, RootState, Extended, AnyAction>;\n\nexport function createAction<T extends string>(type: T): Action<T>;\n\nexport function createAction<T extends string, P>(\n\ttype: T,\n\tpayload: P\n): ActionWithPayload<T, P>;\n\nexport function createAction<T extends string, P>(type: T, payload?: P) {\n\treturn payload === void 0 ? { type } : { type, payload };\n}\n","import { createAction, AsyncAction } from \".\";\nimport { ConfirmModalProps } from \"../components/Modals/ConfirmModal\";\n\n// ------------------------------------------------------------------\n\nexport type ModalPrereqT<T extends string, P> = {\n\ttype: T;\n\tprops: P;\n};\n\nexport type ModalPrereq =\n\t| ModalPrereqT<\"Confirm\", ConfirmModalProps>\n\t| ModalPrereqT<\"ConnectUser\", null>\n\t| ModalPrereqT<\"CreateRoom\", null>\n\t| ModalPrereqT<\"CreateUser\", null>\n\t| ModalPrereqT<\"Search\", null>\n\t| ModalPrereqT<\"UnlockRoom\", null>;\n\n// ------------------------------------------------------------------\n\nexport type ModalsAction =\n\t| ReturnType<typeof closeModal>\n\t| ReturnType<typeof openModal>\n\t| ReturnType<typeof popModal>\n\t| ReturnType<typeof pushModal>;\n\n// ------------------------------------------------------------------\n\nexport const openModal = (prereq: ModalPrereq) =>\n\tcreateAction(\"modals/OPEN\", prereq);\n\nexport const closeModal = () => createAction(\"modals/CLOSE\");\n\n// ------------------------------------------------------------------\n\nexport const pushModal = (prereq: ModalPrereq) =>\n\tcreateAction(\"modals/PUSH\", prereq);\n\nexport const popModal = () => createAction(\"modals/POP\");\n\n// ------------------------------------------------------------------\n\nexport const confirmModal = (\n\tquestion: string,\n\tonConfirmed: () => void,\n\tonCanceled?: () => void\n): AsyncAction => async () => {\n\t// TODO: open custom ConfirmModal instead of system popup\n\tif (window.confirm(question)) {\n\t\tonConfirmed();\n\t} else if (onCanceled) {\n\t\tonCanceled();\n\t}\n};\n","import { createAction, AsyncAction } from \".\";\nimport { Message, MessageType } from \"../utils/messages\";\n\n// ------------------------------------------------------------------\n\nexport type MessagesAction =\n\t| ReturnType<typeof addMessage>\n\t| ReturnType<typeof clearMessages>\n\t| ReturnType<typeof removeMessage>;\n\nconst addMessage = (message: Message) => createAction(\"message/ADD\", message);\n\nconst removeMessage = (id: number) => createAction(\"message/REMOVE\", id);\n\nconst clearMessages = () => createAction(\"message/RESET\");\n\n// ------------------------------------------------------------------\n\nlet MESSAGE_ID_GENERATOR: number = 0;\n\nexport const displayMessage = (\n\ttype: MessageType,\n\ttext: string,\n\tduration: number = 5000\n): AsyncAction => (dispatch): any => {\n\tconst id = MESSAGE_ID_GENERATOR++;\n\tdispatch(addMessage({ id, stamp: new Date().getTime(), text, type }));\n\tsetTimeout(() => dispatch(removeMessage(id)), duration);\n};\n\nexport const displayError = (text: string): AsyncAction => (dispatch): any => {\n\tdispatch(displayMessage(\"error\", text, 3000));\n};\n\nexport const displayInfo = (text: string) => displayMessage(\"info\", text, 3000);\n","import { connect } from \"react-redux\";\nimport { ThunkDispatch } from \"redux-thunk\";\n//\nimport { RootState } from \"../../reducers\";\nimport Head from \"../../components/Room/Head\";\nimport { extractRoom } from \"../../selectors/room\";\nimport { confirmModal } from \"../../actions/modals\";\nimport { displayMessage } from \"../../actions/messages\";\n\n// ------------------------------------------------------------------\n\nconst stateToProps = (state: RootState) => ({\n\troom: extractRoom(state)\n});\n\nconst dispatchToProps = (dispatch: ThunkDispatch<RootState, any, any>) => ({\n\tonConfirm: (question: string, onConfirmed: () => void) => {\n\t\tdispatch(confirmModal(question, onConfirmed));\n\t},\n\tonMessage: (message: string) => dispatch(displayMessage(\"info\", message))\n});\n\nexport type MappedProps = ReturnType<typeof stateToProps> &\n\tReturnType<typeof dispatchToProps>;\n\nexport default connect(stateToProps, dispatchToProps)(Head);\n","import React, { Component } from \"react\";\nimport { withTranslation, WithTranslation } from \"react-i18next\";\nimport classNames from \"classnames\";\n//\nimport Icon from \"../Common/Icon\";\nimport \"./Cover.scss\";\n\n// ------------------------------------------------------------------\n\ntype Props = {\n\timage: string;\n\tonPlay: () => void;\n\tonStop: () => void;\n\tplayable: boolean;\n\tplaying: boolean;\n};\n\nclass Cover extends Component<Props & WithTranslation> {\n\tpublic render = () => {\n\t\tconst { playable, playing, image, onPlay, onStop, t } = this.props;\n\t\tif (playable) {\n\t\t\treturn (\n\t\t\t\t<div\n\t\t\t\t\tclassName={classNames(\"Cover\", { playable, playing })}\n\t\t\t\t\tstyle={image ? { backgroundImage: `url('${image}')` } : {}}\n\t\t\t\t\tonClick={!playing ? onPlay : onStop}>\n\t\t\t\t\t{!playing ? (\n\t\t\t\t\t\t<Icon icon=\"play\" title={t(\"player.play\")} />\n\t\t\t\t\t) : (\n\t\t\t\t\t\t<Icon icon=\"pause\" title={t(\"player.stop\")} />\n\t\t\t\t\t)}\n\t\t\t\t</div>\n\t\t\t);\n\t\t} else {\n\t\t\treturn (\n\t\t\t\t<div\n\t\t\t\t\tclassName={classNames(\"Cover\", { playing })}\n\t\t\t\t\tstyle={image ? { backgroundImage: `url('${image}')` } : {}}>\n\t\t\t\t\t{playing ? (\n\t\t\t\t\t\t<Icon icon=\"music\" title={t(\"player.playing\")} />\n\t\t\t\t\t) : null}\n\t\t\t\t</div>\n\t\t\t);\n\t\t}\n\t};\n}\n\nexport default withTranslation()(Cover);\n","import React, { ReactNode, Component } from \"react\";\nimport { withTranslation, WithTranslation } from \"react-i18next\";\n//\nimport Cover from \"./Cover\";\nimport { LoadingIcon } from \"../Common/Icon\";\nimport {\n\tAlbum,\n\tPlaylist,\n\tTrack,\n\tMedia as MediaData,\n\tMediaType\n} from \"../../utils/medias\";\nimport \"./Medias.scss\";\n\n// ------------------------------------------------------------------\n\ntype MediaProps = {\n\tactions?: ReactNode;\n\tmedia: MediaData | null;\n\tmediaType: MediaType;\n\tplayable: boolean;\n\tplaying: boolean;\n\tonPlay: () => void;\n\tonStop: () => void;\n};\n\n// ------------------------------------------------------------------\n\nclass _Media extends Component<MediaProps & WithTranslation> {\n\tpublic render = () => {\n\t\tconst {\n\t\t\tactions,\n\t\t\tmedia,\n\t\t\tmediaType,\n\t\t\tplayable,\n\t\t\tplaying,\n\t\t\tonPlay,\n\t\t\tonStop,\n\t\t\tt\n\t\t} = this.props;\n\t\tif (!media) {\n\t\t\treturn (\n\t\t\t\t<div className=\"Media\">\n\t\t\t\t\t{actions}\n\t\t\t\t\t<Cover\n\t\t\t\t\t\tplayable={playable}\n\t\t\t\t\t\tplaying={playing}\n\t\t\t\t\t\timage={\"\"}\n\t\t\t\t\t\tonPlay={onPlay}\n\t\t\t\t\t\tonStop={onStop}\n\t\t\t\t\t/>\n\t\t\t\t\t<div className=\"Metas\">\n\t\t\t\t\t\t<LoadingIcon size=\"M\" />\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t);\n\t\t} else if (mediaType === \"album\") {\n\t\t\tconst album = media as Album;\n\t\t\treturn (\n\t\t\t\t<div className=\"Media Album\">\n\t\t\t\t\t{actions}\n\t\t\t\t\t<Cover\n\t\t\t\t\t\tplayable={playable}\n\t\t\t\t\t\tplaying={playing}\n\t\t\t\t\t\timage={album.cover_small}\n\t\t\t\t\t\tonPlay={onPlay}\n\t\t\t\t\t\tonStop={onStop}\n\t\t\t\t\t/>\n\t\t\t\t\t<div className=\"Metas\">\n\t\t\t\t\t\t<div className=\"Meta AlbumTitle\">\n\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\thref={album.link}\n\t\t\t\t\t\t\t\ttarget=\"_blank\"\n\t\t\t\t\t\t\t\trel=\"noopener noreferrer\">\n\t\t\t\t\t\t\t\t{album.title}\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className=\"Meta AlbumArtist\">\n\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\thref={album.artist.link}\n\t\t\t\t\t\t\t\ttarget=\"_blank\"\n\t\t\t\t\t\t\t\trel=\"noopener noreferrer\">\n\t\t\t\t\t\t\t\t{t(\"medias.by\", { artist: album.artist.name })}\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t);\n\t\t} else if (mediaType === \"playlist\") {\n\t\t\tconst playlist = media as Playlist;\n\t\t\treturn (\n\t\t\t\t<div className=\"Media Playlist\">\n\t\t\t\t\t{actions}\n\t\t\t\t\t<Cover\n\t\t\t\t\t\tplayable={playable}\n\t\t\t\t\t\tplaying={playing}\n\t\t\t\t\t\timage={playlist.picture_small}\n\t\t\t\t\t\tonPlay={onPlay}\n\t\t\t\t\t\tonStop={onStop}\n\t\t\t\t\t/>\n\t\t\t\t\t<div className=\"Metas\">\n\t\t\t\t\t\t<div className=\"Meta PlaylistTitle\">\n\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\thref={media.link}\n\t\t\t\t\t\t\t\ttarget=\"_blank\"\n\t\t\t\t\t\t\t\trel=\"noopener noreferrer\">\n\t\t\t\t\t\t\t\t{media.title}\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className=\"Meta PlaylistCreator\">\n\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\thref={playlist.user.link}\n\t\t\t\t\t\t\t\ttarget=\"_blank\"\n\t\t\t\t\t\t\t\trel=\"noopener noreferrer\">\n\t\t\t\t\t\t\t\t{t(\"medias.by\", { artist: playlist.user.name })}\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t);\n\t\t} else if (mediaType === \"track\") {\n\t\t\tconst track = media as Track;\n\t\t\treturn (\n\t\t\t\t<div className=\"Media Track\">\n\t\t\t\t\t{actions}\n\t\t\t\t\t<Cover\n\t\t\t\t\t\tplayable={playable && !!track.preview}\n\t\t\t\t\t\tplaying={playing}\n\t\t\t\t\t\timage={track.album.cover_small}\n\t\t\t\t\t\tonPlay={onPlay}\n\t\t\t\t\t\tonStop={onStop}\n\t\t\t\t\t/>\n\t\t\t\t\t<div className=\"Metas\">\n\t\t\t\t\t\t<div className=\"Meta TrackTitle\">\n\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\thref={track.link}\n\t\t\t\t\t\t\t\ttarget=\"_blank\"\n\t\t\t\t\t\t\t\trel=\"noopener noreferrer\">\n\t\t\t\t\t\t\t\t{track.title}\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className=\"Meta TrackArtist\">\n\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\thref={track.artist.link}\n\t\t\t\t\t\t\t\ttarget=\"_blank\"\n\t\t\t\t\t\t\t\trel=\"noopener noreferrer\">\n\t\t\t\t\t\t\t\t{t(\"medias.by\", { artist: track.artist.name })}\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t);\n\t\t}\n\t};\n}\n\nexport default withTranslation()(_Media);\n","import React, { Component } from \"react\";\nimport { withTranslation, WithTranslation } from \"react-i18next\";\n//\nimport Media from \"./Medias\";\nimport IconButton from \"../Common/IconButton\";\nimport { Media as MediaData, MediaType } from \"../../utils/medias\";\n\n// ------------------------------------------------------------------\n\ntype Props = {\n\tlocked: boolean;\n\tmedia: MediaData | null; // if null : stiil loading or cannot be loaded or to reload later because of rate limit\n\tmediaType: MediaType;\n\tplaying: boolean;\n\tonPlay: () => void;\n\tonRemove: () => void;\n\tonStop: () => void;\n};\n\nclass QueueItem extends Component<Props & WithTranslation> {\n\tpublic render = () => {\n\t\tconst {\n\t\t\tlocked,\n\t\t\tmedia,\n\t\t\tmediaType,\n\t\t\tplaying,\n\t\t\tonPlay,\n\t\t\tonRemove,\n\t\t\tonStop,\n\t\t\tt\n\t\t} = this.props;\n\t\treturn (\n\t\t\t<div className=\"QueueItem\">\n\t\t\t\t<Media\n\t\t\t\t\tmedia={media}\n\t\t\t\t\tmediaType={mediaType}\n\t\t\t\t\tplayable={!!media && !locked}\n\t\t\t\t\tplaying={playing}\n\t\t\t\t\tonPlay={onPlay}\n\t\t\t\t\tonStop={onStop}\n\t\t\t\t\tactions={\n\t\t\t\t\t\t!locked ? (\n\t\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\t\ttitle={t(\"medias.remove\")}\n\t\t\t\t\t\t\t\ticon=\"trash\"\n\t\t\t\t\t\t\t\tonClick={onRemove}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t) : null\n\t\t\t\t\t}\n\t\t\t\t/>\n\t\t\t</div>\n\t\t);\n\t};\n}\n\nexport default withTranslation()(QueueItem);\n","import React, { Component } from \"react\";\nimport { withTranslation, WithTranslation } from \"react-i18next\";\n//\nimport { MappedProps } from \"../../containers/Room/Queue\";\nimport IconButton from \"../Common/IconButton\";\nimport { LoadingIcon } from \"../Common/Icon\";\nimport QueueItem from \"./QueueItem\";\nimport \"./Queue.scss\";\n\n// ------------------------------------------------------------------\n\nclass Queue extends Component<MappedProps & WithTranslation> {\n\tpublic render = () => {\n\t\tconst {\n\t\t\tloaded,\n\t\t\tlocked,\n\t\t\tmedias,\n\t\t\tplaying,\n\t\t\tplayingIndex,\n\t\t\tonPlay,\n\t\t\tonRemove,\n\t\t\tonSearch,\n\t\t\tonStop,\n\t\t\tt\n\t\t} = this.props;\n\t\treturn (\n\t\t\t<div className=\"Queue\">\n\t\t\t\t{medias.length > 0 ? (\n\t\t\t\t\tmedias.map((media, index) => (\n\t\t\t\t\t\t<QueueItem\n\t\t\t\t\t\t\tkey={index}\n\t\t\t\t\t\t\tlocked={locked}\n\t\t\t\t\t\t\tplaying={playing && playingIndex === index}\n\t\t\t\t\t\t\tmedia={media}\n\t\t\t\t\t\t\tmediaType=\"track\"\n\t\t\t\t\t\t\tonPlay={() => onPlay(index)}\n\t\t\t\t\t\t\tonRemove={() => onRemove(index)}\n\t\t\t\t\t\t\tonStop={onStop}\n\t\t\t\t\t\t/>\n\t\t\t\t\t))\n\t\t\t\t) : (\n\t\t\t\t\t<div className=\"QueueEmpty\">\n\t\t\t\t\t\t{loaded ? (\n\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\t\t\ttitle=\"...\"\n\t\t\t\t\t\t\t\t\ticon=\"shower\"\n\t\t\t\t\t\t\t\t\tonClick={onSearch}\n\t\t\t\t\t\t\t\t\tsize=\"L\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t<span onClick={onSearch}>\n\t\t\t\t\t\t\t\t\t{t(\"rooms.empty\")}\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t<LoadingIcon size=\"L\" />\n\t\t\t\t\t\t\t\t<span>{t(\"rooms.loading\")}</span>\n\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</div>\n\t\t\t\t)}\n\t\t\t</div>\n\t\t);\n\t};\n}\n\nexport default withTranslation()(Queue);\n","import { RootState } from \"../reducers\";\nimport { Media, MediaAccess } from \"../utils/medias\";\n\n// ------------------------------------------------------------------\n\nexport const extractMedias = (\n\tstate: RootState,\n\tmediaAccesses: MediaAccess[]\n) => {\n\tconst res: Array<Media | null> = [];\n\tconst {\n\t\tmedias: { medias }\n\t} = state;\n\tfor (const mediaAccess of mediaAccesses) {\n\t\tconst media = medias[mediaAccess.type][mediaAccess.id];\n\t\tif (!!media) {\n\t\t\tres.push(media);\n\t\t} else {\n\t\t\tres.push(null); // Stiil loading or cannot be loaded or to reload later because of rate limit\n\t\t}\n\t}\n\treturn res;\n};\n","const config = {\n\tappIDs: (process.env.REACT_APP_DATABASE_ID || \"\").split(\"|\")\n};\n\nconsole.debug(config);\n\nexport default config;\n","export const sleep = (delay: number) =>\n\tnew Promise(resolve => setTimeout(resolve, delay));\n\nexport const onlyUnique = <T>(value: T, index: number, self: T[]) =>\n\tself.indexOf(value) === index;\n\nexport const getFromDict = <T>(dict: { [id: string]: T }, id: string) => {\n\tconst value = dict[id];\n\treturn !value ? void 0 : value;\n};\n\nexport const getFromList = <T extends { id: string }>(\n\tlist: T[],\n\tid: string\n) => {\n\treturn list.find(item => item.id === id);\n};\n\nexport const getFromDictOrList = <T extends { id: string }>(\n\tdict: { [id: string]: T },\n\tlist: T[],\n\tid: string\n) => getFromDict(dict, id) || getFromList(list, id);\n","import * as firebase from \"firebase/app\";\nimport \"firebase/database\";\n//\nimport firebaseConfig from \"../config/firebase\";\nimport { RoomInfo } from \"./rooms\";\nimport { UserInfo } from \"./users\";\nimport { sleep } from \".\";\n\n// ------------------------------------------------------------------\n\ntype FirebaseCB = (eventType: firebase.database.DataSnapshot) => void;\n\n// ------------------------------------------------------------------\n\nconst APPS: {\n\t[id: string]: {\n\t\tapp: firebase.app.App;\n\t\tdatabase: firebase.database.Database;\n\t\tmembers: firebase.database.Reference;\n\t\trooms: firebase.database.Reference;\n\t\tusers: firebase.database.Reference;\n\t};\n} = {};\n\nfirebaseConfig.appIDs.forEach(appId => {\n\tconst databaseURL = `https://${appId}.firebaseio.com`;\n\tconst app = firebase.initializeApp({ databaseURL });\n\tconst database = firebase.database(app);\n\tAPPS[appId] = {\n\t\tapp,\n\t\tdatabase,\n\t\tmembers: database.ref(\"members\"),\n\t\trooms: database.ref(\"rooms\"),\n\t\tusers: database.ref(\"users\")\n\t};\n});\n\nconst DEFAULT_APP = Object.values(APPS)[0];\n\n// ------------------------------------------------------------------\n\nexport const FirebaseRoom = (id: string, secret?: string) => {\n\tconst _room = DEFAULT_APP.rooms.child(id);\n\tconst _info = _room.child(\"info\");\n\tconst _members = DEFAULT_APP.members.child(id);\n\tlet _secret = secret || \"\";\n\tconsole.debug(\"INIT SECRET\", _secret);\n\tlet _values: RoomInfo = {\n\t\tname: \"dummy\",\n\t\tplaying: false,\n\t\tqueue: {},\n\t\tqueue_position: 0,\n\t\ttimestamp: 0,\n\t\ttype: \"dj\"\n\t};\n\n\tconst getInfo = () => _values;\n\n\tconst isLocked = () => !_secret;\n\n\tconst setSecret = (newSecret: string) => {\n\t\tconsole.debug(\"[Firebase] Setting room secret\", {\n\t\t\toldSecret: _secret,\n\t\t\tnewSecret\n\t\t});\n\t\t_secret = newSecret;\n\t};\n\n\tconst wait = async (): Promise<RoomInfo> =>\n\t\tnew Promise((resolve, reject) => {\n\t\t\tconsole.debug(\"[Firebase] Waiting room...\");\n\t\t\t_info.once(\"value\", snapshot => {\n\t\t\t\tconst newValues = snapshot.val();\n\t\t\t\tif (newValues) {\n\t\t\t\t\t_values = newValues;\n\t\t\t\t\tresolve(_values);\n\t\t\t\t} else {\n\t\t\t\t\treject(new Error(\"rooms.errors.invalid\"));\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\tconst subscribeInfo = (cb: FirebaseCB) => {\n\t\tconsole.debug(\"[Firebase] Subscribing room...\");\n\t\t_info.on(\"value\", cb);\n\t};\n\n\tconst unsubscribeInfo = (cb: FirebaseCB) => {\n\t\tconsole.debug(\"[Firebase] Unsubscribing room...\");\n\t\t_info.off(\"value\", cb);\n\t};\n\n\tconst subscribeMembers = (cbAdded: FirebaseCB, cbRemoved: FirebaseCB) => {\n\t\tconsole.debug(\"[Firebase] Subscribing members...\");\n\t\t_members.on(\"child_added\", cbAdded);\n\t\t_members.on(\"child_removed\", cbRemoved);\n\t};\n\n\tconst unsubscribeMembers = (cbAdded: FirebaseCB, cbRemoved: FirebaseCB) => {\n\t\tconsole.debug(\"[Firebase] Unsubscribing members...\");\n\t\t_members.off(\"child_added\", cbAdded);\n\t\t_members.off(\"child_removed\", cbRemoved);\n\t};\n\n\tconst update = async ({\n\t\tname,\n\t\tplaying,\n\t\tqueue,\n\t\tqueue_position\n\t}: Partial<\n\t\tPick<RoomInfo, \"name\" | \"playing\" | \"queue\" | \"queue_position\">\n\t>) => {\n\t\tconsole.debug(\"[Firebase] Updating room...\", {\n\t\t\tname,\n\t\t\tplaying,\n\t\t\tqueue,\n\t\t\tqueue_position\n\t\t});\n\t\tif (name !== void 0) {\n\t\t\t_values.name = name;\n\t\t}\n\t\tif (playing !== void 0) {\n\t\t\t_values.playing = playing;\n\t\t}\n\t\tif (queue !== void 0) {\n\t\t\t_values.queue = queue;\n\t\t}\n\t\tif (queue_position !== void 0) {\n\t\t\t_values.queue_position = queue_position;\n\t\t}\n\t\tawait _room.set({\n\t\t\tinfo: {\n\t\t\t\t..._values,\n\t\t\t\ttimestamp: firebase.database.ServerValue.TIMESTAMP\n\t\t\t},\n\t\t\tsecret: _secret\n\t\t});\n\t};\n\n\treturn {\n\t\tgetInfo,\n\t\tid,\n\t\tisLocked,\n\t\tsetSecret,\n\t\twait,\n\t\tsubscribeInfo,\n\t\tsubscribeMembers,\n\t\tunsubscribeInfo,\n\t\tunsubscribeMembers,\n\t\tupdate\n\t};\n};\n\n// ------------------------------------------------------------------\n\nexport const FirebaseUser = (id: string, secret?: string) => {\n\tconst _user = DEFAULT_APP.users.child(id);\n\tconst _info = _user.child(\"info\");\n\tlet _membership: firebase.database.Reference | null = null;\n\tlet _secret = secret || \"\";\n\tlet _values: UserInfo = {\n\t\tname: \"dummy\",\n\t\tonline: false,\n\t\troom_id: \"\",\n\t\tstatus: \"\",\n\t\ttimestamp: 0\n\t};\n\n\tconst getInfo = () => _values;\n\n\tconst isLocked = () => !_secret;\n\n\tconst setSecret = (newSecret: string) => {\n\t\tconsole.debug(\"[Firebase] Setting user secret...\", {\n\t\t\toldSecret: _secret,\n\t\t\tnewSecret\n\t\t});\n\t\t_secret = newSecret;\n\t};\n\n\tconst wait = async (): Promise<UserInfo> =>\n\t\tnew Promise((resolve, reject) => {\n\t\t\tconsole.debug(\"[Firebase] Waiting user...\");\n\t\t\t_info.once(\"value\", snapshot => {\n\t\t\t\tconst newValues = snapshot.val();\n\t\t\t\tif (newValues) {\n\t\t\t\t\t_values = newValues;\n\t\t\t\t\tresolve(_values);\n\t\t\t\t} else {\n\t\t\t\t\treject(new Error(\"users.errors.invalid\"));\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\tconst subscribeInfo = (cb: FirebaseCB) => {\n\t\tconsole.debug(\"[Firebase] Subscribing user...\");\n\t\t_info.on(\"value\", cb);\n\t};\n\n\tconst unsubscribeInfo = (cb: FirebaseCB) => {\n\t\tconsole.debug(\"[Firebase] Unsubscribing user...\");\n\t\t_info.off(\"value\", cb);\n\t};\n\n\tconst update = async ({\n\t\tname,\n\t\troom_id\n\t}: Partial<Pick<UserInfo, \"name\" | \"room_id\">>) => {\n\t\tconsole.debug(\"[Firebase] Updating user...\", { name, room_id });\n\t\tif (name !== void 0) {\n\t\t\t_values.name = name;\n\t\t}\n\t\tif (room_id !== void 0) {\n\t\t\t_values.room_id = room_id;\n\t\t}\n\t\tawait _user.set({\n\t\t\tinfo: {\n\t\t\t\t..._values,\n\t\t\t\tonline: true,\n\t\t\t\tstatus: \"online\",\n\t\t\t\ttimestamp: firebase.database.ServerValue.TIMESTAMP\n\t\t\t},\n\t\t\tsecret: _secret\n\t\t});\n\t\tinstallDisconnect();\n\t};\n\n\tconst installDisconnect = () => {\n\t\tconsole.debug(\"[Firebase] Installing user disconnect...\");\n\t\t_user.onDisconnect().cancel();\n\t\t_user.onDisconnect().set({\n\t\t\tinfo: {\n\t\t\t\t..._values,\n\t\t\t\tonline: false,\n\t\t\t\troom_id: \"\",\n\t\t\t\tstatus: \"disconnected\",\n\t\t\t\ttimestamp: firebase.database.ServerValue.TIMESTAMP\n\t\t\t},\n\t\t\tsecret: _secret\n\t\t});\n\t};\n\n\tconst enter = async (room: ReturnType<typeof FirebaseRoom>) => {\n\t\tif (_membership) {\n\t\t\tawait _membership.remove();\n\t\t\t_membership = null;\n\t\t}\n\t\tawait update({\n\t\t\troom_id: room.id\n\t\t});\n\t\t_membership = DEFAULT_APP.members.child(room.id).child(id);\n\t\t_membership.onDisconnect().remove();\n\t\tawait _membership.set({\n\t\t\ttimestamp: firebase.database.ServerValue.TIMESTAMP\n\t\t});\n\t};\n\n\tconst exit = async () => {\n\t\tif (_membership) {\n\t\t\tawait _membership.remove();\n\t\t\t_membership = null;\n\t\t}\n\t\tawait update({\n\t\t\troom_id: \"\"\n\t\t});\n\t};\n\n\treturn {\n\t\tid,\n\t\tenter,\n\t\texit,\n\t\tisLocked,\n\t\tsetSecret,\n\t\twait,\n\t\tsubscribeInfo,\n\t\tunsubscribeInfo,\n\t\tupdate,\n\t\tgetInfo\n\t};\n};\n\n// ------------------------------------------------------------------\n\nexport const FirebaseParty = (\n\tid: string,\n\troom: ReturnType<typeof FirebaseRoom>\n) => {\n\tconst _members: string[] = [];\n\tconst _users: { [id: string]: ReturnType<typeof FirebaseUser> } = {};\n\tlet _info: RoomInfo = {\n\t\tname: \"\",\n\t\tplaying: false,\n\t\tqueue: {},\n\t\tqueue_position: 0,\n\t\ttimestamp: 0,\n\t\ttype: \"dj\"\n\t};\n\n\tconst _onAdded = (added: firebase.database.DataSnapshot) => {\n\t\tconst userId = added.key;\n\t\tif (userId) {\n\t\t\tconst index = _members.indexOf(userId);\n\t\t\tif (index === -1) {\n\t\t\t\t_members.push(userId);\n\t\t\t\t_users[userId] = FirebaseUser(userId);\n\t\t\t\t_log();\n\t\t\t}\n\t\t}\n\t};\n\n\tconst _onRemoved = (removed: firebase.database.DataSnapshot) => {\n\t\tconst userId = removed.key;\n\t\tif (userId) {\n\t\t\tconst index = _members.indexOf(userId);\n\t\t\tif (index !== -1) {\n\t\t\t\t_members.splice(index, 1);\n\t\t\t\tdelete _users[userId];\n\t\t\t\t_log();\n\t\t\t}\n\t\t}\n\t};\n\n\tconst _onRoomInfo = (snapshot: firebase.database.DataSnapshot) => {\n\t\tconst newValues = snapshot.val() as RoomInfo | null;\n\t\tif (newValues) {\n\t\t\t_info = newValues;\n\t\t\t_log();\n\t\t}\n\t};\n\n\tconst _log = () => {\n\t\tconsole.debug(\"PARTY\", {\n\t\t\t_info,\n\t\t\t_members\n\t\t});\n\t};\n\n\tconst init = () => {\n\t\troom.subscribeInfo(_onRoomInfo);\n\t\troom.subscribeMembers(_onAdded, _onRemoved);\n\t};\n\n\tconst terminate = () => {\n\t\troom.unsubscribeInfo(_onRoomInfo);\n\t\troom.unsubscribeMembers(_onAdded, _onRemoved);\n\t};\n\n\treturn {\n\t\tinit,\n\t\tterminate\n\t};\n};\n\n// ------------------------------------------------------------------\n// ------------------------------------------------------------------\n// ------------------------------------------------------------------\n\nexport const testRoom = async () => {\n\tconst room = FirebaseRoom(\"r1\", \"rs1\");\n\tawait room.update({ name: \"R1\" });\n\troom.subscribeInfo(info => console.debug(\"ROOM\", info.val()));\n\troom.subscribeMembers(\n\t\tmembers => console.debug(\"ADDED\", members.key),\n\t\tmembers => console.debug(\"REMOVED\", members.key)\n\t);\n\tawait room.update({ name: \"R1\" });\n\tawait sleep(1000);\n\tawait room.update({\n\t\tname: \"R1b\",\n\t\tqueue: {},\n\t\tqueue_position: 0\n\t});\n};\n\nexport const testUser = async () => {\n\tconst user = FirebaseUser(\"u1\", \"us1\");\n\tuser.subscribeInfo(info => console.debug(\"USER\", info.val()));\n\tawait user.update({ name: \"U1\" });\n\tawait sleep(1000);\n\tawait user.update({ name: \"U1b\" });\n};\n\nexport const testParty = async () => {\n\tconst room1 = FirebaseRoom(\"r1\", \"rs1\");\n\tawait room1.update({ name: \"R1\" });\n\tconst room2 = FirebaseRoom(\"r2\", \"rs2\");\n\tawait room2.update({ name: \"R2\" });\n\tconst user1 = FirebaseUser(\"u1\", \"us1\");\n\tawait user1.update({ name: \"U1\" });\n\tconst user2 = FirebaseUser(\"u2\", \"us2\");\n\tawait user2.update({ name: \"U2\" });\n\n\tawait sleep(2000);\n\n\tconst party1 = FirebaseParty(\"P1\", room1);\n\tawait party1.init();\n\tconst party2 = FirebaseParty(\"P2\", room2);\n\tawait party2.init();\n\n\tawait sleep(1000);\n\tuser1.enter(room1);\n\tawait sleep(1000);\n\tuser2.enter(room1);\n\tawait sleep(1000);\n\tuser1.enter(room2);\n\tawait sleep(1000);\n\tuser1.exit();\n\tawait sleep(1000);\n\tuser1.enter(room1);\n};\n\nexport const test = () => {\n\t// testRoom();\n\t// testUser();\n\t// testParty();\n};\n","export type MessageType = \"error\" | \"info\";\n\nexport type Message = {\n\tid: number;\n\tstamp: number;\n\ttext: string;\n\ttype: MessageType;\n};\n\nexport const extractErrorMessage = (err: any) =>\n\terr.response && err.response.data && err.response.data.message\n\t\t? err.response.data.message\n\t\t: err.message;\n","import { AxiosError } from \"axios\";\n//\nimport { createAction, AsyncAction } from \".\";\nimport { displayError } from \"./messages\";\nimport { appendInQueue } from \"./queue\";\nimport { getFromDictOrList, onlyUnique } from \"../utils\";\nimport {\n\tMedia,\n\tMediaType,\n\tProviderType,\n\tTrack,\n\tContainer\n} from \"../utils/medias\";\nimport { extractErrorMessage } from \"../utils/messages\";\n\n// ------------------------------------------------------------------\n\nexport type MediasAction =\n\t| ReturnType<typeof fetching>\n\t| ReturnType<typeof success>\n\t| ReturnType<typeof error>\n\t| ReturnType<typeof reset>\n\t| ReturnType<typeof set>;\n\nconst fetching = () => createAction(\"medias/FETCHING\");\nconst success = () => createAction(\"medias/FETCHED\");\nconst error = (error: AxiosError) => createAction(\"medias/ERROR\", error);\nconst reset = () => createAction(\"medias/RESET\");\nconst set = (medias: Media[]) => createAction(\"medias/SET\", medias);\n\n// ------------------------------------------------------------------\n\nexport const loadMedias = (\n\tprovider: ProviderType,\n\tmediaType: MediaType,\n\tmediaIds: string[],\n\tenqueue: boolean,\n\tpreview: boolean\n): AsyncAction => async (dispatch, getState, { deezer, previewPlayer }) => {\n\tif (mediaIds.length > 0) {\n\t\tconst {\n\t\t\tmedias: { medias }\n\t\t} = getState();\n\t\ttry {\n\t\t\tif (mediaType === \"track\") {\n\t\t\t\t// TRACK\n\t\t\t\tconst { track: oldTracks } = medias;\n\t\t\t\tconst newTrackIds: string[] = mediaIds\n\t\t\t\t\t.filter(trackId => !oldTracks[trackId])\n\t\t\t\t\t.filter(onlyUnique);\n\t\t\t\tlet newTracks: Track[] = [];\n\t\t\t\tif (newTrackIds.length > 0) {\n\t\t\t\t\tconsole.debug(\"Loading tracks...\", {\n\t\t\t\t\t\tmediaIds: newTrackIds\n\t\t\t\t\t});\n\t\t\t\t\tnewTracks = await deezer.loadTracks(newTrackIds);\n\t\t\t\t\tdispatch(set(newTracks));\n\t\t\t\t}\n\t\t\t\tif (enqueue) {\n\t\t\t\t\tconsole.debug(\"Enqueuing tracks...\", { mediaIds });\n\t\t\t\t\tdispatch(appendInQueue(provider, mediaIds));\n\t\t\t\t}\n\t\t\t\tif (preview) {\n\t\t\t\t\tconst trackId = mediaIds[0];\n\t\t\t\t\tconst track = getFromDictOrList(\n\t\t\t\t\t\toldTracks,\n\t\t\t\t\t\tnewTracks,\n\t\t\t\t\t\ttrackId\n\t\t\t\t\t);\n\t\t\t\t\tif (track) {\n\t\t\t\t\t\tconsole.debug(\"Previewing track...\", {\n\t\t\t\t\t\t\ttrack,\n\t\t\t\t\t\t\ttrackId\n\t\t\t\t\t\t});\n\t\t\t\t\t\tawait previewPlayer.play(0, track.id, track.preview, 0);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconsole.debug(\"Cannot load track to preview...\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// CONTAINERS\n\t\t\t\tconst { [mediaType]: oldContainers } = medias;\n\t\t\t\tconst newContainerIds: string[] = mediaIds\n\t\t\t\t\t.filter(containerId => !oldContainers[containerId])\n\t\t\t\t\t.filter(onlyUnique);\n\t\t\t\tlet newContainers: Array<Container> = [];\n\t\t\t\tif (newContainerIds.length > 0) {\n\t\t\t\t\tconsole.debug(\"Loading containers...\", {\n\t\t\t\t\t\tmediaIds: newContainerIds\n\t\t\t\t\t});\n\t\t\t\t\tnewContainers = await deezer.loadContainers(\n\t\t\t\t\t\tmediaType,\n\t\t\t\t\t\tnewContainerIds\n\t\t\t\t\t);\n\n\t\t\t\t\tconst newContainersAndTracks: Media[] = [...newContainers];\n\t\t\t\t\tfor (const container of newContainers) {\n\t\t\t\t\t\tnewContainersAndTracks.push(...container.tracks!);\n\t\t\t\t\t}\n\n\t\t\t\t\tdispatch(set(newContainersAndTracks));\n\t\t\t\t}\n\n\t\t\t\tif (enqueue) {\n\t\t\t\t\tconsole.debug(\"Enqueuing containers tracks...\", {\n\t\t\t\t\t\tmediaIds\n\t\t\t\t\t});\n\t\t\t\t\tfor (const containerId of mediaIds) {\n\t\t\t\t\t\tconst container = getFromDictOrList<Container>(\n\t\t\t\t\t\t\toldContainers,\n\t\t\t\t\t\t\tnewContainers,\n\t\t\t\t\t\t\tcontainerId\n\t\t\t\t\t\t);\n\t\t\t\t\t\tif (container) {\n\t\t\t\t\t\t\tdispatch(\n\t\t\t\t\t\t\t\tappendInQueue(\n\t\t\t\t\t\t\t\t\tprovider,\n\t\t\t\t\t\t\t\t\tcontainer.tracks!.map(track => track.id)\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (preview) {\n\t\t\t\t\tlet track: Track | null = null;\n\t\t\t\t\tfor (const containerId of mediaIds) {\n\t\t\t\t\t\tconst container = getFromDictOrList<Container>(\n\t\t\t\t\t\t\toldContainers,\n\t\t\t\t\t\t\tnewContainers,\n\t\t\t\t\t\t\tcontainerId\n\t\t\t\t\t\t);\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\tcontainer &&\n\t\t\t\t\t\t\tcontainer.tracks &&\n\t\t\t\t\t\t\tcontainer.tracks.length > 0\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\ttrack = container.tracks[0];\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (track) {\n\t\t\t\t\t\tconsole.debug(\"Previewing container first track...\");\n\t\t\t\t\t\tawait previewPlayer.play(0, track.id, track.preview, 0);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconsole.debug(\"Cannot load track to preview...\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t} catch (err) {\n\t\t\tdispatch(displayError(extractErrorMessage(err)));\n\t\t}\n\t}\n};\n","import { AxiosError } from \"axios\";\nimport { v4 } from \"uuid\";\n//\nimport { createAction, AsyncAction } from \".\";\nimport { displayError } from \"./messages\";\nimport { RoomInfo } from \"../utils/rooms\";\nimport { FirebaseRoom } from \"../utils/firebase\";\nimport { loadMedias } from \"./medias\";\nimport { MediaAccess } from \"../utils/medias\";\nimport history from \"../utils/history\";\nimport { extractErrorMessage } from \"../utils/messages\";\nimport { RoomData } from \"../reducers/room\";\n\n// ------------------------------------------------------------------\n\nexport type RoomAction =\n\t| ReturnType<typeof fetching>\n\t| ReturnType<typeof success>\n\t| ReturnType<typeof error>\n\t| ReturnType<typeof resetRoom>\n\t| ReturnType<typeof setRoom>;\n\nconst fetching = () => createAction(\"room/FETCHING\");\nconst success = () => createAction(\"room/FETCHED\");\nconst error = (error: AxiosError) => createAction(\"room/ERROR\", error);\nconst resetRoom = () => createAction(\"room/RESET\");\nexport const setRoom = (values: Partial<RoomData>) =>\n\tcreateAction(\"room/SET\", values);\n\n// ------------------------------------------------------------------\n\nexport const createRoom = (\n\tname: string,\n\tsecret: string\n): AsyncAction => async dispatch => {\n\ttry {\n\t\tconst id = v4();\n\t\tconsole.debug(\"Creating room...\", { id, secret });\n\t\tawait FirebaseRoom(id, secret).update({ name });\n\t\tdispatch(enterRoom(id, secret));\n\t} catch (err) {\n\t\tdispatch(displayError(extractErrorMessage(err)));\n\t}\n};\n\n// ------------------------------------------------------------------\n\nlet FIREBASE_CB: any = null;\n\nexport const enterRoom = (id: string, secret: string): AsyncAction => async (\n\tdispatch,\n\tgetState\n) => {\n\tconst {\n\t\troom: { room }\n\t} = getState();\n\tif (!room || room.id !== id) {\n\t\tdispatch(exitRoom());\n\t\ttry {\n\t\t\tconsole.debug(\"Entering room...\", { id, secret });\n\t\t\tconst newRoom = FirebaseRoom(id, secret);\n\t\t\tdispatch(\n\t\t\t\tsetRoom({\n\t\t\t\t\taccess: { id, secret },\n\t\t\t\t\troom: newRoom,\n\t\t\t\t\tinfo: await newRoom.wait()\n\t\t\t\t})\n\t\t\t);\n\t\t\tFIREBASE_CB = newRoom.subscribeInfo(\n\t\t\t\t(snapshot: firebase.database.DataSnapshot) => {\n\t\t\t\t\tconst newInfo = snapshot.val() as RoomInfo;\n\t\t\t\t\tconsole.debug(\n\t\t\t\t\t\t\"[Firebase] Received room update...\",\n\t\t\t\t\t\tnewInfo\n\t\t\t\t\t);\n\t\t\t\t\tlet medias: MediaAccess[] = [];\n\t\t\t\t\tif (newInfo.queue) {\n\t\t\t\t\t\tmedias = Object.entries(newInfo.queue)\n\t\t\t\t\t\t\t.sort(\n\t\t\t\t\t\t\t\t(media1, media2) =>\n\t\t\t\t\t\t\t\t\tNumber(media1[0]) - Number(media2[0])\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t.map(media => media[1]);\n\t\t\t\t\t\tdispatch(\n\t\t\t\t\t\t\tloadMedias(\n\t\t\t\t\t\t\t\t\"deezer\",\n\t\t\t\t\t\t\t\t\"track\",\n\t\t\t\t\t\t\t\tmedias.map(media => media.id),\n\t\t\t\t\t\t\t\tfalse,\n\t\t\t\t\t\t\t\tfalse\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\tdispatch(\n\t\t\t\t\t\tsetRoom({\n\t\t\t\t\t\t\tmedias,\n\t\t\t\t\t\t\tplaying: newInfo.playing,\n\t\t\t\t\t\t\tposition: newInfo.queue_position,\n\t\t\t\t\t\t\troom: newRoom,\n\t\t\t\t\t\t\tinfo: newInfo\n\t\t\t\t\t\t})\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t);\n\t\t\thistory.push(`/room/${id}?key=${secret}`); // TODO: should push only if we're not already in it\n\t\t} catch (err) {\n\t\t\tdispatch(displayError(extractErrorMessage(err)));\n\t\t}\n\t}\n};\n\nexport const exitRoom = (): AsyncAction => async (dispatch, getState) => {\n\tconst {\n\t\troom: { room }\n\t} = getState();\n\tif (room) {\n\t\tconsole.debug(\"Exiting room...\");\n\t\troom.unsubscribeInfo(FIREBASE_CB);\n\t\tFIREBASE_CB = null;\n\t\tdispatch(resetRoom());\n\t}\n};\n\n// ------------------------------------------------------------------\n\nexport const lockRoom = (): AsyncAction => async (dispatch, getState) => {\n\tconst {\n\t\troom: {\n\t\t\troom,\n\t\t\taccess: { id }\n\t\t}\n\t} = getState();\n\tif (room && room.id === id) {\n\t\tconsole.debug(\"Locking room...\", { id });\n\t\troom.setSecret(\"\");\n\t\tdispatch(setRoom({ access: { id, secret: \"\" } }));\n\t}\n};\n\nexport const unlockRoom = (secret: string): AsyncAction => async (\n\tdispatch,\n\tgetState\n) => {\n\tconst {\n\t\troom: {\n\t\t\troom,\n\t\t\taccess: { id }\n\t\t}\n\t} = getState();\n\tif (room && room.id === id) {\n\t\tconsole.debug(\"Unlocking room...\", { id, secret });\n\t\troom.setSecret(secret);\n\t\tdispatch(setRoom({ access: { id, secret } }));\n\t}\n};\n","import { AsyncAction } from \".\";\nimport { RoomQueue } from \"../utils/rooms\";\nimport { displayError } from \"./messages\";\nimport { lockRoom } from \"./room\";\nimport { ProviderType } from \"../utils/medias\";\nimport { extractErrorMessage } from \"../utils/messages\";\n\n// ------------------------------------------------------------------\n\nexport const clearQueue = (): AsyncAction => async (dispatch, getState) => {\n\tconst {\n\t\troom: { room }\n\t} = getState();\n\tif (room && !room.isLocked()) {\n\t\ttry {\n\t\t\tconsole.debug(\"Clearing queue...\");\n\t\t\tawait room.update({ queue: {}, queue_position: 0 });\n\t\t} catch (err) {\n\t\t\tdispatch(displayError(extractErrorMessage(err)));\n\t\t\tdispatch(lockRoom());\n\t\t}\n\t} else {\n\t\tdispatch(displayError(\"rooms.error.locked\"));\n\t}\n};\n\nexport const appendInQueue = (\n\tprovider: ProviderType,\n\ttrackIds: string[]\n): AsyncAction => async (dispatch, getState) => {\n\tconst {\n\t\troom: { room }\n\t} = getState();\n\tif (room && !room.isLocked()) {\n\t\tif (trackIds.length > 0) {\n\t\t\tconst {\n\t\t\t\troom: { medias: queueMedias }\n\t\t\t} = getState();\n\t\t\ttry {\n\t\t\t\tconsole.debug(\"Appending queue...\", { trackIds });\n\t\t\t\tconst queue: RoomQueue = {};\n\t\t\t\t[...queueMedias.map(media => media.id), ...trackIds].forEach(\n\t\t\t\t\t(id, index) => {\n\t\t\t\t\t\tqueue[index] = {\n\t\t\t\t\t\t\tid,\n\t\t\t\t\t\t\tprovider,\n\t\t\t\t\t\t\ttype: \"track\"\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t\tawait room.update({ queue });\n\t\t\t} catch (err) {\n\t\t\t\tdispatch(displayError(extractErrorMessage(err)));\n\t\t\t\tdispatch(lockRoom());\n\t\t\t}\n\t\t}\n\t} else {\n\t\tdispatch(displayError(\"rooms.error.locked\"));\n\t}\n};\n\nexport const removeFromQueue = (index: number): AsyncAction => async (\n\tdispatch,\n\tgetState\n) => {\n\tconst {\n\t\troom: { medias: queueMedias, position, room }\n\t} = getState();\n\tif (room && !room.isLocked()) {\n\t\tif (index < queueMedias.length) {\n\t\t\ttry {\n\t\t\t\tconsole.debug(\"Removing from queue...\", { index });\n\t\t\t\tconst oldIndex = position % queueMedias.length;\n\t\t\t\tconst queue: RoomQueue = {};\n\t\t\t\tconst copy = [...queueMedias];\n\t\t\t\tcopy.splice(index, 1);\n\t\t\t\tcopy.forEach((mediaAccess, index) => {\n\t\t\t\t\tqueue[index] = mediaAccess;\n\t\t\t\t});\n\t\t\t\tawait room.update({\n\t\t\t\t\tqueue,\n\t\t\t\t\tqueue_position: index < oldIndex ? position - 1 : position\n\t\t\t\t});\n\t\t\t} catch (err) {\n\t\t\t\tdispatch(displayError(extractErrorMessage(err)));\n\t\t\t\tdispatch(lockRoom());\n\t\t\t}\n\t\t}\n\t} else {\n\t\tdispatch(displayError(\"rooms.error.locked\"));\n\t}\n};\n\nexport const setQueuePosition = (newPosition: number): AsyncAction => async (\n\tdispatch,\n\tgetState\n) => {\n\tconst {\n\t\troom: { position: oldPosition, room }\n\t} = getState();\n\tif (room && !room.isLocked()) {\n\t\tif (oldPosition !== newPosition) {\n\t\t\ttry {\n\t\t\t\tconsole.debug(\"Set queue position...\", {\n\t\t\t\t\toldPosition,\n\t\t\t\t\tnewPosition\n\t\t\t\t});\n\t\t\t\tawait room.update({ queue_position: newPosition });\n\t\t\t} catch (err) {\n\t\t\t\tdispatch(displayError(extractErrorMessage(err)));\n\t\t\t\tdispatch(lockRoom());\n\t\t\t}\n\t\t}\n\t} else {\n\t\tdispatch(displayError(\"rooms.error.locked\"));\n\t}\n};\n\n// ------------------------------------------------------------------\n\nexport const moveBackward = (): AsyncAction => async (dispatch, getState) => {\n\tconst {\n\t\troom: { medias: queueMedias, position }\n\t} = getState();\n\tif (queueMedias.length > 0) {\n\t\tconsole.debug(\"Moving backward...\");\n\t\tdispatch(\n\t\t\tsetQueuePosition(\n\t\t\t\tposition > 0 ? position - 1 : queueMedias.length - 1\n\t\t\t)\n\t\t);\n\t}\n};\n\nexport const moveForward = (): AsyncAction => async (dispatch, getState) => {\n\tconst {\n\t\troom: { medias: queueMedias, position }\n\t} = getState();\n\tif (queueMedias.length > 0) {\n\t\tconsole.debug(\"Moving forward...\");\n\t\tdispatch(setQueuePosition(position + 1));\n\t}\n};\n","import * as jimp from \"jimp\";\n\n// ------------------------------------------------------------------\n\nexport type Color = {\n\tr: number;\n\tg: number;\n\tb: number;\n};\n\nexport type CombinedColor = {\n\tbg: Color;\n\tfg: Color;\n};\n\nconst CACHE: { [url: string]: CombinedColor } = {};\n\nconst DEFAULT_COLOR = {\n\tbg: { r: 255, g: 255, b: 255 },\n\tfg: { r: 0, g: 0, b: 0 }\n};\n\n// ------------------------------------------------------------------\n\n// https://stackoverflow.com/questions/3942878/how-to-decide-font-color-in-white-or-black-depending-on-background-color\nexport const pickColor = async (url: string) => {\n\tlet res = DEFAULT_COLOR;\n\tif (url) {\n\t\tres = CACHE[url];\n\t\tif (!res) {\n\t\t\ttry {\n\t\t\t\tconst image = await jimp.read(url);\n\t\t\t\tconst pixel = await image.resize(1, 1).getPixelColor(0, 0);\n\t\t\t\tconst bg = jimp.intToRGBA(pixel);\n\t\t\t\tCACHE[url] = res = {\n\t\t\t\t\tbg,\n\t\t\t\t\tfg:\n\t\t\t\t\t\tbg.r * 0.299 + bg.g * 0.587 + bg.b * 0.114 > 186\n\t\t\t\t\t\t\t? { r: 0, g: 0, b: 0 }\n\t\t\t\t\t\t\t: { r: 255, g: 255, b: 255 }\n\t\t\t\t};\n\t\t\t} catch (err) {\n\t\t\t\tconsole.debug(\"An error prevented colorpicking\", err);\n\t\t\t}\n\t\t}\n\t}\n\treturn res;\n};\n","import { AsyncAction, createAction, Dispatch } from \".\";\nimport { setRoom } from \"./room\";\nimport { pickColor } from \"../utils/colorpicker\";\nimport { setQueuePosition } from \"./queue\";\nimport { Player } from \"../utils/player\";\nimport { RootState } from \"../reducers\";\nimport { MediaAccess } from \"../utils/medias\";\nimport { displayError } from \"./messages\";\nimport { extractErrorMessage } from \"../utils/messages\";\n\n// ------------------------------------------------------------------\n\nexport type PlayerAction =\n\t| ReturnType<typeof resetPlayer>\n\t| ReturnType<typeof setPlayer>;\n\nconst resetPlayer = () => createAction(\"player/RESET\");\nconst setPlayer = (\n\tvalues: Partial<{ playing: boolean; track_percent: number }>\n) => createAction(\"player/SET\", values);\n\n// ------------------------------------------------------------------\n\nexport const startPlayer = (): AsyncAction => async (\n\tdispatch,\n\tgetState,\n\t{ queuePlayer }\n) => {\n\tif (!PLAYER_TIMER1 && !PLAYER_TIMER2) {\n\t\t_installTimer1(dispatch, getState, queuePlayer);\n\t\t_installTimer2(dispatch, getState, queuePlayer);\n\t\tdispatch(setPlayer({ playing: true }));\n\t}\n};\n\n// ------------------------------------------------------------------\n\nexport const stopPlayer = (): AsyncAction => async (\n\tdispatch,\n\t_,\n\t{ queuePlayer }\n) => {\n\tif (PLAYER_TIMER1 && PLAYER_TIMER2) {\n\t\tclearTimeout(PLAYER_TIMER1);\n\t\tPLAYER_TIMER1 = null;\n\t\tclearTimeout(PLAYER_TIMER2);\n\t\tPLAYER_TIMER2 = null;\n\t\tawait queuePlayer.stop();\n\t\tdispatch(resetPlayer());\n\t}\n};\n\n// ------------------------------------------------------------------\n\nexport const stopPreview = (): AsyncAction => async (\n\t_1,\n\t_2,\n\t{ previewPlayer }\n) => {\n\tconsole.debug(\"Stop previewing...\");\n\tawait previewPlayer.stop();\n};\n\n// ------------------------------------------------------------------\n\nlet PLAYER_TIMER1: NodeJS.Timeout | null = null;\nlet PLAYER_TIMER2: NodeJS.Timeout | null = null;\n\nconst _computeNextPosition = (\n\tqueuePlayer: ReturnType<typeof Player>,\n\tqueueTrackPosition: number,\n\tmedias: MediaAccess[]\n) => {\n\tlet nextPosition = -1;\n\tconst playingTrackID = queuePlayer.getPlayingTrackID();\n\tconst playingTrackPosition = queuePlayer.getPlayingTrackPosition();\n\tif (playingTrackPosition !== queueTrackPosition) {\n\t\tif (queuePlayer.isPlaying()) {\n\t\t\t// User has clicked an other track or added/removed a track in queue\n\t\t\tnextPosition = queueTrackPosition;\n\t\t} else {\n\t\t\t// Not playing which means previous track has terminated\n\t\t\tnextPosition =\n\t\t\t\tplayingTrackPosition >= 0\n\t\t\t\t\t? playingTrackPosition\n\t\t\t\t\t: queueTrackPosition;\n\t\t}\n\t} else if (\n\t\tplayingTrackID !== medias[queueTrackPosition % medias.length].id\n\t) {\n\t\t// User has deleted playing track\n\t\tnextPosition = queueTrackPosition;\n\t}\n\treturn nextPosition;\n};\n\nconst _installTimer1 = (\n\tdispatch: Dispatch,\n\tgetState: () => RootState,\n\tqueuePlayer: ReturnType<typeof Player>\n) => {\n\t// Don't use setInterval because a step could be triggered before previous one terminated\n\tPLAYER_TIMER1 = setTimeout(async () => {\n\t\tconst {\n\t\t\troom: { medias: queueMedias, position },\n\t\t\tmedias: {\n\t\t\t\tmedias: { track: tracks }\n\t\t\t}\n\t\t} = getState();\n\t\tif (queueMedias.length > 0) {\n\t\t\t// Detect and apply change to queue and player\n\t\t\tconst nextTrackPosition = _computeNextPosition(\n\t\t\t\tqueuePlayer,\n\t\t\t\tposition,\n\t\t\t\tqueueMedias\n\t\t\t);\n\t\t\tif (nextTrackPosition >= 0) {\n\t\t\t\tconst nextIndex = nextTrackPosition % queueMedias.length;\n\t\t\t\tconst nextTrack = tracks[queueMedias[nextIndex].id];\n\t\t\t\tconsole.debug(\"Detected play change...\", {\n\t\t\t\t\tnextIndex,\n\t\t\t\t\tnextTrack,\n\t\t\t\t\tnextTrackPosition\n\t\t\t\t});\n\n\t\t\t\ttry {\n\t\t\t\t\tdispatch(setQueuePosition(nextTrackPosition));\n\t\t\t\t\tconst [color] = await Promise.all([\n\t\t\t\t\t\tpickColor(nextTrack.album.cover_small),\n\t\t\t\t\t\tqueuePlayer.play(\n\t\t\t\t\t\t\tnextTrackPosition,\n\t\t\t\t\t\t\tnextTrack.id,\n\t\t\t\t\t\t\tnextTrack.preview,\n\t\t\t\t\t\t\t0\n\t\t\t\t\t\t)\n\t\t\t\t\t]);\n\t\t\t\t\tdispatch(setRoom({ color }));\n\t\t\t\t} catch (err) {\n\t\t\t\t\tdispatch(displayError(extractErrorMessage(err)));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Reschedule time\n\t\t\t_installTimer1(dispatch, getState, queuePlayer);\n\t\t} else {\n\t\t\t// Last track has been removed from queue by user\n\t\t\tconsole.debug(\"No more tracks in queue...\");\n\t\t\tdispatch(stopPlayer());\n\t\t}\n\t}, 250);\n};\n\nconst _installTimer2 = (\n\tdispatch: Dispatch,\n\tgetState: () => RootState,\n\tqueuePlayer: ReturnType<typeof Player>\n) => {\n\t// Don't use setInterval because a step could be triggered before previous one terminated\n\tPLAYER_TIMER2 = setTimeout(() => {\n\t\tconst {\n\t\t\troom: { medias }\n\t\t} = getState();\n\t\tif (medias.length > 0) {\n\t\t\t// Refresh player track percent\n\t\t\tdispatch(\n\t\t\t\tsetPlayer({\n\t\t\t\t\ttrack_percent: queuePlayer.getPlayingTrackPercent()\n\t\t\t\t})\n\t\t\t);\n\n\t\t\t// Reschedule time\n\t\t\t_installTimer2(dispatch, getState, queuePlayer);\n\t\t}\n\t}, 250); // Must do very few operation because called very often (if we put less it creates blink on mobile when playing & scrolling)\n};\n","import { connect } from \"react-redux\";\nimport { ThunkDispatch } from \"redux-thunk\";\n//\nimport { RootState } from \"../../reducers\";\nimport Queue from \"../../components/Room/Queue\";\nimport { extractMedias } from \"../../selectors/medias\";\nimport { setQueuePosition, removeFromQueue } from \"../../actions/queue\";\nimport { stopPlayer, startPlayer } from \"../../actions/player\";\nimport { isRoomLoaded, isRoomLocked } from \"../../selectors/room\";\nimport { openModal } from \"../../actions/modals\";\n\n// ------------------------------------------------------------------\n\nconst stateToProps = (state: RootState) => ({\n\tloaded: isRoomLoaded(state),\n\tlocked: isRoomLocked(state),\n\tmedias: extractMedias(state, state.room.medias),\n\tplaying: state.player.playing,\n\tplayingIndex: state.room.position % state.room.medias.length\n});\n\nconst dispatchToProps = (dispatch: ThunkDispatch<RootState, any, any>) => ({\n\tonPlay: (index: number) => {\n\t\tdispatch(startPlayer());\n\t\tdispatch(setQueuePosition(index));\n\t},\n\tonRemove: (index: number) => dispatch(removeFromQueue(index)),\n\tonSearch: () => dispatch(openModal({ type: \"Search\", props: null })),\n\tonStop: () => dispatch(stopPlayer())\n});\n\nexport type MappedProps = ReturnType<typeof stateToProps> &\n\tReturnType<typeof dispatchToProps>;\n\nexport default connect(stateToProps, dispatchToProps)(Queue);\n","import React, { Component } from \"react\";\nimport classNames from \"classnames\";\n//\nimport { MappedProps } from \"../../containers/Room/Progress\";\nimport \"./Progress.scss\";\n\n// ------------------------------------------------------------------\n\nclass Progress extends Component<MappedProps> {\n\tpublic render = () => {\n\t\tconst { playing, value } = this.props;\n\t\treturn (\n\t\t\t<div className={classNames(\"Progress\", { playing })}>\n\t\t\t\t<progress max={100} value={value * 100} />\n\t\t\t</div>\n\t\t);\n\t};\n}\n\nexport default Progress;\n","import { connect } from \"react-redux\";\nimport { ThunkDispatch } from \"redux-thunk\";\n//\nimport { RootState } from \"../../reducers\";\nimport Progress from \"../../components/Room/Progress\";\n\n// ------------------------------------------------------------------\n\nconst stateToProps = (state: RootState) => ({\n\tplaying: state.player.playing,\n\tvalue: state.player.track_percent\n});\n\nconst dispatchToProps = (dispatch: ThunkDispatch<RootState, any, any>) => ({});\n\nexport type MappedProps = ReturnType<typeof stateToProps> &\n\tReturnType<typeof dispatchToProps>;\n\nexport default connect(stateToProps, dispatchToProps)(Progress);\n","import React, { Component } from \"react\";\nimport { withTranslation, WithTranslation } from \"react-i18next\";\n//\nimport { MappedProps } from \"../../containers/Room/Controls\";\nimport IconButton from \"../Common/IconButton\";\nimport Progress from \"../../containers/Room/Progress\";\nimport \"./Controls.scss\";\n\n// ------------------------------------------------------------------\n\nclass Controls extends Component<MappedProps & WithTranslation> {\n\tpublic render = () => {\n\t\tconst {\n\t\t\tonMoveBackward,\n\t\t\tonMoveForward,\n\t\t\tonPlay,\n\t\t\tonSearch,\n\t\t\tonStop,\n\t\t\tonUnlock,\n\t\t\ttracksCount,\n\t\t\tlocked,\n\t\t\tplaying,\n\t\t\tt\n\t\t} = this.props;\n\t\treturn (\n\t\t\t<div className=\"Controls\">\n\t\t\t\t<div className=\"ControlsSet\">\n\t\t\t\t\t<div className=\"Control\">\n\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\tdisabled={locked || tracksCount === 0}\n\t\t\t\t\t\t\ticon=\"step-backward\"\n\t\t\t\t\t\t\tonClick={onMoveBackward}\n\t\t\t\t\t\t\tsize=\"M\"\n\t\t\t\t\t\t\ttitle={t(\"player.backward\")}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className=\"Control\">\n\t\t\t\t\t\t{!playing ? (\n\t\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\t\tdisabled={locked || tracksCount === 0}\n\t\t\t\t\t\t\t\tonClick={onPlay}\n\t\t\t\t\t\t\t\ticon=\"play\"\n\t\t\t\t\t\t\t\tsize=\"L\"\n\t\t\t\t\t\t\t\ttitle={t(\"player.play\")}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\t\tdisabled={locked || tracksCount === 0}\n\t\t\t\t\t\t\t\tonClick={onStop}\n\t\t\t\t\t\t\t\ticon=\"pause\"\n\t\t\t\t\t\t\t\ttitle={t(\"player.stop\")}\n\t\t\t\t\t\t\t\tsize=\"L\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className=\"Control\">\n\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\tdisabled={locked || tracksCount === 0}\n\t\t\t\t\t\t\ticon=\"step-forward\"\n\t\t\t\t\t\t\tonClick={onMoveForward}\n\t\t\t\t\t\t\tsize=\"M\"\n\t\t\t\t\t\t\ttitle={t(\"player.forward\")}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<Progress />\n\t\t\t\t<div className=\"ControlsSet\">\n\t\t\t\t\t<div className=\"Control\">\n\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\tdisabled={locked || tracksCount === 0}\n\t\t\t\t\t\t\tonClick={this.onClear}\n\t\t\t\t\t\t\ticon=\"trash\"\n\t\t\t\t\t\t\ttitle={t(\"rooms.clear\")}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className=\"Control\">\n\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\tonClick={onSearch}\n\t\t\t\t\t\t\ticon=\"search\"\n\t\t\t\t\t\t\ttitle={t(\"medias.search\")}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className=\"Control\">\n\t\t\t\t\t\t{locked ? (\n\t\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\t\ticon=\"lock\"\n\t\t\t\t\t\t\t\tonClick={onUnlock}\n\t\t\t\t\t\t\t\tsize=\"M\"\n\t\t\t\t\t\t\t\ttitle={t(\"rooms.locked\")}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\t\ticon=\"unlock\"\n\t\t\t\t\t\t\t\tonClick={this.onLock}\n\t\t\t\t\t\t\t\tsize=\"M\"\n\t\t\t\t\t\t\t\ttitle={t(\"rooms.unlocked\")}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t);\n\t};\n\n\tprivate onClear = () => {\n\t\tconst { onClear, onConfirm, t } = this.props;\n\t\tonConfirm(t(\"rooms.confirm_clear\"), onClear);\n\t};\n\n\tprivate onLock = () => {\n\t\tconst { onConfirm, t } = this.props;\n\t\tonConfirm(t(\"rooms.confirm_lock\"), this.props.onLock);\n\t};\n}\n\nexport default withTranslation()(Controls);\n","import { connect } from \"react-redux\";\nimport { ThunkDispatch } from \"redux-thunk\";\n//\nimport { RootState } from \"../../reducers\";\nimport Controls from \"../../components/Room/Controls\";\nimport { startPlayer, stopPlayer } from \"../../actions/player\";\nimport { openModal, confirmModal } from \"../../actions/modals\";\nimport { clearQueue, moveBackward, moveForward } from \"../../actions/queue\";\nimport { isRoomLocked } from \"../../selectors/room\";\nimport { displayMessage } from \"../../actions/messages\";\nimport { lockRoom } from \"../../actions/room\";\n\n// ------------------------------------------------------------------\n\nconst stateToProps = (state: RootState) => ({\n\ttracksCount: state.room.medias.length,\n\tlocked: isRoomLocked(state),\n\tplaying: state.player.playing\n});\n\nconst dispatchToProps = (dispatch: ThunkDispatch<RootState, any, any>) => ({\n\tonClear: () => {\n\t\tdispatch(clearQueue());\n\t\tdispatch(stopPlayer());\n\t},\n\tonConfirm: (question: string, onConfirmed: () => void) => {\n\t\tdispatch(confirmModal(question, onConfirmed));\n\t},\n\tonLock: () => dispatch(lockRoom()),\n\tonUnlock: () => dispatch(openModal({ type: \"UnlockRoom\", props: null })),\n\tonMessage: (message: string) => dispatch(displayMessage(\"info\", message)),\n\tonMoveBackward: () => dispatch(moveBackward()),\n\tonMoveForward: () => dispatch(moveForward()),\n\tonPlay: () => dispatch(startPlayer()),\n\tonSearch: () => dispatch(openModal({ type: \"Search\", props: null })),\n\tonStop: () => dispatch(stopPlayer())\n});\n\nexport type MappedProps = ReturnType<typeof stateToProps> &\n\tReturnType<typeof dispatchToProps>;\n\nexport default connect(stateToProps, dispatchToProps)(Controls);\n","import React, { Component } from \"react\";\nimport { withRouter, RouteComponentProps } from \"react-router-dom\";\n//\nimport { MappedProps } from \"../../containers/Room\";\nimport Head from \"../../containers/Room/Head\";\nimport Queue from \"../../containers/Room/Queue\";\nimport Controls from \"../../containers/Room/Controls\";\nimport \"./index.scss\";\n\n// ------------------------------------------------------------------\n\nexport type Props = RouteComponentProps<{\n\troom_id: string;\n}>;\n\nclass Room extends Component<Props & MappedProps> {\n\tpublic componentDidMount = () => {\n\t\tthis.props.onEnter();\n\t};\n\n\tpublic componentWillUnmount = () => {\n\t\tthis.props.onExit();\n\t};\n\n\tpublic render = () => {\n\t\tconst {\n\t\t\tcolor: { fg, bg }\n\t\t} = this.props;\n\t\treturn (\n\t\t\t<div\n\t\t\t\tclassName=\"Room\"\n\t\t\t\tstyle={{\n\t\t\t\t\tcolor: `rgb(${fg.r}, ${fg.g}, ${fg.b})`,\n\t\t\t\t\tbackgroundColor: `rgb(${bg.r}, ${bg.g}, ${bg.b})`\n\t\t\t\t}}>\n\t\t\t\t<Head />\n\t\t\t\t<Queue />\n\t\t\t\t<Controls />\n\t\t\t</div>\n\t\t);\n\t};\n}\n\nexport default withRouter(Room);\n","import { connect } from \"react-redux\";\nimport { ThunkDispatch } from \"redux-thunk\";\nimport * as qs from \"qs\";\n//\nimport { RootState } from \"../../reducers\";\nimport Room, { Props } from \"../../components/Room\";\nimport { enterRoom, exitRoom } from \"../../actions/room\";\n\n// ------------------------------------------------------------------\n\nconst stateToProps = (state: RootState, ownProps: Props) => ({\n\tcolor: state.room.color\n});\n\nconst dispatchToProps = (\n\tdispatch: ThunkDispatch<RootState, any, any>,\n\townProps: Props\n) => {\n\tconst { key } = qs.parse(ownProps.location.search.substr(1)) as {\n\t\tkey?: string;\n\t};\n\treturn {\n\t\tonEnter: () =>\n\t\t\tdispatch(enterRoom(ownProps.match.params.room_id, key || \"\")),\n\t\tonExit: () => dispatch(exitRoom())\n\t};\n};\n\nexport type MappedProps = ReturnType<typeof stateToProps> &\n\tReturnType<typeof dispatchToProps>;\n\nexport default connect(stateToProps, dispatchToProps)(Room);\n","import React, { Component } from \"react\";\nimport { Link } from \"react-router-dom\";\nimport { withTranslation, WithTranslation } from \"react-i18next\";\n//\nimport { MappedProps } from \"../../containers/Splash\";\nimport IconButton from \"../Common/IconButton\";\nimport \"./index.scss\";\n\n// ------------------------------------------------------------------\n\nclass Splash extends Component<MappedProps & WithTranslation> {\n\tpublic render = () => {\n\t\tconst { loggedIn, onCreateRoom, onConnectUser, t } = this.props;\n\t\treturn (\n\t\t\t<div className=\"Splash\">\n\t\t\t\t<div className=\"Top\">\n\t\t\t\t\t<div className=\"Logo\">\n\t\t\t\t\t\t<Link to=\"/\">Party</Link>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className=\"PoweredWith\">\n\t\t\t\t\t\t<span>{t(\"splash.powered_with\")}</span>\n\t\t\t\t\t\t<a\n\t\t\t\t\t\t\thref=\"https://www.deezer.com\"\n\t\t\t\t\t\t\ttarget=\"_blank\"\n\t\t\t\t\t\t\trel=\"noopener noreferrer\">\n\t\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t\tsrc=\"/images/deezer.svg\"\n\t\t\t\t\t\t\t\theight=\"20px\"\n\t\t\t\t\t\t\t\ttitle=\"Deezer\"\n\t\t\t\t\t\t\t\talt=\"Deezer Logo\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div className=\"Middle\">\n\t\t\t\t\t<div className=\"Menu\">\n\t\t\t\t\t\t{loggedIn ? (\n\t\t\t\t\t\t\t<div className=\"MenuItem\">\n\t\t\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\t\t\tdisplayTitle={true}\n\t\t\t\t\t\t\t\t\ticon=\"plus\"\n\t\t\t\t\t\t\t\t\tonClick={onCreateRoom}\n\t\t\t\t\t\t\t\t\tsize=\"L\"\n\t\t\t\t\t\t\t\t\ttitle={t(\"rooms.create\")}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t<div className=\"MenuItem\">\n\t\t\t\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\t\t\t\tdisplayTitle={true}\n\t\t\t\t\t\t\t\t\t\tonClick={onConnectUser}\n\t\t\t\t\t\t\t\t\t\ticon=\"sign-in\"\n\t\t\t\t\t\t\t\t\t\tsize=\"L\"\n\t\t\t\t\t\t\t\t\t\ttitle={t(\"users.connect\")}\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div className=\"Bottom\">\n\t\t\t\t\t<div className=\"Menu\">\n\t\t\t\t\t\t{loggedIn ? (\n\t\t\t\t\t\t\t<div className=\"MenuItem\">\n\t\t\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\t\t\tdisplayTitle={true}\n\t\t\t\t\t\t\t\t\ticon=\"sign-out\"\n\t\t\t\t\t\t\t\t\tonClick={this.onDisconnect}\n\t\t\t\t\t\t\t\t\tsize=\"M\"\n\t\t\t\t\t\t\t\t\ttitle={t(\"users.disconnect\")}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t<div className=\"MenuItem\">\n\t\t\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\t\t\tdisplayTitle={true}\n\t\t\t\t\t\t\t\t\ticon=\"info\"\n\t\t\t\t\t\t\t\t\tonClick={() => {}}\n\t\t\t\t\t\t\t\t\tsize=\"M\"\n\t\t\t\t\t\t\t\t\ttitle={t(\"splash.CGU\")}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t);\n\t};\n\n\tonDisconnect = () => {\n\t\tconst { onConfirm, onDisconnectUser, t } = this.props;\n\t\tonConfirm(t(\"users.confirm_disconnect\"), onDisconnectUser);\n\t};\n}\n\nexport default withTranslation()(Splash);\n","import { RootState } from \"../reducers\";\n\nexport const extractUser = (state: RootState) => state.user.info;\n","import { AxiosError } from \"axios\";\nimport { v4 } from \"uuid\";\n//\nimport { createAction, AsyncAction } from \".\";\nimport { UserInfo } from \"../utils/users\";\nimport { FirebaseUser } from \"../utils/firebase\";\nimport { displayError } from \"./messages\";\nimport { extractErrorMessage } from \"../utils/messages\";\nimport { UserData } from \"../reducers/user\";\n\n// ------------------------------------------------------------------\n\nexport type UserAction =\n\t| ReturnType<typeof fetching>\n\t| ReturnType<typeof success>\n\t| ReturnType<typeof error>\n\t| ReturnType<typeof resetUser>\n\t| ReturnType<typeof setUser>;\n\nconst fetching = () => createAction(\"user/FETCHING\");\nconst success = () => createAction(\"user/FETCHED\");\nconst error = (error: AxiosError) => createAction(\"user/ERROR\", error);\nconst resetUser = () => createAction(\"user/RESET\");\nconst setUser = (values: Partial<UserData>) => createAction(\"user/SET\", values);\n\n// ------------------------------------------------------------------\n\nexport const createUser = (\n\tname: string,\n\tsecret: string\n): AsyncAction => async dispatch => {\n\ttry {\n\t\tconsole.debug(\"Creating user...\");\n\t\tconst id = v4();\n\t\tawait FirebaseUser(id, secret).update({ name });\n\t\tdispatch(connectUser(id, secret));\n\t} catch (err) {\n\t\tdispatch(displayError(extractErrorMessage(err)));\n\t}\n};\n\n// ------------------------------------------------------------------\n\nlet FIREBASE_CB: any = null;\n\nexport const connectUser = (id: string, secret: string): AsyncAction => async (\n\tdispatch,\n\tgetState\n) => {\n\tconst {\n\t\tuser: { user }\n\t} = getState();\n\tif (!user || user.id !== id) {\n\t\tdispatch(disconnectUser());\n\t\ttry {\n\t\t\tconsole.debug(\"Connection user...\", { id, secret });\n\t\t\tconst newUser = FirebaseUser(id);\n\t\t\tdispatch(\n\t\t\t\tsetUser({\n\t\t\t\t\taccess: { id, secret },\n\t\t\t\t\tuser: newUser,\n\t\t\t\t\tinfo: await newUser.wait()\n\t\t\t\t})\n\t\t\t);\n\t\t\tFIREBASE_CB = newUser.subscribeInfo(\n\t\t\t\t(snapshot: firebase.database.DataSnapshot) => {\n\t\t\t\t\tconst newInfo = snapshot.val() as UserInfo;\n\t\t\t\t\tconsole.debug(\n\t\t\t\t\t\t\"[Firebase] Received user update...\",\n\t\t\t\t\t\tnewInfo\n\t\t\t\t\t);\n\t\t\t\t\tdispatch(setUser({ user: newUser, info: newInfo }));\n\t\t\t\t}\n\t\t\t);\n\t\t} catch (err) {\n\t\t\tdispatch(displayError(extractErrorMessage(err)));\n\t\t\tdispatch(setUser({ access: { id, secret: \"\" } }));\n\t\t}\n\t}\n};\n\nexport const disconnectUser = (): AsyncAction => async (dispatch, getState) => {\n\tconst {\n\t\tuser: { user }\n\t} = getState();\n\tif (user) {\n\t\tconsole.debug(\"Disconnecting user...\");\n\t\tuser.unsubscribeInfo(FIREBASE_CB);\n\t\tFIREBASE_CB = null;\n\t\tdispatch(resetUser());\n\t}\n};\n\nexport const reconnectUser = (): AsyncAction => async (dispatch, getState) => {\n\tconst {\n\t\tuser: {\n\t\t\taccess: { id, secret }\n\t\t}\n\t} = getState();\n\tif (id && secret) {\n\t\tconsole.debug(\"Reconnecting user...\", { id, secret });\n\t\tdispatch(connectUser(id, secret));\n\t}\n};\n","import { connect } from \"react-redux\";\nimport { ThunkDispatch } from \"redux-thunk\";\n//\nimport { RootState } from \"../../reducers\";\nimport Splash from \"../../components/Splash\";\nimport { extractUser } from \"../../selectors/user\";\nimport { openModal, confirmModal } from \"../../actions/modals\";\nimport { disconnectUser } from \"../../actions/user\";\n\n// ------------------------------------------------------------------\n\nconst stateToProps = (state: RootState) => ({\n\tloggedIn: !!state.user.access.id,\n\tuser: extractUser(state)\n});\n\nconst dispatchToProps = (dispatch: ThunkDispatch<RootState, any, any>) => ({\n\tonConfirm: (question: string, onConfirmed: () => void) => {\n\t\tdispatch(confirmModal(question, onConfirmed));\n\t},\n\tonCreateRoom: () =>\n\t\tdispatch(openModal({ type: \"CreateRoom\", props: null })),\n\tonConnectUser: () =>\n\t\tdispatch(openModal({ type: \"CreateUser\", props: null })),\n\tonDisconnectUser: () => dispatch(disconnectUser())\n});\n\nexport type MappedProps = ReturnType<typeof stateToProps> &\n\tReturnType<typeof dispatchToProps>;\n\nexport default connect(stateToProps, dispatchToProps)(Splash);\n","import React, { Component, FormEvent, ReactNode } from \"react\";\nimport classNames from \"classnames\";\nimport { withTranslation, WithTranslation } from \"react-i18next\";\n//\nimport { MappedProps } from \"../../containers/Modals/Modal\";\nimport IconButton from \"../Common/IconButton\";\n\n// ------------------------------------------------------------------\n\ntype Props = {\n\tchildren: ReactNode;\n\tclassName?: string;\n\ttitle: string;\n\trenderFoot?: () => React.ReactNode;\n\tonSubmit?: () => void;\n};\n\nclass Modal extends Component<Props & MappedProps & WithTranslation> {\n\tpublic render = () => {\n\t\tconst {\n\t\t\tchildren,\n\t\t\tclassName,\n\t\t\ttitle,\n\t\t\trenderFoot,\n\t\t\tonClose,\n\t\t\tonPop,\n\t\t\thas_prev_modal,\n\t\t\tt\n\t\t} = this.props;\n\t\treturn (\n\t\t\t<form\n\t\t\t\tclassName={classNames(\"Modal\", className)}\n\t\t\t\tonSubmit={this.onSubmit}>\n\t\t\t\t<div className=\"ModalHead\">\n\t\t\t\t\t<IconButton\n\t\t\t\t\t\tkind=\"special\"\n\t\t\t\t\t\tclassName={classNames(\"ModalHeadBack\", {\n\t\t\t\t\t\t\thidden: !has_prev_modal\n\t\t\t\t\t\t})}\n\t\t\t\t\t\ticon=\"angle-left\"\n\t\t\t\t\t\ttitle=\"Back\"\n\t\t\t\t\t\tonClick={onPop}\n\t\t\t\t\t/>\n\t\t\t\t\t<div className=\"ModalTitle\">{title}</div>\n\t\t\t\t\t<IconButton\n\t\t\t\t\t\tkind=\"special\"\n\t\t\t\t\t\tclassName=\"ModalHeadClose\"\n\t\t\t\t\t\tonClick={onClose}\n\t\t\t\t\t\ttitle={t(\"cancel\")}\n\t\t\t\t\t\ticon=\"times\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div className=\"ModalBody\">{children}</div>\n\t\t\t\t<div className=\"ModalFoot\">{renderFoot && renderFoot()}</div>\n\t\t\t</form>\n\t\t);\n\t};\n\n\tprivate onSubmit = (event: FormEvent<HTMLFormElement>) => {\n\t\tevent.preventDefault();\n\t\tif (this.props.onSubmit) {\n\t\t\tthis.props.onSubmit();\n\t\t}\n\t};\n}\n\nexport default withTranslation()(Modal);\n","import { connect } from \"react-redux\";\n//\nimport Modal from \"../../components/Modals/Modal\";\nimport { RootState } from \"../../reducers\";\nimport { popModal } from \"../../actions/modals\";\n\n// ------------------------------------------------------------------\n\nconst mapStateToProps = (state: RootState) => ({\n\thas_prev_modal: state.modals.stack.length > 1\n});\n\nconst mapDispatchToProps = (dispatch: any) => ({\n\tonClose: () => dispatch(popModal()),\n\tonPop: () => dispatch(popModal())\n});\n\nexport type MappedProps = ReturnType<typeof mapStateToProps> &\n\tReturnType<typeof mapDispatchToProps>;\n\nexport default connect(mapStateToProps, mapDispatchToProps)(Modal);\n","import React, { Component } from \"react\";\nimport classNames from \"classnames\";\n//\nimport Modal from \"../../containers/Modals/Modal\";\nimport \"./FormModal.scss\";\n\n// ------------------------------------------------------------------\n\ntype Props = {\n\tclassName?: string;\n\tonSubmit: () => void;\n\trenderButtons: () => React.ReactNode;\n\ttitle: string;\n};\n\nclass FormModal extends Component<Props> {\n\tpublic render = () => {\n\t\tconst {\n\t\t\tchildren,\n\t\t\tclassName,\n\t\t\trenderButtons,\n\t\t\ttitle,\n\t\t\tonSubmit\n\t\t} = this.props;\n\t\treturn (\n\t\t\t<Modal\n\t\t\t\tclassName={classNames(\"FormModal\", className)}\n\t\t\t\ttitle={title}\n\t\t\t\trenderFoot={renderButtons}\n\t\t\t\tonSubmit={onSubmit}>\n\t\t\t\t{children}\n\t\t\t</Modal>\n\t\t);\n\t};\n}\n\nexport default FormModal;\n","import React, { Component } from \"react\";\nimport { withTranslation, WithTranslation } from \"react-i18next\";\n//\nimport FormModal from \"../Modals/FormModal\";\nimport { MappedProps } from \"../../containers/Modals/ConfirmModal\";\nimport IconButton, { CancelButton } from \"../Common/IconButton\";\n\n// ------------------------------------------------------------------\n\nexport type ConfirmModalProps = {\n\tquestion: string;\n\tonCanceled?: () => void;\n\tonConfirmed: () => void;\n};\n\nclass ConfirmModal extends Component<\n\tConfirmModalProps & MappedProps & WithTranslation\n> {\n\tpublic render = () => {\n\t\tconst { question, t } = this.props;\n\t\treturn (\n\t\t\t<FormModal\n\t\t\t\ttitle={t(\"confirm\")}\n\t\t\t\tonSubmit={this.props.onConfirmed}\n\t\t\t\trenderButtons={this.renderButtons}>\n\t\t\t\t{question}\n\t\t\t</FormModal>\n\t\t);\n\t};\n\n\tprivate renderButtons = () => {\n\t\tconst { t } = this.props;\n\t\treturn (\n\t\t\t<>\n\t\t\t\t<IconButton\n\t\t\t\t\ttitle={t(\"cancel\")}\n\t\t\t\t\tkind=\"primary\"\n\t\t\t\t\ticon=\"plus\"\n\t\t\t\t\ttype=\"submit\"\n\t\t\t\t/>\n\t\t\t\t<CancelButton onClick={this.props.onCancel} />\n\t\t\t</>\n\t\t);\n\t};\n}\n\nexport default withTranslation()(ConfirmModal);\n","import { connect } from \"react-redux\";\nimport { ThunkDispatch } from \"redux-thunk\";\n//\nimport { RootState } from \"../../reducers\";\nimport ConfirmModal, {\n\tConfirmModalProps\n} from \"../../components/Modals/ConfirmModal\";\nimport { popModal } from \"../../actions/modals\";\n\n// ------------------------------------------------------------------\n\nconst stateToProps = (state: RootState) => {\n\treturn {};\n};\n\nconst dispatchToProps = (\n\tdispatch: ThunkDispatch<RootState, any, any>,\n\townProps: ConfirmModalProps\n) => ({\n\tonCancel: () => {\n\t\tdispatch(popModal());\n\t\tif (ownProps.onCanceled) {\n\t\t\townProps.onCanceled();\n\t\t}\n\t}\n});\n\nexport type MappedProps = ReturnType<typeof stateToProps> &\n\tReturnType<typeof dispatchToProps>;\n\nexport default connect(stateToProps, dispatchToProps)(ConfirmModal);\n","import React, { Component, RefObject, createRef } from \"react\";\nimport { withTranslation, WithTranslation } from \"react-i18next\";\n//\nimport FormModal from \"../Modals/FormModal\";\nimport { MappedProps } from \"../../containers/Users/ConnectUserModal\";\nimport IconButton, { CancelButton } from \"../Common/IconButton\";\n\n// ------------------------------------------------------------------\n\ntype State = {\n\tid: string;\n\tsecret: string;\n};\n\nclass ConnectUserModal extends Component<MappedProps & WithTranslation, State> {\n\tprivate idRef: RefObject<HTMLInputElement> = createRef();\n\n\tpublic readonly state: State = {\n\t\tid: \"\",\n\t\tsecret: \"\"\n\t};\n\n\tpublic componentDidMount() {\n\t\tif (this.idRef.current) {\n\t\t\tthis.idRef.current.focus();\n\t\t}\n\t}\n\n\tpublic render = () => {\n\t\tconst { t } = this.props;\n\t\tconst { id, secret } = this.state;\n\t\treturn (\n\t\t\t<FormModal\n\t\t\t\ttitle={t(\"users.connection\")}\n\t\t\t\tonSubmit={this.onConnect}\n\t\t\t\trenderButtons={this.renderButtons}>\n\t\t\t\t<div className=\"ModalField\">\n\t\t\t\t\t<label htmlFor=\"modal-id\">{t(\"users.user_id\")}</label>\n\t\t\t\t\t<input\n\t\t\t\t\t\tid=\"modal-id\"\n\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\tplaceholder={t(\"users.id_placeholder\")}\n\t\t\t\t\t\tmaxLength={36}\n\t\t\t\t\t\tminLength={36}\n\t\t\t\t\t\trequired={true}\n\t\t\t\t\t\tvalue={id}\n\t\t\t\t\t\tref={this.idRef}\n\t\t\t\t\t\tonChange={e => {\n\t\t\t\t\t\t\tthis.setState({ id: e.target.value });\n\t\t\t\t\t\t}}\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div className=\"ModalField\">\n\t\t\t\t\t<label htmlFor=\"modal-secret\">{t(\"users.secret\")}</label>\n\t\t\t\t\t<input\n\t\t\t\t\t\tid=\"modal-secret\"\n\t\t\t\t\t\ttype=\"password\"\n\t\t\t\t\t\tplaceholder={t(\"users.secret_placeholder\")}\n\t\t\t\t\t\tmaxLength={36}\n\t\t\t\t\t\tminLength={36}\n\t\t\t\t\t\trequired={true}\n\t\t\t\t\t\tvalue={secret}\n\t\t\t\t\t\tonChange={e => {\n\t\t\t\t\t\t\tthis.setState({ secret: e.target.value });\n\t\t\t\t\t\t}}\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</FormModal>\n\t\t);\n\t};\n\n\tprivate renderButtons = () => {\n\t\tconst { t } = this.props;\n\t\treturn (\n\t\t\t<>\n\t\t\t\t<IconButton\n\t\t\t\t\ttitle={t(\"users.connect\")}\n\t\t\t\t\tkind=\"primary\"\n\t\t\t\t\ticon=\"sign-in\"\n\t\t\t\t\ttype=\"submit\"\n\t\t\t\t/>\n\t\t\t\t<CancelButton onClick={this.props.onClose} />\n\t\t\t\t<IconButton\n\t\t\t\t\ttitle={t(\"users.create\")}\n\t\t\t\t\tkind=\"default\"\n\t\t\t\t\ticon=\"plus\"\n\t\t\t\t\tonClick={this.props.onToggle}\n\t\t\t\t/>\n\t\t\t</>\n\t\t);\n\t};\n\n\tprivate onConnect = () => {\n\t\tconst { onClose, onConnect, onError } = this.props;\n\t\tconst { id, secret } = this.state;\n\t\tif (id.trim().length === 0) {\n\t\t\tonError(\"users.id_is_invalid\");\n\t\t\treturn;\n\t\t}\n\t\tif (secret.trim().length === 0) {\n\t\t\tonError(\"users.secret_is_invalid\");\n\t\t\treturn;\n\t\t}\n\t\tonConnect(id, secret);\n\t\tonClose();\n\t};\n}\n\nexport default withTranslation()(ConnectUserModal);\n","import { connect } from \"react-redux\";\nimport { ThunkDispatch } from \"redux-thunk\";\n//\nimport { RootState } from \"../../reducers\";\nimport ConnectUserModal from \"../../components/Users/ConnectUserModal\";\nimport { connectUser } from \"../../actions/user\";\nimport { popModal, openModal } from \"../../actions/modals\";\nimport { displayError } from \"../../actions/messages\";\n\n// ------------------------------------------------------------------\n\nconst stateToProps = (state: RootState) => {\n\treturn {};\n};\n\nconst dispatchToProps = (dispatch: ThunkDispatch<RootState, any, any>) => ({\n\tonClose: () => dispatch(popModal()),\n\tonConnect: (id: string, secret: string) =>\n\t\tdispatch(connectUser(id, secret)),\n\tonError: (message: string) => dispatch(displayError(message)),\n\tonToggle: () => dispatch(openModal({ type: \"CreateUser\", props: null }))\n});\n\nexport type MappedProps = ReturnType<typeof stateToProps> &\n\tReturnType<typeof dispatchToProps>;\n\nexport default connect(stateToProps, dispatchToProps)(ConnectUserModal);\n","import React, { Component } from \"react\";\nimport { withTranslation, WithTranslation } from \"react-i18next\";\n//\nimport { copyToClipboard } from \"../../utils/clipboard\";\nimport IconButton from \"../Common/IconButton\";\nimport { MappedProps } from \"../../containers/Modals/SecretField\";\n\n// ------------------------------------------------------------------\n\ntype Props = {\n\tid: string;\n\tlabel: string;\n\tonChange: (value: string) => void;\n\tplaceholder: string;\n\tvalue: string;\n};\n\nclass SecretField extends Component<Props & MappedProps & WithTranslation> {\n\tpublic render = () => {\n\t\tconst { id, label, onChange, placeholder, value } = this.props;\n\t\treturn (\n\t\t\t<div className=\"ModalField\">\n\t\t\t\t<label htmlFor={id}>{label}</label>\n\t\t\t\t<div\n\t\t\t\t\tstyle={{\n\t\t\t\t\t\tdisplay: \"flex\",\n\t\t\t\t\t\tflexDirection: \"row\",\n\t\t\t\t\t\tjustifyContent: \"space-between\"\n\t\t\t\t\t}}>\n\t\t\t\t\t<input\n\t\t\t\t\t\tstyle={{\n\t\t\t\t\t\t\tflexGrow: 1,\n\t\t\t\t\t\t\tmarginRight: \"0.5rem\"\n\t\t\t\t\t\t}}\n\t\t\t\t\t\tid={id}\n\t\t\t\t\t\ttype=\"password\"\n\t\t\t\t\t\tplaceholder={placeholder}\n\t\t\t\t\t\tmaxLength={36}\n\t\t\t\t\t\tminLength={36}\n\t\t\t\t\t\trequired={true}\n\t\t\t\t\t\tvalue={value}\n\t\t\t\t\t\tonChange={e => onChange(e.target.value)}\n\t\t\t\t\t/>\n\t\t\t\t\t<IconButton\n\t\t\t\t\t\ticon=\"clipboard\"\n\t\t\t\t\t\tonClick={this.onCopyToClipboard}\n\t\t\t\t\t\tsize=\"M\"\n\t\t\t\t\t\ttitle={`Copy to Clipboard`}\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t);\n\t};\n\n\tprivate onCopyToClipboard = async () => {\n\t\tconst { onMessage, value, t } = this.props;\n\t\tawait copyToClipboard(value);\n\t\tonMessage(t(\"secret_copied_to_clipboard\"));\n\t};\n}\n\nexport default withTranslation()(SecretField);\n","import { connect } from \"react-redux\";\n//\nimport SecretField from \"../../components/Modals/SecretField\";\nimport { RootState } from \"../../reducers\";\nimport { displayMessage } from \"../../actions/messages\";\n\n// ------------------------------------------------------------------\n\nconst mapStateToProps = (state: RootState) => ({});\n\nconst mapDispatchToProps = (dispatch: any) => ({\n  onMessage: (message: string) => dispatch(displayMessage(\"info\", message))\n});\n\nexport type MappedProps = ReturnType<typeof mapStateToProps> &\n  ReturnType<typeof mapDispatchToProps>;\n\nexport default connect(mapStateToProps, mapDispatchToProps)(SecretField);\n","import React, { Component, RefObject, createRef } from \"react\";\nimport { withTranslation, WithTranslation } from \"react-i18next\";\nimport { v4 } from \"uuid\";\n//\nimport FormModal from \"../Modals/FormModal\";\nimport { MappedProps } from \"../../containers/Room/CreateRoomModal\";\nimport IconButton, { CancelButton } from \"../Common/IconButton\";\nimport SecretField from \"../../containers/Modals/SecretField\";\n\n// ------------------------------------------------------------------\n\nlet ROOM_COUNTER = 1;\n\n// ------------------------------------------------------------------\n\ntype State = {\n\tname: string;\n\tsecret: string;\n};\n\nclass CreateRoomModal extends Component<MappedProps & WithTranslation, State> {\n\tprivate nameRef: RefObject<HTMLInputElement> = createRef();\n\n\tpublic readonly state: State = {\n\t\tname: \"\",\n\t\tsecret: v4()\n\t};\n\n\tpublic componentDidMount() {\n\t\tthis.setState({\n\t\t\tname: `${this.props.t(\"rooms.room\")} ${ROOM_COUNTER}`\n\t\t});\n\t\tif (this.nameRef.current) {\n\t\t\tthis.nameRef.current.focus();\n\t\t}\n\t}\n\n\tpublic render = () => {\n\t\tconst { t } = this.props;\n\t\tconst { name, secret } = this.state;\n\t\treturn (\n\t\t\t<FormModal\n\t\t\t\ttitle={t(\"rooms.room_creation\")}\n\t\t\t\tonSubmit={this.onCreate}\n\t\t\t\trenderButtons={this.renderButtons}>\n\t\t\t\t<div className=\"ModalField\">\n\t\t\t\t\t<label htmlFor=\"modal-name\">{t(\"rooms.name\")}</label>\n\t\t\t\t\t<input\n\t\t\t\t\t\tid=\"modal-name\"\n\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\tplaceholder={t(\"rooms.name_placeholder\")}\n\t\t\t\t\t\tmaxLength={100}\n\t\t\t\t\t\tminLength={2}\n\t\t\t\t\t\trequired={true}\n\t\t\t\t\t\tvalue={name}\n\t\t\t\t\t\tref={this.nameRef}\n\t\t\t\t\t\tonChange={e => this.setState({ name: e.target.value })}\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<SecretField\n\t\t\t\t\tid=\"modal-secret\"\n\t\t\t\t\tlabel={t(\"rooms.key\")}\n\t\t\t\t\tplaceholder={t(\"rooms.key_placeholder\")}\n\t\t\t\t\tvalue={secret}\n\t\t\t\t\tonChange={newSecret => this.setState({ secret: newSecret })}\n\t\t\t\t/>\n\t\t\t</FormModal>\n\t\t);\n\t};\n\n\tprivate renderButtons = () => {\n\t\tconst { t } = this.props;\n\t\treturn (\n\t\t\t<>\n\t\t\t\t<IconButton\n\t\t\t\t\ttitle={t(\"rooms.create\")}\n\t\t\t\t\tkind=\"primary\"\n\t\t\t\t\ticon=\"plus\"\n\t\t\t\t\ttype=\"submit\"\n\t\t\t\t/>\n\t\t\t\t<CancelButton onClick={this.props.onClose} />\n\t\t\t</>\n\t\t);\n\t};\n\n\tprivate onCreate = () => {\n\t\tconst { onClose, onCreate, onError } = this.props;\n\t\tconst { name, secret } = this.state;\n\t\tif (name.trim().length === 0) {\n\t\t\tonError(\"rooms.name_is_invalid\");\n\t\t\treturn;\n\t\t}\n\t\tif (secret.trim().length === 0) {\n\t\t\tonError(\"rooms.secret_is_invalid\");\n\t\t\treturn;\n\t\t}\n\t\tonCreate(name, secret);\n\t\tonClose();\n\t\tROOM_COUNTER++;\n\t};\n}\n\nexport default withTranslation()(CreateRoomModal);\n","import { connect } from \"react-redux\";\nimport { ThunkDispatch } from \"redux-thunk\";\n//\nimport { RootState } from \"../../reducers\";\nimport CreateRoomModal from \"../../components/Room/CreateRoomModal\";\nimport { createRoom } from \"../../actions/room\";\nimport { popModal } from \"../../actions/modals\";\nimport { displayError } from \"../../actions/messages\";\n\n// ------------------------------------------------------------------\n\nconst stateToProps = (state: RootState) => {\n\treturn {};\n};\n\nconst dispatchToProps = (dispatch: ThunkDispatch<RootState, any, any>) => ({\n\tonClose: () => dispatch(popModal()),\n\tonCreate: (name: string, secret: string) =>\n\t\tdispatch(createRoom(name, secret)),\n\tonError: (message: string) => dispatch(displayError(message))\n});\n\nexport type MappedProps = ReturnType<typeof stateToProps> &\n\tReturnType<typeof dispatchToProps>;\n\nexport default connect(stateToProps, dispatchToProps)(CreateRoomModal);\n","import React, { Component, RefObject, createRef } from \"react\";\nimport { withTranslation, WithTranslation } from \"react-i18next\";\nimport { v4 } from \"uuid\";\n//\nimport FormModal from \"../Modals/FormModal\";\nimport { MappedProps } from \"../../containers/Users/CreateUserModal\";\nimport IconButton, { CancelButton } from \"../Common/IconButton\";\nimport SecretField from \"../../containers/Modals/SecretField\";\n\n// ------------------------------------------------------------------\n\nlet USER_COUNTER = 1;\n\n// ------------------------------------------------------------------\n\ntype State = {\n\tname: string;\n\tsecret: string;\n};\n\nclass CreateUserModal extends Component<MappedProps & WithTranslation, State> {\n\tprivate nameRef: RefObject<HTMLInputElement> = createRef();\n\n\tpublic readonly state: State = {\n\t\tname: \"\",\n\t\tsecret: v4()\n\t};\n\n\tpublic componentDidMount() {\n\t\tthis.setState({\n\t\t\tname: `${this.props.t(\"users.user\")} ${USER_COUNTER}`\n\t\t});\n\t\tif (this.nameRef.current) {\n\t\t\tthis.nameRef.current.focus();\n\t\t}\n\t}\n\n\tpublic render = () => {\n\t\tconst { t } = this.props;\n\t\tconst { name, secret } = this.state;\n\t\treturn (\n\t\t\t<FormModal\n\t\t\t\ttitle={t(\"users.user_creation\")}\n\t\t\t\tonSubmit={this.onCreate}\n\t\t\t\trenderButtons={this.renderButtons}>\n\t\t\t\t<div className=\"ModalField\">\n\t\t\t\t\t<label htmlFor=\"modal-name\">{t(\"users.name\")}</label>\n\t\t\t\t\t<input\n\t\t\t\t\t\tid=\"modal-name\"\n\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\tplaceholder={t(\"users.name_placeholder\")}\n\t\t\t\t\t\tmaxLength={100}\n\t\t\t\t\t\tminLength={2}\n\t\t\t\t\t\trequired={true}\n\t\t\t\t\t\tvalue={name}\n\t\t\t\t\t\tref={this.nameRef}\n\t\t\t\t\t\tonChange={e => this.setState({ name: e.target.value })}\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<SecretField\n\t\t\t\t\tid=\"modal-secret\"\n\t\t\t\t\tlabel={t(\"users.secret\")}\n\t\t\t\t\tplaceholder={t(\"users.secret_placeholder\")}\n\t\t\t\t\tvalue={secret}\n\t\t\t\t\tonChange={newSecret => this.setState({ secret: newSecret })}\n\t\t\t\t/>\n\t\t\t</FormModal>\n\t\t);\n\t};\n\n\tprivate renderButtons = () => {\n\t\tconst { t } = this.props;\n\t\treturn (\n\t\t\t<>\n\t\t\t\t<IconButton\n\t\t\t\t\ttitle={t(\"users.create\")}\n\t\t\t\t\tkind=\"primary\"\n\t\t\t\t\ticon=\"plus\"\n\t\t\t\t\ttype=\"submit\"\n\t\t\t\t/>\n\t\t\t\t<CancelButton onClick={this.props.onClose} />\n\t\t\t\t<IconButton\n\t\t\t\t\ttitle={t(\"users.connect\")}\n\t\t\t\t\tkind=\"default\"\n\t\t\t\t\ticon=\"sign-in\"\n\t\t\t\t\tonClick={this.props.onToggle}\n\t\t\t\t/>\n\t\t\t</>\n\t\t);\n\t};\n\n\tprivate onCreate = () => {\n\t\tconst { onClose, onCreate, onError } = this.props;\n\t\tconst { name, secret } = this.state;\n\t\tif (name.trim().length === 0) {\n\t\t\tonError(\"users.name_is_invalid\");\n\t\t\treturn;\n\t\t}\n\t\tif (secret.trim().length === 0) {\n\t\t\tonError(\"users.secret_is_invalid\");\n\t\t\treturn;\n\t\t}\n\t\tonCreate(name, secret);\n\t\tonClose();\n\t\tUSER_COUNTER++;\n\t};\n}\n\nexport default withTranslation()(CreateUserModal);\n","import { connect } from \"react-redux\";\nimport { ThunkDispatch } from \"redux-thunk\";\n//\nimport { RootState } from \"../../reducers\";\nimport CreateUserModal from \"../../components/Users/CreateUserModal\";\nimport { createUser } from \"../../actions/user\";\nimport { popModal, openModal } from \"../../actions/modals\";\nimport { displayError } from \"../../actions/messages\";\n\n// ------------------------------------------------------------------\n\nconst stateToProps = (state: RootState) => {\n\treturn {};\n};\n\nconst dispatchToProps = (dispatch: ThunkDispatch<RootState, any, any>) => ({\n\tonClose: () => dispatch(popModal()),\n\tonCreate: (name: string, secret: string) =>\n\t\tdispatch(createUser(name, secret)),\n\tonError: (message: string) => dispatch(displayError(message)),\n\tonToggle: () => dispatch(openModal({ type: \"ConnectUser\", props: null }))\n});\n\nexport type MappedProps = ReturnType<typeof stateToProps> &\n\tReturnType<typeof dispatchToProps>;\n\nexport default connect(stateToProps, dispatchToProps)(CreateUserModal);\n","// import Axios from \"axios\";\nimport jsonp from \"jsonp\";\n//\nimport { sleep } from \".\";\nimport {\n\tSearchResults,\n\tContainer,\n\tContainerType,\n\tAlbum,\n\tPlaylist,\n\tTrack,\n\tMediaType\n} from \"./medias\";\n\n// ------------------------------------------------------------------\n\nconst RATE_LIMIT_DELAY = 5000; // ms\n\n// ------------------------------------------------------------------\n\nexport type ApiError = {\n\tcode: number;\n\tmessage: string;\n\ttype: string;\n};\n\nexport type ApiAlbum = {\n\terror?: ApiError;\n\tartist: {\n\t\tid: number;\n\t\tname: string;\n\t\tpicture_big: string;\n\t\tpicture_small: string;\n\t};\n\tcover_big: string;\n\tcover_small: string;\n\tid: number;\n\ttitle: string;\n\ttracks?: { data: ApiTrack[] };\n};\n\nexport type ApiPlaylist = {\n\terror?: ApiError;\n\tcreator?: {\n\t\tid: number;\n\t\tname: string;\n\t};\n\tid: number;\n\tpicture_big: string;\n\tpicture_small: string;\n\tpublic: true;\n\ttitle: string;\n\ttracks?: { data: ApiTrack[] };\n\tuser?: {\n\t\tid: number;\n\t\tname: string;\n\t};\n};\n\nexport type ApiTrack = {\n\terror?: ApiError;\n\talbum: {\n\t\tcover_big: string;\n\t\tcover_small: string;\n\t\tid: number;\n\t\ttitle: string;\n\t};\n\tartist: {\n\t\tid: number;\n\t\tname: string;\n\t\tpicture_big: string;\n\t\tpicture_small: string;\n\t};\n\tduration: number;\n\tid: number;\n\tpreview: string;\n\treadable: boolean;\n\ttitle: string;\n};\n\nexport type ApiSearchResult<T> = {\n\tdata: T[];\n\ttotal: number;\n};\n\n// ------------------------------------------------------------------\n\nconst ConvertAlbum = (album: ApiAlbum): Album => ({\n\tartist: {\n\t\tid: album.artist.id.toString(),\n\t\tname: album.artist.name,\n\t\tlink: `https://www.deezer.com/artist/${album.artist.id}`,\n\t\tpicture_big: album.artist.picture_big,\n\t\tpicture_small: album.artist.picture_small\n\t},\n\tcover_big: album.cover_big,\n\tcover_small: album.cover_small,\n\tid: album.id.toString(),\n\tlink: `https://www.deezer.com/album/${album.id}`,\n\ttitle: album.title,\n\ttracks:\n\t\talbum.tracks !== void 0\n\t\t\t? album.tracks.data\n\t\t\t\t\t.filter(track => track.readable && track.preview)\n\t\t\t\t\t.map(track => ConvertTrack(track, album))\n\t\t\t: void 0,\n\ttype: \"album\"\n});\n\nconst ConvertPlaylist = (\n\tplaylist: ApiPlaylist,\n\tuser: { id: number; name: string }\n): Playlist => ({\n\tid: playlist.id.toString(),\n\tlink: `https://www.deezer.com/playlist/${playlist.id}`,\n\tpicture_big: playlist.picture_big,\n\tpicture_small: playlist.picture_small,\n\ttitle: playlist.title,\n\ttracks:\n\t\tplaylist.tracks !== void 0\n\t\t\t? playlist.tracks.data\n\t\t\t\t\t.filter(track => track.readable && track.preview)\n\t\t\t\t\t.map(track => ConvertTrack(track, track.album))\n\t\t\t: void 0,\n\ttype: \"playlist\",\n\tuser: {\n\t\tid: user.id.toString(),\n\t\tname: user.name,\n\t\tlink: `https://www.deezer.com/profile/${user.id}`\n\t}\n});\n\nconst ConvertTrack = (\n\ttrack: ApiTrack,\n\talbum: { id: number; title: string; cover_big: string; cover_small: string }\n): Track => ({\n\talbum: {\n\t\tid: album.id.toString(),\n\t\tlink: `https://www.deezer.com/album/${album.id}`,\n\t\ttitle: album.title,\n\t\tcover_big: album.cover_big,\n\t\tcover_small: album.cover_small\n\t},\n\tartist: {\n\t\tid: track.artist.id.toString(),\n\t\tname: track.artist.name,\n\t\tlink: `https://www.deezer.com/artist/${track.artist.id}`,\n\t\tpicture_big: track.artist.picture_big,\n\t\tpicture_small: track.artist.picture_small\n\t},\n\tduration: track.duration,\n\tid: track.id.toString(),\n\tlink: `https://www.deezer.com/track/${track.id}`,\n\tpreview: track.preview,\n\ttitle: track.title,\n\ttype: \"track\"\n});\n\n// ------------------------------------------------------------------\n\nexport const DeezerApi = () => {\n\tconst API_BASE = \"https://api.deezer.com\";\n\n\tconst _asyncJsonp = <T>(url: string): Promise<T> =>\n\t\tnew Promise((resolve, reject) => {\n\t\t\tjsonp(url, void 0, (err, data) => {\n\t\t\t\tif (err) {\n\t\t\t\t\treject(new Error(err.message));\n\t\t\t\t} else {\n\t\t\t\t\tresolve(data);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\tconst _call = async <T>(path: string, qs?: string) => {\n\t\t// We have to rely on jsonp because the Deezer api is CORS restricted\n\t\tconst fullpath = qs\n\t\t\t? `${API_BASE}/${path}?${qs}&output=jsonp&callback=`\n\t\t\t: `${API_BASE}/${path}?output=jsonp&callback=`;\n\t\treturn await _asyncJsonp<T>(fullpath);\n\t};\n\n\tconst _search = <T>(type: MediaType, query: string) =>\n\t\t_call<ApiSearchResult<T>>(\n\t\t\t`search/${type}`,\n\t\t\t`q=${encodeURIComponent(query)}`\n\t\t);\n\n\tconst _load = <T extends { error?: ApiError }>(\n\t\ttype: MediaType,\n\t\tids: string[]\n\t) =>\n\t\tPromise.all(\n\t\t\tids.map(async id => {\n\t\t\t\tconst media = await _call<T>(`${type}/${id}`);\n\t\t\t\treturn media.error ? null : media;\n\t\t\t})\n\t\t);\n\n\tconst _loadWithRetry = async <T extends { error?: ApiError }>(\n\t\ttype: MediaType,\n\t\tids: string[]\n\t) => {\n\t\tlet first = true;\n\t\tconst medias: Array<T | null> = ids.map(() => null);\n\t\twhile (medias.includes(null)) {\n\t\t\tconst subIds: string[] = [];\n\t\t\tconst subIndexes: number[] = [];\n\t\t\tmedias.forEach((media, index) => {\n\t\t\t\tif (!media) {\n\t\t\t\t\tsubIds.push(ids[index]);\n\t\t\t\t\tsubIndexes.push(index);\n\t\t\t\t}\n\t\t\t});\n\t\t\tif (!first) {\n\t\t\t\tconsole.debug(`Handling rate limit delayed batch...`, {\n\t\t\t\t\tsubIds\n\t\t\t\t});\n\t\t\t\tawait sleep(RATE_LIMIT_DELAY);\n\t\t\t}\n\t\t\tconst subMedias = await _load<T>(type, subIds);\n\t\t\tsubIndexes.forEach((index, subIndex) => {\n\t\t\t\tmedias[index] = subMedias[subIndex];\n\t\t\t});\n\t\t\tfirst = false;\n\t\t}\n\t\treturn medias as T[];\n\t};\n\n\tconst _searchAlbums = (query: string) => _search<ApiAlbum>(\"album\", query);\n\n\tconst _searchPlaylists = (query: string) =>\n\t\t_search<ApiPlaylist>(\"playlist\", query);\n\n\tconst _searchTracks = (query: string) => _search<ApiTrack>(\"track\", query);\n\n\tconst search = async (query: string): Promise<SearchResults> => {\n\t\tconst [album, playlist, track] = await Promise.all([\n\t\t\t_searchAlbums(query),\n\t\t\t_searchPlaylists(query),\n\t\t\t_searchTracks(query)\n\t\t]);\n\t\treturn {\n\t\t\t// keys are MediaType\n\t\t\talbum: album.data.map(ConvertAlbum),\n\t\t\tplaylist: playlist.data\n\t\t\t\t.filter(playlist => playlist.public)\n\t\t\t\t.map(playlist => ConvertPlaylist(playlist, playlist.user!)),\n\t\t\ttrack: track.data\n\t\t\t\t.filter(track => track.readable && track.preview)\n\t\t\t\t.map(track => ConvertTrack(track, track.album))\n\t\t};\n\t};\n\n\tconst loadAlbums = async (ids: string[]): Promise<Album[]> => {\n\t\tconst albums = await _loadWithRetry<ApiAlbum>(\"album\", ids);\n\t\treturn albums.map(album => ConvertAlbum(album));\n\t};\n\n\tconst loadPlaylists = async (ids: string[]): Promise<Playlist[]> => {\n\t\tconst playlists = await _loadWithRetry<ApiPlaylist>(\"playlist\", ids);\n\t\treturn playlists.map(playlist =>\n\t\t\tConvertPlaylist(playlist, playlist.creator!)\n\t\t);\n\t};\n\n\tconst loadContainers = async (\n\t\ttype: ContainerType,\n\t\tids: string[]\n\t): Promise<Container[]> => {\n\t\tswitch (type) {\n\t\t\tcase \"album\":\n\t\t\t\treturn loadAlbums(ids);\n\t\t\tcase \"playlist\":\n\t\t\t\treturn loadPlaylists(ids);\n\t\t}\n\t};\n\n\tconst loadTracks = async (ids: string[]): Promise<Track[]> => {\n\t\tconst tracks = await _loadWithRetry<ApiTrack>(\"track\", ids);\n\t\treturn tracks.map(track => ConvertTrack(track, track.album));\n\t};\n\n\treturn {\n\t\tsearch,\n\t\tloadContainers,\n\t\tloadTracks\n\t};\n};\n\n// ------------------------------------------------------------------\n\nexport const DEFAULT_API = DeezerApi();\n","export type MediaAccess = {\n\tid: string;\n\tprovider: ProviderType;\n\ttype: MediaType;\n};\n\nexport type ContainerType = \"album\" | \"playlist\";\n\nexport type MediaType = ContainerType | \"track\";\n\nexport type MediaTypeDefinition = {\n\tlabel: string;\n\tprovider: ProviderType;\n\ttype: MediaType;\n};\n\nexport type ProviderType = \"deezer\";\n\nexport type TrackType = \"track\";\n\n// ------------------------------------------------------------------\n\nexport type Album = {\n\tartist: {\n\t\tid: string;\n\t\tlink: string;\n\t\tname: string;\n\t\tpicture_big: string;\n\t\tpicture_small: string;\n\t};\n\tcover_big: string;\n\tcover_small: string;\n\tid: string;\n\tlink: string;\n\ttitle: string;\n\ttracks?: Track[];\n\ttype: \"album\";\n};\n\nexport type Playlist = {\n\tid: string;\n\tlink: string;\n\tpicture_big: string;\n\tpicture_small: string;\n\ttitle: string;\n\ttracks?: Track[];\n\ttype: \"playlist\";\n\tuser: {\n\t\tid: string;\n\t\tlink: string;\n\t\tname: string;\n\t};\n};\n\nexport type Track = {\n\talbum: {\n\t\tcover_big: string;\n\t\tcover_small: string;\n\t\tid: string;\n\t\tlink: string;\n\t\ttitle: string;\n\t};\n\tartist: {\n\t\tid: string;\n\t\tname: string;\n\t\tlink: string;\n\t\tpicture_big: string;\n\t\tpicture_small: string;\n\t};\n\tduration: number;\n\tid: string;\n\tlink: string;\n\tpreview: string;\n\ttitle: string;\n\ttype: \"track\";\n};\n\nexport type Container = Album | Playlist;\n\nexport type Media = Container | Track;\n\n// ------------------------------------------------------------------\n\nexport type SearchResults = {\n\t// keys are MediaType\n\talbum: Album[];\n\tplaylist: Playlist[];\n\ttrack: Track[];\n};\n\n// ------------------------------------------------------------------\n\nexport const MEDIA_TYPE_DEFINITIONS: MediaTypeDefinition[] = [\n\t{\n\t\tlabel: \"medias.albums\",\n\t\tprovider: \"deezer\",\n\t\ttype: \"album\"\n\t},\n\t{\n\t\tlabel: \"medias.playlists\",\n\t\tprovider: \"deezer\",\n\t\ttype: \"playlist\"\n\t},\n\t{\n\t\tlabel: \"medias.tracks\",\n\t\tprovider: \"deezer\",\n\t\ttype: \"track\"\n\t}\n];\n","import React, { ReactNode } from \"react\";\n//\nimport { Media } from \"../../utils/medias\";\n\n// ------------------------------------------------------------------\n\nconst MAX_RESULTS_COUNT = 5;\n\n// ------------------------------------------------------------------\n\nconst SearchResultCategory = ({\n\titems,\n\tlabel,\n\tcb\n}: {\n\titems: Media[];\n\tlabel: string;\n\tcb: (item: Media) => ReactNode;\n}) =>\n\titems.length > 0 ? (\n\t\t<>\n\t\t\t<div className=\"ModalField\">\n\t\t\t\t<label>{label}</label>\n\t\t\t</div>\n\t\t\t{items.slice(0, MAX_RESULTS_COUNT).map(item => (\n\t\t\t\t<div key={item.id} className=\"ModalField\">\n\t\t\t\t\t<div className=\"SearchResultItem\">{cb(item)}</div>\n\t\t\t\t</div>\n\t\t\t))}\n\t\t</>\n\t) : null;\n\nexport default SearchResultCategory;\n","import React, { Component, createRef, RefObject } from \"react\";\nimport { withTranslation, WithTranslation } from \"react-i18next\";\n//\nimport FormModal from \"../Modals/FormModal\";\nimport { MappedProps } from \"../../containers/Room/SearchModal\";\nimport IconButton, { CancelButton } from \"../Common/IconButton\";\nimport { DEFAULT_API } from \"../../utils/deezer\";\nimport Media from \"./Medias\";\nimport {\n\tMEDIA_TYPE_DEFINITIONS,\n\tMediaType,\n\tProviderType,\n\tSearchResults\n} from \"../../utils/medias\";\nimport SearchResultCategory from \"./SearchResultCategory\";\nimport \"./SearchModal.scss\";\n\n// ------------------------------------------------------------------\n\ntype State = {\n\tplayingMediaId: string;\n\tplayingMediaType: MediaType;\n\tprovider: ProviderType;\n\tquery: string;\n\tresults: SearchResults;\n};\n\nclass SearchModal extends Component<MappedProps & WithTranslation, State> {\n\tprivate queryRef: RefObject<HTMLInputElement> = createRef();\n\n\tpublic readonly state: State = {\n\t\tplayingMediaId: \"\",\n\t\tplayingMediaType: \"track\",\n\t\tprovider: \"deezer\",\n\t\tquery: \"\",\n\t\tresults: {\n\t\t\t// keys are MediaType\n\t\t\talbum: [],\n\t\t\tplaylist: [],\n\t\t\ttrack: []\n\t\t}\n\t};\n\n\tpublic componentDidMount() {\n\t\tif (this.queryRef.current) {\n\t\t\tthis.queryRef.current.focus();\n\t\t}\n\t}\n\n\tpublic componentWillUnmount() {\n\t\tthis.props.onStop();\n\t}\n\n\tpublic render = () => {\n\t\tconst { t } = this.props;\n\t\treturn (\n\t\t\t<FormModal\n\t\t\t\tclassName=\"SearchModal\"\n\t\t\t\ttitle={t(\"medias.medias_search\")}\n\t\t\t\tonSubmit={this.onSearch}\n\t\t\t\trenderButtons={this.renderButtons}>\n\t\t\t\t{this.renderInputs()}\n\t\t\t\t{this.renderResults()}\n\t\t\t</FormModal>\n\t\t);\n\t};\n\n\tprivate renderButtons = () => {\n\t\tconst { t } = this.props;\n\t\treturn (\n\t\t\t<>\n\t\t\t\t<IconButton\n\t\t\t\t\ttitle={t(\"medias.search\")}\n\t\t\t\t\tkind=\"primary\"\n\t\t\t\t\ticon=\"search\"\n\t\t\t\t\ttype=\"submit\"\n\t\t\t\t/>\n\t\t\t\t<CancelButton onClick={this.props.onClose} />\n\t\t\t</>\n\t\t);\n\t};\n\n\tprivate renderInputs = () => {\n\t\tconst { t } = this.props;\n\t\tconst { query } = this.state;\n\t\treturn (\n\t\t\t<div className=\"ModalField\">\n\t\t\t\t<input\n\t\t\t\t\tid=\"modal-query\"\n\t\t\t\t\ttype=\"text\"\n\t\t\t\t\tplaceholder={t(\"medias.search_placeholder\")}\n\t\t\t\t\tmaxLength={100}\n\t\t\t\t\tminLength={2}\n\t\t\t\t\trequired={true}\n\t\t\t\t\tvalue={query}\n\t\t\t\t\tref={this.queryRef}\n\t\t\t\t\tonChange={e => {\n\t\t\t\t\t\tthis.setState({ query: e.target.value });\n\t\t\t\t\t}}\n\t\t\t\t/>\n\t\t\t</div>\n\t\t);\n\t};\n\n\tprivate renderResults = () => {\n\t\tconst { onSelect, locked, t } = this.props;\n\t\tconst {\n\t\t\tplayingMediaId,\n\t\t\tplayingMediaType,\n\t\t\tprovider,\n\t\t\tresults\n\t\t} = this.state;\n\t\treturn MEDIA_TYPE_DEFINITIONS.map(({ label, type }) => (\n\t\t\t<SearchResultCategory\n\t\t\t\tkey={type}\n\t\t\t\tlabel={t(label)}\n\t\t\t\titems={results[type]}\n\t\t\t\tcb={media => (\n\t\t\t\t\t<Media\n\t\t\t\t\t\tactions={\n\t\t\t\t\t\t\t!locked ? (\n\t\t\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\t\t\ttitle={t(\"medias.add\")}\n\t\t\t\t\t\t\t\t\ticon=\"plus\"\n\t\t\t\t\t\t\t\t\tonClick={() =>\n\t\t\t\t\t\t\t\t\t\tonSelect(provider, type, media.id)\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t) : null\n\t\t\t\t\t\t}\n\t\t\t\t\t\tmedia={media}\n\t\t\t\t\t\tmediaType={type}\n\t\t\t\t\t\tplayable={true}\n\t\t\t\t\t\tplaying={\n\t\t\t\t\t\t\tplayingMediaType === type &&\n\t\t\t\t\t\t\tplayingMediaId === media.id\n\t\t\t\t\t\t}\n\t\t\t\t\t\tonPlay={() => this.onStartPreview(type, media.id)}\n\t\t\t\t\t\tonStop={this.onStopPreview}\n\t\t\t\t\t/>\n\t\t\t\t)}\n\t\t\t/>\n\t\t));\n\t};\n\n\tprivate onSearch = async () => {\n\t\tconst { query } = this.state;\n\t\tif (query.trim().length > 0) {\n\t\t\tthis.setState({ results: await DEFAULT_API.search(query) });\n\t\t}\n\t};\n\n\tprivate onStartPreview = (\n\t\tplayingMediaType: MediaType,\n\t\tplayingMediaId: string\n\t) => {\n\t\tthis.props.onPlay(\n\t\t\tthis.state.provider,\n\t\t\tplayingMediaType,\n\t\t\tplayingMediaId\n\t\t);\n\t\tthis.setState({\n\t\t\tplayingMediaId,\n\t\t\tplayingMediaType\n\t\t});\n\t};\n\n\tprivate onStopPreview = () => {\n\t\tthis.props.onStop();\n\t\tthis.setState({\n\t\t\tplayingMediaId: \"\",\n\t\t\tplayingMediaType: \"track\"\n\t\t});\n\t};\n}\n\nexport default withTranslation()(SearchModal);\n","import { connect } from \"react-redux\";\nimport { ThunkDispatch } from \"redux-thunk\";\n//\nimport { RootState } from \"../../reducers\";\nimport SearchModal from \"../../components/Room/SearchModal\";\nimport { popModal } from \"../../actions/modals\";\nimport { loadMedias } from \"../../actions/medias\";\nimport { stopPreview } from \"../../actions/player\";\nimport { ProviderType, MediaType } from \"../../utils/medias\";\nimport { isRoomLocked } from \"../../selectors/room\";\n\n// ------------------------------------------------------------------\n\nconst stateToProps = (state: RootState) => ({\n\tlocked: isRoomLocked(state)\n});\n\nconst dispatchToProps = (dispatch: ThunkDispatch<RootState, any, any>) => ({\n\tonClose: () => dispatch(popModal()),\n\tonSelect: (provider: ProviderType, mediaType: MediaType, mediaId: string) =>\n\t\tdispatch(loadMedias(provider, mediaType, [mediaId], true, false)),\n\tonPlay: (provider: ProviderType, mediaType: MediaType, mediaId: string) =>\n\t\tdispatch(loadMedias(provider, mediaType, [mediaId], false, true)),\n\tonStop: () => dispatch(stopPreview())\n});\n\nexport type MappedProps = ReturnType<typeof stateToProps> &\n\tReturnType<typeof dispatchToProps>;\n\nexport default connect(stateToProps, dispatchToProps)(SearchModal);\n","import React, { Component, createRef, RefObject } from \"react\";\nimport { withTranslation, WithTranslation } from \"react-i18next\";\n//\nimport FormModal from \"../Modals/FormModal\";\nimport { MappedProps } from \"../../containers/Room/UnlockRoomModal\";\nimport IconButton, { CancelButton } from \"../Common/IconButton\";\n\n// ------------------------------------------------------------------\n\ntype State = {\n\tsecret: string;\n};\n\nclass UnlockRoomModal extends Component<MappedProps & WithTranslation, State> {\n\tprivate secretRef: RefObject<HTMLInputElement> = createRef();\n\n\tpublic readonly state: State = {\n\t\tsecret: \"\"\n\t};\n\n\tpublic componentDidMount() {\n\t\tif (this.secretRef.current) {\n\t\t\tthis.secretRef.current.focus();\n\t\t}\n\t}\n\n\tpublic render = () => {\n\t\tconst { t } = this.props;\n\t\tconst { secret } = this.state;\n\t\treturn (\n\t\t\t<FormModal\n\t\t\t\ttitle={t(\"rooms.room_unlocking\")}\n\t\t\t\tonSubmit={this.onUnlock}\n\t\t\t\trenderButtons={this.renderButtons}>\n\t\t\t\t<div className=\"ModalField\">\n\t\t\t\t\t<label htmlFor=\"modal-secret\">{t(\"rooms.key\")}</label>\n\t\t\t\t\t<input\n\t\t\t\t\t\tid=\"modal-secret\"\n\t\t\t\t\t\ttype=\"password\"\n\t\t\t\t\t\tplaceholder={t(\"rooms.key_placeholder\")}\n\t\t\t\t\t\tmaxLength={36}\n\t\t\t\t\t\tminLength={36}\n\t\t\t\t\t\trequired={true}\n\t\t\t\t\t\tvalue={secret}\n\t\t\t\t\t\tref={this.secretRef}\n\t\t\t\t\t\tonChange={e => {\n\t\t\t\t\t\t\tthis.setState({ secret: e.target.value });\n\t\t\t\t\t\t}}\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</FormModal>\n\t\t);\n\t};\n\n\tprivate renderButtons = () => {\n\t\tconst { t } = this.props;\n\t\treturn (\n\t\t\t<>\n\t\t\t\t<IconButton\n\t\t\t\t\ttitle={t(\"rooms.unlock\")}\n\t\t\t\t\tkind=\"primary\"\n\t\t\t\t\ticon=\"unlock\"\n\t\t\t\t\ttype=\"submit\"\n\t\t\t\t/>\n\t\t\t\t<CancelButton onClick={this.props.onClose} />\n\t\t\t</>\n\t\t);\n\t};\n\n\tprivate onUnlock = () => {\n\t\tconst { onClose, onUnlock } = this.props;\n\t\tonUnlock(this.state.secret);\n\t\tonClose();\n\t};\n}\n\nexport default withTranslation()(UnlockRoomModal);\n","import { connect } from \"react-redux\";\nimport { ThunkDispatch } from \"redux-thunk\";\n//\nimport { RootState } from \"../../reducers\";\nimport UnlockRoomModal from \"../../components/Room/UnlockRoomModal\";\nimport { unlockRoom } from \"../../actions/room\";\nimport { popModal } from \"../../actions/modals\";\n\n// ------------------------------------------------------------------\n\nconst stateToProps = (state: RootState) => {\n\treturn {};\n};\n\nconst dispatchToProps = (dispatch: ThunkDispatch<RootState, any, any>) => ({\n\tonClose: () => dispatch(popModal()),\n\tonUnlock: (secret: string) => dispatch(unlockRoom(secret))\n});\n\nexport type MappedProps = ReturnType<typeof stateToProps> &\n\tReturnType<typeof dispatchToProps>;\n\nexport default connect(stateToProps, dispatchToProps)(UnlockRoomModal);\n","import React, { Component, MouseEvent } from \"react\";\nimport { CSSTransition } from \"react-transition-group\";\n//\nimport { MappedProps } from \"../../containers/Modals\";\nimport { ModalPrereq } from \"../../actions/modals\";\nimport ConfirmModal from \"../../containers/Modals/ConfirmModal\";\nimport ConnectUserModal from \"../../containers/Users/ConnectUserModal\";\nimport CreateRoomModal from \"../../containers/Room/CreateRoomModal\";\nimport CreateUserModal from \"../../containers/Users/CreateUserModal\";\nimport SearchModal from \"../../containers/Room/SearchModal\";\nimport UnlockRoomModal from \"../../containers/Room/UnlockRoomModal\";\nimport \"./index.scss\";\n\n// ------------------------------------------------------------------\n\nconst TransitionTimeout = 300;\n\n// ------------------------------------------------------------------\n\nexport const getModal = (prereq: ModalPrereq) => {\n\tswitch (prereq.type) {\n\t\tcase \"Confirm\":\n\t\t\treturn <ConfirmModal {...prereq.props} />;\n\t\tcase \"ConnectUser\":\n\t\t\treturn <ConnectUserModal />;\n\t\tcase \"CreateRoom\":\n\t\t\treturn <CreateRoomModal />;\n\t\tcase \"CreateUser\":\n\t\t\treturn <CreateUserModal />;\n\t\tcase \"Search\":\n\t\t\treturn <SearchModal />;\n\t\tcase \"UnlockRoom\":\n\t\t\treturn <UnlockRoomModal />;\n\t}\n};\n\n// ------------------------------------------------------------------\n\ntype State = {\n\tcurr_prereq?: ModalPrereq;\n\tprev_prereq?: ModalPrereq; // Keeping prev modal prereq for modal fadeout\n};\n\nclass Modals extends Component<MappedProps, State> {\n\tpublic readonly state: State = {\n\t\tcurr_prereq: void 0,\n\t\tprev_prereq: void 0\n\t};\n\n\tpublic componentDidMount = () => {\n\t\tdocument.addEventListener(\"keydown\", this.onKeyDown);\n\t};\n\n\tpublic componentWillUnmount = () => {\n\t\tdocument.removeEventListener(\"keydown\", this.onKeyDown);\n\t};\n\n\tpublic componentDidUpdate = (prevProps: MappedProps) => {\n\t\tconst oldPrereq = prevProps.prereq;\n\t\tconst newPrereq = this.props.prereq;\n\t\tif (oldPrereq !== newPrereq) {\n\t\t\t// Hide current modal before showing new one (if there is a new one)\n\t\t\tthis.setState(\n\t\t\t\t{\n\t\t\t\t\tcurr_prereq: void 0,\n\t\t\t\t\tprev_prereq: oldPrereq\n\t\t\t\t},\n\t\t\t\t() => {\n\t\t\t\t\tif (newPrereq) {\n\t\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\t\tthis.setState({\n\t\t\t\t\t\t\t\tcurr_prereq: newPrereq\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}, TransitionTimeout);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\t};\n\n\tpublic render = () => {\n\t\tconst { curr_prereq, prev_prereq } = this.state;\n\t\tconst prereq = curr_prereq || prev_prereq;\n\t\tlet modal = null;\n\t\tif (prereq) {\n\t\t\tmodal = getModal(prereq);\n\t\t}\n\t\treturn (\n\t\t\t<CSSTransition\n\t\t\t\tin={!!curr_prereq}\n\t\t\t\ttimeout={TransitionTimeout}\n\t\t\t\tunmountOnExit={true}>\n\t\t\t\t<div className=\"ModalOverlay\" onClick={this.onClickOverlay}>\n\t\t\t\t\t{modal && (\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclassName=\"ModalWrapper\"\n\t\t\t\t\t\t\trole=\"dialog\"\n\t\t\t\t\t\t\tonClick={this.onClickWrapper}>\n\t\t\t\t\t\t\t{modal}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\t\t\t\t</div>\n\t\t\t</CSSTransition>\n\t\t);\n\t};\n\n\tprivate onClickOverlay = (event: MouseEvent) => {\n\t\t// Clicking overlay will close current modal\n\t\tevent.stopPropagation();\n\t\tthis.props.onCloseModal();\n\t};\n\n\tprivate onClickWrapper = (event: MouseEvent) => {\n\t\t// Clicking wrapper modal will not progagate to overlay which would close current modal\n\t\tevent.stopPropagation();\n\t};\n\n\tprivate onKeyDown = (e: KeyboardEvent) => {\n\t\tif (e.keyCode === 27) {\n\t\t\tthis.props.onCloseModal();\n\t\t}\n\t};\n}\n\nexport default Modals;\n","import { connect } from \"react-redux\";\n//\nimport Modals from \"../../components/Modals\";\nimport { RootState } from \"../../reducers\";\nimport { popModal } from \"../../actions/modals\";\n\n// ------------------------------------------------------------------\n\nconst mapStateToProps = (state: RootState) => ({\n\tprereq:\n\t\tstate.modals.stack.length > 0\n\t\t\t? state.modals.stack[state.modals.stack.length - 1]\n\t\t\t: void 0\n});\n\nconst mapDispatchToProps = (dispatch: any) => ({\n\tonCloseModal: () => dispatch(popModal())\n});\n\nexport type MappedProps = ReturnType<typeof mapStateToProps> &\n\tReturnType<typeof mapDispatchToProps>;\n\nexport default connect(mapStateToProps, mapDispatchToProps)(Modals);\n","import React, { Component } from \"react\";\nimport classNames from \"classnames\";\nimport { TransitionGroup, CSSTransition } from \"react-transition-group\";\n//\nimport { MappedProps } from \"../../containers/App/Messages\";\nimport { Message } from \"../../utils/messages\";\nimport \"./Messages.scss\";\nimport { withTranslation, WithTranslation } from \"react-i18next\";\n\n// ------------------------------------------------------------------\n\nclass Messages extends Component<MappedProps & WithTranslation> {\n\tpublic render = () => (\n\t\t<div className=\"Messages\">\n\t\t\t<TransitionGroup>\n\t\t\t\t{this.props.messages.map(this.renderMessage)}\n\t\t\t</TransitionGroup>\n\t\t</div>\n\t);\n\n\tprivate renderMessage = (message: Message) => (\n\t\t<CSSTransition\n\t\t\tkey={message.id}\n\t\t\tclassNames=\"Message\"\n\t\t\ttimeout={{ enter: 200, exit: 200 }}>\n\t\t\t<div className={classNames(\"Message\", \"Message-\" + message.type)}>\n\t\t\t\t{this.props.t(message.text)}\n\t\t\t</div>\n\t\t</CSSTransition>\n\t);\n}\n\nexport default withTranslation()(Messages);\n","import { RootState } from \"../reducers\";\n\n// ------------------------------------------------------------------\n\nexport const extractMessages = (state: RootState) =>\n\tstate.messages.sort((m1, m2) => m1.stamp - m2.stamp);\n","import { connect } from \"react-redux\";\n//\nimport { RootState } from \"../../reducers\";\nimport Messages from \"../../components/App/Messages\";\nimport { extractMessages } from \"../../selectors/messages\";\n\n// ------------------------------------------------------------------\n\nconst mapStateToProps = (state: RootState) => ({\n\tmessages: extractMessages(state)\n});\n\nconst mapDispatchToProps = (dispatch: any) => ({});\n\nexport type MappedProps = ReturnType<typeof mapStateToProps> &\n\tReturnType<typeof mapDispatchToProps>;\n\nexport default connect(mapStateToProps, mapDispatchToProps)(Messages);\n","import React, { Component } from \"react\";\nimport { Redirect, Route, Switch } from \"react-router-dom\";\n//\nimport { MappedProps } from \"../../containers/App\";\nimport Room from \"../../containers/Room\";\nimport Splash from \"../../containers/Splash\";\nimport Modals from \"../../containers/Modals\";\nimport Messages from \"../../containers/App/Messages\";\nimport \"./index.scss\";\n\n// ------------------------------------------------------------------\n\nclass App extends Component<MappedProps> {\n\tpublic componentDidMount = async () => {\n\t\tthis.props.onReconnect();\n\t};\n\n\tpublic render = () => {\n\t\treturn (\n\t\t\t<div className=\"App\">\n\t\t\t\t<Modals />\n\t\t\t\t<Switch>\n\t\t\t\t\t<Route\n\t\t\t\t\t\texact={true}\n\t\t\t\t\t\tpath=\"/room/:room_id\"\n\t\t\t\t\t\tcomponent={Room}\n\t\t\t\t\t/>\n\t\t\t\t\t<Route exact={true} path=\"/\" component={Splash} />\n\t\t\t\t\t<Redirect to=\"/\" />\n\t\t\t\t</Switch>\n\t\t\t\t<Messages />\n\t\t\t</div>\n\t\t);\n\t};\n}\n\nexport default App;\n","import { connect } from \"react-redux\";\nimport { ThunkDispatch } from \"redux-thunk\";\n//\nimport { RootState } from \"../../reducers\";\nimport App from \"../../components/App\";\nimport { reconnectUser } from \"../../actions/user\";\n\n// ------------------------------------------------------------------\n\nconst stateToProps = (state: RootState) => ({});\n\nconst dispatchToProps = (dispatch: ThunkDispatch<RootState, any, any>) => ({\n\tonReconnect: () => dispatch(reconnectUser())\n});\n\nexport type MappedProps = ReturnType<typeof stateToProps> &\n\tReturnType<typeof dispatchToProps>;\n\nexport default connect(stateToProps, dispatchToProps)(App);\n","// ------------------------------------------------------------------\n\nlet AUDIO_CONTEXT: AudioContext | null = null;\n\nconst getContext = () => {\n\tif (!AUDIO_CONTEXT) {\n\t\tAUDIO_CONTEXT = new (window.AudioContext ||\n\t\t\t(window as any).webkitAudioContext)();\n\t}\n\treturn AUDIO_CONTEXT;\n};\n\nconst decodeAudioData = (encodedBuffer: ArrayBuffer): Promise<AudioBuffer> =>\n\tnew Promise((resolve, reject) =>\n\t\tgetContext().decodeAudioData(encodedBuffer, resolve, reject)\n\t);\n\nconst loadAudioBuffer = (trackId: string, url: string): Promise<AudioBuffer> =>\n\tnew Promise((resolve, reject) => {\n\t\tconst req = new XMLHttpRequest();\n\t\treq.open(\"GET\", url, true);\n\t\treq.responseType = \"arraybuffer\";\n\t\treq.addEventListener(\n\t\t\t\"error\",\n\t\t\t() => reject(new Error(\"player.errors.cannot_load_audio_buffer\")),\n\t\t\tfalse\n\t\t);\n\t\treq.addEventListener(\n\t\t\t\"load\",\n\t\t\tasync () => {\n\t\t\t\ttry {\n\t\t\t\t\tresolve(await decodeAudioData(req.response as ArrayBuffer));\n\t\t\t\t} catch (error) {\n\t\t\t\t\tconsole.debug(\n\t\t\t\t\t\t\"An error occurred while decoding audio data\",\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttrackId,\n\t\t\t\t\t\t\turl\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t\treject(new Error(\"player.errors.cannot_decode_audio_data\"));\n\t\t\t\t}\n\t\t\t},\n\t\t\tfalse\n\t\t);\n\t\treq.send();\n\t});\n\nconst AUDIO_BUFFER_CACHES: Array<{ buffer: AudioBuffer; url: string }> = [];\nconst AUDIO_BUFFER_CACHES_MAX_SIZE = 10;\n\nconst loadAudioBufferWithCache = async (\n\ttrackId: string,\n\turl: string\n): Promise<AudioBuffer> => {\n\tif (!url) {\n\t\tconsole.error(\"Track has invalid URL\", { trackId });\n\t\tthrow new Error(\"Invalid URL\");\n\t}\n\tlet buffer: AudioBuffer | null = null;\n\tconst index = AUDIO_BUFFER_CACHES.findIndex(item => item.url === url);\n\tif (index >= 0) {\n\t\t// Found: extract old buffer, it will be repush at the end of cache\n\t\tconsole.debug(\"Reusing cached audio buffer...\", { trackId, url });\n\t\tbuffer = AUDIO_BUFFER_CACHES.splice(index, 1)[0].buffer;\n\t} else {\n\t\t// Not Found\n\t\tconsole.debug(\"Loading audio buffer...\", { trackId, url });\n\t\tbuffer = await loadAudioBuffer(trackId, url);\n\t}\n\tAUDIO_BUFFER_CACHES.push({ buffer, url });\n\tAUDIO_BUFFER_CACHES.splice(AUDIO_BUFFER_CACHES_MAX_SIZE);\n\treturn buffer;\n};\n\n// ------------------------------------------------------------------\n\n// Fix Safari and iOS Audio Context\n(() => {\n\tconst fixAudioContext = () => {\n\t\tdocument.removeEventListener(\"click\", fixAudioContext);\n\t\tdocument.removeEventListener(\"touchstart\", fixAudioContext);\n\t\tconsole.debug(\"Fixing audio context...\");\n\t\tconst context = getContext();\n\t\t// Create empty buffer, connect to output, play sound\n\t\tvar buffer = context.createBuffer(1, 1, 22050);\n\t\tvar source = context.createBufferSource();\n\t\tsource.buffer = buffer;\n\t\tsource.connect(context.destination);\n\t\tsource.start(0);\n\t};\n\tdocument.addEventListener(\"click\", fixAudioContext);\n\tdocument.addEventListener(\"touchstart\", fixAudioContext);\n})();\n\n// ------------------------------------------------------------------\n\nexport type PlayerCallbacks = {\n\tonStart: () => void;\n\tonStop: () => void;\n};\n\nexport const Player = (chainPlay: boolean) => {\n\tlet analyserNode: AnalyserNode | null = null;\n\tlet gainNode: GainNode | null = null;\n\tlet _node: AudioNode | null = null;\n\tlet _buffer: AudioBuffer | null = null;\n\tlet _sourceNode: AudioBufferSourceNode | null = null;\n\tlet _sourceNodeStartTime = 0;\n\tlet _trackId = \"\";\n\tlet _trackPosition = -1;\n\n\tconst getOrCreateNode = () => {\n\t\tif (!_node) {\n\t\t\tconst context = getContext();\n\t\t\t_node = context.destination;\n\n\t\t\tgainNode = context.createGain();\n\t\t\tgainNode.gain.value = 1.0;\n\t\t\tgainNode.connect(_node);\n\t\t\t_node = gainNode;\n\n\t\t\tanalyserNode = context.createAnalyser();\n\t\t\tanalyserNode.fftSize = 128;\n\t\t\t// analyserNode.minDecibels = -90;\n\t\t\t// analyserNode.maxDecibels = -10;\n\t\t\tanalyserNode.connect(_node);\n\t\t\t_node = analyserNode;\n\t\t}\n\t\treturn _node;\n\t};\n\n\tconst isPlaying = () => !!_sourceNode;\n\n\tconst getPlayingTrackID = () => _trackId;\n\n\tconst getPlayingTrackPosition = () => _trackPosition;\n\n\t// Percentage [0, 1]\n\tconst getPlayingTrackPercent = () => {\n\t\tif (_buffer && _sourceNode) {\n\t\t\treturn (\n\t\t\t\t(getContext().currentTime - _sourceNodeStartTime) /\n\t\t\t\t_buffer.duration\n\t\t\t);\n\t\t}\n\t\treturn 0;\n\t};\n\n\tconst play = async (\n\t\ttrackPosition: number,\n\t\ttrackId: string,\n\t\ttrackUrl: string,\n\t\toffset: number\n\t) => {\n\t\tawait stop();\n\t\t_buffer = await loadAudioBufferWithCache(trackId, trackUrl); // TODO: warning if loadBuffer takes long for some reason and user clicks stop before end, next part of this function will continue after stop have been requested\n\t\tconsole.debug(\"Starting audio...\", {\n\t\t\ttrackPosition,\n\t\t\ttrackId,\n\t\t\ttrackUrl\n\t\t});\n\t\t_trackId = trackId;\n\t\t_trackPosition = trackPosition;\n\t\t_sourceNode = getContext().createBufferSource();\n\t\t_sourceNode.buffer = _buffer;\n\t\t_sourceNode.loop = false;\n\t\t_sourceNode.loopStart = 0;\n\t\t_sourceNode.loopEnd = 0;\n\t\t_sourceNode.onended = () => {\n\t\t\tconsole.debug(\"Audio terminated...\");\n\t\t\t_buffer = null;\n\t\t\t_sourceNode = null;\n\t\t\tif (chainPlay) {\n\t\t\t\t_trackPosition++;\n\t\t\t}\n\t\t};\n\t\t_sourceNode.playbackRate.value = 1.0;\n\t\t_sourceNode.connect(getOrCreateNode());\n\t\t_sourceNode.start(0, offset); // A new BufferSource must be created for each start\n\t\t_sourceNodeStartTime = getContext().currentTime;\n\t};\n\n\tconst stop = async (): Promise<void> =>\n\t\tnew Promise(resolve => {\n\t\t\tif (null !== _sourceNode) {\n\t\t\t\tconsole.debug(\"Stopping audio...\");\n\t\t\t\t_sourceNode.onended = () => {\n\t\t\t\t\tconsole.debug(\"Forced audio termination...\");\n\t\t\t\t\tresolve();\n\t\t\t\t};\n\t\t\t\t_sourceNode.stop();\n\t\t\t\t_sourceNode = null;\n\t\t\t\t_sourceNodeStartTime = 0;\n\t\t\t\t_trackPosition = -1;\n\t\t\t} else {\n\t\t\t\tresolve();\n\t\t\t}\n\t\t});\n\n\treturn {\n\t\tanalyserNode,\n\t\tgainNode,\n\t\tgetPlayingTrackID,\n\t\tgetPlayingTrackPercent,\n\t\tgetPlayingTrackPosition,\n\t\tisPlaying,\n\t\tplay,\n\t\tstop\n\t};\n};\n","export default {\n\tsplash: {\n\t\tCGU: \"CGU\",\n\t\tpowered_with: \"Powered with\"\n\t},\n\tusers: {\n\t\terrors: {\n\t\t\tinvalid: \"User is invalid\"\n\t\t},\n\t\tuser: \"User\",\n\t\tconfirm_disconnect: \"Are you sure you want to disconnect?\",\n\t\tconnect: \"Connect\",\n\t\tconnection: \"Connection\",\n\t\tcreate: \"Create a user\",\n\t\tdisconnect: \"Disconnect\",\n\t\tuser_creation: \"User Registration\",\n\t\tid_is_invalid: \"ID is invalid\",\n\t\tid_placeholder: \"User ID...\",\n\t\tuser_id: \"User ID\",\n\t\tname_is_invalid: \"Name is invalid\",\n\t\tname_placeholder: \"User Name...\",\n\t\tname: \"User Name\",\n\t\tsecret_is_invalid: \"Secret is invalid\",\n\t\tsecret_placeholder: \"User Secret...\",\n\t\tsecret: \"User Secret\"\n\t},\n\trooms: {\n\t\terrors: {\n\t\t\tinvalid: \"Room is invalid\",\n\t\t\tlocked: \"Room is locked\"\n\t\t},\n\t\tclear: \"Clear all tracks\",\n\t\tconfirm_clear: \"Are you sure you want to remove all tracks?\",\n\t\tconfirm_exit: \"Are you sure you want to leave the room?\",\n\t\tconfirm_lock: \"Are you sure you want to lock the room?\",\n\t\tcopy_link: \"Copy Room Link to Clipboard\",\n\t\tcreate: \"Create a room\",\n\t\tempty: \"It's empty here, you should add some tracks...\",\n\t\texit: \"Exit Room\",\n\t\tkey_placeholder: \"Room Key...\",\n\t\tkey: \"Room Key\",\n\t\tlink_copied_to_clipboard: \"Room link has been copied to clipboard\",\n\t\tloading: \"Loading...\",\n\t\tlocked: \"Locked (click to unlock)\",\n\t\tname_is_invalid: \"Name is invalid\",\n\t\tname_placeholderl: \"Room Name...\",\n\t\tname: \"Room Name\",\n\t\troom_creation: \"Room Creation\",\n\t\troom_unlocking: \"Room Unlocking\",\n\t\troom: \"Room\",\n\t\tsecret_is_invalid: \"Secret is invalid\",\n\t\tunlock: \"Unlock\",\n\t\tunlocked: \"Unlocked (click to lock)\"\n\t},\n\tmedias: {\n\t\tby: \"by {{artist}}\",\n\t\tadd: \"Add\",\n\t\tremove: \"Remove\",\n\t\tsearch: \"Search Media\",\n\t\tsearch_placeholder: \"Search...\",\n\t\tmedias_search: \"Media Search\",\n\t\talbums: \"Albums\",\n\t\tplaylists: \"Playlists\",\n\t\ttracks: \"Tracks\"\n\t},\n\tplayer: {\n\t\terrors: {\n\t\t\tcannot_decode_audio_data: \"Audio buffer cannot be decoded\",\n\t\t\tcannot_load_audio_buffer: \"Audio buffer loading failed\"\n\t\t},\n\t\tbackward: \"Backward\",\n\t\tforward: \"Forward\",\n\t\tplay: \"Play\",\n\t\tplaying: \"Playing\",\n\t\tstop: \"Stop\"\n\t},\n\tcancel: \"Cancel\",\n\tsecret_copied_to_clipboard: \"Secret has been copied to clipboard\"\n};\n","export default {\n\tsplash: {\n\t\tCGU: \"CGU\",\n\t\tpowered_with: \"boosté avec\"\n\t},\n\tusers: {\n\t\terrors: {\n\t\t\tinvalid: \"L'utilisateur est invalide\"\n\t\t},\n\t\tuser: \"Utilisateur\",\n\t\tconfirm_disconnect: \"Êtes-vous sûr(e) de vouloir vous déconnecter ?\",\n\t\tconnect: \"Se connecter\",\n\t\tconnection: \"Connexion\",\n\t\tcreate: \"Créer un utilisateur\",\n\t\tdisconnect: \"Se déconnecter\",\n\t\tuser_creation: \"Création d'un utilisateur\",\n\t\tid_is_invalid: \"L'identifiant est invalide\",\n\t\tid_placeholder: \"Identifiant...\",\n\t\tuser_id: \"Identifiant\",\n\t\tname_is_invalid: \"Le nom est invalide\",\n\t\tname_placeholder: \"Nom...\",\n\t\tname: \"Nom\",\n\t\tsecret_is_invalid: \"Le secret est invalide\",\n\t\tsecret_placeholder: \"Secret...\",\n\t\tsecret: \"Secret\"\n\t},\n\trooms: {\n\t\terrors: {\n\t\t\tinvalid: \"La salle est invalide\",\n\t\t\tlocked: \"La salle est verrouillée\"\n\t\t},\n\t\tclear: \"Supprimer toutes les pistes\",\n\t\tconfirm_clear:\n\t\t\t\"Êtes-vous sûr(e) de vouloir supprimer toutes les pistes ?\",\n\t\tconfirm_exit: \"Êtes-vous sûr(e) de vouloir quitter la salle ?\",\n\t\tconfirm_lock: \"Êtes-vous sûr(e) de vouloir verrouiller la salle ?\",\n\t\tcopy_link: \"Copier le lien de la salle dans le presse-papier\",\n\t\tcreate: \"Créer une salle\",\n\t\tempty: \"Cette salle est vide, vous devriez ajouter quelques pistes...\",\n\t\texit: \"Quitter la salle\",\n\t\tkey_placeholder: \"Clef...\",\n\t\tkey: \"Clef\",\n\t\tloading: \"Chargement...\",\n\t\tlink_copied_to_clipboard:\n\t\t\t\"Le lien de la salle a été copié dans le presse-papier\",\n\t\tlocked: \"Verrouillée (cliquer pour déverrouiller)\",\n\t\tname_is_invalid: \"Le nom est invalide\",\n\t\tname_placeholderl: \"Nom...\",\n\t\tname: \"Nom\",\n\t\troom: \"Salle\",\n\t\troom_creation: \"Création d'une salle\",\n\t\troom_unlocking: \"Déverrouillage de la salle\",\n\t\tsecret_is_invalid: \"Le secret is invalide\",\n\t\tunlock: \"Déverrouiller\",\n\t\tunlocked: \"Déverrouillée (cliquer pour verrouiller)\"\n\t},\n\tmedias: {\n\t\tby: \"par {{artist}}\",\n\t\tadd: \"Ajouter\",\n\t\tremove: \"Supprimer\",\n\t\tsearch: \"Chercher des médias\",\n\t\tsearch_placeholder: \"Recherche...\",\n\t\tmedias_search: \"Recherche de médias\",\n\t\talbums: \"Albums\",\n\t\tplaylists: \"Playlists\",\n\t\ttracks: \"Pistes\"\n\t},\n\tplayer: {\n\t\terrors: {\n\t\t\tcannot_decode_audio_data: \"Le buffer audio ne peut pas être décodé\",\n\t\t\tcannot_load_audio_buffer: \"Le buffer audio ne peut pas être chargé\"\n\t\t},\n\t\tbackward: \"Piste précédente\",\n\t\tforward: \"Piste suivante\",\n\t\tplay: \"Lire\",\n\t\tplaying: \"En cours de lecture\",\n\t\tstop: \"Arrêter\"\n\t},\n\tcancel: \"Annuler\",\n\tsecret_copied_to_clipboard: \"Le secret a été copié dans le presse-papier\"\n};\n","import i18next from \"i18next\";\nimport { initReactI18next } from \"react-i18next\";\n//\nimport en from \"../locales/en\";\nimport fr from \"../locales/fr\";\n\n// --------------------------------------------------------------\n\nexport const changeLanguage = (language: string) =>\n\ti18next.changeLanguage(language);\n\n// --------------------------------------------------------------\n\nexport const initLocales = async (): Promise<void> =>\n\tnew Promise((resolve, reject) => {\n\t\tconsole.debug(\"Initializing language...\", {\n\t\t\tcurrent: navigator.language || (navigator as any).userLanguage\n\t\t});\n\t\ti18next.use(initReactI18next).init(\n\t\t\t{\n\t\t\t\tfallbackLng: \"en\",\n\t\t\t\tlng: navigator.language || (navigator as any).userLanguage,\n\t\t\t\tresources: {\n\t\t\t\t\ten: { translation: en },\n\t\t\t\t\t\"en-US\": { translation: en },\n\t\t\t\t\tfr: { translation: fr },\n\t\t\t\t\t\"fr-FR\": { translation: fr }\n\t\t\t\t},\n\t\t\t\tinterpolation: {\n\t\t\t\t\tescapeValue: false, // react is already safe from xss\n\t\t\t\t\tformat: (value, format, lng) => {\n\t\t\t\t\t\t// if (format === \"uppercase\") return value.toUpperCase();\n\t\t\t\t\t\t// if (value instanceof Date) return moment(value).format(format);\n\t\t\t\t\t\treturn value;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\terror => {\n\t\t\t\tif (error) reject(error);\n\t\t\t\tresolve();\n\t\t\t}\n\t\t);\n\t});\n","import * as React from \"react\";\nimport * as ReactDOM from \"react-dom\";\nimport { Provider } from \"react-redux\";\nimport { Route, HashRouter } from \"react-router-dom\";\nimport { composeWithDevTools } from \"redux-devtools-extension\";\nimport { applyMiddleware, createStore, compose } from \"redux\";\nimport thunk from \"redux-thunk\";\n//\nimport { rootReducer } from \"./reducers\";\nimport App from \"./containers/App\";\nimport { DEFAULT_API } from \"./utils/deezer\";\nimport { Player } from \"./utils/player\";\nimport { initLocales } from \"./utils/i18n\";\nimport \"./index.scss\";\n\n// ------------------------------------------------------------------\n\nconst init = async () => {\n\tconst composeEnhancers =\n\t\tprocess.env.NODE_ENV === \"development\"\n\t\t\t? composeWithDevTools({})\n\t\t\t: compose;\n\n\tconst deezer = DEFAULT_API;\n\tconst queuePlayer = Player(true);\n\tconst previewPlayer = Player(false);\n\tinitLocales();\n\n\tconst store = createStore(\n\t\trootReducer,\n\t\tcomposeEnhancers(\n\t\t\tapplyMiddleware(\n\t\t\t\tthunk.withExtraArgument({ deezer, queuePlayer, previewPlayer })\n\t\t\t)\n\t\t)\n\t);\n\n\t// const dispatch: Dispatch = store.dispatch.bind(store);\n\n\treturn store;\n};\n\n// ------------------------------------------------------------------\n\ninit().then(store => {\n\tReactDOM.render(\n\t\t<Provider store={store}>\n\t\t\t<HashRouter>\n\t\t\t\t<Route path=\"/\" component={App} />\n\t\t\t</HashRouter>\n\t\t</Provider>,\n\t\tdocument.getElementById(\"root\")\n\t);\n});\n"],"sourceRoot":""}