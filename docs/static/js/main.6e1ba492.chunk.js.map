{"version":3,"sources":["reducers/containers.ts","reducers/messages.ts","reducers/modals.ts","reducers/player.ts","reducers/queue.ts","reducers/rooms.ts","reducers/tracks.ts","reducers/users.ts","utils/users.ts","reducers/index.ts","components/Common/Icon.tsx","components/Common/IconButton.tsx","utils/clipboard.ts","components/Room/Head.tsx","selectors/rooms.ts","actions/index.ts","actions/modals.ts","actions/messages.ts","utils/messages.ts","config/firebase.ts","utils/index.ts","utils/firebase.ts","actions/queue.ts","actions/tracks.ts","actions/containers.ts","utils/history.ts","actions/rooms.ts","containers/Room/Head.ts","components/Room/Cover.tsx","components/Room/Medias.tsx","components/Room/Queue.tsx","selectors/tracks.ts","utils/colorpicker.ts","actions/player.ts","containers/Room/Queue.ts","components/Room/Progress.tsx","containers/Room/Progress.ts","components/Room/Controls.tsx","containers/Room/Controls.ts","components/Room/index.tsx","containers/Room/index.ts","components/Splash/index.tsx","selectors/users.ts","actions/users.ts","containers/Splash/index.ts","components/Modals/Modal.tsx","containers/Modals/Modal.ts","components/Modals/FormModal.tsx","components/Users/ConnectUserModal.tsx","containers/Users/ConnectUserModal.ts","components/Modals/SecretField.tsx","containers/Modals/SecretField.ts","components/Room/CreateRoomModal.tsx","containers/Room/CreateRoomModal.ts","components/Users/CreateUserModal.tsx","containers/Users/CreateUserModal.ts","utils/deezer.ts","components/Room/SearchResultCategory.tsx","components/Room/SearchModal.tsx","containers/Room/SearchModal.ts","components/Room/UnlockRoomModal.tsx","containers/Room/UnlockRoomModal.ts","components/Modals/index.tsx","containers/Modals/index.ts","components/App/Messages.tsx","selectors/messages.ts","containers/App/Messages.ts","components/App/index.tsx","containers/App/index.ts","utils/player.ts","locales/en.ts","locales/fr.ts","utils/i18n.ts","index.tsx"],"names":["INITIAL_STATE","fetching","error","containers","initialState","stack","playing","track_percent","position","trackIds","room","room_access","id","secret","room_color","fg","r","g","b","bg","room_info","tracks","user","user_access","res","s","localStorage","getItem","d","JSON","parse","atob","i","console","debug","err","loadUserAccess","user_info","rootReducer","combineReducers","state","action","type","payload","copy","container","messages","filter","other","modals","pop","player","queue","rooms","info","track","users","setItem","btoa","stringify","saveUserAccess","Icon","Component","render","this","props","className","color","icon","size","title","classNames","name","style","IconButton","disabled","displayTitle","kind","onClick","aria-label","clickable","CancelButton","copyToClipboard","value","a","Promise","resolve","elem","document","createElement","setAttribute","left","body","appendChild","selection","getSelection","selected","rangeCount","getRangeAt","select","execCommand","removeAllRanges","addRange","removeChild","Head","locked","onLock","onUnlock","t","onCopyLink","location","href","split","onMessage","withTranslation","extractRoom","isRoomLocked","createAction","openModal","prereq","popModal","MESSAGE_ID_GENERATOR","displayMessage","text","duration","dispatch","stamp","Date","getTime","setTimeout","removeMessage","displayError","response","data","message","config","databaseURL","process","firebaseApp","firebase","firebaseConfig","firebaseDatabase","MEMBERS","ref","ROOMS","USERS","FirebaseRoom","_room","child","_info","_members","_secret","_values","queue_position","timestamp","getInfo","isLocked","setSecret","newSecret","wait","reject","once","snapshot","newValues","val","Error","subscribeInfo","cb","on","subscribeMembers","cbAdded","cbRemoved","unsubscribeInfo","off","unsubscribeMembers","update","set","ServerValue","TIMESTAMP","FirebaseUser","_user","_membership","online","room_id","status","installDisconnect","onDisconnect","cancel","enter","remove","exit","setQueue","clearQueue","getState","lockRoom","appendInQueue","length","forEach","index","removeFromQueue","oldIndex","splice","setQueuePosition","moveBackward","moveForward","setTracks","onlyUnique","self","indexOf","loadTracks","enqueue","preview","deezer","previewPlayer","oldTracks","newTrackIds","trackId","newTracks","all","map","loadTrack","find","toString","play","loadContainer","containerType","containerId","containerTypeId","loadAlbum","loadPlaylist","previewContainer","createHashHistory","setRoom","setRoomAccess","setRoomColor","createRoom","v4","enterRoom","FIREBASE_CB","exitRoom","newRoom","newInfo","Object","entries","sort","track1","track2","Number","history","push","unlockRoom","queueTracks","connect","Cover","playable","image","onPlay","onStop","backgroundImage","_Album","actions","album","cover_small","link","target","rel","artist","Album","_Playlist","playlist","picture_small","Playlist","_Track","Track","Queue","trackIndex","onRemove","onSearch","key","extractTracks","CACHE","DEFAULT_COLOR","pickColor","url","jimp","resize","getPixelColor","pixel","setPlayerTrackPercent","percent","PLAYER_TIMER1","PLAYER_TIMER2","_computeNextPosition","queuePlayer","playingPosition","queuePosition","nextPosition","isPlaying","_installTimer1","getPlayingPosition","nextIndex","nextTrack","stopPlayer","_installTimer2","getTrackPercent","startPlayer","_","clearTimeout","stop","startPreview","stopPreview","_1","_2","Progress","max","Controls","onMoveBackward","onMoveForward","tracksCount","onClear","onExit","window","confirm","Room","componentDidMount","onEnter","componentWillUnmount","backgroundColor","withRouter","ownProps","qs","search","substr","match","params","Splash","loggedIn","onCreateRoom","onConnectUser","to","src","height","alt","onDisconnectUser","extractUser","setUser","setUserAccess","createUser","connectUser","disconnectUser","newUser","reconnectUser","Modal","children","renderFoot","onClose","onPop","has_prev_modal","onSubmit","hidden","event","preventDefault","FormModal","renderButtons","ConnectUserModal","idRef","createRef","onConnect","htmlFor","placeholder","maxLength","minLength","required","onChange","e","setState","onToggle","onError","trim","current","focus","SecretField","label","display","flexDirection","justifyContent","flexGrow","marginRight","onCopyToClipboard","ROOM_COUNTER","CreateRoomModal","nameRef","onCreate","USER_COUNTER","CreateUserModal","DEFAULT_API","asyncJsonp","jsonp","call","path","fullpath","query","encodeURIComponent","load","searchAlbums","searchPlaylists","searchTracks","searchAll","albums","playlists","DeezerApi","SearchResultCategory","items","slice","item","SearchModal","queryRef","mediaId","mediaType","results","total","renderInputs","renderResults","onSelect","onStartPreview","onStopPreview","UnlockRoomModal","secretRef","Modals","curr_prereq","prev_prereq","addEventListener","onKeyDown","removeEventListener","componentDidUpdate","prevProps","oldPrereq","newPrereq","modal","getModal","in","timeout","unmountOnExit","onClickOverlay","role","onClickWrapper","stopPropagation","onCloseModal","keyCode","Messages","React","renderMessage","extractMessages","m1","m2","App","onReconnect","exact","component","AUDIO_CONTEXT","getContext","AudioContext","webkitAudioContext","decodeAudioData","encodedBuffer","loadAudioBuffer","req","XMLHttpRequest","open","responseType","send","fixAudioContext","context","buffer","createBuffer","source","createBufferSource","destination","start","Player","chainPlay","analyserNode","gainNode","_node","_buffer","_bufferUrl","_sourceNode","_sourceNodeStartTime","_position","getOrCreateNode","createGain","gain","createAnalyser","fftSize","_loadBuffer","offset","loop","loopStart","loopEnd","onended","playbackRate","currentTime","splash","CGU","powered_with","confirm_disconnect","connection","create_user","disconnect","user_creation","user_id_is_invalid","user_id_placeholder","user_id","user_name_is_invalid","user_name_placeholder","user_name","user_secret_is_invalid","user_secret_placeholder","user_secret","empty","copy_link","link_copied_to_clipboard","unlocked","clear","confirm_clear","confirm_exit","unlock","create_room","room_creation","room_key","room_key_placeholder","room_name","room_name_placeholderl","room_name_is_invalid","room_secret_is_invalid","room_unlock","medias","by","add","search_placeholder","medias_search","backward","forward","secret_copied_to_clipboard","initLocales","log","i18next","use","initReactI18next","init","fallbackLng","lng","navigator","language","userLanguage","resources","translation","en","fr","interpolation","escapeValue","format","composeEnhancers","compose","store","createStore","applyMiddleware","thunk","withExtraArgument","then","ReactDOM","getElementById"],"mappings":"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","file":"static/js/main.6e1ba492.chunk.js","sourcesContent":["import { Reducer } from \"redux\";\nimport { AxiosError } from \"axios\";\nimport { ContainersAction } from \"../actions/containers\";\nimport { Containers } from \"../utils/containers\";\n\n// ------------------------------------------------------------------\n\nexport type State = {\n  fetching: boolean;\n  error: null | AxiosError;\n  containers: Containers;\n};\n\nconst INITIAL_STATE: State = {\n  fetching: false,\n  error: null,\n  containers: {}\n};\n\n// ------------------------------------------------------------------\n\nexport const containersReducer: Reducer<State, ContainersAction> = (\n  state = INITIAL_STATE,\n  action: ContainersAction\n): State => {\n  switch (action.type) {\n    case \"containers/FETCHING\":\n      return {\n        ...state,\n        fetching: true,\n        error: null\n      };\n    case \"containers/FETCHED\": {\n      return {\n        ...state,\n        fetching: false,\n        error: null\n      };\n    }\n    case \"containers/ERROR\":\n      return {\n        ...state,\n        fetching: false,\n        error: action.payload\n      };\n    case \"containers/SET_CONTAINERS\": {\n      const copy = { ...state, containers: { ...state.containers } };\n      for (const container of action.payload) {\n        copy.containers[`${container.type}|${container.id}`] = container;\n      }\n      return copy;\n    }\n    case \"containers/RESET\":\n      return INITIAL_STATE;\n    default:\n      return state;\n  }\n};\n","import { Reducer } from \"redux\";\nimport { MessagesAction } from \"../actions/messages\";\nimport { Message } from \"../utils/messages\";\n\n// ------------------------------------------------------------------\n\nexport type State = Message[];\n\nexport const INITIAL_STATE: State = [];\n\n// ------------------------------------------------------------------\n\nexport const messagesReducer: Reducer<State, MessagesAction> = (\n  state = INITIAL_STATE,\n  action\n): State => {\n  switch (action.type) {\n    case \"message/ADD\":\n      return [action.payload, ...state];\n    case \"message/REMOVE\":\n      return state.filter(other => other.id !== action.payload);\n    case \"message/RESET\":\n      return INITIAL_STATE;\n    default:\n      return state;\n  }\n};\n","import { Reducer } from \"redux\";\nimport { ModalsAction, ModalPrereq } from \"../actions/modals\";\n\n// ------------------------------------------------------------------\n\nexport type ModalsState = {\n  stack: ModalPrereq[];\n};\n\n// ------------------------------------------------------------------\n\nexport const initialState: ModalsState = {\n  stack: []\n};\n\n// ------------------------------------------------------------------\n\nexport const modalsReducer: Reducer<ModalsState, ModalsAction> = (\n  state = initialState,\n  action\n): ModalsState => {\n  switch (action.type) {\n    case \"modals/OPEN\":\n      return {\n        ...state,\n        stack: [action.payload]\n      };\n    case \"modals/CLOSE\":\n      return {\n        ...state,\n        stack: []\n      };\n    case \"modals/PUSH\":\n      return {\n        ...state,\n        stack: [...state.stack, action.payload]\n      };\n    case \"modals/POP\":\n      const copy = [...state.stack];\n      copy.pop();\n      return {\n        ...state,\n        stack: copy\n      };\n    default:\n      return state;\n  }\n};\n","import { Reducer } from \"redux\";\nimport { PlayerAction } from \"../actions/player\";\n\n// ------------------------------------------------------------------\n\nexport type State = {\n  playing: boolean;\n  track_percent: number;\n};\n\nexport const INITIAL_STATE: State = {\n  playing: false,\n  track_percent: 0\n};\n\n// ------------------------------------------------------------------\n\nexport const playerReducer: Reducer<State, PlayerAction> = (\n  state = INITIAL_STATE,\n  action\n): State => {\n  switch (action.type) {\n    case \"player/START\":\n      return { ...state, playing: true };\n    case \"player/STOP\":\n      return { ...state, playing: false };\n    case \"player/SET_TRACK_PERCENT\":\n      return { ...state, track_percent: action.payload };\n    case \"player/RESET\":\n      return INITIAL_STATE;\n    default:\n      return state;\n  }\n};\n","import { Reducer } from \"redux\";\nimport { QueueAction } from \"../actions/queue\";\n\n// ------------------------------------------------------------------\n\nexport type State = {\n  position: number;\n  trackIds: string[];\n};\n\nexport const INITIAL_STATE: State = {\n  position: 0,\n  trackIds: []\n};\n\n// ------------------------------------------------------------------\n\nexport const queueReducer: Reducer<State, QueueAction> = (\n  state = INITIAL_STATE,\n  action\n): State => {\n  switch (action.type) {\n    case \"queue/SET\":\n      return {\n        ...state,\n        position: action.payload.position,\n        trackIds: action.payload.trackIds\n      };\n    default:\n      return state;\n  }\n};\n","import { Reducer } from \"redux\";\nimport { AxiosError } from \"axios\";\nimport { RoomsAction } from \"../actions/rooms\";\nimport { RoomAccess, RoomInfo } from \"../utils/rooms\";\nimport { CombinedColor } from \"../utils/colorpicker\";\nimport { FirebaseRoom } from \"../utils/firebase\";\n\n// ------------------------------------------------------------------\n\nexport type State = {\n  fetching: boolean;\n  error: null | AxiosError;\n  room: ReturnType<typeof FirebaseRoom> | null;\n  room_access: RoomAccess;\n  room_color: CombinedColor;\n  room_info: RoomInfo | null;\n};\n\nconst INITIAL_STATE: State = {\n  fetching: false,\n  error: null,\n  room: null,\n  room_access: { id: \"\", secret: \"\" },\n  room_color: { fg: { r: 0, g: 0, b: 0 }, bg: { r: 255, g: 255, b: 255 } },\n  room_info: null\n};\n\n// ------------------------------------------------------------------\n\nexport const roomsReducer: Reducer<State, RoomsAction> = (\n  state = INITIAL_STATE,\n  action: RoomsAction\n): State => {\n  switch (action.type) {\n    case \"rooms/FETCHING\":\n      return {\n        ...state,\n        fetching: true,\n        error: null\n      };\n    case \"rooms/FETCHED\": {\n      return {\n        ...state,\n        fetching: false,\n        error: null\n      };\n    }\n    case \"rooms/ERROR\":\n      return {\n        ...state,\n        fetching: false,\n        error: action.payload\n      };\n    case \"rooms/SET_ROOM\": {\n      return {\n        ...state,\n        room: action.payload.room,\n        room_info: action.payload.info\n      };\n    }\n    case \"rooms/SET_ROOM_ACCESS\": {\n      return {\n        ...state,\n        room_access: action.payload\n      };\n    }\n    case \"rooms/SET_ROOM_COLOR\": {\n      return {\n        ...state,\n        room_color: action.payload\n      };\n    }\n    case \"rooms/RESET\":\n      return INITIAL_STATE;\n    default:\n      return state;\n  }\n};\n","import { Reducer } from \"redux\";\nimport { AxiosError } from \"axios\";\nimport { TracksAction } from \"../actions/tracks\";\nimport { Tracks } from \"../utils/tracks\";\n\n// ------------------------------------------------------------------\n\nexport type State = {\n  fetching: boolean;\n  error: null | AxiosError;\n  tracks: Tracks;\n};\n\nconst INITIAL_STATE: State = {\n  fetching: false,\n  error: null,\n  tracks: {}\n};\n\n// ------------------------------------------------------------------\n\nexport const tracksReducer: Reducer<State, TracksAction> = (\n  state = INITIAL_STATE,\n  action: TracksAction\n): State => {\n  switch (action.type) {\n    case \"tracks/FETCHING\":\n      return {\n        ...state,\n        fetching: true,\n        error: null\n      };\n    case \"tracks/FETCHED\": {\n      return {\n        ...state,\n        fetching: false,\n        error: null\n      };\n    }\n    case \"tracks/ERROR\":\n      return {\n        ...state,\n        fetching: false,\n        error: action.payload\n      };\n    case \"tracks/SET_TRACKS\": {\n      const copy = { ...state, tracks: { ...state.tracks } };\n      for (const track of action.payload) {\n        copy.tracks[track.id] = track;\n      }\n      return copy;\n    }\n    case \"tracks/RESET\":\n      return INITIAL_STATE;\n    default:\n      return state;\n  }\n};\n","import { Reducer } from \"redux\";\nimport { AxiosError } from \"axios\";\nimport { UsersAction } from \"../actions/users\";\nimport {\n  saveUserAccess,\n  loadUserAccess,\n  UserAccess,\n  UserInfo\n} from \"../utils/users\";\nimport { FirebaseUser } from \"../utils/firebase\";\n\n// ------------------------------------------------------------------\n\nexport type State = {\n  fetching: boolean;\n  error: null | AxiosError;\n  user: ReturnType<typeof FirebaseUser> | null;\n  user_access: UserAccess;\n  user_info: UserInfo | null;\n};\n\nconst INITIAL_STATE: State = {\n  fetching: false,\n  error: null,\n  user: null,\n  user_access: loadUserAccess(),\n  user_info: null\n};\n\n// ------------------------------------------------------------------\n\nexport const usersReducer: Reducer<State, UsersAction> = (\n  state = INITIAL_STATE,\n  action: UsersAction\n): State => {\n  switch (action.type) {\n    case \"users/FETCHING\":\n      return {\n        ...state,\n        fetching: true,\n        error: null\n      };\n    case \"users/FETCHED\": {\n      return {\n        ...state,\n        fetching: false,\n        error: null\n      };\n    }\n    case \"users/ERROR\":\n      return {\n        ...state,\n        fetching: false,\n        error: action.payload\n      };\n    case \"users/SET_USER\": {\n      return {\n        ...state,\n        user: action.payload.user,\n        user_info: action.payload.info\n      };\n    }\n    case \"users/SET_USER_ACCESS\": {\n      saveUserAccess(action.payload);\n      return {\n        ...state,\n        user_access: { ...action.payload }\n      };\n    }\n    case \"users/RESET\":\n      return INITIAL_STATE;\n    default:\n      return state;\n  }\n};\n","export type UserInfo = {\n  name: string;\n  online: boolean;\n  room_id: string;\n  status: string;\n  timestamp: number;\n};\n\nexport type UserAccess = {\n  id: string;\n  secret: string;\n};\n\n// ------------------------------------------------------------------\n\nexport const loadUserAccess = (): UserAccess => {\n  const res: UserAccess = {\n    id: \"\",\n    secret: \"\"\n  };\n  const s = localStorage.getItem(\"U\");\n  if (s) {\n    try {\n      const d = JSON.parse(atob(s));\n      if (typeof d.i === \"string\" && typeof d.s === \"string\") {\n        res.id = d.i;\n        res.secret = d.s;\n        console.debug(\"Loaded user access: \", res);\n      }\n    } catch (err) {}\n  }\n  return res;\n};\n\nexport const saveUserAccess = ({ id, secret }: UserAccess) => {\n  localStorage.setItem(\n    \"U\",\n    btoa(\n      JSON.stringify({\n        i: id,\n        s: secret\n      })\n    )\n  );\n};\n","import { combineReducers } from \"redux\";\nimport { containersReducer as containers } from \"./containers\";\nimport { messagesReducer as messages } from \"./messages\";\nimport { modalsReducer as modals } from \"./modals\";\nimport { playerReducer as player } from \"./player\";\nimport { queueReducer as queue } from \"./queue\";\nimport { roomsReducer as rooms } from \"./rooms\";\nimport { tracksReducer as tracks } from \"./tracks\";\nimport { usersReducer as users } from \"./users\";\n\nexport type RootState = ReturnType<typeof rootReducer>;\n\nexport const rootReducer = combineReducers({\n  containers,\n  messages,\n  modals,\n  player,\n  queue,\n  rooms,\n  tracks,\n  users\n});\n","import React, { Component } from \"react\";\nimport FontAwesome from \"react-fontawesome\";\nimport classNames from \"classnames\";\n//\nimport \"./Icon.scss\";\n\n// ------------------------------------------------------------------\n\nexport type Props = {\n  className?: string;\n  color?: string;\n  icon: string;\n  size?: \"S\" | \"M\" | \"L\";\n  title?: string;\n};\n\nclass Icon extends Component<Props> {\n  public render = () => {\n    const { className, color, icon, size = \"M\", title } = this.props;\n    return (\n      <FontAwesome\n        className={classNames(\"Icon\", className, size)}\n        name={icon}\n        style={{ color }}\n        title={title}\n      />\n    );\n  };\n}\n\nexport default Icon;\n","import React, { Component } from \"react\";\nimport classNames from \"classnames\";\n//\nimport Icon from \"./Icon\";\nimport \"./IconButton.scss\";\n\n// ------------------------------------------------------------------\n\ntype ButtonType = \"button\" | \"submit\";\n\nexport type Props = {\n  className?: string;\n  color?: string;\n  disabled?: boolean;\n  displayTitle?: boolean;\n  icon: string;\n  kind?: \"default\" | \"primary\" | \"danger\" | \"special\";\n  onClick?: () => void;\n  size?: \"S\" | \"M\" | \"L\";\n  title: string;\n  type?: ButtonType;\n};\n\nclass IconButton extends Component<Props> {\n  public render = () => {\n    const {\n      className,\n      color,\n      disabled = false,\n      displayTitle = false,\n      icon,\n      kind = \"default\",\n      onClick,\n      size,\n      title,\n      type = \"button\"\n    } = this.props;\n    return (\n      <button\n        type={type}\n        aria-label={title}\n        className={classNames(\"IconButton\", className, kind, size, {\n          clickable: !disabled && (!!onClick || type === \"submit\")\n        })}\n        onClick={disabled ? void 0 : onClick}\n        title={title}\n      >\n        <Icon color={color} icon={icon} size={size} />\n        {displayTitle && (\n          <div className={classNames(\"IconButtonTitle\", size)}>{title}</div>\n        )}\n      </button>\n    );\n  };\n}\n\nexport const CancelButton = ({ onClick }: { onClick: () => void }) => (\n  <IconButton onClick={onClick} title=\"Cancel\" kind=\"default\" icon=\"ban\" />\n);\n\nexport default IconButton;\n","// https://hackernoon.com/copying-text-to-clipboard-with-javascript-df4d4988697f\nexport const copyToClipboard = async (value: string): Promise<void> =>\n  await new Promise(resolve => {\n    const elem = document.createElement(\"textarea\");\n    elem.value = value;\n    elem.setAttribute(\"readonly\", \"\");\n    elem.style.position = \"absolute\";\n    elem.style.left = \"-9999px\";\n\n    document.body.appendChild(elem);\n    const selection = document.getSelection();\n    if (selection !== null) {\n      const selected =\n        selection.rangeCount > 0 ? selection.getRangeAt(0) : false;\n      elem.select();\n      document.execCommand(\"copy\");\n      if (selected !== false) {\n        selection.removeAllRanges();\n        selection.addRange(selected);\n      }\n    }\n    document.body.removeChild(elem);\n    resolve();\n  });\n","import React, { Component } from \"react\";\nimport { withTranslation, WithTranslation } from \"react-i18next\";\n//\nimport IconButton from \"../Common/IconButton\";\nimport { MappedProps } from \"../../containers/Room/Head\";\nimport { copyToClipboard } from \"../../utils/clipboard\";\nimport \"./Head.scss\";\n\n// ------------------------------------------------------------------\n\nclass Head extends Component<MappedProps & WithTranslation> {\n  public render = () => {\n    const { locked, room, onLock, onUnlock, t } = this.props;\n    return (\n      <div className=\"Head\">\n        <div className=\"RoomStatus\">\n          {locked ? (\n            <IconButton\n              icon=\"lock\"\n              onClick={onUnlock}\n              size=\"M\"\n              title={t(\"rooms.locked\")}\n            />\n          ) : (\n            <IconButton\n              icon=\"unlock\"\n              onClick={onLock}\n              size=\"M\"\n              title={t(\"rooms.unlocked\")}\n            />\n          )}\n        </div>\n        <div className=\"RoomName\">{room ? room.name : \"\"}</div>\n        <div className=\"RoomLink\">\n          <IconButton\n            icon=\"link\"\n            onClick={this.onCopyLink}\n            size=\"M\"\n            title={t(\"rooms.copy_link\")}\n          />\n        </div>\n      </div>\n    );\n  };\n\n  private onCopyLink = async () => {\n    const { t } = this.props;\n    await copyToClipboard(document.location.href.split(\"?\")[0]);\n    this.props.onMessage(t(\"rooms.link_copied_to_clipboard\"));\n  };\n}\n\nexport default withTranslation()(Head);\n","import { RootState } from \"../reducers\";\n\nexport const extractRoom = (state: RootState) => state.rooms.room_info;\n\nexport const isRoomLocked = (state: RootState) =>\n  !state.rooms.room_access.secret;\n","import { AnyAction } from \"redux\";\nimport { ThunkAction, ThunkDispatch } from \"redux-thunk\";\n//\nimport { RootState } from \"../reducers\";\nimport { Player } from \"../utils/player\";\nimport { DeezerApi } from \"../utils/deezer\";\n\n// ------------------------------------------------------------------\n\nexport type Action<T extends string> = {\n  type: T;\n};\n\nexport type ActionWithPayload<T extends string, P> = {\n  type: T;\n  payload: P;\n};\n\nexport type Extended = {\n  deezer: ReturnType<typeof DeezerApi>;\n  previewPlayer: ReturnType<typeof Player>;\n  queuePlayer: ReturnType<typeof Player>;\n};\n\nexport type Dispatch = ThunkDispatch<RootState, Extended, AnyAction>;\n\nexport type AsyncAction = ThunkAction<void, RootState, Extended, AnyAction>;\n\nexport function createAction<T extends string>(type: T): Action<T>;\n\nexport function createAction<T extends string, P>(\n  type: T,\n  payload: P\n): ActionWithPayload<T, P>;\n\nexport function createAction<T extends string, P>(type: T, payload?: P) {\n  return payload === void 0 ? { type } : { type, payload };\n}\n","import { createAction } from \".\";\n\n// ------------------------------------------------------------------\n\nexport type ModalPrereqT<T extends string, P> = {\n  type: T;\n  props: P;\n};\n\nexport type ModalPrereq =\n  | ModalPrereqT<\"ConnectUser\", null>\n  | ModalPrereqT<\"CreateRoom\", null>\n  | ModalPrereqT<\"CreateUser\", null>\n  | ModalPrereqT<\"Search\", null>\n  | ModalPrereqT<\"UnlockRoom\", null>;\n\n// ------------------------------------------------------------------\n\nexport type ModalsAction =\n  | ReturnType<typeof closeModal>\n  | ReturnType<typeof openModal>\n  | ReturnType<typeof popModal>\n  | ReturnType<typeof pushModal>;\n\n// ------------------------------------------------------------------\n\nexport const openModal = (prereq: ModalPrereq) =>\n  createAction(\"modals/OPEN\", prereq);\n\nexport const closeModal = () => createAction(\"modals/CLOSE\");\n\n// ------------------------------------------------------------------\n\nexport const pushModal = (prereq: ModalPrereq) =>\n  createAction(\"modals/PUSH\", prereq);\n\nexport const popModal = () => createAction(\"modals/POP\");\n","import { createAction, AsyncAction } from \".\";\nimport { Message, MessageType, extractErrorMessage } from \"../utils/messages\";\n\n// ------------------------------------------------------------------\n\nexport type MessagesAction =\n  | ReturnType<typeof addMessage>\n  | ReturnType<typeof clearMessages>\n  | ReturnType<typeof removeMessage>;\n\nconst addMessage = (message: Message) => createAction(\"message/ADD\", message);\n\nconst removeMessage = (id: number) => createAction(\"message/REMOVE\", id);\n\nconst clearMessages = () => createAction(\"message/RESET\");\n\n// ------------------------------------------------------------------\n\nlet MESSAGE_ID_GENERATOR: number = 0;\n\nexport const displayMessage = (\n  type: MessageType,\n  text: string,\n  duration: number = 5000\n): AsyncAction => (dispatch): any => {\n  const id = MESSAGE_ID_GENERATOR++;\n  dispatch(addMessage({ id, stamp: new Date().getTime(), text, type }));\n  setTimeout(() => dispatch(removeMessage(id)), duration);\n};\n\nexport const displayError = (text: string, error?: any): AsyncAction => (\n  dispatch\n): any => {\n  dispatch(\n    displayMessage(\n      \"error\",\n      error ? `${text}: ${extractErrorMessage(error)}` : text,\n      3000\n    )\n  );\n};\n\nexport const displayInfo = (text: string) => displayMessage(\"info\", text, 3000);\n","export type MessageType = \"error\" | \"info\";\n\nexport type Message = {\n  id: number;\n  stamp: number;\n  text: string;\n  type: MessageType;\n};\n\nexport const extractErrorMessage = (err: any) =>\n  err.response && err.response.data && err.response.data.message\n    ? err.response.data.message\n    : err.message;\n","const config = {\n  databaseURL: process.env.REACT_APP_FIREBASE_URL\n};\n\nconsole.debug(config);\n\nexport default config;\n","export const sleep = (delay: number) =>\n  new Promise(resolve => setTimeout(resolve, delay));\n","import * as firebase from \"firebase/app\";\nimport \"firebase/database\";\n//\nimport firebaseConfig from \"../config/firebase\";\nimport { RoomInfo } from \"./rooms\";\nimport { UserInfo } from \"./users\";\nimport { sleep } from \".\";\n\n// ------------------------------------------------------------------\n\ntype FirebaseCB = (eventType: firebase.database.DataSnapshot) => void;\n\n// ------------------------------------------------------------------\n\nconst firebaseApp = firebase.initializeApp(firebaseConfig);\nconst firebaseDatabase = firebase.database(firebaseApp);\n\n// ------------------------------------------------------------------\n\nconst MEMBERS = firebaseDatabase.ref(\"members\");\nconst ROOMS = firebaseDatabase.ref(\"rooms\");\nconst USERS = firebaseDatabase.ref(\"users\");\n\n// ------------------------------------------------------------------\n\nexport const FirebaseRoom = (id: string, secret?: string) => {\n  const _room = ROOMS.child(id);\n  const _info = _room.child(\"info\");\n  const _members = MEMBERS.child(id);\n  let _secret = secret || \"\";\n  console.debug(\"INIT SECRET\", _secret);\n  let _values: RoomInfo = {\n    name: \"dummy\",\n    queue: {},\n    queue_position: 0,\n    timestamp: 0,\n    type: \"dj\",\n  };\n\n  const getInfo = () => _values;\n\n  const isLocked = () => !_secret;\n\n  const setSecret = (newSecret: string) => {\n    console.debug(\"SETTING SECRET\", newSecret);\n    _secret = newSecret;\n  };\n\n  const wait = async (): Promise<RoomInfo> =>\n    new Promise((resolve, reject) => {\n      _info.once(\"value\", (snapshot) => {\n        const newValues = snapshot.val();\n        if (newValues) {\n          _values = newValues;\n          resolve(_values);\n        } else {\n          reject(new Error(\"Room is invalid\"));\n        }\n      });\n    });\n\n  const subscribeInfo = (cb: FirebaseCB) => {\n    _info.on(\"value\", cb);\n  };\n\n  const unsubscribeInfo = (cb: FirebaseCB) => {\n    _info.off(\"value\", cb);\n  };\n\n  const subscribeMembers = (cbAdded: FirebaseCB, cbRemoved: FirebaseCB) => {\n    _members.on(\"child_added\", cbAdded);\n    _members.on(\"child_removed\", cbRemoved);\n  };\n\n  const unsubscribeMembers = (cbAdded: FirebaseCB, cbRemoved: FirebaseCB) => {\n    _members.off(\"child_added\", cbAdded);\n    _members.off(\"child_removed\", cbRemoved);\n  };\n\n  const update = async ({\n    name,\n    queue,\n    queue_position,\n  }: Partial<Pick<RoomInfo, \"name\" | \"queue\" | \"queue_position\">>) => {\n    if (name !== void 0) {\n      _values.name = name;\n    }\n    if (queue !== void 0) {\n      _values.queue = queue;\n    }\n    if (queue_position !== void 0) {\n      _values.queue_position = queue_position;\n    }\n    await _room.set({\n      info: {\n        ..._values,\n        timestamp: firebase.database.ServerValue.TIMESTAMP,\n      },\n      secret: _secret,\n    });\n  };\n\n  return {\n    getInfo,\n    id,\n    isLocked,\n    setSecret,\n    wait,\n    subscribeInfo,\n    subscribeMembers,\n    unsubscribeInfo,\n    unsubscribeMembers,\n    update,\n  };\n};\n\n// ------------------------------------------------------------------\n\nexport const FirebaseUser = (id: string, secret?: string) => {\n  const _user = USERS.child(id);\n  const _info = _user.child(\"info\");\n  let _membership: firebase.database.Reference | null = null;\n  let _secret = secret || \"\";\n  let _values: UserInfo = {\n    name: \"dummy\",\n    online: false,\n    room_id: \"\",\n    status: \"\",\n    timestamp: 0,\n  };\n\n  const getInfo = () => _values;\n\n  const isLocked = () => !_secret;\n\n  const setSecret = (newSecret: string) => {\n    _secret = newSecret;\n  };\n\n  const wait = async (): Promise<UserInfo> =>\n    new Promise((resolve, reject) => {\n      _info.once(\"value\", (snapshot) => {\n        const newValues = snapshot.val();\n        if (newValues) {\n          _values = newValues;\n          resolve(_values);\n        } else {\n          reject(new Error(\"User is invalid\"));\n        }\n      });\n    });\n\n  const subscribeInfo = (cb: FirebaseCB) => {\n    _info.on(\"value\", cb);\n  };\n\n  const unsubscribeInfo = (cb: FirebaseCB) => {\n    _info.off(\"value\", cb);\n  };\n\n  const update = async ({\n    name,\n    room_id,\n  }: Partial<Pick<UserInfo, \"name\" | \"room_id\">>) => {\n    if (name !== void 0) {\n      _values.name = name;\n    }\n    if (room_id !== void 0) {\n      _values.room_id = room_id;\n    }\n    await _user.set({\n      info: {\n        ..._values,\n        online: true,\n        status: \"online\",\n        timestamp: firebase.database.ServerValue.TIMESTAMP,\n      },\n      secret: _secret,\n    });\n    installDisconnect();\n  };\n\n  const installDisconnect = () => {\n    _user.onDisconnect().cancel();\n    _user.onDisconnect().set({\n      info: {\n        ..._values,\n        online: false,\n        room_id: \"\",\n        status: \"disconnected\",\n        timestamp: firebase.database.ServerValue.TIMESTAMP,\n      },\n      secret: _secret,\n    });\n  };\n\n  const enter = async (room: ReturnType<typeof FirebaseRoom>) => {\n    if (_membership) {\n      await _membership.remove();\n      _membership = null;\n    }\n    await update({\n      room_id: room.id,\n    });\n    _membership = MEMBERS.child(room.id).child(id);\n    _membership.onDisconnect().remove();\n    await _membership.set({\n      timestamp: firebase.database.ServerValue.TIMESTAMP,\n    });\n  };\n\n  const exit = async () => {\n    if (_membership) {\n      await _membership.remove();\n      _membership = null;\n    }\n    await update({\n      room_id: \"\",\n    });\n  };\n\n  return {\n    id,\n    enter,\n    exit,\n    isLocked,\n    setSecret,\n    wait,\n    subscribeInfo,\n    unsubscribeInfo,\n    update,\n    getInfo,\n  };\n};\n\n// ------------------------------------------------------------------\n\nexport const FirebaseParty = (\n  id: string,\n  room: ReturnType<typeof FirebaseRoom>\n) => {\n  const _members: string[] = [];\n  const _users: { [id: string]: ReturnType<typeof FirebaseUser> } = {};\n  let _info: RoomInfo = {\n    name: \"\",\n    queue: {},\n    queue_position: 0,\n    timestamp: 0,\n    type: \"dj\",\n  };\n\n  const _onAdded = (added: firebase.database.DataSnapshot) => {\n    const userId = added.key;\n    if (userId) {\n      const index = _members.indexOf(userId);\n      if (index === -1) {\n        _members.push(userId);\n        _users[userId] = FirebaseUser(userId);\n        _log();\n      }\n    }\n  };\n\n  const _onRemoved = (removed: firebase.database.DataSnapshot) => {\n    const userId = removed.key;\n    if (userId) {\n      const index = _members.indexOf(userId);\n      if (index !== -1) {\n        _members.splice(index, 1);\n        delete _users[userId];\n        _log();\n      }\n    }\n  };\n\n  const _onRoomInfo = (snapshot: firebase.database.DataSnapshot) => {\n    const newValues = snapshot.val() as RoomInfo | null;\n    if (newValues) {\n      _info = newValues;\n      _log();\n    }\n  };\n\n  const _log = () => {\n    console.debug(\"PARTY\", {\n      _info,\n      _members,\n    });\n  };\n\n  const init = () => {\n    room.subscribeInfo(_onRoomInfo);\n    room.subscribeMembers(_onAdded, _onRemoved);\n  };\n\n  const terminate = () => {\n    room.unsubscribeInfo(_onRoomInfo);\n    room.unsubscribeMembers(_onAdded, _onRemoved);\n  };\n\n  return {\n    init,\n    terminate,\n  };\n};\n\n// ------------------------------------------------------------------\n// ------------------------------------------------------------------\n// ------------------------------------------------------------------\n\nexport const testRoom = async () => {\n  const room = FirebaseRoom(\"r1\", \"rs1\");\n  await room.update({ name: \"R1\" });\n  room.subscribeInfo((info) => console.debug(\"ROOM\", info.val()));\n  room.subscribeMembers(\n    (members) => console.debug(\"ADDED\", members.key),\n    (members) => console.debug(\"REMOVED\", members.key)\n  );\n  await room.update({ name: \"R1\" });\n  await sleep(1000);\n  await room.update({\n    name: \"R1b\",\n    queue: {},\n    queue_position: 0,\n  });\n};\n\nexport const testUser = async () => {\n  const user = FirebaseUser(\"u1\", \"us1\");\n  user.subscribeInfo((info) => console.debug(\"USER\", info.val()));\n  await user.update({ name: \"U1\" });\n  await sleep(1000);\n  await user.update({ name: \"U1b\" });\n};\n\nexport const testParty = async () => {\n  const room1 = FirebaseRoom(\"r1\", \"rs1\");\n  await room1.update({ name: \"R1\" });\n  const room2 = FirebaseRoom(\"r2\", \"rs2\");\n  await room2.update({ name: \"R2\" });\n  const user1 = FirebaseUser(\"u1\", \"us1\");\n  await user1.update({ name: \"U1\" });\n  const user2 = FirebaseUser(\"u2\", \"us2\");\n  await user2.update({ name: \"U2\" });\n\n  await sleep(2000);\n\n  const party1 = FirebaseParty(\"P1\", room1);\n  await party1.init();\n  const party2 = FirebaseParty(\"P2\", room2);\n  await party2.init();\n\n  await sleep(1000);\n  user1.enter(room1);\n  await sleep(1000);\n  user2.enter(room1);\n  await sleep(1000);\n  user1.enter(room2);\n  await sleep(1000);\n  user1.exit();\n  await sleep(1000);\n  user1.enter(room1);\n};\n\nexport const test = () => {\n  // testRoom();\n  // testUser();\n  // testParty();\n};\n","import { createAction, AsyncAction } from \".\";\nimport { RoomQueue } from \"../utils/rooms\";\nimport { displayError } from \"./messages\";\nimport { lockRoom } from \"./rooms\";\n\n// ------------------------------------------------------------------\n\nexport type QueueAction = ReturnType<typeof setQueue>;\n\nexport const setQueue = (trackIds: string[], position: number) =>\n  createAction(\"queue/SET\", { position, trackIds });\n\n// ------------------------------------------------------------------\n\nexport const clearQueue = (): AsyncAction => async (dispatch, getState) => {\n  const {\n    rooms: { room }\n  } = getState();\n  if (room && !room.isLocked()) {\n    try {\n      console.debug(\"Clearing queue...\");\n      await room.update({ queue: {}, queue_position: 0 });\n    } catch (err) {\n      dispatch(displayError(\"Cannot clear queue\"));\n      dispatch(lockRoom());\n    }\n  } else {\n    dispatch(displayError(\"Room is locked\"));\n  }\n};\n\nexport const appendInQueue = (trackIds: string[]): AsyncAction => async (\n  dispatch,\n  getState\n) => {\n  const {\n    rooms: { room }\n  } = getState();\n  if (room && !room.isLocked() && trackIds.length > 0) {\n    try {\n      console.debug(\"Appending queue...\", { trackIds });\n      const queue: RoomQueue = {};\n      [...getState().queue.trackIds, ...trackIds].forEach((id, index) => {\n        queue[index] = {\n          id,\n          type: \"deezer\"\n        };\n      });\n      await room.update({ queue });\n    } catch (err) {\n      dispatch(displayError(\"Cannot append in queue\"));\n      dispatch(lockRoom());\n    }\n  } else {\n    dispatch(displayError(\"Room is locked\"));\n  }\n};\n\nexport const removeFromQueue = (index: number): AsyncAction => async (\n  dispatch,\n  getState\n) => {\n  const {\n    queue: { trackIds, position },\n    rooms: { room }\n  } = getState();\n  if (room && !room.isLocked()) {\n    if (index < trackIds.length) {\n      try {\n        console.debug(\"Removing from queue...\", { index });\n        const oldIndex = position % trackIds.length;\n        const queue: RoomQueue = {};\n        const copy = [...getState().queue.trackIds];\n        copy.splice(index, 1);\n        copy.forEach((id, index) => {\n          queue[index] = {\n            id,\n            type: \"deezer\"\n          };\n        });\n        await room.update({\n          queue,\n          queue_position: index < oldIndex ? position - 1 : position\n        });\n      } catch (err) {\n        dispatch(displayError(\"Cannot remove from queue\"));\n        dispatch(lockRoom());\n      }\n    }\n  } else {\n    dispatch(displayError(\"Room is locked\"));\n  }\n};\n\nexport const setQueuePosition = (position: number): AsyncAction => async (\n  dispatch,\n  getState\n) => {\n  const {\n    rooms: { room }\n  } = getState();\n  if (room && !room.isLocked()) {\n    try {\n      console.debug(\"Set queue position...\", { position });\n      await room.update({ queue_position: position });\n    } catch (err) {\n      dispatch(displayError(\"Cannot set queue position\"));\n      dispatch(lockRoom());\n    }\n  } else {\n    dispatch(displayError(\"Room is locked\"));\n  }\n};\n\n// ------------------------------------------------------------------\n\nexport const moveBackward = (): AsyncAction => async (dispatch, getState) => {\n  const {\n    queue: { position, trackIds }\n  } = getState();\n  if (trackIds.length > 0) {\n    console.debug(\"Moving backward...\");\n    dispatch(\n      setQueuePosition(position > 0 ? position - 1 : trackIds.length - 1)\n    );\n  }\n};\n\nexport const moveForward = (): AsyncAction => async (dispatch, getState) => {\n  const {\n    queue: { position, trackIds }\n  } = getState();\n  if (trackIds.length > 0) {\n    console.debug(\"Moving forward...\");\n    dispatch(setQueuePosition(position + 1));\n  }\n};\n","import { AxiosError } from \"axios\";\n//\nimport { createAction, AsyncAction } from \".\";\nimport { displayError } from \"./messages\";\nimport { appendInQueue } from \"./queue\";\nimport { ApiTrack } from \"../utils/deezer\";\n\n// ------------------------------------------------------------------\n\nexport type TracksAction =\n  | ReturnType<typeof fetching>\n  | ReturnType<typeof success>\n  | ReturnType<typeof error>\n  | ReturnType<typeof reset>\n  | ReturnType<typeof setTracks>;\n\nconst fetching = () => createAction(\"tracks/FETCHING\");\nconst success = () => createAction(\"tracks/FETCHED\");\nconst error = (error: AxiosError) => createAction(\"tracks/ERROR\", error);\nconst reset = () => createAction(\"tracks/RESET\");\nexport const setTracks = (tracks: ApiTrack[]) =>\n  createAction(\"tracks/SET_TRACKS\", tracks);\n\n// ------------------------------------------------------------------\n\nconst onlyUnique = (value: string, index: number, self: string[]) =>\n  self.indexOf(value) === index;\n\nexport const loadTracks = (\n  trackIds: string[],\n  enqueue: boolean,\n  preview: boolean\n): AsyncAction => async (dispatch, getState, { deezer, previewPlayer }) => {\n  if (trackIds.length > 0) {\n    try {\n      const {\n        tracks: { tracks: oldTracks }\n      } = getState();\n      const newTrackIds: string[] = trackIds\n        .filter(trackId => !oldTracks[trackId])\n        .filter(onlyUnique);\n      let newTracks: ApiTrack[] = [];\n      if (newTrackIds.length > 0) {\n        console.debug(\"Loading track...\", { trackIds: newTrackIds });\n        newTracks = await Promise.all(\n          newTrackIds.map(trackId => deezer.loadTrack(trackId))\n        );\n        dispatch(setTracks(newTracks));\n      }\n      if (enqueue) {\n        console.debug(\"Enqueuing track...\", { trackIds });\n        dispatch(appendInQueue(trackIds));\n      }\n      if (preview) {\n        const trackId = trackIds[0];\n        const track =\n          oldTracks[trackId] ||\n          newTracks.find(track => track.id.toString() === trackId);\n        console.debug(\"Previewing track...\", { track, trackId });\n        await previewPlayer.play(0, track.preview, 0);\n      }\n    } catch (err) {\n      dispatch(displayError(\"Cannot load track\", err));\n    }\n  }\n};\n","import { AxiosError } from \"axios\";\n//\nimport { createAction, AsyncAction } from \".\";\nimport { Container, ContainerType } from \"../utils/containers\";\nimport { displayError } from \"./messages\";\nimport { appendInQueue } from \"./queue\";\nimport { loadTracks, setTracks } from \"./tracks\";\n\n// ------------------------------------------------------------------\n\nexport type ContainersAction =\n  | ReturnType<typeof fetching>\n  | ReturnType<typeof success>\n  | ReturnType<typeof error>\n  | ReturnType<typeof reset>\n  | ReturnType<typeof setContainers>;\n\nconst fetching = () => createAction(\"containers/FETCHING\");\nconst success = () => createAction(\"containers/FETCHED\");\nconst error = (error: AxiosError) => createAction(\"containers/ERROR\", error);\nconst reset = () => createAction(\"containers/RESET\");\nconst setContainers = (containers: Container[]) =>\n  createAction(\"containers/SET_CONTAINERS\", containers);\n\n// ------------------------------------------------------------------\n\nexport const loadContainer = (\n  containerType: ContainerType,\n  containerId: string,\n  enqueue: boolean,\n  preview: boolean\n): AsyncAction => async (dispatch, getState, { deezer }) => {\n  try {\n    const state = getState();\n    const containerTypeId = `${containerType}|${containerId}`;\n    let container = state.containers.containers[containerTypeId];\n    if (!container) {\n      console.debug(\"Loading container...\", { containerId, containerType });\n      switch (containerType) {\n        case \"album\":\n          container = await deezer.loadAlbum(containerId);\n          break;\n        case \"playlist\":\n          container = await deezer.loadPlaylist(containerId);\n          break;\n      }\n    }\n    if (container) {\n      dispatch(setContainers([container]));\n      if (container.tracks && container.tracks.data.length > 0) {\n        dispatch(setTracks(container.tracks.data));\n        if (enqueue) {\n          console.debug(\"Enqueuing container...\");\n          dispatch(\n            appendInQueue(\n              container.tracks.data.map(track => track.id.toString())\n            )\n          );\n        }\n        if (preview) {\n          console.debug(\"Previewing container...\");\n          dispatch(\n            loadTracks([container.tracks.data[0].id.toString()], false, true)\n          );\n        }\n      }\n    }\n  } catch (err) {\n    dispatch(displayError(\"Cannot load container\", err));\n  }\n};\n\n// ------------------------------------------------------------------\n\nexport const previewContainer = (\n  containerType: ContainerType,\n  containerId: string\n): AsyncAction => async dispatch => {\n  console.debug(\"Previewing container...\", { containerType, containerId });\n  dispatch(loadContainer(containerType, containerId, false, true));\n};\n","import { createHashHistory } from \"history\";\n\nexport default createHashHistory();\n","import { AxiosError } from \"axios\";\nimport { v4 } from \"uuid\";\n//\nimport { createAction, AsyncAction } from \".\";\nimport { displayError } from \"./messages\";\nimport { RoomInfo } from \"../utils/rooms\";\nimport { FirebaseRoom } from \"../utils/firebase\";\nimport { loadTracks } from \"./tracks\";\nimport { loadContainer } from \"./containers\";\nimport { ContainerType } from \"../utils/containers\";\nimport { CombinedColor } from \"../utils/colorpicker\";\nimport history from \"../utils/history\";\nimport { setQueue } from \"./queue\";\n\n// ------------------------------------------------------------------\n\nexport type RoomsAction =\n  | ReturnType<typeof fetching>\n  | ReturnType<typeof success>\n  | ReturnType<typeof error>\n  | ReturnType<typeof reset>\n  | ReturnType<typeof setRoom>\n  | ReturnType<typeof setRoomAccess>\n  | ReturnType<typeof setRoomColor>;\n\nconst fetching = () => createAction(\"rooms/FETCHING\");\nconst success = () => createAction(\"rooms/FETCHED\");\nconst error = (error: AxiosError) => createAction(\"rooms/ERROR\", error);\nconst reset = () => createAction(\"rooms/RESET\");\nconst setRoom = (\n  room: ReturnType<typeof FirebaseRoom> | null,\n  info: RoomInfo | null\n) => createAction(\"rooms/SET_ROOM\", { info, room });\nconst setRoomAccess = (id: string, secret: string) =>\n  createAction(\"rooms/SET_ROOM_ACCESS\", { id, secret });\nexport const setRoomColor = (color: CombinedColor) =>\n  createAction(\"rooms/SET_ROOM_COLOR\", color);\n\n// ------------------------------------------------------------------\n\nexport const createRoom = (\n  name: string,\n  secret: string\n): AsyncAction => async dispatch => {\n  try {\n    const id = v4();\n    console.debug(\"Creating room...\", { id, secret });\n    await FirebaseRoom(id, secret).update({ name });\n    dispatch(enterRoom(id, secret));\n  } catch (err) {\n    dispatch(displayError(\"Cannot create room\", err));\n  }\n};\n\n// ------------------------------------------------------------------\n\nlet FIREBASE_CB: any = null;\n\nexport const enterRoom = (id: string, secret: string): AsyncAction => async (\n  dispatch,\n  getState\n) => {\n  const {\n    rooms: { room }\n  } = getState();\n  if (!room || room.id !== id) {\n    dispatch(exitRoom());\n    try {\n      console.debug(\"Entering room...\", { id, secret });\n      const newRoom = FirebaseRoom(id, secret);\n      dispatch(setRoom(newRoom, await newRoom.wait()));\n      dispatch(setRoomAccess(id, secret));\n      FIREBASE_CB = (snapshot: firebase.database.DataSnapshot) => {\n        const newInfo = snapshot.val() as RoomInfo;\n        let trackIds: string[] = [];\n        if (newInfo.queue) {\n          trackIds = Object.entries(newInfo.queue)\n            .sort((track1, track2) => Number(track1[0]) - Number(track2[0]))\n            .map(track => track[1].id);\n          dispatch(loadTracks(trackIds, false, false));\n        }\n        dispatch(setQueue(trackIds, newInfo.queue_position));\n        dispatch(setRoom(newRoom, newInfo));\n      };\n      newRoom.subscribeInfo(FIREBASE_CB);\n      history.push(`/room/${id}?key=${secret}`); // TODO: should push only if we're not already in it\n    } catch (err) {\n      dispatch(displayError(\"Cannot join room\", err));\n    }\n  }\n};\n\nexport const exitRoom = (): AsyncAction => async (dispatch, getState) => {\n  const {\n    rooms: { room }\n  } = getState();\n  if (room) {\n    console.debug(\"Exiting room...\");\n    room.unsubscribeInfo(FIREBASE_CB);\n    FIREBASE_CB = null;\n    dispatch(setRoom(null, null));\n    dispatch(setRoomAccess(\"\", \"\"));\n  }\n};\n\n// ------------------------------------------------------------------\n\nexport const lockRoom = (): AsyncAction => async (dispatch, getState) => {\n  const {\n    rooms: {\n      room,\n      room_access: { id }\n    }\n  } = getState();\n  if (room && room.id === id) {\n    console.debug(\"Locking room...\", { id });\n    room.setSecret(\"\");\n    dispatch(setRoomAccess(id, \"\"));\n  }\n};\n\nexport const unlockRoom = (secret: string): AsyncAction => async (\n  dispatch,\n  getState\n) => {\n  const {\n    rooms: {\n      room,\n      room_access: { id }\n    }\n  } = getState();\n  if (room && room.id === id) {\n    console.debug(\"Unlocking room...\", { id, secret });\n    room.setSecret(secret);\n    dispatch(setRoomAccess(id, secret));\n  }\n};\n\n// ------------------------------------------------------------------\n\nexport const queueTracks = (\n  containerType: ContainerType,\n  containerId: string,\n  trackId: string\n): AsyncAction => async dispatch => {\n  if (containerId) {\n    dispatch(loadContainer(containerType, containerId, true, false));\n  }\n  if (trackId) {\n    dispatch(loadTracks([trackId], true, false));\n  }\n};\n","import { connect } from \"react-redux\";\nimport { ThunkDispatch } from \"redux-thunk\";\n//\nimport { RootState } from \"../../reducers\";\nimport Head from \"../../components/Room/Head\";\nimport { extractRoom, isRoomLocked } from \"../../selectors/rooms\";\nimport { openModal } from \"../../actions/modals\";\nimport { lockRoom } from \"../../actions/rooms\";\nimport { displayMessage } from \"../../actions/messages\";\n\n// ------------------------------------------------------------------\n\nconst stateToProps = (state: RootState) => ({\n  locked: isRoomLocked(state),\n  room: extractRoom(state)\n});\n\nconst dispatchToProps = (dispatch: ThunkDispatch<RootState, any, any>) => ({\n  onLock: () => dispatch(lockRoom()),\n  onMessage: (message: string) => dispatch(displayMessage(\"info\", message)),\n  onUnlock: () => dispatch(openModal({ type: \"UnlockRoom\", props: null }))\n});\n\nexport type MappedProps = ReturnType<typeof stateToProps> &\n  ReturnType<typeof dispatchToProps>;\n\nexport default connect(stateToProps, dispatchToProps)(Head);\n","import React, { Component } from \"react\";\nimport { withTranslation, WithTranslation } from \"react-i18next\";\nimport classNames from \"classnames\";\n//\nimport Icon from \"../Common/Icon\";\nimport \"./Cover.scss\";\n\n// ------------------------------------------------------------------\n\ntype Props = {\n  image: string;\n  onPlay: () => void;\n  onStop: () => void;\n  playable: boolean;\n  playing: boolean;\n};\n\nclass Cover extends Component<Props & WithTranslation> {\n  public render = () => {\n    const { playable, playing, image, onPlay, onStop, t } = this.props;\n    if (playable) {\n      return (\n        <div\n          className={classNames(\"Cover\", { playing })}\n          style={{ backgroundImage: `url('${image}')` }}\n          onClick={!playing ? onPlay : onStop}\n        >\n          {!playing ? (\n            <Icon icon=\"play\" title={t(\"player.play\")} />\n          ) : (\n            <Icon icon=\"pause\" title={t(\"player.stop\")} />\n          )}\n        </div>\n      );\n    } else {\n      return (\n        <div\n          className={classNames(\"Cover\", { playing })}\n          style={{ backgroundImage: `url('${image}')` }}\n        >\n          {playing ? <Icon icon=\"music\" title={t(\"player.playing\")} /> : null}\n        </div>\n      );\n    }\n  };\n}\n\nexport default withTranslation()(Cover);\n","import React, { ReactNode, Component } from \"react\";\nimport { withTranslation, WithTranslation } from \"react-i18next\";\n//\nimport { ApiAlbum, ApiPlaylist, ApiTrack } from \"../../utils/deezer\";\nimport Cover from \"./Cover\";\nimport \"./Medias.scss\";\n\n// ------------------------------------------------------------------\n\ntype AlbumProps = {\n  actions?: ReactNode;\n  album: ApiAlbum;\n  playable: boolean;\n  playing: boolean;\n  onPlay: () => void;\n  onStop: () => void;\n};\n\nexport class _Album extends Component<AlbumProps & WithTranslation> {\n  public render = () => {\n    const { actions, album, playable, playing, onPlay, onStop, t } = this.props;\n    return (\n      <div className=\"Media Album\">\n        {actions}\n        <Cover\n          playable={playable}\n          playing={playing}\n          image={album.cover_small}\n          onPlay={onPlay}\n          onStop={onStop}\n        />\n        <div className=\"Metas\">\n          <div className=\"Meta AlbumTitle\">\n            <a href={album.link} target=\"_blank\" rel=\"noopener noreferrer\">\n              {album.title}\n            </a>\n          </div>\n          <div className=\"Meta AlbumArtistName\">\n            <a\n              href={album.artist.link}\n              target=\"_blank\"\n              rel=\"noopener noreferrer\"\n            >\n              {t(\"medias.by\", { artist: album.artist.name })}\n            </a>\n          </div>\n        </div>\n      </div>\n    );\n  };\n}\n\nexport const Album = withTranslation()(_Album);\n\n// ------------------------------------------------------------------\n\ntype PlaylistProps = {\n  actions?: ReactNode;\n  playlist: ApiPlaylist;\n  playable: boolean;\n  playing: boolean;\n  onPlay: () => void;\n  onStop: () => void;\n};\n\nexport class _Playlist extends Component<PlaylistProps & WithTranslation> {\n  public render = () => {\n    const { actions, playlist, playable, playing, onPlay, onStop } = this.props;\n    return (\n      <div className=\"Media Playlist\">\n        {actions}\n        <Cover\n          playable={playable}\n          playing={playing}\n          image={playlist.picture_small}\n          onPlay={onPlay}\n          onStop={onStop}\n        />\n        <div className=\"Metas\">\n          <div className=\"Meta PlaylistTitle\">\n            <a href={playlist.link} target=\"_blank\" rel=\"noopener noreferrer\">\n              {playlist.title}\n            </a>\n          </div>\n        </div>\n      </div>\n    );\n  };\n}\n\nexport const Playlist = withTranslation()(_Playlist);\n\n// ------------------------------------------------------------------\n\ntype TrackProps = {\n  actions?: ReactNode;\n  track: ApiTrack;\n  playable: boolean;\n  playing: boolean;\n  onPlay: () => void;\n  onStop: () => void;\n};\n\nexport class _Track extends Component<TrackProps & WithTranslation> {\n  public render = () => {\n    const { actions, track, playable, playing, onPlay, onStop, t } = this.props;\n    return (\n      <div className=\"Media Track\">\n        {actions}\n        <Cover\n          playable={playable}\n          playing={playing}\n          image={track.album.cover_small}\n          onPlay={onPlay}\n          onStop={onStop}\n        />\n        <div className=\"Metas\">\n          <div className=\"Meta TrackTitle\">\n            <a href={track.link} target=\"_blank\" rel=\"noopener noreferrer\">\n              {track.title}\n            </a>\n          </div>\n          <div className=\"Meta TrackArtistName\">\n            <a\n              href={track.artist.link}\n              target=\"_blank\"\n              rel=\"noopener noreferrer\"\n            >\n              {t(\"medias.by\", { artist: track.artist.name })}\n            </a>\n          </div>\n        </div>\n      </div>\n    );\n  };\n}\n\nexport const Track = withTranslation()(_Track);\n","import React, { Component } from \"react\";\nimport { withTranslation, WithTranslation } from \"react-i18next\";\n//\nimport { MappedProps } from \"../../containers/Room/Queue\";\nimport { Track } from \"./Medias\";\nimport IconButton from \"../Common/IconButton\";\nimport \"./Queue.scss\";\n\n// ------------------------------------------------------------------\n\nclass Queue extends Component<MappedProps & WithTranslation> {\n  public render = () => {\n    const {\n      locked,\n      playing,\n      trackIndex,\n      tracks,\n      onPlay,\n      onRemove,\n      onSearch,\n      onStop,\n      t,\n    } = this.props;\n    return (\n      <div className=\"Queue\">\n        {tracks.length > 0 ? (\n          tracks.map((track, index) => (\n            <div className=\"QueueItem\" key={index}>\n              <Track\n                track={track}\n                playable={!locked}\n                playing={playing && trackIndex === index}\n                onPlay={() => onPlay(index)}\n                onStop={onStop}\n                actions={\n                  !locked ? (\n                    <IconButton\n                      title={t(\"medias.remove\")}\n                      icon=\"trash\"\n                      onClick={() => onRemove(index)}\n                    />\n                  ) : null\n                }\n              />\n            </div>\n          ))\n        ) : (\n          <div className=\"QueueEmpty\">\n            <IconButton title=\"...\" icon=\"shower\" onClick={onSearch} size=\"L\" />\n            <span onClick={onSearch}>{t(\"rooms.empty\")}</span>\n          </div>\n        )}\n      </div>\n    );\n  };\n}\n\nexport default withTranslation()(Queue);\n","import { RootState } from \"../reducers\";\nimport { ApiTrack } from \"../utils/deezer\";\n\nexport const extractTracks = (state: RootState, trackIds: string[]) => {\n  const res: Array<ApiTrack> = [];\n  const {\n    tracks: { tracks }\n  } = state;\n  for (const trackId of trackIds) {\n    const track = tracks[trackId];\n    if (!!track) {\n      res.push(track);\n    }\n  }\n  return res;\n};\n","import * as jimp from \"jimp\";\n\n// ------------------------------------------------------------------\n\nexport type Color = {\n  r: number;\n  g: number;\n  b: number;\n};\n\nexport type CombinedColor = {\n  bg: Color;\n  fg: Color;\n};\n\nconst CACHE: { [url: string]: CombinedColor } = {};\n\nconst DEFAULT_COLOR = {\n  bg: { r: 255, g: 255, b: 255 },\n  fg: { r: 0, g: 0, b: 0 }\n};\n\n// ------------------------------------------------------------------\n\n// https://stackoverflow.com/questions/3942878/how-to-decide-font-color-in-white-or-black-depending-on-background-color\nexport const pickColor = async (url: string) => {\n  let res = DEFAULT_COLOR;\n  if (url) {\n    res = CACHE[url];\n    if (!res) {\n      try {\n        const image = await jimp.read(url);\n        const pixel = await image.resize(1, 1).getPixelColor(0, 0);\n        const bg = jimp.intToRGBA(pixel);\n        CACHE[url] = res = {\n          bg,\n          fg:\n            bg.r * 0.299 + bg.g * 0.587 + bg.b * 0.114 > 186\n              ? { r: 0, g: 0, b: 0 }\n              : { r: 255, g: 255, b: 255 }\n        };\n      } catch (err) {\n        console.debug(\"An error prevented colorpicking\", err);\n      }\n    }\n  }\n  return res;\n};\n\n/*\nconst backgroundColor = color\n? `rgb(${color.r}, ${color.g}, ${color.b})`\n: void 0;\n<div\nstyle={{\n  backgroundColor\n}}\n>\nx\n</div>\n\ncolors: {\n  [id: string]: {\n    r: number;\n    g: number;\n    b: number;\n    a: number;\n  };\n};,\ncolors: {}\nconst color = this.state.colors[album.id];\n\nimport { pickColor } from \"../../utils/colorpicker\";\n\nprivate XXX = async (id: number, url: string) => {\n  if (!this.state.colors[id]) {\n    const color = await pickColor(url);\n    this.setState({\n      colors: { ...this.state.colors, [id]: color }\n    });\n  }\n};\n*/\n","import { AsyncAction, createAction, Dispatch } from \".\";\nimport { setTracks } from \"./tracks\";\nimport { displayError } from \"./messages\";\nimport { setRoomColor } from \"./rooms\";\nimport { pickColor } from \"../utils/colorpicker\";\nimport { setQueuePosition } from \"./queue\";\nimport { Player } from \"../utils/player\";\nimport { RootState } from \"../reducers\";\n\n// ------------------------------------------------------------------\n\nexport type PlayerAction =\n  | ReturnType<typeof reset>\n  | ReturnType<typeof setPlayerTrackPercent>\n  | ReturnType<typeof start>\n  | ReturnType<typeof stop>;\n\nconst reset = () => createAction(\"player/RESET\");\nconst setPlayerTrackPercent = (percent: number) =>\n  createAction(\"player/SET_TRACK_PERCENT\", percent);\nconst start = () => createAction(\"player/START\");\nconst stop = () => createAction(\"player/STOP\");\n\n// ------------------------------------------------------------------\n\nlet PLAYER_TIMER1: NodeJS.Timeout | null = null;\nlet PLAYER_TIMER2: NodeJS.Timeout | null = null;\n\nconst _computeNextPosition = (\n  queuePlayer: ReturnType<typeof Player>,\n  playingPosition: number,\n  queuePosition: number\n) => {\n  let nextPosition = -1;\n  if (playingPosition !== queuePosition) {\n    console.debug(\"Detected play change...\", {\n      playingPosition,\n      queuePosition,\n      isPlaying: queuePlayer.isPlaying(),\n    });\n    if (queuePlayer.isPlaying()) {\n      // User has clicked an other track or added/removed a track in queue\n      nextPosition = queuePosition;\n    } else {\n      // Not playing which means previous track has terminated\n      nextPosition = playingPosition >= 0 ? playingPosition : queuePosition;\n    }\n  }\n  return nextPosition;\n};\n\nconst _installTimer1 = (\n  dispatch: Dispatch,\n  getState: () => RootState,\n  queuePlayer: ReturnType<typeof Player>\n) => {\n  // Don't use setInterval because a step could be triggered before previous one terminated\n  PLAYER_TIMER1 = setTimeout(async () => {\n    const {\n      queue: { position: queuePosition, trackIds },\n      tracks: { tracks },\n    } = getState();\n    if (trackIds.length > 0) {\n      const playingPosition = queuePlayer.getPlayingPosition();\n\n      // Detect change\n      const nextPosition = _computeNextPosition(\n        queuePlayer,\n        playingPosition,\n        queuePosition\n      );\n\n      // Apply change to queue and player\n      if (nextPosition >= 0) {\n        const nextIndex = nextPosition % trackIds.length;\n        const nextTrack = tracks[trackIds[nextIndex]];\n        console.debug(\"Applying play change...\", {\n          nextPosition,\n          nextIndex,\n          nextTrack,\n        });\n        dispatch(setQueuePosition(nextPosition));\n        const [color] = await Promise.all([\n          pickColor(nextTrack.album.cover_small),\n          queuePlayer.play(nextPosition, nextTrack.preview, 0),\n        ]);\n        dispatch(setRoomColor(color));\n      }\n\n      // Reschedule time\n      _installTimer1(dispatch, getState, queuePlayer);\n    } else {\n      // Last track has been removed from queue by user\n      console.debug(\"No more tracks in queue...\");\n      dispatch(stopPlayer());\n    }\n  }, 250);\n};\n\nconst _installTimer2 = (\n  dispatch: Dispatch,\n  getState: () => RootState,\n  queuePlayer: ReturnType<typeof Player>\n) => {\n  // Don't use setInterval because a step could be triggered before previous one terminated\n  PLAYER_TIMER2 = setTimeout(async () => {\n    const {\n      queue: { trackIds },\n    } = getState();\n    if (trackIds.length > 0) {\n      // Refresh player track percent\n      dispatch(setPlayerTrackPercent(queuePlayer.getTrackPercent()));\n\n      // Reschedule time\n      _installTimer2(dispatch, getState, queuePlayer);\n    }\n  }, 50); // Must do very few operation because called very often\n};\n\nexport const startPlayer = (): AsyncAction => async (\n  dispatch,\n  getState,\n  { queuePlayer }\n) => {\n  if (!PLAYER_TIMER1 && !PLAYER_TIMER2) {\n    _installTimer1(dispatch, getState, queuePlayer);\n    _installTimer2(dispatch, getState, queuePlayer);\n    dispatch(start());\n  }\n};\n\n// ------------------------------------------------------------------\n\nexport const stopPlayer = (): AsyncAction => async (\n  dispatch,\n  _,\n  { queuePlayer }\n) => {\n  if (PLAYER_TIMER1 && PLAYER_TIMER2) {\n    clearTimeout(PLAYER_TIMER1);\n    PLAYER_TIMER1 = null;\n    clearTimeout(PLAYER_TIMER2);\n    PLAYER_TIMER2 = null;\n    await queuePlayer.stop();\n    dispatch(stop());\n    dispatch(setPlayerTrackPercent(0));\n  }\n};\n\n// ------------------------------------------------------------------\n\nexport const startPreview = (trackId: string): AsyncAction => async (\n  dispatch,\n  getState,\n  { deezer, previewPlayer }\n) => {\n  try {\n    const state = getState();\n    let track = state.tracks.tracks[trackId];\n    if (!track) {\n      console.debug(\"Loading track...\", { trackId });\n      track = await deezer.loadTrack(trackId);\n      dispatch(setTracks([track]));\n    }\n    console.debug(\"Start previewing...\");\n    await previewPlayer.play(0, track.preview, 0);\n  } catch (err) {\n    dispatch(displayError(\"Cannot load track\", err));\n  }\n};\n\n// ------------------------------------------------------------------\n\nexport const stopPreview = (): AsyncAction => async (\n  _1,\n  _2,\n  { previewPlayer }\n) => {\n  console.debug(\"Stop previewing...\");\n  await previewPlayer.stop();\n};\n","import { connect } from \"react-redux\";\nimport { ThunkDispatch } from \"redux-thunk\";\n//\nimport { RootState } from \"../../reducers\";\nimport Queue from \"../../components/Room/Queue\";\nimport { extractTracks } from \"../../selectors/tracks\";\nimport { setQueuePosition, removeFromQueue } from \"../../actions/queue\";\nimport { stopPlayer, startPlayer } from \"../../actions/player\";\nimport { isRoomLocked } from \"../../selectors/rooms\";\nimport { openModal } from \"../../actions/modals\";\n\n// ------------------------------------------------------------------\n\nconst stateToProps = (state: RootState) => ({\n  locked: isRoomLocked(state),\n  playing: state.player.playing,\n  trackIndex: state.queue.position % state.queue.trackIds.length,\n  tracks: extractTracks(state, state.queue.trackIds),\n});\n\nconst dispatchToProps = (dispatch: ThunkDispatch<RootState, any, any>) => ({\n  onPlay: (index: number) => {\n    dispatch(startPlayer());\n    dispatch(setQueuePosition(index));\n  },\n  onRemove: (index: number) => dispatch(removeFromQueue(index)),\n  onSearch: () => dispatch(openModal({ type: \"Search\", props: null })),\n  onStop: () => dispatch(stopPlayer()),\n});\n\nexport type MappedProps = ReturnType<typeof stateToProps> &\n  ReturnType<typeof dispatchToProps>;\n\nexport default connect(stateToProps, dispatchToProps)(Queue);\n","import React, { Component } from \"react\";\nimport classNames from \"classnames\";\n//\nimport { MappedProps } from \"../../containers/Room/Progress\";\nimport \"./Progress.scss\";\n\n// ------------------------------------------------------------------\n\nclass Progress extends Component<MappedProps> {\n  public render = () => {\n    const { playing, value } = this.props;\n    return (\n      <div className={classNames(\"Progress\", { playing })}>\n        <progress max={100} value={value * 100} />\n      </div>\n    );\n  };\n}\n\nexport default Progress;\n","import { connect } from \"react-redux\";\nimport { ThunkDispatch } from \"redux-thunk\";\n//\nimport { RootState } from \"../../reducers\";\nimport Progress from \"../../components/Room/Progress\";\n\n// ------------------------------------------------------------------\n\nconst stateToProps = (state: RootState) => ({\n  playing: state.player.playing,\n  value: state.player.track_percent\n});\n\nconst dispatchToProps = (dispatch: ThunkDispatch<RootState, any, any>) => ({});\n\nexport type MappedProps = ReturnType<typeof stateToProps> &\n  ReturnType<typeof dispatchToProps>;\n\nexport default connect(stateToProps, dispatchToProps)(Progress);\n","import React, { Component } from \"react\";\nimport { withTranslation, WithTranslation } from \"react-i18next\";\n//\nimport { MappedProps } from \"../../containers/Room/Controls\";\nimport IconButton from \"../Common/IconButton\";\nimport history from \"../../utils/history\";\nimport Progress from \"../../containers/Room/Progress\";\nimport \"./Controls.scss\";\n\n// ------------------------------------------------------------------\n\nclass Controls extends Component<MappedProps & WithTranslation> {\n  public render = () => {\n    const {\n      onMoveBackward,\n      onMoveForward,\n      onPlay,\n      onSearch,\n      onStop,\n      tracksCount,\n      locked,\n      playing,\n      t,\n    } = this.props;\n    return (\n      <div className=\"Controls\">\n        <div className=\"ControlsSet\">\n          <div className=\"Control\">\n            <IconButton\n              disabled={locked || tracksCount === 0}\n              icon=\"step-backward\"\n              onClick={onMoveBackward}\n              size=\"M\"\n              title={t(\"player.backward\")}\n            />\n          </div>\n          <div className=\"Control\">\n            {!playing ? (\n              <IconButton\n                disabled={locked || tracksCount === 0}\n                onClick={onPlay}\n                icon=\"play\"\n                size=\"L\"\n                title={t(\"player.play\")}\n              />\n            ) : (\n              <IconButton\n                disabled={locked || tracksCount === 0}\n                onClick={onStop}\n                icon=\"pause\"\n                title={t(\"player.stop\")}\n                size=\"L\"\n              />\n            )}\n          </div>\n          <div className=\"Control\">\n            <IconButton\n              disabled={locked || tracksCount === 0}\n              icon=\"step-forward\"\n              onClick={onMoveForward}\n              size=\"M\"\n              title={t(\"player.forward\")}\n            />\n          </div>\n        </div>\n        <Progress />\n        <div className=\"ControlsSet\">\n          <div className=\"Control\">\n            <IconButton\n              disabled={locked || tracksCount === 0}\n              onClick={this.onClear}\n              icon=\"trash\"\n              title={t(\"rooms.clear\")}\n            />\n          </div>\n          <div className=\"Control\">\n            <IconButton\n              onClick={onSearch}\n              icon=\"search\"\n              title={t(\"medias.search\")}\n            />\n          </div>\n          <div className=\"Control\">\n            <IconButton\n              onClick={this.onExit}\n              icon=\"sign-out\"\n              title={t(\"rooms.exit\")}\n            />\n          </div>\n        </div>\n      </div>\n    );\n  };\n\n  onClear = () => {\n    const { t } = this.props;\n    if (window.confirm(t(\"rooms.confirm_clear\"))) {\n      this.props.onClear();\n    }\n  };\n\n  onExit = () => {\n    const { t } = this.props;\n    if (window.confirm(t(\"rooms.confirm_exit\"))) {\n      history.push(\"/\");\n    }\n  };\n}\n\nexport default withTranslation()(Controls);\n","import { connect } from \"react-redux\";\nimport { ThunkDispatch } from \"redux-thunk\";\n//\nimport { RootState } from \"../../reducers\";\nimport Controls from \"../../components/Room/Controls\";\nimport { startPlayer, stopPlayer } from \"../../actions/player\";\nimport { openModal } from \"../../actions/modals\";\nimport { clearQueue, moveBackward, moveForward } from \"../../actions/queue\";\nimport { isRoomLocked } from \"../../selectors/rooms\";\n\n// ------------------------------------------------------------------\n\nconst stateToProps = (state: RootState) => ({\n  tracksCount: state.queue.trackIds.length,\n  locked: isRoomLocked(state),\n  playing: state.player.playing,\n});\n\nconst dispatchToProps = (dispatch: ThunkDispatch<RootState, any, any>) => ({\n  onClear: () => {\n    dispatch(clearQueue());\n    dispatch(stopPlayer());\n  },\n  onMoveBackward: () => dispatch(moveBackward()),\n  onMoveForward: () => dispatch(moveForward()),\n  onPlay: () => dispatch(startPlayer()),\n  onSearch: () => dispatch(openModal({ type: \"Search\", props: null })),\n  onStop: () => dispatch(stopPlayer()),\n});\n\nexport type MappedProps = ReturnType<typeof stateToProps> &\n  ReturnType<typeof dispatchToProps>;\n\nexport default connect(stateToProps, dispatchToProps)(Controls);\n","import React, { Component } from \"react\";\nimport { withRouter, RouteComponentProps } from \"react-router-dom\";\n//\nimport { MappedProps } from \"../../containers/Room\";\nimport Head from \"../../containers/Room/Head\";\nimport Queue from \"../../containers/Room/Queue\";\nimport Controls from \"../../containers/Room/Controls\";\nimport \"./index.scss\";\n\n// ------------------------------------------------------------------\n\nexport type Props = RouteComponentProps<{\n  room_id: string;\n}>;\n\nclass Room extends Component<Props & MappedProps> {\n  public componentDidMount = () => {\n    this.props.onEnter();\n  };\n\n  public componentWillUnmount = () => {\n    this.props.onExit();\n  };\n\n  public render = () => {\n    const {\n      color: { fg, bg }\n    } = this.props;\n    return (\n      <div\n        className=\"Room\"\n        style={{\n          color: `rgb(${fg.r}, ${fg.g}, ${fg.b})`,\n          backgroundColor: `rgb(${bg.r}, ${bg.g}, ${bg.b})`\n        }}\n      >\n        <Head />\n        <Queue />\n        <Controls />\n      </div>\n    );\n  };\n}\n\nexport default withRouter(Room);\n","import { connect } from \"react-redux\";\nimport { ThunkDispatch } from \"redux-thunk\";\nimport * as qs from \"qs\";\n//\nimport { RootState } from \"../../reducers\";\nimport Room, { Props } from \"../../components/Room\";\nimport { enterRoom, exitRoom } from \"../../actions/rooms\";\n\n// ------------------------------------------------------------------\n\nconst stateToProps = (state: RootState, ownProps: Props) => ({\n  color: state.rooms.room_color\n});\n\nconst dispatchToProps = (\n  dispatch: ThunkDispatch<RootState, any, any>,\n  ownProps: Props\n) => {\n  const { key } = qs.parse(ownProps.location.search.substr(1)) as {\n    key?: string;\n  };\n  return {\n    onEnter: () =>\n      dispatch(enterRoom(ownProps.match.params.room_id, key || \"\")),\n    onExit: () => dispatch(exitRoom())\n  };\n};\n\nexport type MappedProps = ReturnType<typeof stateToProps> &\n  ReturnType<typeof dispatchToProps>;\n\nexport default connect(stateToProps, dispatchToProps)(Room);\n","import React, { Component, Fragment } from \"react\";\nimport { Link } from \"react-router-dom\";\nimport { withTranslation, WithTranslation } from \"react-i18next\";\n//\nimport { MappedProps } from \"../../containers/Splash\";\nimport IconButton from \"../Common/IconButton\";\nimport \"./index.scss\";\n\n// ------------------------------------------------------------------\n\nclass Splash extends Component<MappedProps & WithTranslation> {\n  public render = () => {\n    const { loggedIn, onCreateRoom, onConnectUser, t } = this.props;\n    return (\n      <div className=\"Splash\">\n        <div className=\"Top\">\n          <div className=\"Logo\">\n            <Link to=\"/\">Party</Link>\n          </div>\n          <div className=\"PoweredWith\">\n            <span>{t(\"splash.powered_with\")}</span>\n            <a\n              href=\"https://www.deezer.com\"\n              target=\"_blank\"\n              rel=\"noopener noreferrer\"\n            >\n              <img\n                src=\"/images/deezer.svg\"\n                height=\"20px\"\n                title=\"Deezer\"\n                alt=\"Deezer Logo\"\n              />\n            </a>\n          </div>\n        </div>\n        <div className=\"Middle\">\n          <div className=\"Menu\">\n            {loggedIn ? (\n              <div className=\"MenuItem\">\n                <IconButton\n                  displayTitle={true}\n                  icon=\"plus\"\n                  onClick={onCreateRoom}\n                  size=\"L\"\n                  title={t(\"rooms.create_room\")}\n                />\n              </div>\n            ) : (\n              <Fragment>\n                <div className=\"MenuItem\">\n                  <IconButton\n                    displayTitle={true}\n                    onClick={onConnectUser}\n                    icon=\"sign-in\"\n                    size=\"L\"\n                    title={t(\"users.connect\")}\n                  />\n                </div>\n              </Fragment>\n            )}\n          </div>\n        </div>\n        <div className=\"Bottom\">\n          <div className=\"Menu\">\n            {loggedIn ? (\n              <div className=\"MenuItem\">\n                <IconButton\n                  displayTitle={true}\n                  icon=\"sign-out\"\n                  onClick={this.onDisconnect}\n                  size=\"M\"\n                  title={t(\"users.disconnect\")}\n                />\n              </div>\n            ) : (\n              <div className=\"MenuItem\">\n                <IconButton\n                  displayTitle={true}\n                  icon=\"info\"\n                  onClick={() => {}}\n                  size=\"M\"\n                  title={t(\"splash.CGU\")}\n                />\n              </div>\n            )}\n          </div>\n        </div>\n      </div>\n    );\n  };\n\n  onDisconnect = () => {\n    if (window.confirm(this.props.t(\"users.confirm_disconnect\"))) {\n      this.props.onDisconnectUser();\n    }\n  };\n}\n\nexport default withTranslation()(Splash);\n","import { RootState } from \"../reducers\";\n\nexport const extractUser = (state: RootState) => state.users.user_info;\n","import { AxiosError } from \"axios\";\nimport { v4 } from \"uuid\";\n//\nimport { createAction, AsyncAction } from \".\";\nimport { UserInfo } from \"../utils/users\";\nimport { FirebaseUser } from \"../utils/firebase\";\nimport { displayError } from \"./messages\";\n\n// ------------------------------------------------------------------\n\nexport type UsersAction =\n  | ReturnType<typeof fetching>\n  | ReturnType<typeof success>\n  | ReturnType<typeof error>\n  | ReturnType<typeof reset>\n  | ReturnType<typeof setUser>\n  | ReturnType<typeof setUserAccess>;\n\nconst fetching = () => createAction(\"users/FETCHING\");\nconst success = () => createAction(\"users/FETCHED\");\nconst error = (error: AxiosError) => createAction(\"users/ERROR\", error);\nconst reset = () => createAction(\"users/RESET\");\nconst setUser = (\n  user: ReturnType<typeof FirebaseUser> | null,\n  info: UserInfo | null\n) => createAction(\"users/SET_USER\", { info, user });\nconst setUserAccess = (id: string, secret: string) =>\n  createAction(\"users/SET_USER_ACCESS\", { id, secret });\n\n// ------------------------------------------------------------------\n\nexport const createUser = (\n  name: string,\n  secret: string\n): AsyncAction => async dispatch => {\n  try {\n    console.debug(\"Creating user...\");\n    const id = v4();\n    await FirebaseUser(id, secret).update({ name });\n    dispatch(connectUser(id, secret));\n  } catch (err) {\n    dispatch(displayError(\"Cannot create user\", err));\n  }\n};\n\n// ------------------------------------------------------------------\n\nlet FIREBASE_CB: any = null;\n\nexport const connectUser = (id: string, secret: string): AsyncAction => async (\n  dispatch,\n  getState\n) => {\n  const {\n    users: { user }\n  } = getState();\n  if (!user || user.id !== id) {\n    dispatch(disconnectUser());\n    try {\n      console.debug(\"Connection user...\", { id, secret });\n      const newUser = FirebaseUser(id);\n      dispatch(setUser(newUser, await newUser.wait()));\n      dispatch(setUserAccess(id, secret));\n      FIREBASE_CB = (snapshot: firebase.database.DataSnapshot) => {\n        const newInfo = snapshot.val() as UserInfo;\n        dispatch(setUser(newUser, newInfo));\n      };\n      newUser.subscribeInfo(FIREBASE_CB);\n    } catch (err) {\n      dispatch(displayError(\"Cannot connect user\", err));\n      dispatch(setUserAccess(\"\", \"\"));\n    }\n  }\n};\n\nexport const disconnectUser = (): AsyncAction => async (dispatch, getState) => {\n  const {\n    users: { user }\n  } = getState();\n  if (user) {\n    console.debug(\"Disconnecting user...\");\n    user.unsubscribeInfo(FIREBASE_CB);\n    FIREBASE_CB = null;\n    setUser(null, null);\n    dispatch(setUserAccess(\"\", \"\"));\n  }\n};\n\nexport const reconnectUser = (): AsyncAction => async (dispatch, getState) => {\n  const {\n    users: {\n      user_access: { id, secret }\n    }\n  } = getState();\n  if (id && secret) {\n    console.debug(\"Reconnecting user...\", { id, secret });\n    dispatch(connectUser(id, secret));\n  }\n};\n","import { connect } from \"react-redux\";\nimport { ThunkDispatch } from \"redux-thunk\";\n//\nimport { RootState } from \"../../reducers\";\nimport Splash from \"../../components/Splash\";\nimport { extractUser } from \"../../selectors/users\";\nimport { openModal } from \"../../actions/modals\";\nimport { disconnectUser } from \"../../actions/users\";\n\n// ------------------------------------------------------------------\n\nconst stateToProps = (state: RootState) => ({\n  loggedIn: !!state.users.user_access.id,\n  user: extractUser(state)\n});\n\nconst dispatchToProps = (dispatch: ThunkDispatch<RootState, any, any>) => ({\n  onCreateRoom: () => dispatch(openModal({ type: \"CreateRoom\", props: null })),\n  onConnectUser: () => dispatch(openModal({ type: \"CreateUser\", props: null })),\n  onDisconnectUser: () => dispatch(disconnectUser())\n});\n\nexport type MappedProps = ReturnType<typeof stateToProps> &\n  ReturnType<typeof dispatchToProps>;\n\nexport default connect(stateToProps, dispatchToProps)(Splash);\n","import React, { Component, FormEvent, ReactNode } from \"react\";\nimport classNames from \"classnames\";\nimport { withTranslation, WithTranslation } from \"react-i18next\";\n//\nimport { MappedProps } from \"../../containers/Modals/Modal\";\nimport IconButton from \"../Common/IconButton\";\n\n// ------------------------------------------------------------------\n\ntype Props = {\n  children: ReactNode;\n  className?: string;\n  title: string;\n  renderFoot?: () => React.ReactNode;\n  onSubmit?: () => void;\n};\n\nclass Modal extends Component<Props & MappedProps & WithTranslation> {\n  public render = () => {\n    const {\n      children,\n      className,\n      title,\n      renderFoot,\n      onClose,\n      onPop,\n      has_prev_modal,\n    } = this.props;\n    return (\n      <form className={classNames(\"Modal\", className)} onSubmit={this.onSubmit}>\n        <div className=\"ModalHead\">\n          <IconButton\n            kind=\"special\"\n            className={classNames(\"ModalHeadBack\", {\n              hidden: !has_prev_modal,\n            })}\n            icon=\"angle-left\"\n            title=\"Back\"\n            onClick={onPop}\n          />\n          <div className=\"ModalTitle\">{title}</div>\n          <IconButton\n            kind=\"special\"\n            className=\"ModalHeadClose\"\n            onClick={onClose}\n            title=\"Cancel\"\n            icon=\"times\"\n          />\n        </div>\n        <div className=\"ModalBody\">{children}</div>\n        <div className=\"ModalFoot\">{renderFoot && renderFoot()}</div>\n      </form>\n    );\n  };\n\n  private onSubmit = (event: FormEvent<HTMLFormElement>) => {\n    event.preventDefault();\n    if (this.props.onSubmit) {\n      this.props.onSubmit();\n    }\n  };\n}\n\nexport default withTranslation()(Modal);\n","import { connect } from \"react-redux\";\n//\nimport Modal from \"../../components/Modals/Modal\";\nimport { RootState } from \"../../reducers\";\nimport { popModal } from \"../../actions/modals\";\n\n// ------------------------------------------------------------------\n\nconst mapStateToProps = (state: RootState) => ({\n  has_prev_modal: state.modals.stack.length > 1\n});\n\nconst mapDispatchToProps = (dispatch: any) => ({\n  onClose: () => dispatch(popModal()),\n  onPop: () => dispatch(popModal())\n});\n\nexport type MappedProps = ReturnType<typeof mapStateToProps> &\n  ReturnType<typeof mapDispatchToProps>;\n\nexport default connect(mapStateToProps, mapDispatchToProps)(Modal);\n","import React, { Component } from \"react\";\nimport classNames from \"classnames\";\n//\nimport Modal from \"../../containers/Modals/Modal\";\nimport \"./FormModal.scss\";\n\n// ------------------------------------------------------------------\n\ntype Props = {\n  className?: string;\n  onSubmit: () => void;\n  renderButtons: () => React.ReactNode;\n  title: string;\n};\n\nclass FormModal extends Component<Props> {\n  public render = () => {\n    const { children, className, renderButtons, title, onSubmit } = this.props;\n    return (\n      <Modal\n        className={classNames(\"FormModal\", className)}\n        title={title}\n        renderFoot={renderButtons}\n        onSubmit={onSubmit}\n      >\n        {children}\n      </Modal>\n    );\n  };\n}\n\nexport default FormModal;\n","import React, { Component, Fragment, RefObject, createRef } from \"react\";\nimport { withTranslation, WithTranslation } from \"react-i18next\";\n//\nimport FormModal from \"../Modals/FormModal\";\nimport { MappedProps } from \"../../containers/Users/ConnectUserModal\";\nimport IconButton, { CancelButton } from \"../Common/IconButton\";\n\n// ------------------------------------------------------------------\n\ntype State = {\n  id: string;\n  secret: string;\n};\n\nclass ConnectUserModal extends Component<MappedProps & WithTranslation, State> {\n  private idRef: RefObject<HTMLInputElement> = createRef();\n\n  public readonly state: State = {\n    id: \"\",\n    secret: \"\",\n  };\n\n  public componentDidMount() {\n    if (this.idRef.current) {\n      this.idRef.current.focus();\n    }\n  }\n\n  public render = () => {\n    const { t } = this.props;\n    const { id, secret } = this.state;\n    return (\n      <FormModal\n        title={t(\"users.connection\")}\n        onSubmit={this.onConnect}\n        renderButtons={this.renderButtons}\n      >\n        <div className=\"ModalField\">\n          <label htmlFor=\"modal-id\">{t(\"users.user_id\")}</label>\n          <input\n            id=\"modal-id\"\n            type=\"text\"\n            placeholder={t(\"users.user_id_placeholder\")}\n            maxLength={36}\n            minLength={36}\n            required={true}\n            value={id}\n            ref={this.idRef}\n            onChange={(e) => {\n              this.setState({ id: e.target.value });\n            }}\n          />\n        </div>\n        <div className=\"ModalField\">\n          <label htmlFor=\"modal-secret\">{t(\"users.user_secret\")}</label>\n          <input\n            id=\"modal-secret\"\n            type=\"password\"\n            placeholder={t(\"users.user_secret_placeholder\")}\n            maxLength={36}\n            minLength={36}\n            required={true}\n            value={secret}\n            onChange={(e) => {\n              this.setState({ secret: e.target.value });\n            }}\n          />\n        </div>\n      </FormModal>\n    );\n  };\n\n  private renderButtons = () => {\n    const { t } = this.props;\n    return (\n      <Fragment>\n        <IconButton\n          title={t(\"users.connect\")}\n          kind=\"primary\"\n          icon=\"sign-in\"\n          type=\"submit\"\n        />\n        <CancelButton onClick={this.props.onClose} />\n        <IconButton\n          title={t(\"users.create_user\")}\n          kind=\"default\"\n          icon=\"plus\"\n          onClick={this.props.onToggle}\n        />\n      </Fragment>\n    );\n  };\n\n  private onConnect = () => {\n    const { onClose, onConnect, onError, t } = this.props;\n    const { id, secret } = this.state;\n    if (id.trim().length === 0) {\n      onError(t(\"users.user_id_is_invalid\"));\n      return;\n    }\n    if (secret.trim().length === 0) {\n      onError(t(\"users.user_secret_is_invalid\"));\n      return;\n    }\n    onConnect(id, secret);\n    onClose();\n  };\n}\n\nexport default withTranslation()(ConnectUserModal);\n","import { connect } from \"react-redux\";\nimport { ThunkDispatch } from \"redux-thunk\";\n//\nimport { RootState } from \"../../reducers\";\nimport ConnectUserModal from \"../../components/Users/ConnectUserModal\";\nimport { connectUser } from \"../../actions/users\";\nimport { popModal, openModal } from \"../../actions/modals\";\nimport { displayError } from \"../../actions/messages\";\n\n// ------------------------------------------------------------------\n\nconst stateToProps = (state: RootState) => {\n  return {};\n};\n\nconst dispatchToProps = (dispatch: ThunkDispatch<RootState, any, any>) => ({\n  onClose: () => dispatch(popModal()),\n  onConnect: (id: string, secret: string) => dispatch(connectUser(id, secret)),\n  onError: (message: string) => dispatch(displayError(message)),\n  onToggle: () => dispatch(openModal({ type: \"CreateUser\", props: null }))\n});\n\nexport type MappedProps = ReturnType<typeof stateToProps> &\n  ReturnType<typeof dispatchToProps>;\n\nexport default connect(stateToProps, dispatchToProps)(ConnectUserModal);\n","import React, { Component } from \"react\";\nimport { withTranslation, WithTranslation } from \"react-i18next\";\n//\nimport { copyToClipboard } from \"../../utils/clipboard\";\nimport IconButton from \"../Common/IconButton\";\nimport { MappedProps } from \"../../containers/Modals/SecretField\";\n\n// ------------------------------------------------------------------\n\ntype Props = {\n  id: string;\n  label: string;\n  onChange: (value: string) => void;\n  placeholder: string;\n  value: string;\n};\n\nclass SecretField extends Component<Props & MappedProps & WithTranslation> {\n  public render = () => {\n    const { id, label, onChange, placeholder, value } = this.props;\n    return (\n      <div className=\"ModalField\">\n        <label htmlFor={id}>{label}</label>\n        <div\n          style={{\n            display: \"flex\",\n            flexDirection: \"row\",\n            justifyContent: \"space-between\",\n          }}\n        >\n          <input\n            style={{\n              flexGrow: 1,\n              marginRight: \"0.5rem\",\n            }}\n            id={id}\n            type=\"password\"\n            placeholder={placeholder}\n            maxLength={36}\n            minLength={36}\n            required={true}\n            value={value}\n            onChange={(e) => onChange(e.target.value)}\n          />\n          <IconButton\n            icon=\"clipboard\"\n            onClick={this.onCopyToClipboard}\n            size=\"M\"\n            title={`Copy to Clipboard`}\n          />\n        </div>\n      </div>\n    );\n  };\n\n  private onCopyToClipboard = async () => {\n    const { onMessage, value, t } = this.props;\n    await copyToClipboard(value);\n    onMessage(t(\"secret_copied_to_clipboard\"));\n  };\n}\n\nexport default withTranslation()(SecretField);\n","import { connect } from \"react-redux\";\n//\nimport SecretField from \"../../components/Modals/SecretField\";\nimport { RootState } from \"../../reducers\";\nimport { displayMessage } from \"../../actions/messages\";\n\n// ------------------------------------------------------------------\n\nconst mapStateToProps = (state: RootState) => ({});\n\nconst mapDispatchToProps = (dispatch: any) => ({\n  onMessage: (message: string) => dispatch(displayMessage(\"info\", message))\n});\n\nexport type MappedProps = ReturnType<typeof mapStateToProps> &\n  ReturnType<typeof mapDispatchToProps>;\n\nexport default connect(mapStateToProps, mapDispatchToProps)(SecretField);\n","import React, { Component, Fragment, RefObject, createRef } from \"react\";\nimport { withTranslation, WithTranslation } from \"react-i18next\";\nimport { v4 } from \"uuid\";\n//\nimport FormModal from \"../Modals/FormModal\";\nimport { MappedProps } from \"../../containers/Room/CreateRoomModal\";\nimport IconButton, { CancelButton } from \"../Common/IconButton\";\nimport SecretField from \"../../containers/Modals/SecretField\";\n\n// ------------------------------------------------------------------\n\nlet ROOM_COUNTER = 1;\n\n// ------------------------------------------------------------------\n\ntype State = {\n  name: string;\n  secret: string;\n};\n\nclass CreateRoomModal extends Component<MappedProps & WithTranslation, State> {\n  private nameRef: RefObject<HTMLInputElement> = createRef();\n\n  public readonly state: State = {\n    name: \"\",\n    secret: v4(),\n  };\n\n  public componentDidMount() {\n    this.setState({\n      name: `${this.props.t(\"rooms.room\")} ${ROOM_COUNTER}`,\n    });\n    if (this.nameRef.current) {\n      this.nameRef.current.focus();\n    }\n  }\n\n  public render = () => {\n    const { t } = this.props;\n    const { name, secret } = this.state;\n    return (\n      <FormModal\n        title={t(\"rooms.room_creation\")}\n        onSubmit={this.onCreate}\n        renderButtons={this.renderButtons}\n      >\n        <div className=\"ModalField\">\n          <label htmlFor=\"modal-name\">{t(\"rooms.room_name\")}</label>\n          <input\n            id=\"modal-name\"\n            type=\"text\"\n            placeholder={t(\"rooms.room_name_placeholder\")}\n            maxLength={100}\n            minLength={2}\n            required={true}\n            value={name}\n            ref={this.nameRef}\n            onChange={(e) => this.setState({ name: e.target.value })}\n          />\n        </div>\n        <SecretField\n          id=\"modal-secret\"\n          label={t(\"rooms.room_key\")}\n          placeholder={t(\"rooms.room_key_placeholder\")}\n          value={secret}\n          onChange={(newSecret) => this.setState({ secret: newSecret })}\n        />\n      </FormModal>\n    );\n  };\n\n  private renderButtons = () => {\n    const { t } = this.props;\n    return (\n      <Fragment>\n        <IconButton\n          title={t(\"rooms.create_room\")}\n          kind=\"primary\"\n          icon=\"plus\"\n          type=\"submit\"\n        />\n        <CancelButton onClick={this.props.onClose} />\n      </Fragment>\n    );\n  };\n\n  private onCreate = () => {\n    const { onClose, onCreate, onError, t } = this.props;\n    const { name, secret } = this.state;\n    if (name.trim().length === 0) {\n      onError(t(\"rooms.room_name_is_invalid\"));\n      return;\n    }\n    if (secret.trim().length === 0) {\n      onError(t(\"rooms.room_secret_is_invalid\"));\n      return;\n    }\n    onCreate(name, secret);\n    onClose();\n    ROOM_COUNTER++;\n  };\n}\n\nexport default withTranslation()(CreateRoomModal);\n","import { connect } from \"react-redux\";\nimport { ThunkDispatch } from \"redux-thunk\";\n//\nimport { RootState } from \"../../reducers\";\nimport CreateRoomModal from \"../../components/Room/CreateRoomModal\";\nimport { createRoom } from \"../../actions/rooms\";\nimport { popModal } from \"../../actions/modals\";\nimport { displayError } from \"../../actions/messages\";\n\n// ------------------------------------------------------------------\n\nconst stateToProps = (state: RootState) => {\n  return {};\n};\n\nconst dispatchToProps = (dispatch: ThunkDispatch<RootState, any, any>) => ({\n  onClose: () => dispatch(popModal()),\n  onCreate: (name: string, secret: string) =>\n    dispatch(createRoom(name, secret)),\n  onError: (message: string) => dispatch(displayError(message))\n});\n\nexport type MappedProps = ReturnType<typeof stateToProps> &\n  ReturnType<typeof dispatchToProps>;\n\nexport default connect(stateToProps, dispatchToProps)(CreateRoomModal);\n","import React, { Component, Fragment, RefObject, createRef } from \"react\";\nimport { withTranslation, WithTranslation } from \"react-i18next\";\nimport { v4 } from \"uuid\";\n//\nimport FormModal from \"../Modals/FormModal\";\nimport { MappedProps } from \"../../containers/Users/CreateUserModal\";\nimport IconButton, { CancelButton } from \"../Common/IconButton\";\nimport SecretField from \"../../containers/Modals/SecretField\";\n\n// ------------------------------------------------------------------\n\nlet USER_COUNTER = 1;\n\n// ------------------------------------------------------------------\n\ntype State = {\n  name: string;\n  secret: string;\n};\n\nclass CreateUserModal extends Component<MappedProps & WithTranslation, State> {\n  private nameRef: RefObject<HTMLInputElement> = createRef();\n\n  public readonly state: State = {\n    name: \"\",\n    secret: v4(),\n  };\n\n  public componentDidMount() {\n    this.setState({\n      name: `${this.props.t(\"users.user\")} ${USER_COUNTER}`,\n    });\n    if (this.nameRef.current) {\n      this.nameRef.current.focus();\n    }\n  }\n\n  public render = () => {\n    const { t } = this.props;\n    const { name, secret } = this.state;\n    return (\n      <FormModal\n        title={t(\"users.user_creation\")}\n        onSubmit={this.onCreate}\n        renderButtons={this.renderButtons}\n      >\n        <div className=\"ModalField\">\n          <label htmlFor=\"modal-name\">{t(\"users.user_name\")}</label>\n          <input\n            id=\"modal-name\"\n            type=\"text\"\n            placeholder={t(\"users.user_name_placeholder\")}\n            maxLength={100}\n            minLength={2}\n            required={true}\n            value={name}\n            ref={this.nameRef}\n            onChange={(e) => this.setState({ name: e.target.value })}\n          />\n        </div>\n        <SecretField\n          id=\"modal-secret\"\n          label={t(\"users.user_secret\")}\n          placeholder={t(\"users.user_secret_placeholder\")}\n          value={secret}\n          onChange={(newSecret) => this.setState({ secret: newSecret })}\n        />\n      </FormModal>\n    );\n  };\n\n  private renderButtons = () => {\n    const { t } = this.props;\n    return (\n      <Fragment>\n        <IconButton\n          title={t(\"users.create_user\")}\n          kind=\"primary\"\n          icon=\"plus\"\n          type=\"submit\"\n        />\n        <CancelButton onClick={this.props.onClose} />\n        <IconButton\n          title={t(\"users.connect\")}\n          kind=\"default\"\n          icon=\"sign-in\"\n          onClick={this.props.onToggle}\n        />\n      </Fragment>\n    );\n  };\n\n  private onCreate = () => {\n    const { onClose, onCreate, onError, t } = this.props;\n    const { name, secret } = this.state;\n    if (name.trim().length === 0) {\n      onError(t(\"users.user_name_is_invalid\"));\n      return;\n    }\n    if (secret.trim().length === 0) {\n      onError(t(\"users.user_secret_is_invalid\"));\n      return;\n    }\n    onCreate(name, secret);\n    onClose();\n    USER_COUNTER++;\n  };\n}\n\nexport default withTranslation()(CreateUserModal);\n","import { connect } from \"react-redux\";\nimport { ThunkDispatch } from \"redux-thunk\";\n//\nimport { RootState } from \"../../reducers\";\nimport CreateUserModal from \"../../components/Users/CreateUserModal\";\nimport { createUser } from \"../../actions/users\";\nimport { popModal, openModal } from \"../../actions/modals\";\nimport { displayError } from \"../../actions/messages\";\n\n// ------------------------------------------------------------------\n\nconst stateToProps = (state: RootState) => {\n  return {};\n};\n\nconst dispatchToProps = (dispatch: ThunkDispatch<RootState, any, any>) => ({\n  onClose: () => dispatch(popModal()),\n  onCreate: (name: string, secret: string) =>\n    dispatch(createUser(name, secret)),\n  onError: (message: string) => dispatch(displayError(message)),\n  onToggle: () => dispatch(openModal({ type: \"ConnectUser\", props: null }))\n});\n\nexport type MappedProps = ReturnType<typeof stateToProps> &\n  ReturnType<typeof dispatchToProps>;\n\nexport default connect(stateToProps, dispatchToProps)(CreateUserModal);\n","// import Axios from \"axios\";\nimport jsonp from \"jsonp\";\n\n// ------------------------------------------------------------------\n\ntype SearchResult<T> = {\n  data: T[];\n  total: number;\n};\n\nexport type SearchAllResults = {\n  albums: SearchResult<ApiAlbum>;\n  playlists: SearchResult<ApiPlaylist>;\n  tracks: SearchResult<ApiTrack>;\n};\n\nexport type ApiAlbum = {\n  artist: {\n    id: number;\n    name: string;\n    link: string;\n    picture_big: string;\n    picture_small: string;\n  };\n  available: boolean;\n  cover_big: string;\n  cover_small: string;\n  id: number;\n  link: string;\n  nb_tracks: number;\n  title: string;\n  tracks?: { data: ApiTrack[] };\n  type: \"album\";\n};\n\nexport type ApiPlaylist = {\n  description: string;\n  id: number;\n  link: string;\n  nb_tracks: number;\n  picture_big: string;\n  picture_small: string;\n  public: true;\n  title: string;\n  tracks?: { data: ApiTrack[] };\n  type: \"playlist\";\n};\n\nexport type ApiTrack = {\n  album: {\n    id: number;\n    title: string;\n    cover_big: string;\n    cover_small: string;\n  };\n  artist: {\n    id: number;\n    name: string;\n    link: string;\n    picture_big: string;\n    picture_small: string;\n  };\n  duration: number;\n  id: number;\n  link: string;\n  preview: string;\n  readable: boolean;\n  title: string;\n  type: \"track\";\n};\n\n// ------------------------------------------------------------------\n\nexport const DeezerApi = () => {\n  const API_BASE = \"https://api.deezer.com\";\n\n  const asyncJsonp = <T>(url: string): Promise<T> =>\n    new Promise((resolve, reject) => {\n      jsonp(url, void 0, (err, data) => {\n        if (err) {\n          reject(new Error(err.message));\n        } else {\n          resolve(data);\n        }\n      });\n    });\n\n  const call = async <T>(path: string, qs?: string) => {\n    // We have to rely on jsonp because the Deezer api is CORS restricted\n    const fullpath = qs\n      ? `${API_BASE}/${path}?${qs}&output=jsonp&callback=`\n      : `${API_BASE}/${path}?output=jsonp&callback=`;\n    return await asyncJsonp<T>(fullpath);\n  };\n\n  const search = <T>(type: string, query: string) =>\n    call<SearchResult<T>>(`search/${type}`, `q=${encodeURIComponent(query)}`);\n\n  const load = <T>(type: string, id: string) => call<T>(`/${type}/${id}`);\n\n  const searchAlbums = (query: string) => search<ApiAlbum>(\"album\", query);\n\n  const searchPlaylists = (query: string) =>\n    search<ApiPlaylist>(\"playlist\", query);\n\n  const searchTracks = (query: string) => search<ApiTrack>(\"track\", query);\n\n  const searchAll = async (query: string): Promise<SearchAllResults> => {\n    const [albums, playlists, tracks] = await Promise.all([\n      searchAlbums(query),\n      searchPlaylists(query),\n      searchTracks(query)\n    ]);\n    return { albums, playlists, tracks };\n  };\n\n  const loadAlbum = async (id: string) => {\n    const album = await load<ApiAlbum>(\"album\", id);\n    album.tracks!.data.forEach(track => {\n      track.album = album;\n      track.artist.link = `https://www.deezer.com/artist/${track.artist.id}`;\n    });\n    return album;\n  };\n\n  const loadPlaylist = (id: string) => load<ApiPlaylist>(\"playlist\", id);\n\n  const loadTrack = (id: string) => load<ApiTrack>(\"track\", id);\n\n  return {\n    searchAll,\n    loadAlbum,\n    loadPlaylist,\n    loadTrack\n  };\n};\n\n// ------------------------------------------------------------------\n\nexport const DEFAULT_API = DeezerApi();\n","import React, { Fragment, ReactNode } from \"react\";\n//\nimport { MediaType } from \"../../utils/containers\";\n\n// ------------------------------------------------------------------\n\nconst MAX_RESULTS_COUNT = 5;\n\n// ------------------------------------------------------------------\n\nconst SearchResultCategory = <T extends { id: number }>({\n  items,\n  label,\n  cb\n}: {\n  items: T[];\n  label: string;\n  type: MediaType;\n  cb: (item: T) => ReactNode;\n}) =>\n  items.length > 0 ? (\n    <Fragment>\n      <div className=\"ModalField\">\n        <label>{label}</label>\n      </div>\n      {items.slice(0, MAX_RESULTS_COUNT).map(item => (\n        <div key={item.id} className=\"ModalField\">\n          <div className=\"SearchResultItem\">{cb(item)}</div>\n        </div>\n      ))}\n    </Fragment>\n  ) : null;\n\nexport default SearchResultCategory;\n","import React, { Component, Fragment, createRef, RefObject } from \"react\";\nimport { withTranslation, WithTranslation } from \"react-i18next\";\n//\nimport FormModal from \"../Modals/FormModal\";\nimport { MappedProps } from \"../../containers/Room/SearchModal\";\nimport IconButton, { CancelButton } from \"../Common/IconButton\";\nimport { DEFAULT_API, SearchAllResults } from \"../../utils/deezer\";\nimport { Album, Playlist, Track } from \"./Medias\";\nimport { MediaType } from \"../../utils/containers\";\nimport SearchResultCategory from \"./SearchResultCategory\";\nimport \"./SearchModal.scss\";\n\n// ------------------------------------------------------------------\n\ntype State = {\n  mediaId: number;\n  mediaType: MediaType;\n  query: string;\n  results: SearchAllResults;\n};\n\nclass SearchModal extends Component<MappedProps & WithTranslation, State> {\n  private queryRef: RefObject<HTMLInputElement> = createRef();\n\n  public readonly state: State = {\n    mediaId: 0,\n    mediaType: \"track\",\n    query: \"\",\n    results: {\n      albums: { data: [], total: 0 },\n      playlists: { data: [], total: 0 },\n      tracks: { data: [], total: 0 },\n    },\n  };\n\n  public componentDidMount() {\n    if (this.queryRef.current) {\n      this.queryRef.current.focus();\n    }\n  }\n\n  public componentWillUnmount() {\n    this.props.onStopPreview();\n  }\n\n  public render = () => {\n    const { t } = this.props;\n    return (\n      <FormModal\n        className=\"SearchModal\"\n        title={t(\"medias.medias_search\")}\n        onSubmit={this.onSearch}\n        renderButtons={this.renderButtons}\n      >\n        {this.renderInputs()}\n        {this.renderResults()}\n      </FormModal>\n    );\n  };\n\n  private renderButtons = () => {\n    const { t } = this.props;\n    return (\n      <Fragment>\n        <IconButton\n          title={t(\"medias.search\")}\n          kind=\"primary\"\n          icon=\"search\"\n          type=\"submit\"\n        />\n        <CancelButton onClick={this.props.onClose} />\n      </Fragment>\n    );\n  };\n\n  private renderInputs = () => {\n    const { t } = this.props;\n    const { query } = this.state;\n    return (\n      <div className=\"ModalField\">\n        <input\n          id=\"modal-query\"\n          type=\"text\"\n          placeholder={t(\"medias.search_placeholder\")}\n          maxLength={100}\n          minLength={2}\n          required={true}\n          value={query}\n          ref={this.queryRef}\n          onChange={(e) => {\n            this.setState({ query: e.target.value });\n          }}\n        />\n      </div>\n    );\n  };\n\n  private renderResults = () => {\n    const { locked, t } = this.props;\n    const {\n      mediaId,\n      mediaType,\n      results: { albums, playlists, tracks },\n    } = this.state;\n    return (\n      <Fragment>\n        <SearchResultCategory\n          label=\"Albums\"\n          type=\"album\"\n          items={albums.data}\n          cb={(album) => (\n            <Album\n              actions={\n                !locked ? (\n                  <IconButton\n                    title={t(\"medias.add\")}\n                    icon=\"plus\"\n                    onClick={() => this.onSelect(\"album\", album.id)}\n                  />\n                ) : null\n              }\n              album={album}\n              playable={true}\n              playing={mediaType === \"album\" && mediaId === album.id}\n              onPlay={() => this.onStartPreview(\"album\", album.id)}\n              onStop={() => this.onStopPreview()}\n            />\n          )}\n        />\n        <SearchResultCategory\n          label=\"Playlists\"\n          type=\"playlist\"\n          items={playlists.data}\n          cb={(playlist) => (\n            <Playlist\n              actions={\n                !locked ? (\n                  <IconButton\n                    title=\"Add\"\n                    icon=\"plus\"\n                    onClick={() => this.onSelect(\"playlist\", playlist.id)}\n                  />\n                ) : null\n              }\n              playlist={playlist}\n              playable={true}\n              playing={mediaType === \"playlist\" && mediaId === playlist.id}\n              onPlay={() => this.onStartPreview(\"playlist\", playlist.id)}\n              onStop={() => this.onStopPreview()}\n            />\n          )}\n        />\n        <SearchResultCategory\n          label=\"Tracks\"\n          type=\"track\"\n          items={tracks.data}\n          cb={(track) => (\n            <Track\n              actions={\n                !locked ? (\n                  <IconButton\n                    title=\"Add\"\n                    icon=\"plus\"\n                    onClick={() => this.onSelect(\"track\", track.id)}\n                  />\n                ) : null\n              }\n              track={track}\n              playable={true}\n              playing={mediaType === \"track\" && mediaId === track.id}\n              onPlay={() => this.onStartPreview(\"track\", track.id)}\n              onStop={() => this.onStopPreview()}\n            />\n          )}\n        />\n      </Fragment>\n    );\n  };\n\n  private onSearch = async () => {\n    const { query } = this.state;\n    if (query.trim().length > 0) {\n      this.setState({ results: await DEFAULT_API.searchAll(query) });\n    }\n  };\n\n  private onSelect = (mediaType: MediaType, mediaId: number) =>\n    this.props.onSelect(mediaType, mediaId.toString());\n\n  private onStartPreview = (mediaType: MediaType, mediaId: number) => {\n    this.props.onStartPreview(mediaType, mediaId.toString());\n    this.setState({\n      mediaId,\n      mediaType,\n    });\n  };\n\n  private onStopPreview = () => {\n    this.props.onStopPreview();\n    this.setState({\n      mediaId: 0,\n      mediaType: \"track\",\n    });\n  };\n}\n\nexport default withTranslation()(SearchModal);\n","import { connect } from \"react-redux\";\nimport { ThunkDispatch } from \"redux-thunk\";\n//\nimport { RootState } from \"../../reducers\";\nimport SearchModal from \"../../components/Room/SearchModal\";\nimport { popModal } from \"../../actions/modals\";\nimport { previewContainer } from \"../../actions/containers\";\nimport { queueTracks } from \"../../actions/rooms\";\nimport { startPreview, stopPreview } from \"../../actions/player\";\nimport { MediaType } from \"../../utils/containers\";\nimport { isRoomLocked } from \"../../selectors/rooms\";\n\n// ------------------------------------------------------------------\n\nconst stateToProps = (state: RootState) => ({\n  locked: isRoomLocked(state)\n});\n\nconst dispatchToProps = (dispatch: ThunkDispatch<RootState, any, any>) => ({\n  onClose: () => dispatch(popModal()),\n  onSelect: (mediaType: MediaType, mediaId: string) =>\n    dispatch(\n      \"track\" === mediaType\n        ? queueTracks(\"album\", \"\", mediaId)\n        : queueTracks(mediaType, mediaId, \"\")\n    ),\n  onStartPreview: (mediaType: MediaType, mediaId: string) => {\n    dispatch(\n      \"track\" === mediaType\n        ? startPreview(mediaId)\n        : previewContainer(mediaType, mediaId)\n    );\n  },\n  onStopPreview: () => dispatch(stopPreview())\n});\n\nexport type MappedProps = ReturnType<typeof stateToProps> &\n  ReturnType<typeof dispatchToProps>;\n\nexport default connect(stateToProps, dispatchToProps)(SearchModal);\n","import React, { Component, Fragment, createRef, RefObject } from \"react\";\nimport { withTranslation, WithTranslation } from \"react-i18next\";\n//\nimport FormModal from \"../Modals/FormModal\";\nimport { MappedProps } from \"../../containers/Room/UnlockRoomModal\";\nimport IconButton, { CancelButton } from \"../Common/IconButton\";\n\n// ------------------------------------------------------------------\n\ntype State = {\n  secret: string;\n};\n\nclass UnlockRoomModal extends Component<MappedProps & WithTranslation, State> {\n  private secretRef: RefObject<HTMLInputElement> = createRef();\n\n  public readonly state: State = {\n    secret: \"\",\n  };\n\n  public componentDidMount() {\n    if (this.secretRef.current) {\n      this.secretRef.current.focus();\n    }\n  }\n\n  public render = () => {\n    const { t } = this.props;\n    const { secret } = this.state;\n    return (\n      <FormModal\n        title={t(\"rooms.room_unlock\")}\n        onSubmit={this.onUnlock}\n        renderButtons={this.renderButtons}\n      >\n        <div className=\"ModalField\">\n          <label htmlFor=\"modal-secret\">{t(\"rooms.room_key\")}</label>\n          <input\n            id=\"modal-secret\"\n            type=\"password\"\n            placeholder={t(\"rooms.room_key_placeholder\")}\n            maxLength={36}\n            minLength={36}\n            required={true}\n            value={secret}\n            ref={this.secretRef}\n            onChange={(e) => {\n              this.setState({ secret: e.target.value });\n            }}\n          />\n        </div>\n      </FormModal>\n    );\n  };\n\n  private renderButtons = () => {\n    const { t } = this.props;\n    return (\n      <Fragment>\n        <IconButton\n          title={t(\"rooms.unlock\")}\n          kind=\"primary\"\n          icon=\"key\"\n          type=\"submit\"\n        />\n        <CancelButton onClick={this.props.onClose} />\n      </Fragment>\n    );\n  };\n\n  private onUnlock = () => {\n    const { onClose, onUnlock } = this.props;\n    onUnlock(this.state.secret);\n    onClose();\n  };\n}\n\nexport default withTranslation()(UnlockRoomModal);\n","import { connect } from \"react-redux\";\nimport { ThunkDispatch } from \"redux-thunk\";\n//\nimport { RootState } from \"../../reducers\";\nimport UnlockRoomModal from \"../../components/Room/UnlockRoomModal\";\nimport { unlockRoom } from \"../../actions/rooms\";\nimport { popModal } from \"../../actions/modals\";\n\n// ------------------------------------------------------------------\n\nconst stateToProps = (state: RootState) => {\n  return {};\n};\n\nconst dispatchToProps = (dispatch: ThunkDispatch<RootState, any, any>) => ({\n  onClose: () => dispatch(popModal()),\n  onUnlock: (secret: string) => dispatch(unlockRoom(secret))\n});\n\nexport type MappedProps = ReturnType<typeof stateToProps> &\n  ReturnType<typeof dispatchToProps>;\n\nexport default connect(stateToProps, dispatchToProps)(UnlockRoomModal);\n","import React, { Component, MouseEvent } from \"react\";\nimport { CSSTransition } from \"react-transition-group\";\n//\nimport { MappedProps } from \"../../containers/Modals\";\nimport { ModalPrereq } from \"../../actions/modals\";\nimport ConnectUserModal from \"../../containers/Users/ConnectUserModal\";\nimport CreateRoomModal from \"../../containers/Room/CreateRoomModal\";\nimport CreateUserModal from \"../../containers/Users/CreateUserModal\";\nimport SearchModal from \"../../containers/Room/SearchModal\";\nimport UnlockRoomModal from \"../../containers/Room/UnlockRoomModal\";\nimport \"./index.scss\";\n\n// ------------------------------------------------------------------\n\nconst TransitionTimeout = 300;\n\n// ------------------------------------------------------------------\n\nexport const getModal = (prereq: ModalPrereq) => {\n  switch (prereq.type) {\n    case \"ConnectUser\":\n      return <ConnectUserModal />;\n    case \"CreateRoom\":\n      return <CreateRoomModal />;\n    case \"CreateUser\":\n      return <CreateUserModal />;\n    case \"Search\":\n      return <SearchModal />;\n    case \"UnlockRoom\":\n      return <UnlockRoomModal />;\n  }\n};\n\n// ------------------------------------------------------------------\n\ntype State = {\n  curr_prereq?: ModalPrereq;\n  prev_prereq?: ModalPrereq; // Keeping prev modal prereq for modal fadeout\n};\n\nclass Modals extends Component<MappedProps, State> {\n  public readonly state: State = {\n    curr_prereq: void 0,\n    prev_prereq: void 0\n  };\n\n  public componentDidMount = () => {\n    document.addEventListener(\"keydown\", this.onKeyDown);\n  };\n\n  public componentWillUnmount = () => {\n    document.removeEventListener(\"keydown\", this.onKeyDown);\n  };\n\n  public componentDidUpdate = (prevProps: MappedProps) => {\n    const oldPrereq = prevProps.prereq;\n    const newPrereq = this.props.prereq;\n    if (oldPrereq !== newPrereq) {\n      // Hide current modal before showing new one (if there is a new one)\n      this.setState(\n        {\n          curr_prereq: void 0,\n          prev_prereq: oldPrereq\n        },\n        () => {\n          if (newPrereq) {\n            setTimeout(() => {\n              this.setState({\n                curr_prereq: newPrereq\n              });\n            }, TransitionTimeout);\n          }\n        }\n      );\n    }\n  };\n\n  public render = () => {\n    const { curr_prereq, prev_prereq } = this.state;\n    const prereq = curr_prereq || prev_prereq;\n    let modal = null;\n    if (prereq) {\n      modal = getModal(prereq);\n    }\n    return (\n      <CSSTransition\n        in={!!curr_prereq}\n        timeout={TransitionTimeout}\n        unmountOnExit={true}\n      >\n        <div className=\"ModalOverlay\" onClick={this.onClickOverlay}>\n          {modal && (\n            <div\n              className=\"ModalWrapper\"\n              role=\"dialog\"\n              onClick={this.onClickWrapper}\n            >\n              {modal}\n            </div>\n          )}\n        </div>\n      </CSSTransition>\n    );\n  };\n\n  private onClickOverlay = (event: MouseEvent) => {\n    // Clicking overlay will close current modal\n    event.stopPropagation();\n    this.props.onCloseModal();\n  };\n\n  private onClickWrapper = (event: MouseEvent) => {\n    // Clicking wrapper modal will not progagate to overlay which would close current modal\n    event.stopPropagation();\n  };\n\n  private onKeyDown = (e: KeyboardEvent) => {\n    if (e.keyCode === 27) {\n      this.props.onCloseModal();\n    }\n  };\n}\n\nexport default Modals;\n","import { connect } from \"react-redux\";\n//\nimport Modals from \"../../components/Modals\";\nimport { RootState } from \"../../reducers\";\nimport { popModal } from \"../../actions/modals\";\n\n// ------------------------------------------------------------------\n\nconst mapStateToProps = (state: RootState) => ({\n  prereq:\n    state.modals.stack.length > 0\n      ? state.modals.stack[state.modals.stack.length - 1]\n      : void 0\n});\n\nconst mapDispatchToProps = (dispatch: any) => ({\n  onCloseModal: () => dispatch(popModal())\n});\n\nexport type MappedProps = ReturnType<typeof mapStateToProps> &\n  ReturnType<typeof mapDispatchToProps>;\n\nexport default connect(mapStateToProps, mapDispatchToProps)(Modals);\n","import React from \"react\";\nimport classNames from \"classnames\";\nimport { TransitionGroup, CSSTransition } from \"react-transition-group\";\n//\nimport { MappedProps } from \"../../containers/App/Messages\";\nimport { Message } from \"../../utils/messages\";\nimport \"./Messages.scss\";\n\n// ------------------------------------------------------------------\n\nclass Messages extends React.Component<MappedProps> {\n  public render = () => (\n    <div className=\"Messages\">\n      <TransitionGroup>\n        {this.props.messages.map((message) => this.renderMessage(message))}\n      </TransitionGroup>\n    </div>\n  );\n\n  public renderMessage(message: Message) {\n    return (\n      <CSSTransition\n        key={message.id}\n        classNames=\"Message\"\n        timeout={{ enter: 200, exit: 200 }}\n      >\n        <div className={classNames(\"Message\", \"Message-\" + message.type)}>\n          {message.text}\n        </div>\n      </CSSTransition>\n    );\n  }\n}\n\nexport default Messages;\n","import { RootState } from \"../reducers\";\n\n// ------------------------------------------------------------------\n\nexport const extractMessages = (state: RootState) =>\n  state.messages.sort((m1, m2) => m1.stamp - m2.stamp);\n","import { connect } from \"react-redux\";\n//\nimport { RootState } from \"../../reducers\";\nimport Messages from \"../../components/App/Messages\";\nimport { extractMessages } from \"../../selectors/messages\";\n\n// ------------------------------------------------------------------\n\nexport type MappedProps = ReturnType<typeof mapStateToProps>;\n\nconst mapStateToProps = (state: RootState) => ({\n  messages: extractMessages(state),\n});\n\nexport default connect(mapStateToProps)(Messages);\n","import React, { Component } from \"react\";\nimport { Redirect, Route, Switch } from \"react-router-dom\";\n//\nimport { MappedProps } from \"../../containers/App\";\nimport Room from \"../../containers/Room\";\nimport Splash from \"../../containers/Splash\";\nimport Modals from \"../../containers/Modals\";\nimport Messages from \"../../containers/App/Messages\";\nimport \"./index.scss\";\n\n// ------------------------------------------------------------------\n\nclass App extends Component<MappedProps> {\n  public componentDidMount = async () => {\n    this.props.onReconnect();\n  };\n\n  public render = () => {\n    return (\n      <div className=\"App\">\n        <Modals />\n        <Switch>\n          <Route exact={true} path=\"/room/:room_id\" component={Room} />\n          <Route exact={true} path=\"/\" component={Splash} />\n          <Redirect to=\"/\" />\n        </Switch>\n        <Messages />\n      </div>\n    );\n  };\n}\n\nexport default App;\n","import { connect } from \"react-redux\";\nimport { ThunkDispatch } from \"redux-thunk\";\n//\nimport { RootState } from \"../../reducers\";\nimport App from \"../../components/App\";\nimport { reconnectUser } from \"../../actions/users\";\n\n// ------------------------------------------------------------------\n\nconst stateToProps = (state: RootState) => ({});\n\nconst dispatchToProps = (dispatch: ThunkDispatch<RootState, any, any>) => ({\n  onReconnect: () => dispatch(reconnectUser())\n});\n\nexport type MappedProps = ReturnType<typeof stateToProps> &\n  ReturnType<typeof dispatchToProps>;\n\nexport default connect(stateToProps, dispatchToProps)(App);\n","// ------------------------------------------------------------------\n\nlet AUDIO_CONTEXT: AudioContext | null = null;\n\nconst getContext = () => {\n  if (!AUDIO_CONTEXT) {\n    AUDIO_CONTEXT = new (window.AudioContext ||\n      (window as any).webkitAudioContext)();\n  }\n  return AUDIO_CONTEXT;\n};\n\nconst decodeAudioData = (encodedBuffer: ArrayBuffer): Promise<AudioBuffer> =>\n  new Promise((resolve, reject) =>\n    getContext().decodeAudioData(encodedBuffer, resolve, reject)\n  );\n\nconst loadAudioBuffer = (url: string): Promise<AudioBuffer> =>\n  new Promise((resolve, reject) => {\n    const req = new XMLHttpRequest();\n    req.open(\"GET\", url, true);\n    req.responseType = \"arraybuffer\";\n    req.addEventListener(\n      \"error\",\n      () => reject(new Error(\"Audio buffer loading failed\")),\n      false\n    );\n    req.addEventListener(\n      \"load\",\n      async () => {\n        try {\n          resolve(await decodeAudioData(req.response as ArrayBuffer));\n        } catch (error) {\n          console.debug(\"An error occurred while decoding audio data\");\n          reject(error);\n        }\n      },\n      false\n    );\n    req.send();\n  });\n\n// ------------------------------------------------------------------\n\n// Fix Safari and iOS Audio Context\n(() => {\n  const fixAudioContext = () => {\n    document.removeEventListener(\"click\", fixAudioContext);\n    document.removeEventListener(\"touchstart\", fixAudioContext);\n    console.debug(\"Fixing audio context...\");\n    const context = getContext();\n    // Create empty buffer, connect to output, play sound\n    var buffer = context.createBuffer(1, 1, 22050);\n    var source = context.createBufferSource();\n    source.buffer = buffer;\n    source.connect(context.destination);\n    source.start(0);\n  };\n  document.addEventListener(\"click\", fixAudioContext);\n  document.addEventListener(\"touchstart\", fixAudioContext);\n})();\n\n// ------------------------------------------------------------------\n\nexport type PlayerCallbacks = {\n  onStart: () => void;\n  onStop: () => void;\n};\n\nexport const Player = (chainPlay: boolean) => {\n  let analyserNode: AnalyserNode | null = null;\n  let gainNode: GainNode | null = null;\n  let _node: AudioNode | null = null;\n  let _buffer: AudioBuffer | null = null;\n  let _bufferUrl: string = \"\";\n  let _sourceNode: AudioBufferSourceNode | null = null;\n  let _sourceNodeStartTime = 0;\n  let _position = -1;\n\n  const getOrCreateNode = () => {\n    if (!_node) {\n      const context = getContext();\n      _node = context.destination;\n\n      gainNode = context.createGain();\n      gainNode.gain.value = 1.0;\n      gainNode.connect(_node);\n      _node = gainNode;\n\n      analyserNode = context.createAnalyser();\n      analyserNode.fftSize = 128;\n      // analyserNode.minDecibels = -90;\n      // analyserNode.maxDecibels = -10;\n      analyserNode.connect(_node);\n      _node = analyserNode;\n    }\n    return _node;\n  };\n\n  const isPlaying = () => !!_sourceNode;\n\n  const getPlayingPosition = () => _position;\n\n  // Percentage [0, 1]\n  const getTrackPercent = () => {\n    if (_buffer && _sourceNode) {\n      return (\n        (getContext().currentTime - _sourceNodeStartTime) / _buffer?.duration\n      );\n    }\n    return 0;\n  };\n\n  const _loadBuffer = async (url: string) => {\n    // TODO: cache N last audio buffers\n    if (_bufferUrl !== url) {\n      console.debug(\"Loading audio...\", { url });\n      _buffer = await loadAudioBuffer(url);\n      _bufferUrl = url;\n    }\n  };\n\n  const play = async (position: number, url: string, offset: number) => {\n    await stop();\n    await _loadBuffer(url); // TODO: warning if loadBuffer takes long for some reason and user clicks stop before end, next part of this function will continue after stop have been requested\n    console.debug(\"Starting audio...\", { position, url });\n    _position = position;\n    _sourceNode = getContext().createBufferSource();\n    _sourceNode.buffer = _buffer;\n    _sourceNode.loop = false;\n    _sourceNode.loopStart = 0;\n    _sourceNode.loopEnd = 0;\n    _sourceNode.onended = () => {\n      console.debug(\"Audio terminated...\");\n      if (chainPlay) {\n        _position++;\n      }\n    };\n    _sourceNode.playbackRate.value = 1.0;\n    _sourceNode.connect(getOrCreateNode());\n    _sourceNode.start(0, offset); // A new BufferSource must be created for each start\n    _sourceNodeStartTime = getContext().currentTime;\n  };\n\n  const stop = async (): Promise<void> =>\n    new Promise(resolve => {\n      if (null !== _sourceNode) {\n        console.debug(\"Stopping audio...\");\n        _sourceNode.onended = () => {\n          console.debug(\"Forced audio termination...\");\n          resolve();\n        };\n        _sourceNode.stop();\n        _sourceNode = null;\n        _sourceNodeStartTime = 0;\n        _position = -1;\n      } else {\n        resolve();\n      }\n    });\n\n  return {\n    analyserNode,\n    gainNode,\n    getPlayingPosition,\n    getTrackPercent,\n    isPlaying,\n    play,\n    stop\n  };\n};\n","export default {\n  splash: {\n    CGU: \"CGU\",\n    powered_with: \"Powered with\",\n  },\n  users: {\n    user: \"User\",\n    confirm_disconnect: \"Are you sure you want to disconnect?\",\n    connect: \"Connect\",\n    connection: \"Connection\",\n    create_user: \"Create a user\",\n    disconnect: \"Disconnect\",\n    user_creation: \"User Registration\",\n    user_id_is_invalid: \"ID is invalid\",\n    user_id_placeholder: \"User ID...\",\n    user_id: \"User ID\",\n    user_name_is_invalid: \"Name is invalid\",\n    user_name_placeholder: \"User Name...\",\n    user_name: \"User Name\",\n    user_secret_is_invalid: \"Secret is invalid\",\n    user_secret_placeholder: \"User Secret...\",\n    user_secret: \"User Secret\",\n  },\n  rooms: {\n    room: \"Room\",\n    empty: \"It's empty here, you should add some tracks...\",\n    copy_link: \"Copy Room Link to Clipboard\",\n    link_copied_to_clipboard: \"Room link has been copied to clipboard\",\n    locked: \"Locked (click to unlock)\",\n    unlocked: \"Unlocked (click to lock)\",\n    clear: \"Clear all tracks\",\n    confirm_clear: \"Are you sure you want to remove all tracks?\",\n    confirm_exit: \"Are you sure you want to leave the room?\",\n    exit: \"Exit Room\",\n    unlock: \"Unlock\",\n    create_room: \"Create a room\",\n    room_creation: \"Room Creation\",\n    room_key: \"Room Key\",\n    room_key_placeholder: \"Room Key...\",\n    room_name: \"Room Name\",\n    room_name_placeholderl: \"Room Name...\",\n    room_name_is_invalid: \"Name is invalid\",\n    room_secret_is_invalid: \"Secret is invalid\",\n    room_unlock: \"Room Unlocking\",\n  },\n  medias: {\n    by: \"by {{artist}}\",\n    add: \"Add\",\n    remove: \"Remove\",\n    search: \"Search Media\",\n    search_placeholder: \"Search...\",\n    medias_search: \"Media Search\",\n  },\n  player: {\n    backward: \"Backward\",\n    forward: \"Forward\",\n    play: \"Play\",\n    playing: \"Playing\",\n    stop: \"Stop\",\n  },\n  secret_copied_to_clipboard: \"Secret has been copied to clipboard\",\n};\n","export default {\n  splash: {\n    CGU: \"CGU\",\n    powered_with: \"boosté avec\",\n  },\n  users: {\n    user: \"Utilisateur\",\n    confirm_disconnect: \"Êtes-vous sûr(e) de vouloir vous déconnecter ?\",\n    connect: \"Se connecter\",\n    connection: \"Connexion\",\n    create_user: \"Créer un utilisateur\",\n    disconnect: \"Se déconnecter\",\n    user_creation: \"Création d'un utilisateur\",\n    user_id_is_invalid: \"L'identifiant est invalide\",\n    user_id_placeholder: \"Identifiant...\",\n    user_id: \"Identifiant\",\n    user_name_is_invalid: \"Le nom est invalide\",\n    user_name_placeholder: \"Nom...\",\n    user_name: \"Nom\",\n    user_secret_is_invalid: \"Le secret est invalide\",\n    user_secret_placeholder: \"Secret...\",\n    user_secret: \"Secret\",\n  },\n  rooms: {\n    room: \"Pièce\",\n    empty: \"Cette pièce est vide, vous devriez ajouter quelques pistes...\",\n    copy_link: \"Copier le lien de la pièce dans le presse-papier\",\n    link_copied_to_clipboard:\n      \"Le lien de la pièce a été copié dans le presse-papier\",\n    locked: \"Verrouillée (cliquer pour déverrouiller)\",\n    unlocked: \"Déverrouillée (cliquer pour verrouiller)\",\n    clear: \"Supprimer toutes les pistes\",\n    confirm_clear: \"Êtes-vous sûr(e) de vouloir supprimer toutes les pistes ?\",\n    confirm_exit: \"Êtes-vous sûr(e) de vouloir quitter la pièce ?\",\n    exit: \"Quitter la pièce\",\n    unlock: \"Déverrouiller\",\n    create_room: \"Créer une pièce\",\n    room_creation: \"Création d'une pièce\",\n    room_key: \"Clef\",\n    room_key_placeholder: \"Clef...\",\n    room_name: \"Nom\",\n    room_name_placeholderl: \"Nom...\",\n    room_name_is_invalid: \"Le nom est invalide\",\n    room_secret_is_invalid: \"Le secret is invalide\",\n    room_unlock: \"Déverrouillage de la pièce\",\n  },\n  medias: {\n    by: \"par {{artist}}\",\n    add: \"Ajouter\",\n    remove: \"Supprimer\",\n    search: \"Chercher des médias\",\n    search_placeholder: \"Recherche...\",\n    medias_search: \"Recherche de médias\",\n  },\n  player: {\n    backward: \"Piste précédente\",\n    forward: \"Piste suivante\",\n    play: \"Lire\",\n    playing: \"En cours de lecture\",\n    stop: \"Arrêter\",\n  },\n  secret_copied_to_clipboard: \"Le secret a été copié dans le presse-papier\",\n};\n","import i18next from \"i18next\";\nimport { initReactI18next } from \"react-i18next\";\n//\nimport en from \"../locales/en\";\nimport fr from \"../locales/fr\";\n\n// --------------------------------------------------------------\n\nexport const changeLanguage = (language: string) =>\n  i18next.changeLanguage(language);\n\n// --------------------------------------------------------------\n\nexport const initLocales = async (): Promise<void> =>\n  new Promise((resolve, reject) => {\n    console.log(\"Initializing language...\");\n    i18next.use(initReactI18next).init(\n      {\n        fallbackLng: \"en\",\n        lng: navigator.language || (navigator as any).userLanguage,\n        resources: {\n          \"en-US\": { translation: en },\n          \"fr-FR\": { translation: fr },\n        },\n        interpolation: {\n          escapeValue: false, // react is already safe from xss\n          format: (value, format, lng) => {\n            // if (format === \"uppercase\") return value.toUpperCase();\n            // if (value instanceof Date) return moment(value).format(format);\n            return value;\n          },\n        },\n      },\n      (error) => {\n        if (error) reject(error);\n        resolve();\n      }\n    );\n  });\n","import * as React from \"react\";\nimport * as ReactDOM from \"react-dom\";\nimport { Provider } from \"react-redux\";\nimport { Route, HashRouter } from \"react-router-dom\";\nimport { composeWithDevTools } from \"redux-devtools-extension\";\nimport { applyMiddleware, createStore, compose } from \"redux\";\nimport thunk from \"redux-thunk\";\n//\nimport { rootReducer } from \"./reducers\";\nimport App from \"./containers/App\";\nimport { DEFAULT_API } from \"./utils/deezer\";\nimport { Player } from \"./utils/player\";\nimport { initLocales } from \"./utils/i18n\";\nimport \"./index.scss\";\n\n// ------------------------------------------------------------------\n\nconst init = async () => {\n  const composeEnhancers =\n    process.env.NODE_ENV === \"development\" ? composeWithDevTools({}) : compose;\n\n  const deezer = DEFAULT_API;\n  const queuePlayer = Player(true);\n  const previewPlayer = Player(false);\n  initLocales();\n\n  const store = createStore(\n    rootReducer,\n    composeEnhancers(\n      applyMiddleware(\n        thunk.withExtraArgument({ deezer, queuePlayer, previewPlayer })\n      )\n    )\n  );\n\n  // const dispatch: Dispatch = store.dispatch.bind(store);\n\n  return store;\n};\n\n// ------------------------------------------------------------------\n\ninit().then((store) => {\n  ReactDOM.render(\n    <Provider store={store}>\n      <HashRouter>\n        <Route path=\"/\" component={App} />\n      </HashRouter>\n    </Provider>,\n    document.getElementById(\"root\")\n  );\n});\n"],"sourceRoot":""}