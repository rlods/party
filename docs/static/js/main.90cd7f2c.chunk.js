(this["webpackJsonpparty-app"]=this["webpackJsonpparty-app"]||[]).push([[0],{49:function(e,t,n){e.exports=n(91)},62:function(e,t,n){},63:function(e,t,n){},64:function(e,t,n){},67:function(e,t,n){},68:function(e,t,n){},69:function(e,t,n){},70:function(e,t,n){},71:function(e,t,n){},72:function(e,t,n){},74:function(e,t,n){},75:function(e,t,n){},79:function(e,t,n){},80:function(e,t,n){},88:function(e,t,n){},89:function(e,t,n){},90:function(e,t,n){},91:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(15),c=n(4),s=n(16),i=n(13),l=(n(58),n(12)),u=n(43),p=n(17),m=n(3);const d={fetching:!1,error:null,containers:{}},h=[],f={stack:[]},v={playing:!1,position:0},b={position:-1,trackIds:[]},k={fetching:!1,error:null,room:null,room_access:{id:"",secret:""},room_color:{fg:{r:0,g:0,b:0},bg:{r:255,g:255,b:255}}},y={fetching:!1,error:null,tracks:{}},E={fetching:!1,error:null,user_access:(()=>{const e={id:"",secret:""},t=localStorage.getItem("U");if(t)try{const n=JSON.parse(atob(t));"string"===typeof n.i&&"string"===typeof n.s&&(e.id=n.i,e.secret=n.s,console.log("Loaded user access: ",e))}catch(n){}return e})(),users:{}},g=Object(l.combineReducers)({containers:(e=d,t)=>{switch(t.type){case"containers/FETCHING":return Object(m.a)({},e,{fetching:!0,error:null});case"containers/FETCHED":return Object(m.a)({},e,{fetching:!1,error:null});case"containers/ERROR":return Object(m.a)({},e,{fetching:!1,error:t.payload});case"containers/SET_CONTAINERS":{const o=Object(m.a)({},e,{containers:Object(m.a)({},e.containers)});var n,a=Object(p.a)(t.payload);try{for(a.s();!(n=a.n()).done;){const e=n.value;o.containers["".concat(e.type,"|").concat(e.id)]=e}}catch(r){a.e(r)}finally{a.f()}return o}case"containers/RESET":return d;default:return e}},messages:(e=h,t)=>{switch(t.type){case"message/ADD":return[t.payload,...e];case"message/REMOVE":return e.filter(e=>e.id!==t.payload);case"message/RESET":return h;default:return e}},modals:(e=f,t)=>{switch(t.type){case"modals/OPEN":return Object(m.a)({},e,{stack:[t.payload]});case"modals/CLOSE":return Object(m.a)({},e,{stack:[]});case"modals/PUSH":return Object(m.a)({},e,{stack:[...e.stack,t.payload]});case"modals/POP":const n=[...e.stack];return n.pop(),Object(m.a)({},e,{stack:n});default:return e}},player:(e=v,t)=>{switch(t.type){case"player/START":return Object(m.a)({},e,{playing:!0});case"player/STOP":return Object(m.a)({},e,{playing:!1});case"player/SET_POSITION":return Object(m.a)({},e,{position:t.payload});case"player/RESET":return v;default:return e}},queue:(e=b,t)=>{switch(t.type){case"queue/PUSH":return Object(m.a)({},e,{trackIds:[...e.trackIds,...t.payload]});case"queue/REMOVE":const n=[...e.trackIds];return n.splice(t.payload,1),Object(m.a)({},e,{position:t.payload<e.position?e.position-1:e.position,trackIds:n});case"queue/SET":return Object(m.a)({},e,{trackIds:t.payload});case"queue/SET_POSITION":return Object(m.a)({},e,{position:t.payload});case"queue/RESET":return b;default:return e}},rooms:(e=k,t)=>{switch(t.type){case"rooms/FETCHING":return Object(m.a)({},e,{fetching:!0,error:null});case"rooms/FETCHED":return Object(m.a)({},e,{fetching:!1,error:null});case"rooms/ERROR":return Object(m.a)({},e,{fetching:!1,error:t.payload});case"rooms/SET_ROOM":return Object(m.a)({},e,{room:t.payload});case"rooms/SET_ROOM_ACCESS":return Object(m.a)({},e,{room_access:t.payload});case"rooms/SET_ROOM_COLOR":return Object(m.a)({},e,{room_color:t.payload});case"rooms/RESET":return k;default:return e}},tracks:(e=y,t)=>{switch(t.type){case"tracks/FETCHING":return Object(m.a)({},e,{fetching:!0,error:null});case"tracks/FETCHED":return Object(m.a)({},e,{fetching:!1,error:null});case"tracks/ERROR":return Object(m.a)({},e,{fetching:!1,error:t.payload});case"tracks/SET_TRACKS":{const o=Object(m.a)({},e,{tracks:Object(m.a)({},e.tracks)});var n,a=Object(p.a)(t.payload);try{for(a.s();!(n=a.n()).done;){const e=n.value;o.tracks[e.id]=e}}catch(r){a.e(r)}finally{a.f()}return o}case"tracks/RESET":return y;default:return e}},users:(e=E,t)=>{switch(t.type){case"users/FETCHING":return Object(m.a)({},e,{fetching:!0,error:null});case"users/FETCHED":return Object(m.a)({},e,{fetching:!1,error:null});case"users/ERROR":return Object(m.a)({},e,{fetching:!1,error:t.payload});case"users/SET_USER_ACCESS":return(({id:e,secret:t})=>{localStorage.setItem("U",btoa(JSON.stringify({i:e,s:t})))})(t.payload),Object(m.a)({},e,{user_access:Object(m.a)({},t.payload)});case"users/SET_USERS":return Object(m.a)({},e,{users:Object(m.a)({},e.users,{},t.payload)});case"users/RESET":return E;default:return e}}});var C=n(1),x=n.n(C),S=n(2),w=n(44),O=n(6),j=n.n(O),R=n(45),N=n.n(R);n(62);class T extends a.Component{constructor(...e){super(...e),this.render=()=>{const e=this.props,t=e.className,n=e.color,a=e.icon,o=e.size,c=void 0===o?"M":o,s=e.title;return r.a.createElement(N.a,{className:j()("Icon",t,c),name:a,style:{color:n},title:s})}}}var M=T;n(63);class P extends a.Component{constructor(...e){super(...e),this.render=()=>{const e=this.props,t=e.className,n=e.color,a=e.disabled,o=void 0!==a&&a,c=e.displayTitle,s=void 0!==c&&c,i=e.icon,l=e.kind,u=void 0===l?"default":l,p=e.onClick,m=e.size,d=e.title,h=e.type,f=void 0===h?"button":h;return r.a.createElement("button",{type:f,"aria-label":d,className:j()("IconButton",t,u,m,{clickable:!o&&(!!p||"submit"===f)}),onClick:o?void 0:p,title:d},r.a.createElement(M,{color:n,icon:i,size:m}),s&&r.a.createElement("div",{className:j()("IconButtonTitle",m)},d))}}}const I=({onClick:e})=>r.a.createElement(P,{onClick:e,title:"Cancel",kind:"default",icon:"ban"});var _=P;const q=function(){var e=Object(S.a)(x.a.mark((function e(t){return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise(e=>{const n=document.createElement("textarea");n.value=t,n.setAttribute("readonly",""),n.style.position="absolute",n.style.left="-9999px",document.body.appendChild(n);const a=document.getSelection();if(null!==a){const e=a.rangeCount>0&&a.getRangeAt(0);n.select(),document.execCommand("copy"),!1!==e&&(a.removeAllRanges(),a.addRange(e))}document.body.removeChild(n),e()});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();n(64);class L extends a.Component{constructor(...e){var t;super(...e),t=this,this.render=()=>{const e=this.props,t=e.locked,n=e.room,a=e.onLock,o=e.onUnlock;return r.a.createElement("div",{className:"Head"},r.a.createElement("div",{className:"RoomStatus"},t?r.a.createElement(_,{icon:"lock",onClick:o,size:"M",title:"Locked (click to unlock)"}):r.a.createElement(_,{icon:"unlock",onClick:a,size:"M",title:"Unlocked (click to lock)"})),r.a.createElement("div",{className:"RoomName"},n?n.name:""),r.a.createElement("div",{className:"RoomLink"},r.a.createElement(_,{icon:"link",onClick:this.onCopyLink,size:"M",title:"Copy Room Link to Clipboard"})))},this.onCopyLink=Object(S.a)(x.a.mark((function e(){return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,q(document.location.href);case 2:t.props.onMessage("Room link has been copied to clipboard");case 3:case"end":return e.stop()}}),e)})))}}var U=L;const A=e=>e.rooms.room,F=e=>!e.rooms.room_access.secret;function D(e,t){return void 0===t?{type:e}:{type:e,payload:t}}const B=e=>D("modals/OPEN",e),z=()=>D("modals/POP");var H=n(92);let G=0;const K=(e,t,n=5e3)=>a=>{const r=G++;a(D("message/ADD",{id:r,stamp:(new Date).getTime(),text:t,type:e})),setTimeout(()=>a((e=>D("message/REMOVE",e))(r)),n)},V=(e,t)=>n=>{var a;n(K("error",t?"".concat(e,": ").concat((a=t).response&&a.response.data&&a.response.data.message?a.response.data.message:a.message):e,3e3))};var W=n(14);n(65);const J={databaseURL:"https://test-rl-7ffe8.firebaseio.com"};console.log(J);var Q=J;const X=W.initializeApp(Q),Y=W.database(X),Z=Y.ref("members"),$=Y.ref("rooms"),ee=Y.ref("users");let te=null;const ne=()=>te,ae=e=>{te=e},re=(e,t)=>{const n=$.child(e),a=n.child("info"),r=Z.child(e);let o=t||"";console.log("INIT SECRET",o);let c={name:"dummy",queue:{},queue_position:-1,timestamp:0};const s=function(){var e=Object(S.a)(x.a.mark((function e(t){return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l(e=>{const t=e.val();t&&(c=t)}),e.next=3,u(t);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),i=function(){var e=Object(S.a)(x.a.mark((function e(){return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((e,t)=>{a.once("value",n=>{const a=n.val();a?(c=a,e(c)):t(new Error("Room is invalid"))})}));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),l=e=>{a.on("value",e)},u=function(){var e=Object(S.a)(x.a.mark((function e({name:t,queue:a,queue_position:r}){return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0!==t&&(c.name=t),void 0!==a&&(c.queue=a),void 0!==r&&(c.queue_position=r),e.next=5,n.set({info:Object(m.a)({},c,{timestamp:W.database.ServerValue.TIMESTAMP}),secret:o});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return{getInfo:()=>c,id:e,init:s,isLocked:()=>!o,setSecret:e=>{console.log("SETTING SECRET",e),o=e},wait:i,subscribeInfo:l,subscribeMembers:(e,t)=>{r.on("child_added",e),r.on("child_removed",t)},unsubscribeInfo:e=>{a.off("value",e)},unsubscribeMembers:(e,t)=>{r.off("child_added",e),r.off("child_removed",t)},update:u}},oe=(e,t)=>{const n=ee.child(e),a=n.child("info");let r=null,o=t||"",c={name:"dummy",online:!1,room_id:"",status:"",timestamp:0};const s=function(){var e=Object(S.a)(x.a.mark((function e(t){return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l(e=>{const t=e.val();t&&(c=t)}),e.next=3,u(t);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),i=function(){var e=Object(S.a)(x.a.mark((function e(){return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((e,t)=>{a.once("value",n=>{const a=n.val();a?(c=a,e(c)):t(new Error("User is invalid"))})}));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),l=e=>{a.on("value",e)},u=function(){var e=Object(S.a)(x.a.mark((function e({name:t,room_id:a}){return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0!==t&&(c.name=t),void 0!==a&&(c.room_id=a),e.next=4,n.set({info:Object(m.a)({},c,{online:!0,status:"online",timestamp:W.database.ServerValue.TIMESTAMP}),secret:o});case 4:p();case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),p=()=>{n.onDisconnect().cancel(),n.onDisconnect().set({info:Object(m.a)({},c,{online:!1,room_id:"",status:"disconnected",timestamp:W.database.ServerValue.TIMESTAMP}),secret:o})};return{id:e,enter:function(){var t=Object(S.a)(x.a.mark((function t(n){return x.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!r){t.next=4;break}return t.next=3,r.remove();case 3:r=null;case 4:return t.next=6,u({room_id:n.id});case 6:return r=Z.child(n.id).child(e),r.onDisconnect().remove(),t.next=10,r.set({timestamp:W.database.ServerValue.TIMESTAMP});case 10:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),exit:function(){var e=Object(S.a)(x.a.mark((function e(){return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r){e.next=4;break}return e.next=3,r.remove();case 3:r=null;case 4:return e.next=6,u({room_id:""});case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),init:s,isLocked:()=>!o,setSecret:e=>{o=e},wait:i,subscribeInfo:l,unsubscribeInfo:e=>{a.off("value",e)},update:u,getInfo:()=>c}},ce=e=>D("queue/PUSH",e),se=e=>D("queue/REMOVE",e),ie=e=>D("queue/SET",e),le=e=>D("queue/SET_POSITION",e),ue=()=>function(){var e=Object(S.a)(x.a.mark((function e(t,n){var a;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(a=ne())||a.isLocked()){e.next=14;break}return e.prev=2,e.next=5,a.update({queue:{},queue_position:-1});case 5:t(D("queue/RESET")),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(2),t(V("Cannot clear queue")),t(Ne());case 12:e.next=15;break;case 14:t(V("Room is locked"));case 15:case"end":return e.stop()}}),e,null,[[2,8]])})));return function(t,n){return e.apply(this,arguments)}}(),pe=e=>function(){var t=Object(S.a)(x.a.mark((function t(n,a){var r,o;return x.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(r=ne())||r.isLocked()){t.next=16;break}return t.prev=2,o={},[...a().queue.trackIds,...e].forEach((e,t)=>{o[t]={id:e,type:"deezer"}}),t.next=7,r.update({queue:o});case 7:n(ce(e)),t.next=14;break;case 10:t.prev=10,t.t0=t.catch(2),n(V("Cannot append in queue")),n(Ne());case 14:t.next=17;break;case 16:n(V("Room is locked"));case 17:case"end":return t.stop()}}),t,null,[[2,10]])})));return function(e,n){return t.apply(this,arguments)}}(),me=e=>function(){var t=Object(S.a)(x.a.mark((function t(n,a){var r,o,c;return x.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(r=ne())||r.isLocked()){t.next=18;break}return t.prev=2,o={},(c=[...a().queue.trackIds]).splice(e,1),c.forEach((e,t)=>{o[t]={id:e,type:"deezer"}}),t.next=9,r.update({queue:o});case 9:n(se(e)),t.next=16;break;case 12:t.prev=12,t.t0=t.catch(2),n(V("Cannot remove from queue")),n(Ne());case 16:t.next=19;break;case 18:n(V("Room is locked"));case 19:case"end":return t.stop()}}),t,null,[[2,12]])})));return function(e,n){return t.apply(this,arguments)}}(),de=e=>function(){var t=Object(S.a)(x.a.mark((function t(n,a){var r;return x.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(r=ne())||r.isLocked()){t.next=14;break}return t.prev=2,t.next=5,r.update({queue_position:e});case 5:n(le(e)),t.next=12;break;case 8:t.prev=8,t.t0=t.catch(2),n(V("Cannot remove from queue")),n(Ne());case 12:t.next=15;break;case 14:n(V("Room is locked"));case 15:case"end":return t.stop()}}),t,null,[[2,8]])})));return function(e,n){return t.apply(this,arguments)}}(),he=()=>function(){var e=Object(S.a)(x.a.mark((function e(t,n){var a,r,o,c;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=n(),r=a.queue,o=r.position,(c=r.trackIds).length>0&&t(de(o>0?o-1:c.length-1));case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),fe=()=>function(){var e=Object(S.a)(x.a.mark((function e(t,n){var a,r,o,c;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=n(),r=a.queue,o=r.position,(c=r.trackIds).length>0&&t(de((o+1)%c.length));case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),ve=e=>D("tracks/SET_TRACKS",e),be=(e,t,n)=>function(){var a=Object(S.a)(x.a.mark((function a(r,o,{api:c,previewPlayer:s}){var i,l;return x.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(!(e.length>0)){a.next=23;break}if(a.prev=1,i=o(),!((l=e.filter(e=>!i.tracks.tracks[e])).length>0)){a.next=13;break}return console.log("Loading track...",{trackIds:l}),a.t0=r,a.t1=ve,a.next=10,Promise.all(l.map(e=>c.loadTrack(e)));case 10:a.t2=a.sent,a.t3=(0,a.t1)(a.t2),(0,a.t0)(a.t3);case 13:if(t&&(console.log("Enqueuing track...",{trackIds:e}),r(pe(e))),!n){a.next=18;break}return console.log("Previewing track...",{trackId:e[0]}),a.next=18,s.play(i.tracks.tracks[e[0]].preview,0);case 18:a.next=23;break;case 20:a.prev=20,a.t4=a.catch(1),r(V("Cannot load track",a.t4));case 23:case"end":return a.stop()}}),a,null,[[1,20]])})));return function(e,t,n){return a.apply(this,arguments)}}(),ke=(e,t,n,a)=>function(){var r=Object(S.a)(x.a.mark((function r(o,c,{api:s}){var i,l,u;return x.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(r.prev=0,i=c(),l="".concat(e,"|").concat(t),u=i.containers.containers[l]){r.next=17;break}console.log("Loading container...",{containerId:t,containerType:e}),r.t0=e,r.next="album"===r.t0?9:"playlist"===r.t0?13:17;break;case 9:return r.next=11,s.loadAlbum(t);case 11:return u=r.sent,r.abrupt("break",17);case 13:return r.next=15,s.loadPlaylist(t);case 15:return u=r.sent,r.abrupt("break",17);case 17:u&&(o(D("containers/SET_CONTAINERS",[u])),u.tracks&&u.tracks.data.length>0&&(o(ve(u.tracks.data)),n&&(console.log("Enqueuing container..."),o(pe(u.tracks.data.map(e=>e.id.toString())))),a&&(console.log("Playing container..."),o(be([u.tracks.data[0].id.toString()],!1,!0))))),r.next=23;break;case 20:r.prev=20,r.t1=r.catch(0),o(V("Cannot load container",r.t1));case 23:case"end":return r.stop()}}),r,null,[[0,20]])})));return function(e,t,n){return r.apply(this,arguments)}}(),ye=(e,t)=>function(){var n=Object(S.a)(x.a.mark((function n(a){return x.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:console.log("Previewing container...",{containerType:e,containerId:t}),a(ke(e,t,!1,!0));case 2:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}();var Ee=n(8),ge=Object(Ee.b)();const Ce=e=>D("rooms/SET_ROOM",e),xe=(e,t)=>D("rooms/SET_ROOM_ACCESS",{id:e,secret:t}),Se=e=>D("rooms/SET_ROOM_COLOR",e),we=(e,t)=>function(){var n=Object(S.a)(x.a.mark((function n(a){var r;return x.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,r=Object(H.a)(),console.log("Creating room...",{id:r,secret:t}),n.next=5,re(r,t).init({name:e});case 5:a(je(r,t)),n.next=11;break;case 8:n.prev=8,n.t0=n.catch(0),a(V("Cannot create room",n.t0));case 11:case"end":return n.stop()}}),n,null,[[0,8]])})));return function(e){return n.apply(this,arguments)}}();let Oe=null;const je=(e,t)=>function(){var n=Object(S.a)(x.a.mark((function n(a){var r;return x.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if((r=ne())&&r.id===e){n.next=23;break}return a(Re()),n.prev=3,console.log("Entering room...",{id:e,secret:t}),r=re(e,t),n.t0=a,n.t1=Ce,n.next=10,r.wait();case 10:n.t2=n.sent,n.t3=(0,n.t1)(n.t2),(0,n.t0)(n.t3),a(xe(e,t)),Oe=e=>{const t=e.val();let n=[];t.queue&&(n=Object.entries(t.queue).sort((e,t)=>Number(e[0])-Number(t[0])).map(e=>e[1].id),a(be(n,!1,!1))),a(ie(n)),a(Ce(t))},ae(r),r.subscribeInfo(Oe),ge.push("/room/".concat(e,"?key=").concat(t)),n.next=23;break;case 20:n.prev=20,n.t4=n.catch(3),a(V("Cannot join room",n.t4));case 23:case"end":return n.stop()}}),n,null,[[3,20]])})));return function(e){return n.apply(this,arguments)}}(),Re=()=>function(){var e=Object(S.a)(x.a.mark((function e(t){var n;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(n=ne())&&(console.log("Exiting room..."),n.unsubscribeInfo(Oe),ae(null),Oe=null,t(xe("","")));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Ne=()=>function(){var e=Object(S.a)(x.a.mark((function e(t,n){var a,r,o;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=n(),r=a.rooms.room_access.id,(o=ne())&&o.id===r&&(console.log("Locking room...",{id:r}),o.setSecret(""),t(xe(r,"")));case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),Te=e=>function(){var t=Object(S.a)(x.a.mark((function t(n,a){var r,o,c;return x.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=a(),o=r.rooms.room_access.id,(c=ne())&&c.id===o&&(console.log("Unlocking room...",{id:o,secret:e}),c.setSecret(e),n(xe(o,e)));case 3:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),Me=(e,t,n)=>function(){var a=Object(S.a)(x.a.mark((function a(r){return x.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:console.log("Queuing room tracks...",{containerType:e,containerId:t,trackId:n}),t&&r(ke(e,t,!0,!1)),n&&r(be([n],!0,!1));case 3:case"end":return a.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}();var Pe=Object(c.b)(e=>({locked:F(e),room:A(e)}),e=>({onLock:()=>e(Ne()),onMessage:t=>e(K("info",t)),onUnlock:()=>e(B({type:"UnlockRoom",props:null}))}))(U);n(67);const Ie=({playable:e,playing:t,image:n,onPlay:a,onStop:o})=>e?r.a.createElement("div",{className:j()("Cover",{playing:t}),style:{backgroundImage:"url('".concat(n,"')")},onClick:t?o:a},t?r.a.createElement(M,{icon:"pause",title:"Stop"}):r.a.createElement(M,{icon:"play",title:"Play"})):r.a.createElement("div",{className:j()("Cover",{playing:t}),style:{backgroundImage:"url('".concat(n,"')")}},t?r.a.createElement(M,{icon:"music",title:"Playing"}):null);n(68);const _e=({actions:e,album:t,playable:n,playing:a,onPlay:o,onStop:c})=>r.a.createElement("div",{className:"Media Album"},e,r.a.createElement(Ie,{playable:n,playing:a,image:t.cover_small,onPlay:o,onStop:c}),r.a.createElement("div",{className:"Metas"},r.a.createElement("div",{className:"Meta AlbumTitle"},r.a.createElement("a",{href:t.link,target:"_blank",rel:"noopener noreferrer"},t.title)),r.a.createElement("div",{className:"Meta AlbumArtistName"},"by"," ",r.a.createElement("a",{href:t.artist.link,target:"_blank",rel:"noopener noreferrer"},t.artist.name)))),qe=({actions:e,playlist:t,playable:n,playing:a,onPlay:o,onStop:c})=>r.a.createElement("div",{className:"Media Playlist"},e,r.a.createElement(Ie,{playable:n,playing:a,image:t.picture_small,onPlay:o,onStop:c}),r.a.createElement("div",{className:"Metas"},r.a.createElement("div",{className:"Meta PlaylistTitle"},r.a.createElement("a",{href:t.link,target:"_blank",rel:"noopener noreferrer"},t.title)))),Le=({actions:e,track:t,playable:n,playing:a,onPlay:o,onStop:c})=>r.a.createElement("div",{className:"Media Track"},e,r.a.createElement(Ie,{playable:n,playing:a,image:t.album.cover_small,onPlay:o,onStop:c}),r.a.createElement("div",{className:"Metas"},r.a.createElement("div",{className:"Meta TrackTitle"},r.a.createElement("a",{href:t.link,target:"_blank",rel:"noopener noreferrer"},t.title)),r.a.createElement("div",{className:"Meta TrackArtistName"},"by"," ",r.a.createElement("a",{href:t.artist.link,target:"_blank",rel:"noopener noreferrer"},t.artist.name))));n(69);class Ue extends a.Component{constructor(...e){super(...e),this.render=()=>{const e=this.props,t=e.locked,n=e.playing,a=e.playingPosition,o=e.tracks,c=e.onPlay,s=e.onRemove,i=e.onStop;return r.a.createElement("div",{className:"Queue"},o.map((e,o)=>r.a.createElement("div",{className:"QueueItem",key:o},r.a.createElement(Le,{track:e,playable:!t,playing:n&&a===o,onPlay:()=>c(o),onStop:i,actions:t?null:r.a.createElement(_,{title:"Remove",icon:"trash",onClick:()=>s(o)})}))))}}}var Ae=Ue;const Fe=(e,t)=>{const n=[],a=e.tracks.tracks;var r,o=Object(p.a)(t);try{for(o.s();!(r=o.n()).done;){const e=a[r.value];e&&n.push(e)}}catch(c){o.e(c)}finally{o.f()}return n};var De=n(29);const Be={},ze=function(){var e=Object(S.a)(x.a.mark((function e(t){var n,a,r,o;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",{bg:{r:255,g:255,b:255},fg:{r:0,g:0,b:0}});case 2:if(n=Be[t]){e.next=12;break}return e.next=6,De.read(t);case 6:return a=e.sent,e.next=9,a.resize(1,1).getPixelColor(0,0);case 9:r=e.sent,o=De.intToRGBA(r),Be[t]=n={bg:o,fg:.299*o.r+.587*o.g+.114*o.b>186?{r:0,g:0,b:0}:{r:255,g:255,b:255}};case 12:return e.abrupt("return",n);case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),He=e=>D("player/SET_POSITION",e);let Ge=null,Ke=null,Ve=-1;const We=()=>function(){var e=Object(S.a)(x.a.mark((function e(t,n,{queuePlayer:a}){return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Ge||(Ge=setInterval(Object(S.a)(x.a.mark((function e(){var r,o,c,s,i,l;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n(),o=r.queue,c=o.position,s=o.trackIds,i=r.tracks,!(s.length>0)){e.next=37;break}if(!(Ve!==c||c>=0&&Ke!==i.tracks[s[c]])){e.next=18;break}return Ve=c,Ke=i.tracks[s[Ve]],console.log("Playing clicked...",{id:Ke.id,index:Ve}),t(de(Ve)),e.t0=t,e.t1=Se,e.next=11,ze(Ke.album.cover_small);case 11:return e.t2=e.sent,e.t3=(0,e.t1)(e.t2),(0,e.t0)(e.t3),e.next=16,a.play(Ke.preview,0);case 16:e.next=34;break;case 18:if(a.isPlaying()){e.next=34;break}if(!((l=(c+1)%s.length)<s.length)){e.next=34;break}return Ve=l,Ke=i.tracks[s[Ve]],console.log("Playing next...",{id:Ke.id,index:Ve}),t(de(Ve)),e.t4=t,e.t5=Se,e.next=29,ze(Ke.album.cover_small);case 29:return e.t6=e.sent,e.t7=(0,e.t5)(e.t6),(0,e.t4)(e.t7),e.next=34,a.play(Ke.preview,0);case 34:t(He(a.getPosition())),e.next=39;break;case 37:console.log("No more tracks in queue..."),t(Je());case 39:case"end":return e.stop()}}),e)}))),250),t(D("player/START")));case 1:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}(),Je=()=>function(){var e=Object(S.a)(x.a.mark((function e(t,n,{queuePlayer:a}){return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Ge&&(clearInterval(Ge),Ge=null,Ke=null,Ve=-1,a.stop(),t(D("player/STOP")),t(He(0)));case 1:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}(),Qe=e=>function(){var t=Object(S.a)(x.a.mark((function t(n,a,{api:r,previewPlayer:o}){var c,s;return x.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,c=a(),s=c.tracks.tracks[e]){t.next=9;break}return console.log("Loading track...",{trackId:e}),t.next=7,r.loadTrack(e);case 7:s=t.sent,n(ve([s]));case 9:return console.log("Start previewing..."),t.next=12,o.play(s.preview,0);case 12:t.next=17;break;case 14:t.prev=14,t.t0=t.catch(0),n(V("Cannot load track",t.t0));case 17:case"end":return t.stop()}}),t,null,[[0,14]])})));return function(e,n,a){return t.apply(this,arguments)}}(),Xe=()=>function(){var e=Object(S.a)(x.a.mark((function e(t,n,{previewPlayer:a}){return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("Stop previewing..."),a.stop();case 2:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}();var Ye=Object(c.b)(e=>({locked:F(e),playing:e.player.playing,playingPosition:e.queue.position,tracks:Fe(e,e.queue.trackIds)}),e=>({onPlay:t=>{e(We()),e(de(t))},onRemove:t=>e(me(t)),onStop:()=>e(Je())}))(Ae);n(70);class Ze extends a.Component{constructor(...e){super(...e),this.render=()=>{const e=this.props,t=e.playing,n=e.value;return r.a.createElement("div",{className:j()("Progress",{playing:t})},r.a.createElement("progress",{max:100,value:100*n}))}}}var $e=Ze;var et=Object(c.b)(e=>({playing:e.player.playing,value:e.player.position}),e=>({}))($e);n(71);class tt extends a.Component{constructor(...e){super(...e),this.render=()=>{const e=this.props,t=e.onMoveBackward,n=e.onMoveForward,a=e.onPlay,o=e.onSearch,c=e.onStop,s=e.locked,i=e.playable,l=e.playing;return r.a.createElement("div",{className:"Controls"},r.a.createElement("div",{className:"ControlsSet"},r.a.createElement("div",{className:"Control"},r.a.createElement(_,{disabled:!i,icon:"step-backward",onClick:t,size:"M",title:"Previous"})),r.a.createElement("div",{className:"Control"},i&&l?r.a.createElement(_,{disabled:!i,onClick:c,icon:"pause",title:"Stop",size:"L"}):r.a.createElement(_,{disabled:!i,onClick:a,icon:"play",size:"L",title:"Play"})),r.a.createElement("div",{className:"Control"},r.a.createElement(_,{disabled:!i,icon:"step-forward",onClick:n,size:"M",title:"Next"}))),r.a.createElement(et,null),r.a.createElement("div",{className:"ControlsSet"},r.a.createElement("div",{className:"Control"},r.a.createElement(_,{disabled:s,onClick:this.onClear,icon:"trash",title:"Clear Room"})),r.a.createElement("div",{className:"Control"},r.a.createElement(_,{onClick:o,icon:"search",title:"Search Media"})),r.a.createElement("div",{className:"Control"},r.a.createElement(_,{onClick:this.onExit,icon:"sign-out",title:"Exit Room"}))))},this.onClear=()=>{window.confirm("Are you sure you want to clear Room")&&this.props.onClear()},this.onExit=()=>{window.confirm("Are you sure you want to leave the room?")&&ge.push("/")}}}var nt=tt;var at=Object(c.b)(e=>({locked:F(e),playable:!F(e)&&e.queue.trackIds.length>0,playing:e.player.playing}),e=>({onClear:()=>{e(ue()),e(Je())},onMoveBackward:()=>e(he()),onMoveForward:()=>e(fe()),onPlay:()=>e(We()),onSearch:()=>e(B({type:"Search",props:null})),onStop:()=>e(Je())}))(nt);n(72);class rt extends a.Component{constructor(...e){super(...e),this.componentDidMount=()=>{this.props.onEnter()},this.componentWillUnmount=()=>{this.props.onExit()},this.render=()=>{const e=this.props.color,t=e.fg,n=e.bg;return r.a.createElement("div",{className:"Room",style:{color:"rgb(".concat(t.r,", ").concat(t.g,", ").concat(t.b,")"),backgroundColor:"rgb(".concat(n.r,", ").concat(n.g,", ").concat(n.b,")")}},r.a.createElement(Pe,null),r.a.createElement(Ye,null),r.a.createElement(at,null))}}}var ot=Object(i.g)(rt);var ct=Object(c.b)((e,t)=>({color:e.rooms.room_color}),(e,t)=>{const n=w.parse(t.location.search.substr(1)).key;return{onEnter:()=>e(je(t.match.params.room_id,n||"")),onExit:()=>e(Re())}})(ot);n(74);class st extends a.Component{constructor(...e){super(...e),this.render=()=>{const e=this.props,t=e.user,n=e.loggedIn,o=e.onCreateRoom,c=e.onConnectUser;return r.a.createElement("div",{className:"Splash"},r.a.createElement("div",{className:"Top"},r.a.createElement("div",{className:"Logo"},r.a.createElement(s.b,{to:"/"},"Deezer Party")),r.a.createElement("div",{className:"Welcome"},n||t?"Welcome ".concat((null===t||void 0===t?void 0:t.name)||""):"Please connect to play")),r.a.createElement("div",{className:"Middle"},r.a.createElement("div",{className:"Menu"},n?r.a.createElement("div",{className:"MenuItem"},r.a.createElement(_,{displayTitle:!0,icon:"plus",onClick:o,size:"L",title:"Create Room"})):r.a.createElement(a.Fragment,null,r.a.createElement("div",{className:"MenuItem"},r.a.createElement(_,{displayTitle:!0,onClick:c,icon:"sign-in",size:"L",title:"Connect"}))))),r.a.createElement("div",{className:"Bottom"},r.a.createElement("div",{className:"Menu"},n?r.a.createElement("div",{className:"MenuItem"},r.a.createElement(_,{displayTitle:!0,icon:"sign-out",onClick:this.onDisconnect,size:"M",title:"Disconnect"})):r.a.createElement("div",{className:"MenuItem"},r.a.createElement(_,{displayTitle:!0,icon:"info",onClick:()=>{},size:"M",title:"CGU"})))))},this.onDisconnect=()=>{window.confirm("Are you sure you want to disconnect?")&&this.props.onDisconnectUser()}}}var it=st;const lt=(e,t)=>{const n=e.users.users[t];return n||null},ut=(e,t)=>D("users/SET_USER_ACCESS",{id:e,secret:t}),pt=e=>D("users/SET_USERS",e),mt=(e,t)=>function(){var n=Object(S.a)(x.a.mark((function n(a){var r;return x.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,console.log("Creating user..."),r=Object(H.a)(),n.next=5,oe(r,t).init({name:e});case 5:a(ft(r,t)),n.next=11;break;case 8:n.prev=8,n.t0=n.catch(0),a(V("Cannot create user",n.t0));case 11:case"end":return n.stop()}}),n,null,[[0,8]])})));return function(e){return n.apply(this,arguments)}}();let dt=null,ht=null;const ft=(e,t)=>function(){var n=Object(S.a)(x.a.mark((function n(a){var r;return x.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return a(vt()),n.prev=1,console.log("Connection user...",{id:e,secret:t}),r=oe(e),n.t0=a,n.t1=pt,n.next=8,r.wait();case 8:n.t2=n.sent,n.t3={[e]:n.t2},n.t4=(0,n.t1)(n.t3),(0,n.t0)(n.t4),a(ut(e,t)),ht=t=>{a(pt({[e]:t.val()}))},dt=r,dt.subscribeInfo(ht),n.next=22;break;case 18:n.prev=18,n.t5=n.catch(1),a(V("Cannot connect user",n.t5)),a(ut("",""));case 22:case"end":return n.stop()}}),n,null,[[1,18]])})));return function(e){return n.apply(this,arguments)}}(),vt=()=>function(){var e=Object(S.a)(x.a.mark((function e(t){return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:dt&&(console.log("Disconnecting user..."),dt.unsubscribeInfo(ht),dt=null,ht=null,t(ut("","")));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),bt=()=>function(){var e=Object(S.a)(x.a.mark((function e(t,n){var a,r,o,c;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=n(),r=a.users.user_access,o=r.id,c=r.secret,o&&c)try{console.log("Loading user..."),t(ft(o,c))}catch(s){t(V("Cannot load user",s))}case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();var kt=Object(c.b)(e=>({loggedIn:!!e.users.user_access.id,user:lt(e,e.users.user_access.id)}),e=>({onCreateRoom:()=>e(B({type:"CreateRoom",props:null})),onConnectUser:()=>e(B({type:"CreateUser",props:null})),onDisconnectUser:()=>e(vt())}))(it),yt=n(19);class Et extends a.Component{constructor(...e){super(...e),this.render=()=>{const e=this.props,t=e.children,n=e.className,a=e.title,o=e.renderFoot,c=e.onClose,s=e.onPop,i=e.has_prev_modal;return r.a.createElement("form",{className:j()("Modal",n),onSubmit:this.onSubmit},r.a.createElement("div",{className:"ModalHead"},r.a.createElement(_,{kind:"special",className:j()("ModalHeadBack",{hidden:!i}),icon:"angle-left",title:"Back",onClick:s}),r.a.createElement("div",{className:"ModalTitle"},a),r.a.createElement(_,{kind:"special",className:"ModalHeadClose",onClick:c,title:"Cancel",icon:"times"})),r.a.createElement("div",{className:"ModalBody"},t),r.a.createElement("div",{className:"ModalFoot"},o&&o()))},this.onSubmit=e=>{e.preventDefault(),this.props.onSubmit&&this.props.onSubmit()}}}var gt=Et;var Ct=Object(c.b)(e=>({has_prev_modal:e.modals.stack.length>1}),e=>({onClose:()=>e(z()),onPop:()=>e(z())}))(gt);n(75);class xt extends a.Component{constructor(...e){super(...e),this.render=()=>{const e=this.props,t=e.children,n=e.className,a=e.renderButtons,o=e.title,c=e.onSubmit;return r.a.createElement(Ct,{className:j()("FormModal",n),title:o,renderFoot:a,onSubmit:c},t)}}}var St=xt;class wt extends a.Component{constructor(...e){super(...e),this.idRef=Object(a.createRef)(),this.state={id:"",secret:""},this.render=()=>{const e=this.state,t=e.id,n=e.secret;return r.a.createElement(St,{title:"Connect User",onSubmit:this.onConnect,renderButtons:this.renderButtons},r.a.createElement("div",{className:"ModalField"},r.a.createElement("label",{htmlFor:"modal-id"},"User ID"),r.a.createElement("input",{id:"modal-id",type:"text",placeholder:"User ID...",maxLength:36,minLength:36,required:!0,value:t,ref:this.idRef,onChange:e=>{this.setState({id:e.target.value})}})),r.a.createElement("div",{className:"ModalField"},r.a.createElement("label",{htmlFor:"modal-secret"},"User Secret"),r.a.createElement("input",{id:"modal-secret",type:"text",placeholder:"User Secret...",maxLength:36,minLength:36,required:!0,value:n,onChange:e=>{this.setState({secret:e.target.value})}})))},this.renderButtons=()=>r.a.createElement(a.Fragment,null,r.a.createElement(_,{title:"Connect",kind:"primary",icon:"sign-in",type:"submit"}),r.a.createElement(I,{onClick:this.props.onClose}),r.a.createElement(_,{title:"Create",kind:"default",icon:"plus",onClick:this.props.onToggle})),this.onConnect=()=>{const e=this.props,t=e.onClose,n=e.onConnect,a=e.onError,r=this.state,o=r.id,c=r.secret;0!==o.trim().length?0!==c.trim().length?(n(o,c),t()):a("User secret is invalid"):a("User ID is invalid")}}componentDidMount(){this.idRef.current&&this.idRef.current.focus()}}var Ot=wt;var jt=Object(c.b)(e=>({}),e=>({onClose:()=>e(z()),onConnect:(t,n)=>e(ft(t,n)),onError:t=>e(V(t)),onToggle:()=>e(B({type:"CreateUser",props:null}))}))(Ot);class Rt extends a.Component{constructor(...e){var t;super(...e),t=this,this.render=()=>{const e=this.props,t=e.id,n=e.label,a=e.onChange,o=e.placeholder,c=e.value;return r.a.createElement("div",{className:"ModalField"},r.a.createElement("label",{htmlFor:t},n),r.a.createElement("div",{style:{display:"flex",flexDirection:"row",justifyContent:"space-between"}},r.a.createElement("input",{style:{flexGrow:1,marginRight:"0.5rem"},id:t,type:"text",placeholder:o,maxLength:36,minLength:36,readOnly:!0,required:!0,value:c,onChange:e=>a(e.target.value)}),r.a.createElement(_,{icon:"clipboard",onClick:this.onCopyToClipboard,size:"M",title:"Copy ".concat(n," to Clipboard")})))},this.onCopyToClipboard=Object(S.a)(x.a.mark((function e(){var n,a,r,o;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.props,a=n.onMessage,r=n.label,o=n.value,e.next=3,q(o);case 3:a("".concat(r," has been copied to clipboard"));case 4:case"end":return e.stop()}}),e)})))}}var Nt=Rt;var Tt=Object(c.b)(e=>({}),e=>({onMessage:t=>e(K("info",t))}))(Nt);class Mt extends a.Component{constructor(...e){super(...e),this.nameRef=Object(a.createRef)(),this.state={name:"",secret:Object(H.a)()},this.render=()=>{const e=this.state,t=e.name,n=e.secret;return r.a.createElement(St,{title:"Create Room",onSubmit:this.onCreate,renderButtons:this.renderButtons},r.a.createElement("div",{className:"ModalField"},r.a.createElement("label",{htmlFor:"modal-name"},"Room Name"),r.a.createElement("input",{id:"modal-name",type:"text",placeholder:"Room Name...",maxLength:100,minLength:2,required:!0,value:t,ref:this.nameRef,onChange:e=>this.setState({name:e.target.value})})),r.a.createElement(Tt,{id:"modal-secret",label:"Room Key",placeholder:"Room Key...",value:n,onChange:e=>this.setState({secret:e})}))},this.renderButtons=()=>r.a.createElement(a.Fragment,null,r.a.createElement(_,{title:"Create",kind:"primary",icon:"plus",type:"submit"}),r.a.createElement(I,{onClick:this.props.onClose})),this.onCreate=()=>{const e=this.props,t=e.onClose,n=e.onCreate,a=e.onError,r=this.state,o=r.name,c=r.secret;0!==o.trim().length?0!==c.trim().length?(n(o,c),t()):a("Room secret is invalid"):a("Room name is invalid")}}componentDidMount(){this.nameRef.current&&this.nameRef.current.focus()}}var Pt=Mt;var It=Object(c.b)(e=>({}),e=>({onClose:()=>e(z()),onCreate:(t,n)=>e(we(t,n)),onError:t=>e(V(t))}))(Pt);class _t extends a.Component{constructor(...e){super(...e),this.nameRef=Object(a.createRef)(),this.state={name:"",secret:Object(H.a)()},this.render=()=>{const e=this.state,t=e.name,n=e.secret;return r.a.createElement(St,{title:"Create User",onSubmit:this.onCreate,renderButtons:this.renderButtons},r.a.createElement("div",{className:"ModalField"},r.a.createElement("label",{htmlFor:"modal-name"},"User Name"),r.a.createElement("input",{id:"modal-name",type:"text",placeholder:"User Name...",maxLength:100,minLength:2,required:!0,value:t,ref:this.nameRef,onChange:e=>this.setState({name:e.target.value})})),r.a.createElement(Tt,{id:"modal-secret",label:"User Secret",placeholder:"User Secret...",value:n,onChange:e=>this.setState({secret:e})}))},this.renderButtons=()=>r.a.createElement(a.Fragment,null,r.a.createElement(_,{title:"Create",kind:"primary",icon:"plus",type:"submit"}),r.a.createElement(I,{onClick:this.props.onClose}),r.a.createElement(_,{title:"Connect",kind:"default",icon:"sign-in",onClick:this.props.onToggle})),this.onCreate=()=>{const e=this.props,t=e.onClose,n=e.onCreate,a=e.onError,r=this.state,o=r.name,c=r.secret;0!==o.trim().length?0!==c.trim().length?(n(o,c),t()):a("User secret is invalid"):a("User name is invalid")}}componentDidMount(){this.nameRef.current&&this.nameRef.current.focus()}}var qt=_t;var Lt=Object(c.b)(e=>({}),e=>({onClose:()=>e(z()),onCreate:(t,n)=>e(mt(t,n)),onError:t=>e(V(t)),onToggle:()=>e(B({type:"ConnectUser",props:null}))}))(qt),Ut=n(48),At=n(47),Ft=n.n(At);const Dt=(()=>{const e=e=>new Promise((t,n)=>{Ft()(e,void 0,(e,a)=>{e?n(new Error(e.message)):t(a)})}),t=function(){var t=Object(S.a)(x.a.mark((function t(n,a){var r;return x.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=a?"".concat("https://api.deezer.com","/").concat(n,"?").concat(a,"&output=jsonp&callback="):"".concat("https://api.deezer.com","/").concat(n,"?output=jsonp&callback="),t.next=3,e(r);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),n=(e,n)=>t("search/".concat(e),"q=".concat(encodeURIComponent(n))),a=(e,n)=>t("/".concat(e,"/").concat(n)),r=e=>n("album",e),o=e=>n("playlist",e),c=e=>n("track",e);return{searchAll:function(){var e=Object(S.a)(x.a.mark((function e(t){var n,a,s,i,l;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([r(t),o(t),c(t)]);case 2:return n=e.sent,a=Object(Ut.a)(n,3),s=a[0],i=a[1],l=a[2],e.abrupt("return",{albums:s,playlists:i,tracks:l});case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),loadAlbum:function(){var e=Object(S.a)(x.a.mark((function e(t){var n;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a("album",t);case 2:return(n=e.sent).tracks.data.forEach(e=>{e.album=n,e.artist.link="https://www.deezer.com/artist/".concat(e.artist.id)}),e.abrupt("return",n);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),loadPlaylist:e=>a("playlist",e),loadTrack:e=>a("track",e)}})();var Bt=({items:e,label:t,cb:n})=>e.length>0?r.a.createElement(a.Fragment,null,r.a.createElement("div",{className:"ModalField"},r.a.createElement("label",null,t)),e.slice(0,5).map(e=>r.a.createElement("div",{key:e.id,className:"ModalField"},r.a.createElement("div",{className:"SearchResultItem"},n(e))))):null;n(79);class zt extends a.Component{constructor(...e){var t;super(...e),t=this,this.queryRef=Object(a.createRef)(),this.state={mediaId:0,mediaType:"track",query:"",results:{albums:{data:[],total:0},playlists:{data:[],total:0},tracks:{data:[],total:0}}},this.render=()=>r.a.createElement(St,{className:"SearchModal",title:"Search",onSubmit:this.onSearch,renderButtons:this.renderButtons},this.renderInputs(),this.renderResults()),this.renderButtons=()=>r.a.createElement(a.Fragment,null,r.a.createElement(_,{title:"Search",kind:"primary",icon:"search",type:"submit"}),r.a.createElement(I,{onClick:this.props.onClose})),this.renderInputs=()=>{const e=this.state.query;return r.a.createElement("div",{className:"ModalField"},r.a.createElement("input",{id:"modal-query",type:"text",placeholder:"Search...",maxLength:100,minLength:2,required:!0,value:e,ref:this.queryRef,onChange:e=>{this.setState({query:e.target.value})}}))},this.renderResults=()=>{const e=this.props.locked,t=this.state,n=t.mediaId,o=t.mediaType,c=t.results,s=c.albums,i=c.playlists,l=c.tracks;return r.a.createElement(a.Fragment,null,r.a.createElement(Bt,{label:"Albums",type:"album",items:s.data,cb:t=>r.a.createElement(_e,{actions:e?null:r.a.createElement(_,{title:"Add",icon:"plus",onClick:()=>this.onSelect("album",t.id)}),album:t,playable:!0,playing:"album"===o&&n===t.id,onPlay:()=>this.onStartPreview("album",t.id),onStop:()=>this.onStopPreview()})}),r.a.createElement(Bt,{label:"Playlists",type:"playlist",items:i.data,cb:t=>r.a.createElement(qe,{actions:e?null:r.a.createElement(_,{title:"Add",icon:"plus",onClick:()=>this.onSelect("playlist",t.id)}),playlist:t,playable:!0,playing:"playlist"===o&&n===t.id,onPlay:()=>this.onStartPreview("playlist",t.id),onStop:()=>this.onStopPreview()})}),r.a.createElement(Bt,{label:"Tracks",type:"track",items:l.data,cb:t=>r.a.createElement(Le,{actions:e?null:r.a.createElement(_,{title:"Add",icon:"plus",onClick:()=>this.onSelect("track",t.id)}),track:t,playable:!0,playing:"track"===o&&n===t.id,onPlay:()=>this.onStartPreview("track",t.id),onStop:()=>this.onStopPreview()})}))},this.onSearch=Object(S.a)(x.a.mark((function e(){var n;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((n=t.state.query).trim().length>0)){e.next=8;break}return e.t0=t,e.next=5,Dt.searchAll(n);case 5:e.t1=e.sent,e.t2={results:e.t1},e.t0.setState.call(e.t0,e.t2);case 8:case"end":return e.stop()}}),e)}))),this.onSelect=(e,t)=>this.props.onSelect(e,t.toString()),this.onStartPreview=(e,t)=>{this.props.onStartPreview(e,t.toString()),this.setState({mediaId:t,mediaType:e})},this.onStopPreview=()=>{this.props.onStopPreview(),this.setState({mediaId:0,mediaType:"track"})}}componentDidMount(){this.queryRef.current&&this.queryRef.current.focus()}componentWillUnmount(){this.props.onStopPreview()}}var Ht=zt;var Gt=Object(c.b)(e=>({locked:F(e)}),e=>({onClose:()=>e(z()),onSelect:(t,n)=>e("track"===t?Me("album","",n):Me(t,n,"")),onStartPreview:(t,n)=>{e("track"===t?Qe(n):ye(t,n))},onStopPreview:()=>e(Xe())}))(Ht);class Kt extends a.Component{constructor(...e){super(...e),this.secretRef=Object(a.createRef)(),this.state={secret:""},this.render=()=>{const e=this.state.secret;return r.a.createElement(St,{title:"Unlock Room",onSubmit:this.onUnlock,renderButtons:this.renderButtons},r.a.createElement("div",{className:"ModalField"},r.a.createElement("label",{htmlFor:"modal-secret"},"Room Key"),r.a.createElement("input",{id:"modal-secret",type:"text",placeholder:"Room Key...",maxLength:36,minLength:36,required:!0,value:e,ref:this.secretRef,onChange:e=>{this.setState({secret:e.target.value})}})))},this.renderButtons=()=>r.a.createElement(a.Fragment,null,r.a.createElement(_,{title:"Join",kind:"primary",icon:"sign-in",type:"submit"}),r.a.createElement(I,{onClick:this.props.onClose})),this.onUnlock=()=>{const e=this.props,t=e.onClose;(0,e.onUnlock)(this.state.secret),t()}}componentDidMount(){this.secretRef.current&&this.secretRef.current.focus()}}var Vt=Kt;var Wt=Object(c.b)(e=>({}),e=>({onClose:()=>e(z()),onUnlock:t=>e(Te(t))}))(Vt);n(80);class Jt extends a.Component{constructor(...e){super(...e),this.state={curr_prereq:void 0,prev_prereq:void 0},this.componentDidMount=()=>{document.addEventListener("keydown",this.onKeyDown)},this.componentWillUnmount=()=>{document.removeEventListener("keydown",this.onKeyDown)},this.componentDidUpdate=e=>{const t=e.prereq,n=this.props.prereq;t!==n&&this.setState({curr_prereq:void 0,prev_prereq:t},()=>{n&&setTimeout(()=>{this.setState({curr_prereq:n})},300)})},this.render=()=>{const e=this.state,t=e.curr_prereq,n=e.prev_prereq,a=t||n;let o=null;return a&&(o=(e=>{switch(e.type){case"ConnectUser":return r.a.createElement(jt,null);case"CreateRoom":return r.a.createElement(It,null);case"CreateUser":return r.a.createElement(Lt,null);case"Search":return r.a.createElement(Gt,null);case"UnlockRoom":return r.a.createElement(Wt,null)}})(a)),r.a.createElement(yt.CSSTransition,{in:!!t,timeout:300,unmountOnExit:!0},r.a.createElement("div",{className:"ModalOverlay",onClick:this.onClickOverlay},o&&r.a.createElement("div",{className:"ModalWrapper",role:"dialog",onClick:this.onClickWrapper},o)))},this.onClickOverlay=e=>{e.stopPropagation(),this.props.onCloseModal()},this.onClickWrapper=e=>{e.stopPropagation()},this.onKeyDown=e=>{27===e.keyCode&&this.props.onCloseModal()}}}var Qt=Jt;var Xt=Object(c.b)(e=>({prereq:e.modals.stack.length>0?e.modals.stack[e.modals.stack.length-1]:void 0}),e=>({onCloseModal:()=>e(z())}))(Qt);n(88);class Yt extends r.a.Component{constructor(...e){super(...e),this.render=()=>r.a.createElement("div",{className:"Messages"},r.a.createElement(yt.TransitionGroup,null,this.props.messages.map(e=>this.renderMessage(e))))}renderMessage(e){return r.a.createElement(yt.CSSTransition,{key:e.id,classNames:"Message",timeout:{enter:200,exit:200}},r.a.createElement("div",{className:j()("Message","Message-"+e.type)},e.text))}}var Zt=Yt;var $t=Object(c.b)(e=>({messages:e.messages.sort((e,t)=>e.stamp-t.stamp)}))(Zt);n(89);class en extends a.Component{constructor(...e){var t;super(...e),t=this,this.componentDidMount=Object(S.a)(x.a.mark((function e(){return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.props.onReconnect();case 1:case"end":return e.stop()}}),e)}))),this.render=()=>r.a.createElement("div",{className:"App"},r.a.createElement(Xt,null),r.a.createElement(i.d,null,r.a.createElement(i.b,{exact:!0,path:"/room/:room_id",component:ct}),r.a.createElement(i.b,{exact:!0,path:"/",component:kt}),r.a.createElement(i.a,{to:"/"})),r.a.createElement($t,null))}}var tn=en;var nn=Object(c.b)(e=>({}),e=>({onReconnect:()=>e(bt())}))(tn);let an=null;const rn=()=>(an||(an=new(window.AudioContext||window.webkitAudioContext)),an),on=e=>new Promise((t,n)=>rn().decodeAudioData(e,t,n));(()=>{const e=()=>{document.removeEventListener("click",e),document.removeEventListener("touchstart",e),console.log("Fixing audio context...");const t=rn();var n=t.createBuffer(1,1,22050),a=t.createBufferSource();a.buffer=n,a.connect(t.destination),a.start(0)};document.addEventListener("click",e),document.addEventListener("touchstart",e)})();const cn=()=>{let e=null,t=null,n=null;const a=()=>{if(!n){const a=rn();n=a.destination,t=a.createGain(),t.gain.value=1,t.connect(n),n=t,e=a.createAnalyser(),e.fftSize=128,e.connect(n),n=e}return n};let r=null,o="",c=null,s=0,i=0;const l=e=>new Promise((t,n)=>{const a=new XMLHttpRequest;a.open("GET",e,!0),a.responseType="arraybuffer",a.addEventListener("error",()=>n(new Error("Audio buffer loading failed")),!1),a.addEventListener("load",Object(S.a)(x.a.mark((function e(){return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.t0=t,e.next=4,on(a.response);case 4:e.t1=e.sent,(0,e.t0)(e.t1),e.next=12;break;case 8:e.prev=8,e.t2=e.catch(0),console.log("An error occurred while decoding audio data"),n(e.t2);case 12:case"end":return e.stop()}}),e,null,[[0,8]])}))),!1),a.send()}),u=function(){var e=Object(S.a)(x.a.mark((function e(t,n){return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o===t){e.next=6;break}return console.log("Loading audio...",{url:t}),e.next=4,l(t);case 4:r=e.sent,o=t;case 6:p(),i++,console.log("Starting audio..."),c=rn().createBufferSource(),c.buffer=r,c.loop=!1,c.loopStart=0,c.loopEnd=0,c.onended=()=>{console.log("Audio terminated..."),i--},c.playbackRate.value=1,c.connect(a()),c.start(0,n),s=rn().currentTime;case 19:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),p=()=>{null!==c&&(console.log("Stopping audio..."),c.stop(),c=null,s=0)};return{analyserNode:e,gainNode:t,getPosition:()=>{var e;return r&&c?(rn().currentTime-s)/(null===(e=r)||void 0===e?void 0:e.duration):0},isPlaying:()=>i>0,play:u,stop:p}};n(90);const sn=l.compose,ln=Object(l.createStore)(g,sn(Object(l.applyMiddleware)(u.a.withExtraArgument({api:Dt,queuePlayer:cn(),previewPlayer:cn()}))));o.render(a.createElement(c.a,{store:ln},a.createElement(s.a,null,a.createElement(i.b,{path:"/",component:nn}))),document.getElementById("root"))}},[[49,1,2]]]);
//# sourceMappingURL=main.90cd7f2c.chunk.js.map