(this["webpackJsonpparty-app"]=this["webpackJsonpparty-app"]||[]).push([[0],{100:function(e,t,a){},101:function(e,t,a){},102:function(e,t,a){},103:function(e,t,a){},104:function(e,t,a){},105:function(e,t,a){},113:function(e,t,a){},114:function(e,t,a){},116:function(e,t,a){},117:function(e,t,a){"use strict";a.r(t);var r=a(1),n=a.n(r),c=a(2),o=a(0),i=a.n(o),s=a(23),l=a(3),u=a(21),d=a(20),p=a(8),m=a.n(p),b=a(52),f=a.n(b),y=a(5),v=a(56),k=a.n(v);a(82);const h=i.a.memo(({className:e,color:t,icon:a,size:r="M",title:n})=>i.a.createElement(k.a,{className:m()("Icon",e,r),name:a,style:{color:t},title:n}));a(83);const g=i.a.memo(({className:e,color:t,disabled:a=!1,displayTitle:r=!1,icon:n,kind:c="default",onClick:o,size:s,title:l,type:u="button"})=>i.a.createElement("button",{type:u,"aria-label":l,className:m()("IconButton",e,c,{clickable:!a&&(!!o||"submit"===u)}),onClick:a?void 0:o,title:l},i.a.createElement(h,{color:t,icon:n,size:s}),r&&i.a.createElement("div",{className:m()("IconButtonTitle",s)},l))),E=function(){var e=Object(c.a)(n.a.mark((function e(t){return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise(e=>{const a=document.createElement("textarea");a.value=t,a.setAttribute("readonly",""),a.style.position="absolute",a.style.left="-9999px",document.body.appendChild(a);const r=document.getSelection();if(null!==r){const e=r.rangeCount>0&&r.getRangeAt(0);a.select(),document.execCommand("copy"),!1!==e&&(r.removeAllRanges(),r.addRange(e))}document.body.removeChild(a),e()});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),x=e=>e.room.info,O=e=>!!e.room.room,j=e=>!e.room.access.secret,w=e=>null!==e.room.info&&e.room.info.playing;function S(e,t){return void 0===t?{type:e}:{type:e,payload:t}}const C=e=>S("message/REMOVE",e),_=[];let N=0;const M=(e,{autoclear:t=!0,duration:a=3e3,extra:r,text:n,weight:c=0})=>o=>{const i=N++;o(S("message/ADD",{extra:r,id:i,stamp:(new Date).getTime(),text:n,type:e,weight:c})),t&&setTimeout(()=>o(C(i)),a)},R=e=>M("error",{text:e}),P=e=>M("success",{text:e}),T=(e,t,a)=>Object(c.a)(n.a.mark((function r(){return n.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!window.confirm(e)){r.next=3;break}return t(),r.abrupt("return");case 3:a&&a();case 4:case"end":return r.stop()}}),r)})));var L=a(14);const A=e=>{const t=[],a=e.medias.medias,r=e.room.tracks;var n,c=Object(L.a)(r);try{for(c.s();!(n=c.n()).done;){const e=n.value,r=a[e.provider][e.type][e.id];r?t.push(r):t.push(null)}}catch(o){c.e(o)}finally{c.f()}return t},I=e=>e.room.tracks.length;a(84);const z=()=>{const e=Object(l.b)(),t=Object(y.b)().t,a=Object(d.g)(),r=Object(l.c)(x),s=Object(l.c)(e=>e.room.medias.length),u=Object(l.c)(I),p=Object(o.useCallback)(Object(c.a)(n.a.mark((function t(){return n.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,E(document.location.href.split("?")[0]);case 2:e(P("rooms.link_copied_to_clipboard"));case 3:case"end":return t.stop()}}),t)}))),[e]),m=Object(o.useCallback)(()=>{e(T(t("rooms.confirm_exit"),()=>{a.push("/")}))},[t,e,a]);return i.a.createElement("div",{className:"Head"},i.a.createElement("div",{className:"HeadInner"},i.a.createElement("div",{className:"RoomLink"},i.a.createElement(g,{icon:"link",onClick:p,size:"M",title:t("rooms.copy_link")})),i.a.createElement("div",{className:"RoomMeta"},r?i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{className:"RoomName",title:"".concat(t("rooms.media_count",{count:s})," / ").concat(t("rooms.track_count",{count:u}))},r.name)):null),i.a.createElement("div",{className:"RoomExit"},i.a.createElement(g,{onClick:m,icon:"sign-out",size:"M",title:t("rooms.exit")}))))},B=i.a.memo(({size:e})=>i.a.createElement(h,{className:"rotating",icon:"circle-o-notch",size:e,title:"Loading"}));a(86);const F=i.a.memo(({playable:e,playing:t,image:a,onPlay:r,onStop:n})=>{const c=Object(y.b)().t;return e?i.a.createElement("div",{className:m()("Cover",{playable:e,playing:t}),style:a?{backgroundImage:"url('".concat(a,"')")}:{},onClick:t?n:r},t?i.a.createElement(h,{icon:"pause",size:"S",title:c("player.stop")}):i.a.createElement(h,{icon:"play",size:"S",title:c("player.play")})):i.a.createElement("div",{className:m()("Cover",{playing:t}),style:a?{backgroundImage:"url('".concat(a,"')")}:{}},t?i.a.createElement(h,{icon:"music",size:"S",title:c("player.playing")}):null)});a(87);const W=e=>i.a.createElement(U,{media:e,playable:!1,playing:!0}),U=i.a.memo(({actions:e,media:t,playable:a,playing:r,onPlay:n,onStop:c})=>{const o=Object(y.b)().t;return t?"album"===t.type?i.a.createElement("div",{className:"Media Album"},i.a.createElement(F,{playable:a,playing:r,image:t.picture_small,onPlay:n,onStop:c}),i.a.createElement("div",{className:"Metas"},i.a.createElement("div",{className:"Meta AlbumTitle"},i.a.createElement("a",{href:t.link,target:"_blank",rel:"noopener noreferrer"},t.title)),i.a.createElement("div",{className:"Meta AlbumArtist"},i.a.createElement("a",{href:t.artist.link,target:"_blank",rel:"noopener noreferrer"},o("medias.by",{artist:t.artist.name})))),e?i.a.createElement("div",{className:"Actions"},e):null):"playlist"===t.type?i.a.createElement("div",{className:"Media Playlist"},i.a.createElement(F,{playable:a,playing:r,image:t.picture_small,onPlay:n,onStop:c}),i.a.createElement("div",{className:"Metas"},i.a.createElement("div",{className:"Meta PlaylistTitle"},i.a.createElement("a",{href:t.link,target:"_blank",rel:"noopener noreferrer"},t.title)),i.a.createElement("div",{className:"Meta PlaylistCreator"},i.a.createElement("a",{href:t.user.link,target:"_blank",rel:"noopener noreferrer"},o("medias.by",{artist:t.user.name})))),e?i.a.createElement("div",{className:"Actions"},e):null):"track"===t.type?i.a.createElement("div",{className:"Media Track"},i.a.createElement(F,{playable:a&&!!t.preview,playing:r,image:t.album.picture_small,onPlay:n,onStop:c}),i.a.createElement("div",{className:"Metas"},i.a.createElement("div",{className:"Meta TrackTitle"},i.a.createElement("a",{href:t.link,target:"_blank",rel:"noopener noreferrer"},t.title)),i.a.createElement("div",{className:"Meta TrackArtist"},i.a.createElement("a",{href:t.artist.link,target:"_blank",rel:"noopener noreferrer"},o("medias.by",{artist:t.artist.name})))),e?i.a.createElement("div",{className:"Actions"},e):null):null:i.a.createElement("div",{className:"Media"},i.a.createElement(F,{playable:a,playing:r,image:"",onPlay:n,onStop:c}),i.a.createElement("div",{className:"Metas"},i.a.createElement(B,{size:"M"})),e?i.a.createElement("div",{className:"Actions"},e):null)}),q=i.a.memo(({locked:e,track:t,playing:a,onPlay:r,onRemove:n,onStop:c})=>{const o=Object(y.b)().t;return i.a.createElement("div",{className:"QueueItem"},i.a.createElement(U,{media:t,playable:!!t&&!e,playing:a,onPlay:r,onStop:c,actions:i.a.createElement(g,{disabled:e,title:o("medias.remove"),icon:"trash",onClick:n})}))});var D=a(4),V=a(6),H=a(118),X=a(16);const G={boat1:{x:6,y:6},boat2:{x:6,y:6},boat3:{x:6,y:6}},Q={hitted1:{x:10,y:10},hitted2:{x:10,y:10},missed1:{x:10,y:10},missed2:{x:10,y:10}},J={bullet1:{x:12,y:16},bullet2:{x:12,y:16},bullet3:{x:12,y:16},mine:{x:12,y:12}},Z={boat1:{N:"boat1-N",E:"boat1-E",S:"boat1-S",W:"boat1-W"},boat2:{N:"boat2-N",E:"boat2-E",S:"boat2-S",W:"boat2-W"},boat3:{N:"boat3-N",E:"boat3-E",S:"boat3-S",W:"boat3-W"}},Y={N:{"rotate-left":"W","rotate-right":"E"},E:{"rotate-left":"N","rotate-right":"S"},S:{"rotate-left":"E","rotate-right":"W"},W:{"rotate-left":"S","rotate-right":"N"}},K={boat1:{N:{x:0,y:0},E:{x:0,y:0},S:{x:0,y:0},W:{x:0,y:0}},boat2:{N:{x:0,y:-1},E:{x:1,y:0},S:{x:0,y:1},W:{x:-1,y:0}},boat3:{N:{x:0,y:-2},E:{x:2,y:0},S:{x:0,y:2},W:{x:-2,y:0}}},$={N:{"move-forward":{x:0,y:-1},"move-backward":{x:0,y:1}},E:{"move-forward":{x:1,y:0},"move-backward":{x:-1,y:0}},S:{"move-forward":{x:0,y:1},"move-backward":{x:0,y:-1}},W:{"move-forward":{x:-1,y:0},"move-backward":{x:1,y:0}}},ee={boat1:1,boat2:2,boat3:3},te={N:{forward:"arrow-up",backward:"arrow-down"},E:{forward:"arrow-right",backward:"arrow-left"},S:{forward:"arrow-down",backward:"arrow-up"},W:{forward:"arrow-left",backward:"arrow-right"}},ae=(e,t)=>0===e[t.y][t.x],re=e=>e.x>=0&&e.x<10&&e.y>=0&&e.y<10,ne=(e,t,a,r)=>{const n=e[t];return((e,t,a)=>{if(!re(t))return!1;const r=ee[e.type]-1;switch(a){case"N":return re({x:t.x,y:t.y-r});case"E":return re({x:t.x+r,y:t.y});case"S":return re({x:t.x,y:t.y+r});case"W":return re({x:t.x-r,y:t.y})}})(n,a,r)?!!((e,t,a,r)=>{const n=Array(10).fill(0).map(e=>Array(10).fill(0));for(let c=0,o=e.length;c<o;++c){const a=e[c];if(t!==a)switch(a.direction){case"N":for(let e=0;e<ee[a.type];++e)n[a.position.y-e][a.position.x]+=1;break;case"E":for(let e=0;e<ee[a.type];++e)n[a.position.y][a.position.x+e]+=1;break;case"S":for(let e=0;e<ee[a.type];++e)n[a.position.y+e][a.position.x]+=1;break;case"W":for(let e=0;e<ee[a.type];++e)n[a.position.y][a.position.x-e]+=1}}if(!ae(n,a))return!1;switch(r){case"N":for(let e=0;e<ee[t.type];++e)if(!ae(n,{x:a.x,y:a.y-e}))return!1;break;case"E":for(let e=0;e<ee[t.type];++e)if(!ae(n,{x:a.x+e,y:a.y}))return!1;break;case"S":for(let e=0;e<ee[t.type];++e)if(!ae(n,{x:a.x,y:a.y+e}))return!1;break;case"W":for(let e=0;e<ee[t.type];++e)if(!ae(n,{x:a.x-e,y:a.y}))return!1}return!0})(e,n,a,r)||(console.debug("[Seabattle] Boat blocked by collision"),!1):(console.debug("[Seabattle] Boat blocked by zone"),!1)},ce=["dj","seabattle"],oe=(e,t)=>{const a={};return[...e,...t].forEach(({id:e,provider:t,type:r},n)=>{a[n]={id:e,provider:t,type:r}}),a},ie=(e,t,a)=>{if(t<0||t>=e.length)throw new Error("Media index is out of range");const r={},n=[...e];return n.splice(t,a),n.forEach(({id:e,provider:t,type:a},n)=>{r[n]={id:e,provider:t,type:a}}),r},se=(e,t)=>{switch(t){case"blind":case"dj":return"";case"seabattle":return Object(X.b)((e=>(console.debug("[SeaBattle] Genering battle",{userId:e}),{players:{[e]:{fleet:[{type:"boat1",direction:"E",position:{x:0,y:0},status:"ok"},{type:"boat1",direction:"E",position:{x:1,y:0},status:"ko"},{type:"boat2",direction:"E",position:{x:0,y:1},status:"ok"},{type:"boat2",direction:"E",position:{x:2,y:1},status:"ko"},{type:"boat3",direction:"E",position:{x:0,y:2},status:"ok"},{type:"boat3",direction:"E",position:{x:3,y:2},status:"ko"}],hits:[{position:{x:0,y:1},type:"hitted1"},{position:{x:0,y:2},type:"hitted2"},{position:{x:0,y:3},type:"missed1"},{position:{x:0,y:4},type:"missed2"}],weapons:[{count:1,position:{x:0,y:5},type:"mine"}]},player2:{fleet:[{type:"boat1",direction:"E",position:{x:0,y:0},status:"ok"},{type:"boat1",direction:"E",position:{x:1,y:0},status:"ko"},{type:"boat2",direction:"E",position:{x:0,y:1},status:"ok"},{type:"boat2",direction:"E",position:{x:2,y:1},status:"ko"},{type:"boat3",direction:"E",position:{x:0,y:2},status:"ok"},{type:"boat3",direction:"E",position:{x:3,y:2},status:"ko"}],hits:[{position:{x:0,y:1},type:"hitted1"},{position:{x:0,y:2},type:"hitted2"},{position:{x:0,y:3},type:"missed1"},{position:{x:0,y:4},type:"missed2"}],weapons:[{count:1,position:{x:0,y:5},type:"mine"}]}}}))(e))}};var le=a(22);a(92);const ue={appIDs:"test-rl-7ffe8".split("|")};const de={},pe=ue.appIDs[0],me=(e=pe)=>{let t=de[e];if(!t){console.debug("[Firebase] Creating app",{appId:e});const a="https://".concat(e,".firebaseio.com"),r=le.initializeApp({databaseURL:a}),n=le.database(r);de[e]=t={app:r,database:n,members:n.ref("members"),rooms:n.ref("rooms"),users:n.ref("users")}}return t},be=({id:e,secret:t})=>{const a=me(),r=a.rooms.child(e),o=r.child("info"),i=a.members.child(e);let s=t||"";return{id:e,isLocked:()=>!s,setSecret:e=>{console.debug("[Firebase] Setting room secret",{oldSecret:s,newSecret:e}),s=e},wait:function(){var e=Object(c.a)(n.a.mark((function e(){return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((e,t)=>{console.debug("[Firebase] Waiting room..."),o.once("value",a=>{const r=a.val();r?e(r):t(new Error("rooms.errors.invalid"))})}));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),subscribe:e=>(console.debug("[Firebase] Subscribing room..."),o.on("value",e)),subscribeMembers:(e,t)=>{console.debug("[Firebase] Subscribing members..."),i.on("child_added",e),i.on("child_removed",t)},unsubscribe:e=>{console.debug("[Firebase] Unsubscribing room..."),o.off("value",e)},unsubscribeMembers:(e,t)=>{console.debug("[Firebase] Unsubscribing members..."),i.off("child_added",e),i.off("child_removed",t)},update:function(){var e=Object(c.a)(n.a.mark((function e({extra:t,name:a,playing:c,playmode:o,queue:i,queue_position:l,type:u}){return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.debug("[Firebase] Updating room...",{extra:!!t,name:a,playing:c,playmode:o,queue:i,queue_position:l}),e.next=3,r.set({info:{extra:t,name:a,playing:c,playmode:o,queue:i,queue_position:l,timestamp:le.database.ServerValue.TIMESTAMP,type:u},secret:s});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}},fe=({id:e,secret:t})=>{const a=me().users.child(e),r=a.child("info");let o=null,i=t||"",s={name:"dummy",online:!1,room_id:"",status:"",timestamp:0};const l=function(){var e=Object(c.a)(n.a.mark((function e(){return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((e,t)=>{console.debug("[Firebase] Waiting user..."),r.once("value",a=>{const r=a.val();r?(s=r,e(r)):t(new Error("users.errors.invalid"))})}));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),u=function(){var e=Object(c.a)(n.a.mark((function e({name:t,room_id:r}){return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.debug("[Firebase] Updating user...",{name:t,room_id:r}),void 0!==t&&(s.name=t),void 0!==r&&(s.room_id=r),e.next=5,a.set({info:Object(D.a)({},s,{online:!0,status:"online",timestamp:le.database.ServerValue.TIMESTAMP}),secret:i});case 5:d();case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),d=()=>{console.debug("[Firebase] Installing user disconnect..."),a.onDisconnect().cancel(),a.onDisconnect().set({info:Object(D.a)({},s,{online:!1,room_id:"",status:"disconnected",timestamp:le.database.ServerValue.TIMESTAMP}),secret:i})};return{id:e,enter:function(){var t=Object(c.a)(n.a.mark((function t(a){var r;return n.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=me(),!o){t.next=5;break}return t.next=4,o.remove();case 4:o=null;case 5:return t.next=7,u({room_id:a.id});case 7:return o=r.members.child(a.id).child(e),o.onDisconnect().remove(),t.next=11,o.set({timestamp:le.database.ServerValue.TIMESTAMP});case 11:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),exit:function(){var e=Object(c.a)(n.a.mark((function e(){return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!o){e.next=4;break}return e.next=3,o.remove();case 3:o=null;case 4:return e.next=6,u({room_id:""});case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),isLocked:()=>!i,setSecret:e=>{console.debug("[Firebase] Setting user secret...",{oldSecret:i,newSecret:e}),i=e},wait:l,subscribe:e=>(console.debug("[Firebase] Subscribing user..."),r.on("value",e)),unsubscribe:e=>{console.debug("[Firebase] Unsubscribing user..."),r.off("value",e)},update:u}},ye=[{label:"medias.albums",provider:"deezer",type:"album"},{label:"medias.playlists",provider:"deezer",type:"playlist"},{label:"medias.tracks",provider:"deezer",type:"track"}],ve=(e,t)=>t[e.provider][e.type][e.id],ke=(e,t,a)=>ve(e,t)||((e,t)=>t.find(t=>t.id===e.id&&t.provider===e.provider&&t.type===e.type))(e,a),he=(e,t,a)=>{const r=ke(e,t,a);return r?"track"===r.type?r:r.tracks&&r.tracks.length>0?r.tracks[0]:null:null},ge=(e,t,a)=>{const r=[];var n,c=Object(L.a)(e);try{for(c.s();!(n=c.n()).done;){const e=n.value;if("track"===e.type){r.push({contextId:e.id,contextType:e.type,id:e.id,provider:e.provider,type:e.type});continue}const c=ke(e,t,a);if(!c)throw new Error("Media is unknown");if("track"!==c.type&&c.tracks&&c.tracks.length>0){var o,i=Object(L.a)(c.tracks);try{for(i.s();!(o=i.n()).done;){const e=o.value;r.push({contextId:c.id,contextType:c.type,id:e.id,provider:e.provider,type:e.type})}}catch(s){i.e(s)}finally{i.f()}}}}catch(s){c.e(s)}finally{c.f()}return r},Ee=(e,t,a)=>{if(t<0)throw new Error("Track index is out of range");let r=0;for(let n=0;n<e.length;++n){const c=e[n];if("track"===c.type){if(t===r)return{mediaFirstTrackIndex:t,mediaIndex:n,mediaSize:1};r++}else{const e=ve(c,a);if(!e)throw new Error("Media is unknown");if("track"!==e.type&&e.tracks&&e.tracks.length>0){const a=r;for(let c=0;c<e.tracks.length;++c){if(t===r)return{mediaFirstTrackIndex:a,mediaIndex:n,mediaSize:e.tracks.length};r++}}}}throw new Error("Track index is out of range")},xe=e=>e.response&&e.response.data&&e.response.data.message?e.response.data.message:e.message;var Oe=a(39);const je=function(){var e=Object(c.a)(n.a.mark((function e(t){var a,r,c,o,i,s;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Oe.read(t);case 2:return a=e.sent,e.next=5,a.resize(1,1).getPixelColor(0,0);case 5:return r=e.sent,c=Oe.intToRGBA(r),o=c.r,i=c.g,s=c.b,e.abrupt("return",{r:o,g:i,b:s});case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),we={},Se={bg:{r:255,g:255,b:255},fg:"dark"},Ce=function(){var e=Object(c.a)(n.a.mark((function e(t){var a,r,c,o,i;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=Se,!t){e.next=18;break}if(a=we[t]){e.next=18;break}return e.prev=4,e.next=7,je(t);case 7:r=e.sent,c=r.r,o=r.g,i=r.b,we[t]=a={bg:{r:c,g:o,b:i},fg:.299*c+.587*o+.114*i>186?"dark":"light"},e.next=18;break;case 14:e.prev=14,e.t0=e.catch(4),console.error("An error prevented colorpicking",e.t0),we[t]=a=Se;case 18:return e.abrupt("return",a);case 19:case"end":return e.stop()}}),e,null,[[4,14]])})));return function(t){return e.apply(this,arguments)}}(),_e=e=>new Promise(t=>setTimeout(t,e));var Ne=a(58),Me=a.n(Ne);const Re="https://www.deezer.com",Pe=e=>({artist:{id:e.artist.id.toString(),name:e.artist.name,link:"".concat(Re,"/artist/").concat(e.artist.id),picture_big:e.artist.picture_big,picture_small:e.artist.picture_small},id:e.id.toString(),link:"".concat(Re,"/album/").concat(e.id),picture_big:e.cover_big,picture_small:e.cover_small,provider:"deezer",title:e.title,tracks:void 0!==e.tracks?e.tracks.data.filter(e=>e.readable&&e.preview).map(t=>Le(t,e)):[],type:"album"}),Te=(e,t)=>({id:e.id.toString(),link:"".concat(Re,"/playlist/").concat(e.id),picture_big:e.picture_big,picture_small:e.picture_small,provider:"deezer",title:e.title,tracks:void 0!==e.tracks?e.tracks.data.filter(e=>e.readable&&e.preview).map(e=>Le(e,e.album)):[],type:"playlist",user:{id:t.id.toString(),link:"".concat(Re,"/profile/").concat(t.id),name:t.name}}),Le=(e,t)=>({album:{id:t.id.toString(),link:"".concat(Re,"/album/").concat(t.id),title:t.title,picture_big:t.cover_big,picture_small:t.cover_small},artist:{id:e.artist.id.toString(),name:e.artist.name,link:"".concat(Re,"/artist/").concat(e.artist.id),picture_big:e.artist.picture_big,picture_small:e.artist.picture_small},duration:e.duration,id:e.id.toString(),link:"".concat(Re,"/track/").concat(e.id),preview:e.preview,provider:"deezer",title:e.title,type:"track"}),Ae=(()=>{const e=(e,t)=>(console.debug("[Deezer] Requesting... ",{path:e,qs:t}),((e,t)=>new Promise((a,r)=>{Me()(t?"".concat(e,"?").concat(t,"&output=jsonp&callback="):"".concat(e,"?output=jsonp&callback="),void 0,(e,t)=>{e?r(new Error(e.message)):a(t)})}))("".concat("https://api.deezer.com","/").concat(e),t)),t=(t,a,r)=>e("search/".concat(t),"q=".concat(encodeURIComponent(a)).concat(r&&r.limit?"&limit=".concat(r.limit):"")),a=function(){var t=Object(c.a)(n.a.mark((function t(a,r){var o,i,s;return n.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=[],i=[],s=[],t.next=5,Promise.all(r.map(function(){var t=Object(c.a)(n.a.mark((function t(r){var c;return n.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e("".concat(a,"/").concat(r));case 2:if((c=t.sent).error){t.next=6;break}return s.push(c),t.abrupt("return");case 6:if(4!==c.error.code){t.next=9;break}return o.push(r),t.abrupt("return");case 9:console.error("[Deezer] An error occured while loading ".concat(a,":"),c.error),i.push(r);case 11:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()));case 5:return t.abrupt("return",{delayedIds:o,failedIds:i,loadedMedias:s});case 6:case"end":return t.stop()}}),t)})));return function(e,a){return t.apply(this,arguments)}}(),r=function(){var e=Object(c.a)(n.a.mark((function e(t,r){var c,o,i,s,l,u;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:c=!0,o=[],i=[...r];case 3:if(!(i.length>0)){e.next=18;break}if(c){e.next=8;break}return console.debug("[Deezer] Handling rate limit delayed batch...",{remainingIds:i}),e.next=8,_e(5e3);case 8:return e.next=10,a(t,i);case 10:s=e.sent,l=s.delayedIds,u=s.loadedMedias,o.push(...u),i=l,c=!1,e.next=3;break;case 18:return e.abrupt("return",o);case 19:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}();return{searchAlbums:function(){var e=Object(c.a)(n.a.mark((function e(a,r){return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==a.trim().length){e.next=2;break}return e.abrupt("return",[]);case 2:return e.next=4,t("album",a,r);case 4:return e.abrupt("return",e.sent.data.map(Pe));case 5:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),searchPlaylists:function(){var e=Object(c.a)(n.a.mark((function e(a,r){return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==a.trim().length){e.next=2;break}return e.abrupt("return",[]);case 2:return e.next=4,t("playlist",a,r);case 4:return e.abrupt("return",e.sent.data.filter(e=>e.public).map(e=>Te(e,e.user)));case 5:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),searchTracks:function(){var e=Object(c.a)(n.a.mark((function e(a,r){return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==a.trim().length){e.next=2;break}return e.abrupt("return",[]);case 2:return e.next=4,t("track",a,r);case 4:return e.abrupt("return",e.sent.data.filter(e=>e.readable&&e.preview).map(e=>Le(e,e.album)));case 5:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),loadAlbums:function(){var e=Object(c.a)(n.a.mark((function e(t){var a;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==t.length){e.next=2;break}return e.abrupt("return",[]);case 2:return console.debug("[Deezer] Loading albums...",{ids:t}),e.next=5,r("album",t);case 5:return a=e.sent,e.abrupt("return",a.map(Pe));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),loadPlaylists:function(){var e=Object(c.a)(n.a.mark((function e(t){var a;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==t.length){e.next=2;break}return e.abrupt("return",[]);case 2:return console.debug("[Deezer] Loading playlists...",{ids:t}),e.next=5,r("playlist",t);case 5:return a=e.sent,e.abrupt("return",a.map(e=>Te(e,e.creator)));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),loadTracks:function(){var e=Object(c.a)(n.a.mark((function e(t){var a;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==t.length){e.next=2;break}return e.abrupt("return",[]);case 2:return console.debug("[Deezer] Loading tracks...",{ids:t}),e.next=5,r("track",t);case 5:return a=e.sent,e.abrupt("return",a.map(e=>Le(e,e.album)));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}})(),Ie=function(){var e=Object(c.a)(n.a.mark((function e(t){var a,r,c,o,i,s,l,u,d;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a={deezer:{album:[],playlist:[],track:[]}},r=Object(L.a)(t);try{for(r.s();!(c=r.n()).done;)o=c.value,a[o.provider][o.type].push(o.id)}catch(n){r.e(n)}finally{r.f()}return e.next=5,Ae.loadAlbums(a.deezer.album);case 5:return e.t0=e.sent,e.next=8,Ae.loadPlaylists(a.deezer.playlist);case 8:return e.t1=e.sent,e.next=11,Ae.loadTracks(a.deezer.track);case 11:e.t2=e.sent,e.t3={album:e.t0,playlist:e.t1,track:e.t2},i={deezer:e.t3},s=[],l=Object(L.a)(t);try{for(l.s();!(u=l.n()).done;)o=u.value,(d=i[o.provider][o.type].find(e=>e.id===o.id))&&s.push(d)}catch(n){l.e(n)}finally{l.f()}return e.abrupt("return",s);case 18:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ze=function(){var e=Object(c.a)(n.a.mark((function e(t,a){var r,c,o,i,s,l;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.filter(e=>!a[e.provider][e.type][e.id]).filter((e,t,a)=>t===a.findIndex(t=>t.id===e.id&&t.provider===e.provider&&t.type===e.type)),e.next=3,Ie(r);case 3:c=e.sent,o=[],i=Object(L.a)(c);try{for(i.s();!(s=i.n()).done;)l=s.value,o.push(l),"track"!==l.type&&o.push(...l.tracks)}catch(n){i.e(n)}finally{i.f()}return e.abrupt("return",{newMedias:c,newMediasAndTracks:o});case 8:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),Be=function(){var e=Object(c.a)(n.a.mark((function e(t,a,r){var c,o,i,s,l,u;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r){e.next=9;break}return e.next=3,Promise.all([Ae.searchAlbums(t,a),Ae.searchPlaylists(t,a),Ae.searchTracks(t,a)]);case 3:return c=e.sent,o=Object(V.a)(c,3),i=o[0],s=o[1],l=o[2],e.abrupt("return",{deezer:{album:i,playlist:s,track:l}});case 9:u={deezer:{album:[],playlist:[],track:[]}},e.t0=r,e.next="album"===e.t0?13:"playlist"===e.t0?17:"track"===e.t0?21:25;break;case 13:return e.next=15,Ae.searchAlbums(t,a);case 15:return u.deezer.album=e.sent,e.abrupt("break",25);case 17:return e.next=19,Ae.searchPlaylists(t,a);case 19:return u.deezer.playlist=e.sent,e.abrupt("break",25);case 21:return e.next=23,Ae.searchTracks(t,a);case 23:return u.deezer.track=e.sent,e.abrupt("break",25);case 25:return e.abrupt("return",u);case 26:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}(),Fe=e=>S("medias/SET",e),We={error:null,fetching:!1,medias:{deezer:{album:{},playlist:{},track:{}}}},Ue=e=>S("room/SET",e),qe={access:{id:"",secret:""},color:{fg:"dark",bg:{r:255,g:255,b:255}},error:null,fetching:!1,info:null,medias:[],room:null,tracks:[]},De=[];let Ve=null;const He=()=>(Ve||(console.debug("[Audio] Creating context"),Ve=new(window.AudioContext||window.webkitAudioContext)),Ve),Xe=()=>He().currentTime,Ge=e=>new Promise((t,a)=>He().decodeAudioData(e,t,a)),Qe=e=>new Promise((t,a)=>{const r=new XMLHttpRequest;r.open("GET",e,!0),r.responseType="arraybuffer",r.addEventListener("error",()=>a(new Error("audio.errors.cannot_load_audio_buffer")),!1),r.addEventListener("load",Object(c.a)(n.a.mark((function c(){return n.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.t0=t,n.next=4,Ge(r.response);case 4:n.t1=n.sent,(0,n.t0)(n.t1),n.next=12;break;case 8:n.prev=8,n.t2=n.catch(0),console.debug("[Audio] An error occurred while decoding data",{error:n.t2,url:e}),a(new Error("audio.errors.cannot_decode_audio_data"));case 12:case"end":return n.stop()}}),c,null,[[0,8]])}))),!1),r.send()}),Je=function(){var e=Object(c.a)(n.a.mark((function e(t){var a,r;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new Error("URL is invalid");case 2:if(a=null,!((r=De.findIndex(e=>e.url===t))>=0)){e.next=9;break}console.debug("[Audio] Reusing cached buffer...",{url:t}),a=De.splice(r,1)[0].buffer,e.next=13;break;case 9:return console.debug("[Audio] Loading buffer...",{url:t}),e.next=12,Qe(t);case 12:a=e.sent;case 13:return De.push({buffer:a,url:t}),De.splice(10),e.abrupt("return",a);case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();(()=>{const e=()=>{document.removeEventListener("click",e),document.removeEventListener("touchstart",e),console.debug("[Audio] Fixing context...");const t=He();var a=t.createBuffer(1,1,22050),r=t.createBufferSource();r.buffer=a,r.connect(t.destination),r.start(0)};document.addEventListener("click",e),document.addEventListener("touchstart",e)})();const Ze=()=>Math.floor(1e6*Math.random()),Ye=()=>{let e=null,t=null,a=null,r=0,o=null,i=0,s="",l=-1;const u=()=>(a||(a=He().destination,t=He().createGain(),t.gain.value=1,t.connect(a),a=t,e=He().createAnalyser(),e.fftSize=128,e.connect(a),a=e),a),d=function(){var e=Object(c.a)(n.a.mark((function e(t,a,c,d,m){var b;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p();case 2:return e.next=4,Je(c);case 4:b=e.sent,console.debug("[Player] Starting audio...",{trackPosition:t,trackId:a,trackUrl:c}),r=b.duration,s=a,l=t,o=He().createBufferSource(),o.buffer=b,o.loop=!1,o.loopStart=0,o.loopEnd=0,o.onended=()=>{console.debug("[Player] Audio terminated..."),r=0,o=null,i=0,s="","shuffle"===(null===m||void 0===m?void 0:m.playmode)?l+=Ze():l++},o.playbackRate.value=1,o.connect(u()),o.start(0,d),i=Xe();case 19:case"end":return e.stop()}}),e)})));return function(t,a,r,n,c){return e.apply(this,arguments)}}(),p=()=>new Promise(e=>{null!==o?(console.debug("[Player] Stopping play..."),o.onended=()=>{console.debug("[Player] Forced audio termination..."),e()},o.stop(),r=0,o=null,i=0,s="",l=-1):e()});return{getPlayingTrackID:()=>s,getPlayingTrackPercent:()=>o?(Xe()-i)/r:0,getPlayingTrackPosition:()=>l,isPlaying:()=>!!o,play:d,stop:p}},Ke=Ye(),$e=Ye(),et=e=>function(){var t=Object(c.a)(n.a.mark((function t(a){return n.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",a(M("info",{duration:5e3,extra:()=>W(e),weight:1e3})));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),tt=e=>function(){var t=Object(c.a)(n.a.mark((function t(a,r){var c,o,i,s,l;return n.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,c=r(),o=c.medias.medias,t.next=4,ze([e],o);case 4:if(i=t.sent,s=i.newMedias,l=he(e,o,s)){t.next=9;break}throw new Error("[Medias] Cannot find track to preview...");case 9:return console.debug("[Medias] Previewing track...",{track:l}),t.next=12,$e.play(0,l.id,l.preview,0);case 12:t.next=17;break;case 14:t.prev=14,t.t0=t.catch(0),a(R(xe(t.t0)));case 17:case"end":return t.stop()}}),t,null,[[0,14]])})));return function(e,a){return t.apply(this,arguments)}}();var at=a(10),rt=Object(at.b)();const nt={dj:{playing:!1,playmode:"default",queue:{}},seabattle:{playing:!0,playmode:"shuffle",queue:{0:{id:"301013",provider:"deezer",type:"album"},1:{id:"7358507",provider:"deezer",type:"album"},2:{id:"558976",provider:"deezer",type:"album"},3:{id:"87375582",provider:"deezer",type:"album"}}}},ct=(e,t,a)=>function(){var r=Object(c.a)(n.a.mark((function r(c,o){var i,s,l;return n.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(i=o(),s=i.user.access.id){r.next=4;break}return c(R("users.not_connected")),r.abrupt("return");case 4:return r.prev=4,l=Object(H.a)(),console.debug("[Room] Creating...",{id:l,secret:t}),r.next=9,be({id:l,secret:t}).update(Object(D.a)({extra:se(s,a),name:e,queue_position:0,type:a},nt[a]));case 9:c(ot(l,t)),r.next=15;break;case 12:r.prev=12,r.t0=r.catch(4),c(R(xe(r.t0)));case 15:case"end":return r.stop()}}),r,null,[[4,12]])})));return function(e,t){return r.apply(this,arguments)}}(),ot=(e,t)=>function(){var a=Object(c.a)(n.a.mark((function a(r,c){var o,i,s;return n.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(o=c(),!(i=o.room.room)||i.id!==e){a.next=3;break}return a.abrupt("return");case 3:return r(it()),a.prev=4,console.debug("[Room] Entering...",{id:e,secret:t}),s=be({id:e,secret:t}),a.t0=r,a.t1=Ue,a.t2={id:e,secret:t},a.t3=s,a.next=13,s.wait();case 13:a.t4=a.sent,a.t5={access:a.t2,room:a.t3,info:a.t4},a.t6=(0,a.t1)(a.t5),(0,a.t0)(a.t6),r(dt(s)),rt.push("/room/".concat(e,"?secret=").concat(t)),a.next=24;break;case 21:a.prev=21,a.t7=a.catch(4),r(R(xe(a.t7)));case 24:case"end":return a.stop()}}),a,null,[[4,21]])})));return function(e,t){return a.apply(this,arguments)}}(),it=()=>function(){var e=Object(c.a)(n.a.mark((function e(t,a){var r,c;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=a(),c=r.room.room){e.next=3;break}return e.abrupt("return");case 3:console.debug("[Room] Exiting..."),t(yt()),t(pt(c)),t(S("room/RESET"));case 7:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),st=()=>function(){var e=Object(c.a)(n.a.mark((function e(t,a){var r,c,o,i,s,l;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=a(),c=r.room,o=c.room,i=c.access,s=i.id,l=i.secret,o&&o.id===s&&l){e.next=3;break}return e.abrupt("return");case 3:console.debug("[Room] Locking...",{id:s}),o.setSecret(""),t(Ue({access:{id:s,secret:""}}));case 6:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),lt=e=>function(){var t=Object(c.a)(n.a.mark((function t(a,r){var c,o,i,s,l,u;return n.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(c=r(),o=c.room,i=o.room,s=o.access,l=s.id,u=s.secret,i&&i.id===l&&u!==e){t.next=3;break}return t.abrupt("return");case 3:console.debug("[Room] Unlocking...",{id:l,secret:e}),i.setSecret(e),a(Ue({access:{id:l,secret:e}}));case 6:case"end":return t.stop()}}),t)})));return function(e,a){return t.apply(this,arguments)}}();let ut=null;const dt=e=>function(){var t=Object(c.a)(n.a.mark((function t(a,r,{player:o}){return n.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(console.debug("[Room] Watching..."),!ut){t.next=3;break}return t.abrupt("return");case 3:ut=e.subscribe(function(){var t=Object(c.a)(n.a.mark((function t(c){var i,s,l,u,d,p,m,b;return n.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=r(),s=i.medias.medias,l=c.val(),console.debug("[Room] Received room update...",{newInfo:l}),l){t.next=5;break}return t.abrupt("return");case 5:if(u=[],l.queue&&(u=Object.entries(l.queue).sort((e,t)=>Number(e[0])-Number(t[0])).map(e=>e[1])),l.playing!==o.isPlaying()&&(l.playing?(mt&&console.debug("************ ARG ************"),a(ft())):a(yt())),d=[],!(u.length>0)){t.next=17;break}return t.next=12,ze(u,s);case 12:p=t.sent,m=p.newMedias,(b=p.newMediasAndTracks).length>0&&a(Fe(b)),d=ge(u,s,m);case 17:a(Ue({info:l,medias:u,room:e,tracks:d}));case 18:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());case 4:case"end":return t.stop()}}),t)})));return function(e,a,r){return t.apply(this,arguments)}}(),pt=e=>Object(c.a)(n.a.mark((function t(){return n.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(ut){t.next=2;break}return t.abrupt("return");case 2:console.debug("Unwatching room..."),e.unsubscribe(ut),ut=null;case 5:case"end":return t.stop()}}),t)})));let mt=null;const bt=(e,t,a)=>{let r=-1;const n=e.getPlayingTrackID(),c=e.getPlayingTrackPosition()%t.length;return c!==a?e.isPlaying()?n!==t[a].id&&(r=a):r=c>=0?c:a:n!==t[a].id&&(r=a),r},ft=()=>function(){var e=Object(c.a)(n.a.mark((function e(t,a,{player:r}){return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:mt||(console.debug("[Room] Watching player... ********************"),vt(t,a,r,250));case 1:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}(),yt=()=>function(){var e=Object(c.a)(n.a.mark((function e(t,a,{player:r}){return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return mt&&(console.debug("[Room] Unwatching player... ********************"),clearTimeout(mt),mt=null),e.next=3,r.stop();case 3:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}(),vt=(e,t,a,r)=>{mt=setTimeout(Object(c.a)(n.a.mark((function c(){var o,i,s,l,u,d,p,m,b,f,y;return n.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(o=t(),i=o.room,s=i.info,l=i.tracks,u=o.medias.medias,0!==l.length){n.next=8;break}return console.debug("[Room] No more tracks in queue..."),e(Ue({info:Object(D.a)({},s,{playing:!1})})),n.next=6,a.stop();case 6:return mt=null,n.abrupt("return");case 8:if(!((d=bt(a,l,s.queue_position))>=0)){n.next=26;break}return p=l[d],m=u[p.provider][p.type][p.id],console.debug("Detected play change...",{nextTrack:m,nextTrackIndex:d}),n.prev=13,n.next=16,Promise.all([Ce(m.album.picture_small),a.play(d,m.id,m.preview,0,{playmode:s.playmode})]);case 16:b=n.sent,f=Object(V.a)(b,1),y=f[0],e(et(m)),e(Ue({color:y,info:Object(D.a)({},s,{queue_position:d})})),n.next=26;break;case 23:n.prev=23,n.t0=n.catch(13),e(R(xe(n.t0)));case 26:vt(e,t,a,r);case 27:case"end":return n.stop()}}),c,null,[[13,23]])}))),r)},kt=()=>function(){var e=Object(c.a)(n.a.mark((function e(t,a){var r,c,o,i;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=a(),c=r.room,o=c.info,(i=c.room)&&!i.isLocked()&&o){e.next=4;break}return t(R("rooms.error.locked")),e.abrupt("return");case 4:if(!o.playing){e.next=6;break}return e.abrupt("return");case 6:return e.prev=6,console.debug("[Player] Starting..."),e.next=10,i.update(Object(D.a)({},o,{playing:!0}));case 10:e.next=16;break;case 12:e.prev=12,e.t0=e.catch(6),t(R(xe(e.t0))),t(st());case 16:case"end":return e.stop()}}),e,null,[[6,12]])})));return function(t,a){return e.apply(this,arguments)}}(),ht=()=>function(){var e=Object(c.a)(n.a.mark((function e(t,a){var r,c,o,i;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=a(),c=r.room,o=c.info,(i=c.room)&&!i.isLocked()&&o){e.next=4;break}return t(R("rooms.error.locked")),e.abrupt("return");case 4:if(o.playing){e.next=6;break}return e.abrupt("return");case 6:return e.prev=6,console.debug("[Player] Stopping..."),e.next=10,i.update(Object(D.a)({},o,{playing:!1}));case 10:e.next=16;break;case 12:e.prev=12,e.t0=e.catch(6),t(R(xe(e.t0))),t(st());case 16:case"end":return e.stop()}}),e,null,[[6,12]])})));return function(t,a){return e.apply(this,arguments)}}(),gt=()=>function(){var e=Object(c.a)(n.a.mark((function e(t,a){var r,c,o,i;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=a(),c=r.room,o=c.info,(i=c.room)&&!i.isLocked()&&o){e.next=4;break}return t(R("rooms.error.locked")),e.abrupt("return");case 4:return e.prev=4,console.debug("[Queue] Clearing medias..."),e.next=8,i.update(Object(D.a)({},o,{playing:!1,queue:{},queue_position:0}));case 8:e.next=14;break;case 10:e.prev=10,e.t0=e.catch(4),t(R(xe(e.t0))),t(st());case 14:case"end":return e.stop()}}),e,null,[[4,10]])})));return function(t,a){return e.apply(this,arguments)}}(),Et=e=>function(){var t=Object(c.a)(n.a.mark((function t(a,r){var c,o,i,s,l;return n.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(c=r(),o=c.room,i=o.info,s=o.medias,(l=o.room)&&!l.isLocked()&&i){t.next=4;break}return a(R("rooms.error.locked")),t.abrupt("return");case 4:if(0!==e.length){t.next=6;break}return t.abrupt("return");case 6:return t.prev=6,console.debug("[Queue] Appending medias...",{newMedias:e}),t.next=10,l.update(Object(D.a)({},i,{queue:oe(s,e)}));case 10:t.next=16;break;case 12:t.prev=12,t.t0=t.catch(6),a(R(xe(t.t0))),a(st());case 16:case"end":return t.stop()}}),t,null,[[6,12]])})));return function(e,a){return t.apply(this,arguments)}}(),xt=e=>function(){var t=Object(c.a)(n.a.mark((function t(a,r){var c,o,i,s,l,u,d,p,m,b,f,y,v;return n.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(c=r(),o=c.medias.medias,i=c.room,s=i.info,l=i.medias,u=i.room,d=i.tracks,u&&!u.isLocked()&&s){t.next=4;break}return a(R("rooms.error.locked")),t.abrupt("return");case 4:if(p=Ee(l,e,o),m=p.mediaFirstTrackIndex,b=p.mediaIndex,f=p.mediaSize,!(b<0)){t.next=7;break}return t.abrupt("return");case 7:if(y=s.queue_position,t.prev=8,console.debug("[Queue] Removing track...",{playingTrackIndex:y,removedMediaIndex:b,removedTrackCount:f,removedTrackIndex:e,removedMediaFirstTrackIndex:m}),v=ie(l,b,1),0!==Object.keys(v).length){t.next=17;break}return console.debug("[Queue] Removing last media..."),t.next=15,u.update(Object(D.a)({},s,{playing:!1,queue:{},queue_position:0}));case 15:t.next=29;break;case 17:if(!(y<e)){t.next=22;break}return t.next=20,u.update(Object(D.a)({},s,{queue:v}));case 20:t.next=29;break;case 22:if(!(y>=m&&y<m+f)){t.next=27;break}return t.next=25,u.update(Object(D.a)({},s,{queue:v,queue_position:m+f===d.length?m-1:m}));case 25:t.next=29;break;case 27:return t.next=29,u.update(Object(D.a)({},s,{queue:v,queue_position:y-f}));case 29:t.next=35;break;case 31:t.prev=31,t.t0=t.catch(8),a(R(xe(t.t0))),a(st());case 35:case"end":return t.stop()}}),t,null,[[8,31]])})));return function(e,a){return t.apply(this,arguments)}}(),Ot=e=>function(){var t=Object(c.a)(n.a.mark((function t(a,r){var c,o,i,s,l;return n.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(c=r(),o=c.room,i=o.info,(s=o.room)&&!s.isLocked()&&i){t.next=4;break}return a(R("rooms.error.locked")),t.abrupt("return");case 4:if((l=i.queue_position)!==e){t.next=7;break}return t.abrupt("return");case 7:return t.prev=7,console.debug("[Queue] Set position...",{oldTrackIndex:l,newTrackIndex:e}),t.next=11,s.update(Object(D.a)({},i,{playing:!0,queue_position:e}));case 11:t.next=17;break;case 13:t.prev=13,t.t0=t.catch(7),a(R(xe(t.t0))),a(st());case 17:case"end":return t.stop()}}),t,null,[[7,13]])})));return function(e,a){return t.apply(this,arguments)}}(),jt=()=>function(){var e=Object(c.a)(n.a.mark((function e(t,a){var r,c,o,i;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=a(),c=r.room,o=c.info,i=c.tracks,o&&0!==i.length){e.next=3;break}return e.abrupt("return");case 3:console.debug("[Queue] Moving backward..."),t(Ot(o.queue_position>0?o.queue_position-1:i.length-1));case 5:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),wt=()=>function(){var e=Object(c.a)(n.a.mark((function e(t,a){var r,c,o,i;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=a(),c=r.room,o=c.info,i=c.tracks,o&&0!==i.length){e.next=3;break}return e.abrupt("return");case 3:"shuffle"===o.playmode?(console.debug("[Queue] Randomizing next track..."),t(Ot(Ze()%i.length))):(console.debug("[Queue] Moving forward..."),t(Ot((o.queue_position+1)%i.length)));case 4:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),St=e=>S("modals/OPEN",e),Ct=()=>S("modals/POP"),_t={stack:[]};a(97);const Nt=()=>{const e=Object(l.b)(),t=Object(l.c)(O),a=Object(l.c)(j),r=Object(l.c)(w),n=Object(l.c)(e=>null!==e.room.info?e.room.info.queue_position:0),c=Object(l.c)(A),s=Object(o.useCallback)(t=>{e(kt()),e(Ot(t))},[e]),u=Object(o.useCallback)(t=>e(xt(t)),[e]),d=Object(o.useCallback)(()=>e(St({type:"Search",props:null})),[e]),p=Object(o.useCallback)(()=>e(ht()),[e]);return i.a.createElement("div",{className:"Queue"},c.length>0?i.a.createElement(Rt,{locked:a,tracks:c,playing:r,playingIndex:n,onPlay:s,onRemove:u,onStop:p}):i.a.createElement(Mt,{loaded:t,locked:a,onSearch:d}))},Mt=i.a.memo(({loaded:e,locked:t,onSearch:a})=>{const r=Object(y.b)().t;return i.a.createElement("div",{className:"QueueEmpty"},e?i.a.createElement(i.a.Fragment,null,i.a.createElement(g,{title:"...",icon:"shower",onClick:a,size:"L"}),i.a.createElement("span",{onClick:a},r(t?"rooms.empty_for_now":"rooms.empty"))):i.a.createElement(i.a.Fragment,null,i.a.createElement(B,{size:"L"}),i.a.createElement("span",null,r("rooms.loading"))))}),Rt=i.a.memo(({locked:e,tracks:t,playing:a,playingIndex:r,onPlay:n,onRemove:c,onStop:o})=>i.a.createElement(i.a.Fragment,null,t.map((t,s)=>i.a.createElement(q,{key:s,locked:e,playing:a&&r===s,track:t,onPlay:()=>n(s),onRemove:()=>c(s),onStop:o}))));a(98);const Pt=()=>{const e=Object(o.useState)(0),t=Object(V.a)(e,2),a=t[0],r=t[1];return Object(o.useEffect)(()=>{const e=setInterval(()=>{r(Ke.getPlayingTrackPercent())},250);return()=>{clearInterval(e)}},[r]),i.a.createElement("div",{className:"Progress"},i.a.createElement("progress",{max:100,value:100*a}))};a(99);const Tt=()=>{const e=Object(l.b)(),t=Object(y.b)().t,a=Object(l.c)(e=>e.room.medias.length),r=Object(l.c)(j),n=Object(l.c)(w),c=Object(o.useCallback)(()=>{e(T(t("rooms.confirm_clear"),()=>{e(gt()),e(ht())}))},[e,t]),s=Object(o.useCallback)(()=>{e(T(t("rooms.confirm_lock"),()=>{e(st())}))},[e,t]),u=Object(o.useCallback)(()=>{e(St({type:"UnlockRoom",props:null}))},[e]),d=Object(o.useCallback)(()=>e(jt()),[e]),p=Object(o.useCallback)(()=>e(wt()),[e]),m=Object(o.useCallback)(()=>e(kt()),[e]),b=Object(o.useCallback)(()=>e(St({type:"Search",props:null})),[e]),f=Object(o.useCallback)(()=>e(ht()),[e]);return i.a.createElement("div",{className:"Controls"},i.a.createElement("div",{className:"ControlsInner"},i.a.createElement("div",{className:"ControlsSet PlayerControlsSet"},i.a.createElement("div",{className:"Control"},i.a.createElement(g,{disabled:r||0===a,icon:"step-backward",onClick:d,size:"M",title:t("player.backward")})),i.a.createElement("div",{className:"Control"},n?i.a.createElement(g,{disabled:r||0===a,onClick:f,icon:"pause",title:t("player.stop"),size:"L"}):i.a.createElement(g,{disabled:r||0===a,onClick:m,icon:"play",size:"L",title:t("player.play")})),i.a.createElement("div",{className:"Control"},i.a.createElement(g,{disabled:r||0===a,icon:"step-forward",onClick:p,size:"M",title:t("player.forward")}))),i.a.createElement(Pt,null),i.a.createElement("div",{className:"ControlsSet RoomControlsSet"},i.a.createElement("div",{className:"Control"},r?i.a.createElement(g,{icon:"lock",onClick:u,size:"M",title:t("rooms.locked")}):i.a.createElement(g,{icon:"unlock",onClick:s,size:"M",title:t("rooms.unlocked")})),i.a.createElement("div",{className:"Control"},i.a.createElement(g,{onClick:b,icon:"search",title:t("medias.search")})),i.a.createElement("div",{className:"Control"},i.a.createElement(g,{disabled:r||0===a,onClick:c,icon:"trash",title:t("rooms.clear")})))))},Lt=({boat:e,disabled:t=!1,onMoveBackward:a,onMoveForward:r,onRotateLeft:n,onRotateRight:c})=>{const s=Object(y.b)().t,u=Object(l.b)(),d=Object(l.c)(e=>e.room.medias.length),p=Object(o.useCallback)(()=>u(wt()),[u]);return i.a.createElement("div",{className:"SeaBattleControls"},i.a.createElement(g,{disabled:t,icon:"rotate-left",title:"Rotate Left",onClick:n}),i.a.createElement(g,{disabled:t,icon:(null===e||void 0===e?void 0:e.direction)?te[e.direction].backward:"arrow-down",title:"Move Backward",onClick:a}),i.a.createElement(g,{disabled:0===d,icon:"step-forward",onClick:p,size:"M",title:s("player.forward")}),i.a.createElement(g,{disabled:t,icon:(null===e||void 0===e?void 0:e.direction)?te[e.direction].forward:"arrow-up",title:"Move Forward",onClick:r}),i.a.createElement(g,{disabled:t,icon:"rotate-right",title:"Rotate Right",onClick:c}))};var At=a(19);const It=({data:{position:e},className:t,onClick:a,stopPropagation:r=!1,type:n,visibility:c})=>i.a.createElement("use",Object.assign({onClick:e=>{r&&e.stopPropagation(),a&&a()},className:t,href:"#".concat(n),visibility:c},e)),zt=e=>{let t=e.type,a=e.visibility,r=Object(At.a)(e,["type","visibility"]);return i.a.createElement(It,{className:"SeaBattleCell",type:t,visibility:a,data:Object(D.a)({},r,{position:{x:40*r.position.x,y:40*r.position.y}})})},Bt=e=>{let t=e.type,a=Object(At.a)(e,["type"]);return i.a.createElement(It,{className:"SeaBattleWeapon",type:t,data:Object(D.a)({},a,{position:{x:J[t].x+40*a.position.x,y:J[t].y+40*a.position.y}})})},Ft=({weapons:e})=>i.a.createElement(i.a.Fragment,null,e.map((e,t)=>i.a.createElement(Bt,Object.assign({key:t},e)))),Wt=e=>{let t=e.type,a=Object(At.a)(e,["type"]);return i.a.createElement(It,{className:"SeaBattleHit",type:t,data:Object(D.a)({},a,{position:{x:Q[t].x+40*a.position.x,y:Q[t].y+40*a.position.y}})})},Ut=({hits:e})=>i.a.createElement(i.a.Fragment,null,e.map((e,t)=>i.a.createElement(Wt,Object.assign({key:t},e)))),qt=e=>{let t=e.boat,a=t.direction,r=void 0===a?"E":a,n=t.type,c=t.status,o=void 0===c?"ok":c,s=Object(At.a)(t,["direction","type","status"]),l=e.onClick,u=e.selected;return i.a.createElement(It,{className:m()("SeaBattleBoat",o,{clickable:!!l,selected:u}),onClick:l,stopPropagation:!0,data:Object(D.a)({},s,{position:{x:G[n].x+40*s.position.x,y:G[n].y+40*s.position.y}}),type:Z[n][r]})},Dt=({fleet:e,hideActiveFleet:t,selectedBoat:a,setSelectedBoat:r})=>i.a.createElement(i.a.Fragment,null,e.filter(e=>!t||"ko"===e.status).map((e,t)=>i.a.createElement(qt,{key:t,boat:e,onClick:r&&"ok"===e.status?()=>{r(e===a?-1:t)}:void 0,selected:e===a}))),Vt=()=>i.a.createElement("defs",null,i.a.createElement("circle",{id:"missed1",cx:"10",cy:"10",r:"8",fill:"#fff"}),i.a.createElement("circle",{id:"missed2",cx:"10",cy:"10",r:"8",fill:"#fff7"}),i.a.createElement("circle",{id:"hitted1",cx:"10",cy:"10",r:"8",fill:"#ffcf02"}),i.a.createElement("circle",{id:"hitted2",cx:"10",cy:"10",r:"8",fill:"#e52524"}),i.a.createElement("polygon",{id:"crossed",points:"11.98 8.08 20.07 0 24 3.9 15.92 11.98 24 20.07 20.07 24 11.98 15.92 3.9 24 0 20.07 8.08 11.98 0 3.9 3.9 0 11.98 8.08",fillRule:"evenodd"}),i.a.createElement("path",{id:"cell",d:"M0,0V40H40V0ZM36,36H4V4H36Z"}),i.a.createElement("use",{id:"cell-selected",href:"#cell",fill:"#FF0"}),i.a.createElement("use",{id:"cell-selection",href:"#cell",fill:"#555"}),i.a.createElement("g",{id:"cell-crossed"},i.a.createElement("use",{href:"#cell",fill:"#e52524"}),i.a.createElement("use",{href:"#crossed",fill:"#e52524",x:"8",y:"8"})),i.a.createElement("path",{id:"bullet1",d:"M16,4C16,8.46,0,8,0,8V0S16-.46,16,4Z",fill:"#afafaf"}),i.a.createElement("path",{id:"bullet2",d:"M16,4C16,8.46,0,8,0,8V0S16-.46,16,4Z",fill:"#676766"}),i.a.createElement("path",{id:"bullet3",d:"M16,4C16,8.46,0,8,0,8V0S16-.46,16,4Z",fill:"#000000"}),i.a.createElement("path",{id:"mine",d:"M16,9V7H13.77a5.92,5.92,0,0,0-1-2.41L14.35,3,13,1.65,11.39,3.23A5.92,5.92,0,0,0,9,2.23V0H7V2.23a5.92,5.92,0,0,0-2.41,1L3,1.65,1.65,3,3.23,4.61A5.92,5.92,0,0,0,2.23,7H0V9H2.23a5.92,5.92,0,0,0,1,2.41L1.65,13,3,14.35l1.58-1.58a5.92,5.92,0,0,0,2.41,1V16H9V13.77a5.92,5.92,0,0,0,2.41-1L13,14.35,14.35,13l-1.58-1.58a5.92,5.92,0,0,0,1-2.41Z",fill:"#000000"}),i.a.createElement("path",{id:"boat1",d:"M28,14C28,19,14,28,14,28H0V0H14S28,9.05,28,14Z"}),i.a.createElement("use",{id:"boat1-E",href:"#boat1"}),i.a.createElement("use",{id:"boat1-N",href:"#boat1",transform:"rotate(-90, 14, 14)"}),i.a.createElement("use",{id:"boat1-S",href:"#boat1",transform:"rotate(90, 14, 14)"}),i.a.createElement("use",{id:"boat1-W",href:"#boat1",transform:"rotate(180, 14, 14)"}),i.a.createElement("path",{id:"boat2",d:"M68,14C68,19,51.89,28,51.89,28H0V0H51.89S68,9.05,68,14Z"}),i.a.createElement("use",{id:"boat2-E",href:"#boat2"}),i.a.createElement("use",{id:"boat2-N",href:"#boat2",transform:"rotate(-90, 14, 14)"}),i.a.createElement("use",{id:"boat2-S",href:"#boat2",transform:"rotate(90, 14, 14)"}),i.a.createElement("use",{id:"boat2-W",href:"#boat2",transform:"rotate(180, 14, 14)"}),i.a.createElement("path",{id:"boat3",d:"M108,14C108,19,91.24,28,91.24,28H0V0H91.24S108,9.05,108,14Z"}),i.a.createElement("use",{id:"boat3-E",href:"#boat3"}),i.a.createElement("use",{id:"boat3-N",href:"#boat3",transform:"rotate(-90, 14, 14)"}),i.a.createElement("use",{id:"boat3-S",href:"#boat3",transform:"rotate(90, 14, 14)"}),i.a.createElement("use",{id:"boat3-W",href:"#boat3",transform:"rotate(180, 14, 14)"}),i.a.createElement("pattern",{id:"sea-grid",width:"80",height:"80",patternUnits:"userSpaceOnUse"},i.a.createElement("g",null,i.a.createElement("rect",{width:40,height:40,fill:"#a6dbf8",x:"0",y:"0"}),i.a.createElement("rect",{width:40,height:40,fill:"#50a3db",x:40,y:"0"}),i.a.createElement("rect",{width:40,height:40,fill:"#50a3db",x:"0",y:40}),i.a.createElement("rect",{width:40,height:40,fill:"#a6dbf8",x:40,y:40})))),Ht=(e,{x:t,y:a})=>{var r=e.createSVGPoint();return r.x=t,r.y=a,{tx:(r=r.matrixTransform(e.getScreenCTM().inverse())).x,ty:r.y}},Xt=({hideActiveFleet:e=!1,player:{fleet:t,hits:a,weapons:r}={fleet:[],hits:[],weapons:[]},selectedBoat:n,setSelectedBoat:c})=>{const s=Object(o.useRef)(null),l=Object(o.useState)({x:0,y:0}),u=Object(V.a)(l,2),d=u[0],p=u[1],m=Object(o.useState)("hidden"),b=Object(V.a)(m,2),f=b[0],y=b[1],v=Object(o.useState)({x:0,y:0}),k=Object(V.a)(v,2),h=k[0],g=k[1],E=Object(o.useState)("hidden"),x=Object(V.a)(E,2),O=x[0],j=x[1],w=Object(o.useCallback)(e=>{const t=Ht(s.current,e),a=t.tx,r=t.ty;p({x:Math.floor(a/40),y:Math.floor(r/40)}),y("visible")},[]),S=Object(o.useCallback)(()=>{j("hidden")},[]),C=Object(o.useCallback)(e=>{const t=Ht(s.current,e),a=t.tx,r=t.ty;g({x:Math.floor(a/40),y:Math.floor(r/40)}),j("visible")},[]);return i.a.createElement("svg",{className:"SeaBattleMap",viewBox:"0 0 400 400",ref:s,onClick:e=>w({x:e.clientX,y:e.clientY}),onMouseLeave:S,onMouseMove:e=>C({x:e.clientX,y:e.clientY})},i.a.createElement(Vt,null),i.a.createElement("rect",{width:"400",height:"400",fill:"url(#sea-grid)"}),i.a.createElement(zt,{type:"cell-selection",position:h,visibility:O}),i.a.createElement(zt,{type:"cell-selected",position:d,visibility:f}),i.a.createElement(Ft,{weapons:r}),i.a.createElement(Dt,{hideActiveFleet:e,fleet:t,selectedBoat:n,setSelectedBoat:c}),i.a.createElement(Ut,{hits:a}))},Gt=({boatIndex:e,movement:t})=>function(){var a=Object(c.a)(n.a.mark((function a(r,c){var o,i,s,l,u,d,p,m,b,f,y,v,k,h;return n.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(o=c(),i=o.room,s=i.info,l=i.room,u=o.user.access.id,l&&!l.isLocked()&&s){a.next=4;break}return r(R("rooms.error.locked")),a.abrupt("return");case 4:if(u){a.next=7;break}return r(R("users.not_connected")),a.abrupt("return");case 7:if(a.prev=7,d=Object(X.a)(s.extra),p=d.players[u]){a.next=12;break}return a.abrupt("return");case 12:if(m=p.fleet,!(e<0||e>=p.fleet.length)){a.next=15;break}return a.abrupt("return");case 15:if(b=m[e],f=b.direction,y=b.position,v=b.type,k=Object(D.a)({},y),"move-forward"!==t&&"move-backward"!==t||(k.x+=$[f][t].x,k.y+=$[f][t].y),h=f,"rotate-left"!==t&&"rotate-right"!==t||(h=Y[f][t],k.x+=K[v][f].x,k.y+=K[v][f].y),ne(m,e,k,h)){a.next=24;break}return console.debug("[SeaBattle] Movement is not possible...",{boatIndex:e,movement:t,oldDirection:f,newDirection:h,oldPosition:y,newPosition:k}),r(R("games.seabattle.movement_is_not_possible")),a.abrupt("return");case 24:return console.debug("[SeaBattle] Moving boat...",{boatIndex:e,movement:t,oldDirection:f,oldPosition:y,newDirection:h,newPosition:k}),p.fleet[e].direction=h,p.fleet[e].position=k,a.next=29,l.update(Object(D.a)({},s,{extra:Object(X.b)(d)}));case 29:a.next=34;break;case 31:a.prev=31,a.t0=a.catch(7),r(R(xe(a.t0)));case 34:case"end":return a.stop()}}),a,null,[[7,31]])})));return function(e,t){return a.apply(this,arguments)}}(),Qt=({opponentsCount:e,opponentIndex:t,onSelectPreviousOpponent:a,onSelectNextOpponent:r})=>{const n=Object(y.b)().t;return e>0?i.a.createElement("div",{className:"SeaBattleOpponentSelection"},i.a.createElement(g,{disabled:!0,icon:"caret-left",title:"Previous enemy",onClick:a}),i.a.createElement("span",{className:"SeaBattleOpponentSelectionLabel"},n("games.seabattle.opponent_index",{index:"".concat(t+1," / ").concat(e)})),i.a.createElement(g,{disabled:!0,icon:"caret-right",title:"Next enemy",onClick:r})):i.a.createElement("div",{className:"SeaBattleOpponentSelection"},i.a.createElement("span",{className:"SeaBattleOpponentSelectionLabel"},"No opponent"))},Jt=()=>{const e=Object(o.useRef)(null),t=Object(o.useState)({x:0,y:0}),a=Object(V.a)(t,2),r=a[0],n=a[1],c=Object(o.useState)("hidden"),s=Object(V.a)(c,2),l=s[0],u=s[1],d=Object(o.useState)({x:0,y:0}),p=Object(V.a)(d,2),m=p[0],b=p[1],f=Object(o.useState)("hidden"),y=Object(V.a)(f,2),v=y[0],k=y[1],h=Object(o.useCallback)(t=>{const a=Ht(e.current,t),r=a.tx,c=a.ty;n({x:Math.floor(r/40),y:Math.floor(c/40)}),u("visible")},[]),g=Object(o.useCallback)(t=>{const a=Ht(e.current,t),r=a.tx,n=a.ty;b({x:Math.floor(r/40),y:Math.floor(n/40)}),k("visible")},[]),E=Object(o.useCallback)(()=>{k("hidden")},[]),x=[{count:1,position:{x:0,y:0},type:"bullet1"},{count:1,position:{x:1,y:0},type:"bullet2"},{count:1,position:{x:2,y:0},type:"bullet3"},{count:1,position:{x:3,y:0},type:"mine"}];return i.a.createElement("svg",{className:"SeaBattleWeaponSelection",viewBox:"0 0 160 40",ref:e,onClick:e=>h({x:e.clientX,y:e.clientY}),onMouseLeave:E,onMouseMove:e=>g({x:e.clientX,y:e.clientY})},i.a.createElement(Vt,null),i.a.createElement("rect",{width:"400",height:"400",fill:"url(#sea-grid)"}),i.a.createElement(zt,{type:"cell-selection",position:m,visibility:v}),i.a.createElement(zt,{type:"cell-selected",position:r,visibility:l}),i.a.createElement(Ft,{weapons:x}),x.map((e,t)=>i.a.createElement(zt,{key:t,type:"cell-crossed",position:{x:t,y:0},visibility:0===e.count?"visible":"hidden"})))},Zt=({disabled:e=!0,opponentsCount:t,opponentIndex:a,onSelectPreviousOpponent:r,onSelectNextOpponent:n})=>i.a.createElement("div",{className:"SeaBattleControls"},i.a.createElement(Qt,{opponentsCount:t,opponentIndex:a,onSelectPreviousOpponent:r,onSelectNextOpponent:n}),i.a.createElement(Jt,null));a(100);const Yt=()=>{const e=Object(l.b)(),t=Object(o.useState)(-1),a=Object(V.a)(t,2),r=a[0],n=a[1],c=Object(o.useState)(0),s=Object(V.a)(c,2),u=s[0],d=s[1],p=Object(l.c)(e=>!!e.room.info),m=Object(l.c)(e=>e.user.access.id),b=Object(l.c)(I),f=((e,t,a,r)=>{let n=void 0,c=void 0,o=void 0,i=void 0,s=void 0;return e&&(n=Object(X.a)(e),t&&(c=n.players[t],a>=0&&a<c.fleet.length&&(s=c.fleet[a])),i=Object.values(n.players).filter(e=>e!==c),r>=0&&r<i.length&&(o=i[r])),{battle:n,boat:s,opponent:o,opponents:i,player:c}})(Object(l.c)(e=>{var t;return(null===(t=e.room.info)||void 0===t?void 0:t.extra)||""}),m,r,u),y=f.battle,v=f.boat,k=f.opponent,h=f.opponents,g=f.player;Object(o.useEffect)(()=>{p&&b>0&&(e(Ot(Ze()%b)),e(kt()))},[e,p,b]);const E=Object(o.useCallback)(()=>{e(Gt({boatIndex:r,movement:"move-forward"}))},[e,r]),x=Object(o.useCallback)(()=>{e(Gt({boatIndex:r,movement:"move-backward"}))},[e,r]),O=Object(o.useCallback)(()=>{e(Gt({boatIndex:r,movement:"rotate-left"}))},[e,r]),j=Object(o.useCallback)(()=>{e(Gt({boatIndex:r,movement:"rotate-right"}))},[e,r]),w=Object(o.useCallback)(e=>{if(!y||e.repeat||38!==e.keyCode&&40!==e.keyCode&&37!==e.keyCode&&39!==e.keyCode)return;if(e.preventDefault(),!g||!v)return;const t={N:{38:E,40:x,37:O,39:j},E:{38:O,40:j,37:x,39:E},S:{38:x,40:E,37:j,39:O},W:{38:j,40:O,37:E,39:x}}[v.direction][e.keyCode];t&&t()},[E,x,O,j,y,g,v]);return Object(o.useEffect)(()=>(document.addEventListener("keydown",w),()=>{document.removeEventListener("keydown",w)}),[w]),i.a.createElement("div",{className:"SeaBattle"},i.a.createElement("div",{className:"SeaBattlePlayer current"},i.a.createElement(Lt,{boat:v,disabled:!v,onMoveForward:E,onMoveBackward:x,onRotateLeft:O,onRotateRight:j}),i.a.createElement(Xt,{player:g,selectedBoat:v,setSelectedBoat:n})),i.a.createElement("div",{className:"SeaBattlePlayer other"},i.a.createElement(Zt,{disabled:!k,opponentsCount:(null===h||void 0===h?void 0:h.length)||0,opponentIndex:u,onSelectPreviousOpponent:h&&h.length>0?()=>d(0===u?h.length-1:u-1):void 0,onSelectNextOpponent:h&&h.length>0?()=>d((u+1)%(null===h||void 0===h?void 0:h.length)):void 0}),i.a.createElement(Xt,{player:k,hideActiveFleet:!0})))};a(101);const Kt=()=>{const e=Object(l.b)(),t=Object(l.c)(e=>e.room.color),a=t.fg,r=t.bg,n=Object(l.c)(e=>e.room.info),c=Object(d.h)().search,s=Object(d.i)().room_id,u=f.a.parse(c.substr(1)).secret;return Object(o.useEffect)(()=>(e(ot(s,u||"")),()=>{e(it())}),[e,s,u]),Object(o.useEffect)(()=>{document.body.className=a,document.body.style.backgroundColor="rgb(".concat(r.r,", ").concat(r.g,", ").concat(r.b,")")},[r,a]),i.a.createElement("div",{className:m()("Room")},i.a.createElement(z,null),(()=>{if(!n)return null;switch(n.type){case"blind":return null;case"dj":return i.a.createElement(i.a.Fragment,null,i.a.createElement(Nt,null),i.a.createElement(Tt,null));case"seabattle":return i.a.createElement(Yt,null)}})())},$t=()=>{const e={id:"",secret:""},t=localStorage.getItem("U");if(t)try{const a=Object(X.a)(t);"string"===typeof a.id&&"string"===typeof a.secret&&(e.id=a.id,e.secret=a.secret,console.debug("Loaded user access: ",e))}catch(a){}return e},ea=e=>S("user/SET",e),ta={access:{id:"",secret:""},error:null,fetching:!1,info:null,user:null},aa=(e,t)=>function(){var a=Object(c.a)(n.a.mark((function a(r){var c;return n.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,console.debug("[User] Creating..."),c=Object(H.a)(),a.next=5,fe({id:c,secret:t}).update({name:e});case 5:r(na(c,t)),a.next=11;break;case 8:a.prev=8,a.t0=a.catch(0),r(R(xe(a.t0)));case 11:case"end":return a.stop()}}),a,null,[[0,8]])})));return function(e){return a.apply(this,arguments)}}();let ra=null;const na=(e,t)=>function(){var a=Object(c.a)(n.a.mark((function a(r,c){var o,i,s;return n.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(o=c(),!(i=o.user.user)||i.id!==e){a.next=3;break}return a.abrupt("return");case 3:return r(ca()),a.prev=4,console.debug("[User] Connecting...",{id:e,secret:t}),s=fe({id:e,secret:t}),a.t0=r,a.t1=ea,a.t2={id:e,secret:t},a.t3=s,a.next=13,s.wait();case 13:a.t4=a.sent,a.t5={access:a.t2,user:a.t3,info:a.t4},a.t6=(0,a.t1)(a.t5),(0,a.t0)(a.t6),ra=s.subscribe(e=>{const t=e.val();console.debug("[User] Received user update...",t),r(ea({user:s,info:t}))}),a.next=24;break;case 20:a.prev=20,a.t7=a.catch(4),r(R(xe(a.t7))),r(ea({access:{id:e,secret:""}}));case 24:case"end":return a.stop()}}),a,null,[[4,20]])})));return function(e,t){return a.apply(this,arguments)}}(),ca=()=>function(){var e=Object(c.a)(n.a.mark((function e(t,a){var r,c,o,i,s,l;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=a(),c=r.user,o=c.access,i=o.id,s=o.secret,l=c.user,i||s||l){e.next=3;break}return e.abrupt("return");case 3:console.debug("[User] Disconnecting..."),l&&(l.unsubscribe(ra),ra=null),t(S("user/RESET"));case 6:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),oa=()=>function(){var e=Object(c.a)(n.a.mark((function e(t,a){var r,c,o,i;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=a(),c=r.user.access,o=c.id,i=c.secret,o&&i){e.next=3;break}return e.abrupt("return");case 3:console.debug("[User] Reconnecting...",{id:o,secret:i}),t(na(o,i));case 5:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}();a(102);const ia=()=>{const e=Object(l.b)(),t=Object(l.c)(e=>!!e.user.access.id),a=Object(y.b)().t,r=Object(o.useCallback)(()=>e(St({type:"CreateRoom",props:null})),[e]),n=Object(o.useCallback)(()=>e(St({type:"CreateUser",props:null})),[e]),c=Object(o.useCallback)(()=>e(ca()),[e]);return i.a.createElement("div",{className:"Splash"},i.a.createElement("div",{className:"Top"},i.a.createElement("div",{className:"Logo"},i.a.createElement(u.b,{to:"/"},"Party")),i.a.createElement("div",{className:"Description"},i.a.createElement("span",null,a("splash.description")))),i.a.createElement("div",{className:"Middle"},i.a.createElement("div",{className:"Menu"},t?i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{className:"MenuItem"},i.a.createElement(g,{icon:"plus",onClick:r,size:"L",title:a("rooms.create")}))):i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{className:"MenuItem"},i.a.createElement(g,{onClick:n,icon:"sign-in",size:"L",title:a("users.connect")}))))),i.a.createElement("div",{className:"Bottom"},i.a.createElement("div",{className:"Menu"},t?i.a.createElement("div",{className:"MenuItem"},i.a.createElement(g,{icon:"sign-out",onClick:c,size:"M",title:a("users.disconnect")})):i.a.createElement("div",{className:"MenuItem"},i.a.createElement(g,{icon:"info",onClick:()=>{},size:"M",title:a("splash.CGU")})))))};var sa=a(27);const la=({children:e,className:t,title:a,renderFoot:r,onSubmit:n})=>{const c=Object(l.b)(),s=Object(y.b)().t,u=Object(l.c)(e=>e.modals.stack.length>1),d=Object(o.useCallback)(()=>c(S("modals/CLOSE")),[c]),p=Object(o.useCallback)(()=>c(Ct()),[c]);return i.a.createElement("form",{className:m()("Modal",t),onSubmit:e=>{e.preventDefault(),n&&n()}},i.a.createElement("div",{className:"ModalHead"},i.a.createElement(g,{kind:"special",className:m()("ModalHeadBack",{hidden:!u}),icon:"angle-left",title:"Back",onClick:p}),i.a.createElement("div",{className:"ModalTitle"},a),i.a.createElement(g,{kind:"special",className:"ModalHeadClose",onClick:d,title:s("cancel"),icon:"times"})),i.a.createElement("div",{className:"ModalBody"},e),i.a.createElement("div",{className:"ModalFoot"},r&&r()))};a(103);const ua=({children:e,className:t,renderButtons:a,title:r,onSubmit:n})=>i.a.createElement(la,{className:m()("FormModal",t),title:r,renderFoot:a,onSubmit:n},e),da=({onClick:e})=>{const t=Object(y.b)().t;return i.a.createElement(g,{onClick:e,title:t("cancel"),kind:"default",icon:"ban"})},pa=({question:e,onCanceled:t,onConfirmed:a})=>{const r=Object(l.b)(),n=Object(y.b)().t,c=Object(o.useCallback)(()=>{r(Ct()),t&&t()},[r,t]);return i.a.createElement(ua,{title:n("confirm"),onSubmit:a,renderButtons:()=>i.a.createElement(i.a.Fragment,null,i.a.createElement(g,{title:n("cancel"),kind:"primary",icon:"plus",type:"submit"}),i.a.createElement(da,{onClick:c}))},e)},ma=({children:e})=>i.a.createElement("div",{className:"ModalField"},e),ba=i.a.forwardRef((e,t)=>i.a.createElement(ma,null,i.a.createElement("div",{className:"XXX"},i.a.createElement("label",{htmlFor:e.id},e.label),i.a.createElement("input",Object.assign({ref:t},e))))),fa=({id:e,label:t,onChange:a,placeholder:r,value:s})=>{const u=Object(l.b)(),d=Object(y.b)().t,p=Object(o.useCallback)(Object(c.a)(n.a.mark((function e(){return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,E(s);case 2:u(P("secret_copied_to_clipboard"));case 3:case"end":return e.stop()}}),e)}))),[u,s]);return i.a.createElement(ma,null,i.a.createElement("div",{className:"XXX"},i.a.createElement("label",{htmlFor:e},t),i.a.createElement("div",{style:{display:"flex",flexDirection:"row",justifyContent:"space-between"}},i.a.createElement("input",{style:{flexGrow:1,marginRight:"0.5rem"},id:e,type:"password",autoComplete:"password",placeholder:r,maxLength:36,minLength:36,required:!0,value:s,onChange:e=>a(e.target.value)}),i.a.createElement(g,{icon:"clipboard",onClick:p,size:"M",title:d("copy_to_clipboard")}))))},ya=i.a.forwardRef((e,t)=>i.a.createElement(ma,null,i.a.createElement("div",{className:"XXX"},i.a.createElement("label",{htmlFor:e.id},e.label),i.a.createElement("select",Object.assign({ref:t},e),e.options.sort((e,t)=>e.label.localeCompare(t.label)).map(e=>i.a.createElement("option",{key:e.id,value:e.id},e.label)))))),va=()=>{const e=Object(l.b)(),t=Object(o.useState)(""),a=Object(V.a)(t,2),r=a[0],n=a[1],c=Object(o.useState)(""),s=Object(V.a)(c,2),u=s[0],d=s[1],p=Object(o.useRef)(null),m=Object(y.b)().t;Object(o.useEffect)(()=>{p.current&&p.current.focus()},[p]);const b=Object(o.useCallback)(()=>e(Ct()),[e]),f=Object(o.useCallback)(()=>{0!==r.trim().length?0!==u.trim().length?(e(na(r,u)),e(Ct())):e(R("users.secret_is_invalid")):e(R("users.id_is_invalid"))},[e,r,u]),v=Object(o.useCallback)(()=>e(St({type:"CreateUser",props:null})),[e]);return i.a.createElement(ua,{title:m("users.connection"),onSubmit:f,renderButtons:()=>i.a.createElement(i.a.Fragment,null,i.a.createElement(g,{disabled:0===r.trim().length||36!==r.length||36!==u.length,title:m("users.connect"),kind:"primary",icon:"sign-in",type:"submit"}),i.a.createElement(da,{onClick:b}),i.a.createElement(g,{title:m("users.create"),kind:"default",icon:"plus",onClick:v}))},i.a.createElement(ba,{id:"modal-id",label:m("users.id"),type:"text",placeholder:m("users.id_placeholder"),maxLength:36,minLength:36,required:!0,value:r,ref:p,onChange:e=>n(e.target.value)}),i.a.createElement(ba,{id:"modal-secret",label:m("users.secret"),type:"password",autoComplete:"password",placeholder:m("users.secret_placeholder"),maxLength:36,minLength:36,required:!0,value:u,onChange:e=>d(e.target.value)}))};let ka=1;const ha=()=>{const e=Object(l.b)(),t=Object(o.useState)(""),a=Object(V.a)(t,2),r=a[0],n=a[1],c=Object(o.useState)(Object(H.a)()),s=Object(V.a)(c,2),u=s[0],d=s[1],p=Object(o.useState)("dj"),m=Object(V.a)(p,2),b=m[0],f=m[1],v=Object(o.useRef)(null),k=Object(y.b)().t;Object(o.useEffect)(()=>{n("".concat(k("rooms.room")," ").concat(ka)),v.current&&v.current.focus()},[k,v]);const h=Object(o.useCallback)(()=>e(Ct()),[e]),E=Object(o.useCallback)(()=>{0!==r.trim().length?0!==u.trim().length?(e(ct(r,u,b)),e(Ct()),ka++):e(R("rooms.secret_is_invalid")):e(R("rooms.name_is_invalid"))},[e,r,u,b]),x=Object(o.useCallback)(()=>e(St({type:"JoinRoom",props:null})),[e]);return i.a.createElement(ua,{title:k("rooms.room_creation"),onSubmit:E,renderButtons:()=>i.a.createElement(i.a.Fragment,null,i.a.createElement(g,{disabled:0===r.trim().length||36!==u.length,title:k("rooms.create"),kind:"primary",icon:"plus",type:"submit"}),i.a.createElement(da,{onClick:h}),i.a.createElement(g,{title:k("rooms.join"),kind:"default",icon:"sign-in",onClick:x}))},i.a.createElement(ba,{id:"modal-name",label:k("rooms.name"),type:"text",placeholder:k("rooms.name_placeholder"),maxLength:100,minLength:2,required:!0,value:r,ref:v,onChange:e=>n(e.target.value)}),i.a.createElement(fa,{id:"modal-secret",label:k("rooms.key"),placeholder:k("rooms.key_placeholder"),value:u,onChange:d}),i.a.createElement(ya,{id:"modal-type",label:k("rooms.type"),placeholder:k("rooms.type_placeholder"),options:ce.map(e=>({id:e,label:k("rooms.types.".concat(e))})),value:b,onChange:e=>f(e.target.value)}))};let ga=1;const Ea=()=>{const e=Object(l.b)(),t=Object(o.useState)(""),a=Object(V.a)(t,2),r=a[0],n=a[1],c=Object(o.useState)(Object(H.a)()),s=Object(V.a)(c,2),u=s[0],d=s[1],p=Object(o.useRef)(null),m=Object(y.b)().t;Object(o.useEffect)(()=>{n("".concat(m("users.user")," ").concat(ga)),p.current&&p.current.focus()},[m,p]);const b=Object(o.useCallback)(()=>e(Ct()),[e]),f=Object(o.useCallback)(()=>{0!==r.trim().length?0!==u.trim().length?(e(aa(r,u)),e(Ct()),ga++):e(R("users.secret_is_invalid")):e(R("users.name_is_invalid"))},[e,r,u]),v=Object(o.useCallback)(()=>{e(St({type:"ConnectUser",props:null}))},[e]);return i.a.createElement(ua,{title:m("users.user_creation"),onSubmit:f,renderButtons:()=>i.a.createElement(i.a.Fragment,null,i.a.createElement(g,{disabled:0===r.trim().length||36!==u.length,title:m("users.create"),kind:"primary",icon:"plus",type:"submit"}),i.a.createElement(da,{onClick:b}),i.a.createElement(g,{title:m("users.connect"),kind:"default",icon:"sign-in",onClick:v}))},i.a.createElement(ba,{id:"modal-name",label:m("users.name"),type:"text",placeholder:m("users.name_placeholder"),maxLength:100,minLength:2,required:!0,value:r,ref:p,onChange:e=>n(e.target.value)}),i.a.createElement(fa,{id:"modal-secret",label:m("users.secret"),placeholder:m("users.secret_placeholder"),value:u,onChange:e=>d(e)}))},xa=({items:e,label:t,onViewMore:a,cb:r})=>e.length>0?i.a.createElement(i.a.Fragment,null,i.a.createElement(ma,null,i.a.createElement("div",{className:"XXX"},i.a.createElement("label",null,t))),e.map(e=>i.a.createElement(ma,{key:e.id},i.a.createElement("div",{className:"SearchResultItem"},r(e)))),i.a.createElement(ma,null,i.a.createElement("div",{className:"XXX"},i.a.createElement(g,{icon:"ellipsis-h",onClick:a,title:"View more..."})))):null;a(104);const Oa=()=>{const e=Object(l.b)(),t=Object(y.b)().t,a=Object(o.useRef)(null),r=Object(l.c)(j),s=Object(o.useState)(""),u=Object(V.a)(s,2),d=u[0],p=u[1],m=Object(o.useState)("deezer"),b=Object(V.a)(m,2),f=b[0],v=b[1],k=Object(o.useState)("track"),h=Object(V.a)(k,2),E=h[0],x=h[1],O=Object(o.useState)(""),w=Object(V.a)(O,2),S=w[0],C=w[1],_=Object(o.useState)({deezer:{album:[],playlist:[],track:[]}}),N=Object(V.a)(_,2),M=N[0],R=N[1],P=Object(o.useCallback)(()=>e(Ct()),[e]),T=Object(o.useCallback)(Object(c.a)(n.a.mark((function e(){return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(S.trim().length>0)){e.next=6;break}return e.t0=R,e.next=4,Be(S,{limit:5});case 4:e.t1=e.sent,(0,e.t0)(e.t1);case 6:case"end":return e.stop()}}),e)}))),[S]),L=Object(o.useCallback)((t,a,r)=>e(Et([{provider:t,type:a,id:r}])),[e]),A=Object(o.useCallback)((t,a,r)=>{e(tt({provider:t,type:a,id:r})),p(r),v(t),x(a)},[e]),I=Object(o.useCallback)(Object(c.a)(n.a.mark((function e(){return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.debug("Stop previewing..."),e.next=3,$e.stop();case 3:p(""),v("deezer"),x("track");case 6:case"end":return e.stop()}}),e)}))),[]),z=Object(o.useCallback)(function(){var e=Object(c.a)(n.a.mark((function e(t){return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=R,e.next=3,Be(S,{limit:50},t);case 3:e.t1=e.sent,(0,e.t0)(e.t1);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[S,R]);return Object(o.useEffect)(()=>(a.current&&a.current.focus(),()=>{console.debug("Stop previewing..."),$e.stop()}),[e]),i.a.createElement(ua,{className:"SearchModal",title:t("medias.medias_search"),onSubmit:T,renderButtons:()=>i.a.createElement(i.a.Fragment,null,i.a.createElement(g,{disabled:0===S.trim().length,title:t("medias.search"),kind:"primary",icon:"search",type:"submit"}),i.a.createElement(da,{onClick:P}))},i.a.createElement(ma,null,i.a.createElement("input",{id:"modal-query",type:"text",placeholder:t("medias.search_placeholder"),maxLength:100,minLength:2,required:!0,value:S,ref:a,onChange:e=>C(e.target.value)})),ye.map(({label:e,provider:a,type:n})=>i.a.createElement(xa,{key:n,label:t(e),items:M[a][n],onViewMore:()=>z(n),cb:e=>i.a.createElement(U,{actions:i.a.createElement(g,{disabled:r,title:t("medias.add"),icon:"plus",onClick:()=>L(a,n,e.id)}),media:e,playable:!0,playing:f===a&&E===n&&d===e.id,onPlay:()=>A(a,n,e.id),onStop:I})})))},ja=()=>{const e=Object(l.b)(),t=Object(o.useState)(""),a=Object(V.a)(t,2),r=a[0],n=a[1],c=Object(o.useRef)(null),s=Object(y.b)().t;Object(o.useEffect)(()=>{c.current&&c.current.focus()},[c]);const u=Object(o.useCallback)(()=>e(Ct()),[e]),d=Object(o.useCallback)(()=>{0!==r.trim().length?(e(ot(r,"")),e(Ct())):e(R("rooms.id_is_invalid"))},[e,r]),p=Object(o.useCallback)(()=>e(St({type:"CreateRoom",props:null})),[e]);return i.a.createElement(ua,{title:s("rooms.room_join"),onSubmit:d,renderButtons:()=>i.a.createElement(i.a.Fragment,null,i.a.createElement(g,{disabled:0===r.trim().length||36!==r.length,title:s("rooms.join"),kind:"primary",icon:"sign-in",type:"submit"}),i.a.createElement(da,{onClick:u}),i.a.createElement(g,{title:s("rooms.create"),kind:"default",icon:"plus",onClick:p}))},i.a.createElement(ba,{id:"modal-id",label:s("rooms.id"),type:"text",placeholder:s("rooms.id_placeholder"),maxLength:36,minLength:36,required:!0,value:r,ref:c,onChange:e=>n(e.target.value)}))},wa=()=>{const e=Object(l.b)(),t=Object(o.useState)(""),a=Object(V.a)(t,2),r=a[0],n=a[1],c=Object(o.useRef)(null),s=Object(y.b)().t;Object(o.useEffect)(()=>{c.current&&c.current.focus()},[c]);const u=Object(o.useCallback)(()=>e(Ct()),[e]),d=Object(o.useCallback)(()=>{e(lt(r)),e(Ct())},[e,r]);return i.a.createElement(ua,{title:s("rooms.room_unlocking"),onSubmit:d,renderButtons:()=>i.a.createElement(i.a.Fragment,null,i.a.createElement(g,{disabled:36!==r.length,title:s("rooms.unlock"),kind:"primary",icon:"unlock",type:"submit"}),i.a.createElement(da,{onClick:u}))},i.a.createElement(ba,{id:"modal-secret",label:s("rooms.key"),type:"password",autoComplete:"password",placeholder:s("rooms.key_placeholder"),maxLength:36,minLength:36,required:!0,value:r,ref:c,onChange:e=>n(e.target.value)}))};a(105);const Sa=()=>{const e=Object(l.b)(),t=Object(l.c)(e=>e.modals.stack.length>0?e.modals.stack[e.modals.stack.length-1]:void 0),a=Object(o.useState)(void 0),r=Object(V.a)(a,2),n=r[0],c=r[1],s=Object(o.useState)(void 0),u=Object(V.a)(s,2),d=u[0],p=u[1],m=Object(o.useCallback)(()=>e(Ct()),[e]);Object(o.useEffect)(()=>{const e=e=>{27===e.keyCode&&m()};return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}},[m]),Object(o.useEffect)(()=>{c(void 0),p(t)},[t,c,p]),Object(o.useEffect)(()=>{t&&setTimeout(()=>{c(t)},300)},[t,c]);const b=(e=>{if(e)switch(e.type){case"Confirm":return i.a.createElement(pa,e.props);case"ConnectUser":return i.a.createElement(va,null);case"CreateRoom":return i.a.createElement(ha,null);case"CreateUser":return i.a.createElement(Ea,null);case"JoinRoom":return i.a.createElement(ja,null);case"Search":return i.a.createElement(Oa,null);case"UnlockRoom":return i.a.createElement(wa,null)}return null})(n||d);return i.a.createElement(sa.CSSTransition,{in:!!n,timeout:300,unmountOnExit:!0},i.a.createElement("div",{className:"ModalOverlay",onClick:e=>{e.stopPropagation(),m()}},b&&i.a.createElement("div",{className:"ModalWrapper",role:"dialog",onClick:e=>{e.stopPropagation()}},b)))},Ca=e=>e.messages.sort((e,t)=>e.weight!==t.weight?e.weight-t.weight:e.stamp-t.stamp);a(113);const _a=()=>{const e=Object(y.b)().t,t=Object(l.b)(),a=Object(l.c)(Ca);return i.a.createElement("div",{className:"Messages"},i.a.createElement(sa.TransitionGroup,null,a.map(({extra:a,id:r,text:n,type:c})=>i.a.createElement(sa.CSSTransition,{key:r,classNames:"Message",timeout:{enter:200,exit:200}},i.a.createElement("div",{className:m()("Message","Message-"+c)},i.a.createElement("div",{className:"MessageBody"},n?e(n):null,a?a():null),i.a.createElement("div",{className:"MessageActions"},i.a.createElement(g,{icon:"close",title:e("clear"),onClick:()=>t(C(r))})))))))};a(114);const Na=()=>{const e=Object(l.b)();return Object(o.useEffect)(()=>{e(oa())},[e]),i.a.createElement("div",{className:"App"},i.a.createElement(Sa,null),i.a.createElement(d.d,null,i.a.createElement(d.b,{exact:!0,path:"/room/:room_id",component:Kt}),i.a.createElement(d.b,{exact:!0,path:"/",component:ia}),i.a.createElement(d.a,{to:"/"})),i.a.createElement(_a,null))};var Ma=a(40),Ra={audio:{errors:{cannot_decode_audio_data:"Audio buffer cannot be decoded",cannot_load_audio_buffer:"Audio buffer loading failed"}},splash:{CGU:"CGU",powered_with:"Powered with",description:"Collaborative & Musical Games Experimentation"},users:{errors:{invalid:"User is invalid"},user:"User",confirm_disconnect:"Are you sure you want to disconnect?",connect:"Connect",connection:"Connection",create:"Create a user",disconnect:"Disconnect",id:"User ID",id_is_invalid:"ID is invalid",id_placeholder:"User ID...",name_is_invalid:"Name is invalid",name_placeholder:"User Name...",name:"User Name",secret_is_invalid:"Secret is invalid",secret_placeholder:"User Secret...",secret:"User Secret",user_creation:"User Registration",not_connected:"No user is identified"},games:{seabattle:{movement_is_not_possible:"This movement is not possible!",opponent_index:"Opponent {{index}}"}},rooms:{errors:{invalid:"Room is invalid",locked:"Room is locked"},types:{blind:"Blind Test",dj:"DJ",seabattle:"Sea Battle"},clear:"Clear all tracks",confirm_clear:"Are you sure you want to remove all tracks?",confirm_exit:"Are you sure you want to leave the room?",confirm_lock:"Are you sure you want to lock the room?",copy_link:"Copy Room Link to Clipboard",create:"Create a room",empty:"It's empty here, you should add some tracks...",empty_for_now:"It's empty here, the owner has to fill it..",exit:"Exit Room",id:"Room ID",id_placeholder:"Room ID...",key_placeholder:"Room Key...",type_placeholder:"Room Type...",key:"Room Key",type:"Room Type",join:"Join a Room",link_copied_to_clipboard:"Room link has been copied to clipboard",loading:"Loading...",locked:"Locked (click to unlock)",name_is_invalid:"Name is invalid",name_placeholder:"Room Name...",name:"Room Name",room_creation:"Room Creation",room_join:"Room Access",room_unlocking:"Room Unlocking",room:"Room",secret_is_invalid:"Secret is invalid",unlock:"Unlock",unlocked:"Unlocked (click to lock)",media_count:"{{count}} media",media_count_plural:"{{count}} medias",track_count:"{{count}} track",track_count_plural:"{{count}} tracks"},medias:{by:"by {{artist}}",add:"Add",remove:"Remove",search:"Search Media",search_placeholder:"Search...",medias_search:"Media Search",albums:"Albums",playlists:"Playlists",tracks:"Tracks"},player:{backward:"Backward",forward:"Forward",play:"Play",playing:"Playing",stop:"Stop"},cancel:"Cancel",clear:"Clear",copy_to_clipboard:"Copy to Clipboard",secret_copied_to_clipboard:"Secret has been copied to clipboard"},Pa={audio:{errors:{cannot_decode_audio_data:"Le buffer audio ne peut pas \xeatre d\xe9cod\xe9",cannot_load_audio_buffer:"Le buffer audio ne peut pas \xeatre charg\xe9"}},splash:{CGU:"CGU",powered_with:"Utilise",description:"Exp\xe9rimentation de jeux collaboratifs et musicaux"},users:{errors:{invalid:"L'utilisateur est invalide"},user:"Utilisateur",confirm_disconnect:"\xcates-vous s\xfbr(e) de vouloir vous d\xe9connecter ?",connect:"Se connecter",connection:"Connexion",create:"Cr\xe9er un utilisateur",disconnect:"Se d\xe9connecter",id:"Identifiant",id_is_invalid:"L'identifiant est invalide",id_placeholder:"Identifiant...",name_is_invalid:"Le nom est invalide",name_placeholder:"Nom...",name:"Nom",secret_is_invalid:"Le secret est invalide",secret_placeholder:"Secret...",secret:"Secret",user_creation:"Cr\xe9ation d'un utilisateur",not_connected:"Aucun utilisateur identifi\xe9"},games:{seabattle:{movement_is_not_possible:"Ce d\xe9placement est impossible !",opponent_index:"Ennemi {{index}}"}},rooms:{errors:{invalid:"La salle est invalide",locked:"La salle est verrouill\xe9e"},types:{blind:"Blind Test",dj:"DJ",seabattle:"Bataille Navale"},clear:"Supprimer toutes les pistes",confirm_clear:"\xcates-vous s\xfbr(e) de vouloir supprimer toutes les pistes ?",confirm_exit:"\xcates-vous s\xfbr(e) de vouloir quitter la salle ?",confirm_lock:"\xcates-vous s\xfbr(e) de vouloir verrouiller la salle ?",copy_link:"Copier le lien de la salle dans le presse-papier",create:"Cr\xe9er une salle",empty:"Cette salle est vide, vous devriez ajouter quelques pistes...",empty_for_now:"Cette salle est pour le moment vide...",exit:"Quitter la salle",id:"Identifiant",id_placeholder:"Identifiant...",key_placeholder:"Clef...",type_placeholder:"Type...",key:"Clef",type:"Type",join:"Rejoindre une salle",loading:"Chargement...",link_copied_to_clipboard:"Le lien de la salle a \xe9t\xe9 copi\xe9 dans le presse-papier",locked:"Verrouill\xe9e (cliquer pour d\xe9verrouiller)",name_is_invalid:"Le nom est invalide",name_placeholder:"Nom...",name:"Nom",room:"Salle",room_creation:"Cr\xe9ation d'une salle",room_join:"Rejoindre une salle",room_unlocking:"D\xe9verrouillage de la salle",secret_is_invalid:"Le secret is invalide",unlock:"D\xe9verrouiller",unlocked:"D\xe9verrouill\xe9e (cliquer pour verrouiller)",media_count:"{{count}} media",media_count_plural:"{{count}} medias",track_count:"{{count}} piste",track_count_plural:"{{count}} pistes"},medias:{by:"par {{artist}}",add:"Ajouter",remove:"Supprimer",search:"Chercher des m\xe9dias",search_placeholder:"Recherche...",medias_search:"Recherche de m\xe9dias",albums:"Albums",playlists:"Playlists",tracks:"Pistes"},player:{backward:"Piste pr\xe9c\xe9dente",forward:"Piste suivante",play:"Lire",playing:"En cours de lecture",stop:"Arr\xeater"},cancel:"Annuler",clear:"Supprimer",copy_to_clipboard:"Copier dans le presse-papier",secret_copied_to_clipboard:"Le secret a \xe9t\xe9 copi\xe9 dans le presse-papier"};const Ta=function(){var e=Object(c.a)(n.a.mark((function e(){return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((e,t)=>{console.debug("Initializing language...",{current:navigator.language||navigator.userLanguage}),Ma.a.use(y.a).init({fallbackLng:"en",lng:navigator.language||navigator.userLanguage,resources:{en:{translation:Ra},"en-US":{translation:Ra},fr:{translation:Pa},"fr-FR":{translation:Pa}},interpolation:{escapeValue:!1,format:(e,t,a)=>e}},a=>{a&&t(a),e()})}));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),La=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function Aa(e,t){console.debug("PWA registerValidSW 1"),navigator.serviceWorker.register(e).then(e=>{console.debug("PWA registerValidSW 2"),e.onupdatefound=()=>{console.debug("PWA registerValidSW 3");const a=e.installing;null!=a&&(console.debug("PWA registerValidSW 4"),a.onstatechange=()=>{console.debug("PWA registerValidSW 5",a.state),"installed"===a.state&&(navigator.serviceWorker.controller?(console.debug("PWA registerValidSW 6"),console.debug("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.debug("PWA registerValidSW 7"),console.debug("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}}).catch(e=>{console.error("Error during service worker registration:",e)})}a(115);var Ia=a(13),za=a(59);const Ba={error:null,fetching:!1,battle:{players:{}}},Fa=Object(Ia.combineReducers)({seabattle:(e=Object(D.a)({},Ba),t)=>{switch(t.type){case"games/seabattle/FETCHING":return Object(D.a)({},e,{fetching:!0,error:null});case"games/seabattle/ERROR":return Object(D.a)({},e,{fetching:!1,error:t.payload});case"games/seabattle/SET":return Object(D.a)({},e,{battle:t.payload,fetching:!1,error:null});case"games/seabattle/RESET":return Ba;default:return e}}}),Wa=Object(Ia.combineReducers)({games:Fa,medias:(e=We,t)=>{switch(t.type){case"medias/FETCHING":return Object(D.a)({},e,{fetching:!0,error:null});case"medias/ERROR":return Object(D.a)({},e,{fetching:!1,error:t.payload});case"medias/SET":{const c=Object(D.a)({},e,{fetching:!1,error:null,medias:{deezer:{album:Object(D.a)({},e.medias.deezer.album),playlist:Object(D.a)({},e.medias.deezer.playlist),track:Object(D.a)({},e.medias.deezer.track)}}});var a,r=Object(L.a)(t.payload);try{for(r.s();!(a=r.n()).done;){const e=a.value;c.medias[e.provider][e.type][e.id]=e}}catch(n){r.e(n)}finally{r.f()}return c}case"medias/RESET":return We;default:return e}},messages:(e=_,t)=>{switch(t.type){case"message/ADD":return[t.payload,...e];case"message/REMOVE":return e.filter(e=>e.id!==t.payload);case"message/RESET":return _;default:return e}},modals:(e=_t,t)=>{switch(t.type){case"modals/OPEN":return Object(D.a)({},e,{stack:[t.payload]});case"modals/CLOSE":return Object(D.a)({},e,{stack:[]});case"modals/PUSH":return Object(D.a)({},e,{stack:[...e.stack,t.payload]});case"modals/POP":const a=[...e.stack];return a.pop(),Object(D.a)({},e,{stack:a});default:return e}},room:(e=qe,t)=>{switch(t.type){case"room/FETCHING":return Object(D.a)({},e,{fetching:!0,error:null});case"room/ERROR":return Object(D.a)({},e,{fetching:!1,error:t.payload});case"room/SET":return Object(D.a)({},e,{},t.payload,{fetching:!1,error:null});case"room/RESET":return qe;default:return e}},user:(e=Object(D.a)({},ta,{access:$t()}),t)=>{switch(t.type){case"user/FETCHING":return Object(D.a)({},e,{fetching:!0,error:null});case"user/ERROR":return Object(D.a)({},e,{fetching:!1,error:t.payload});case"user/SET":{const a=Object(D.a)({},e,{},t.payload,{fetching:!1,error:null});return(({id:e,secret:t})=>{localStorage.setItem("U",Object(X.b)({id:e,secret:t}))})(a.access),a}case"user/RESET":return localStorage.removeItem("U"),ta;default:return e}}}),Ua=e=>{const t=Ia.compose,a=Object(Ia.createStore)(Wa,e,t(Object(Ia.applyMiddleware)(za.a.withExtraArgument({player:Ke}))));return{dispatch:a.dispatch.bind(a),getState:a.getState.bind(a),store:a}};a(116);!function(e){if("serviceWorker"in navigator){if(console.debug("PWA register 1",""),new URL("",window.location.href).origin!==window.location.origin)return void console.debug("PWA register 2");window.addEventListener("load",()=>{const t="".concat("","/service-worker.js");console.debug("PWA register 3"),La?(console.debug("PWA register 4"),function(e,t){console.debug("PWA checkValidServiceWorker 1"),fetch(e,{headers:{"Service-Worker":"script"}}).then(a=>{const r=a.headers.get("content-type");console.debug("PWA checkValidServiceWorker 2",r,a.status),404===a.status||null!=r&&-1===r.indexOf("javascript")?navigator.serviceWorker.ready.then(e=>{e.unregister().then(()=>{window.location.reload()})}):Aa(e,t)}).catch(()=>{console.debug("No internet connection found. App is running in offline mode.")})}(t,e),navigator.serviceWorker.ready.then(()=>{console.debug("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")})):(console.debug("PWA register 5"),Aa(t,e))})}}(),function(){var e=Object(c.a)(n.a.mark((function e(){return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Ta(),e.abrupt("return",Ua());case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()().then(({store:e})=>{s.render(o.createElement(l.a,{store:e},o.createElement(u.a,null,o.createElement(d.b,{path:"/",component:Na}))),document.getElementById("root"))})},16:function(e,t,a){"use strict";(function(e){a.d(t,"b",(function(){return r})),a.d(t,"a",(function(){return n}));const r=t=>e.from(JSON.stringify(t)).toString("base64"),n=t=>JSON.parse(e.from(t,"base64").toString("ascii"))}).call(this,a(88).Buffer)},60:function(e,t,a){e.exports=a(117)},82:function(e,t,a){},83:function(e,t,a){},84:function(e,t,a){},86:function(e,t,a){},87:function(e,t,a){},97:function(e,t,a){},98:function(e,t,a){},99:function(e,t,a){}},[[60,1,2]]]);
//# sourceMappingURL=main.ba4f935c.chunk.js.map