{"version":3,"sources":["reducers/medias.ts","reducers/messages.ts","reducers/modals.ts","reducers/room.ts","utils/users.ts","reducers/user.ts","reducers/index.ts","components/Common/Icon.tsx","components/Common/IconButton.tsx","utils/clipboard.ts","selectors/room.ts","actions/index.ts","actions/messages.ts","actions/modals.ts","components/Room/Head.tsx","components/Common/LoadingIcon.tsx","components/Room/Cover.tsx","components/Room/Medias.tsx","components/Room/QueueItem.tsx","selectors/medias.ts","config/firebase.ts","utils/firebase.ts","utils/medias.ts","utils/player.ts","utils/index.ts","utils/jsonp.ts","utils/deezer.ts","utils/providers.ts","actions/medias.ts","utils/messages.ts","utils/colorpicker.ts","utils/history.ts","actions/room.ts","actions/player.ts","utils/rooms.ts","actions/queue.ts","components/Room/Queue.tsx","components/Room/Progress.tsx","components/Room/Controls.tsx","pages/Room.tsx","actions/user.ts","pages/Splash.tsx","components/Modals/Modal.tsx","components/Modals/FormModal.tsx","components/Common/CancelButton.tsx","components/Modals/ConfirmModal.tsx","components/Modals/ModalFields.tsx","components/Users/ConnectUserModal.tsx","components/Room/CreateRoomModal.tsx","components/Users/CreateUserModal.tsx","components/Room/SearchResultCategory.tsx","components/Room/SearchModal.tsx","components/Room/JoinRoomModal.tsx","components/Room/UnlockRoomModal.tsx","components/Modals/index.tsx","selectors/messages.ts","components/App/Messages.tsx","pages/App.tsx","locales/en.ts","locales/fr.ts","utils/i18n.ts","serviceWorker.ts","index.tsx"],"names":["INITIAL_STATE","error","fetching","medias","deezer","album","playlist","track","initialState","stack","access","id","secret","color","fg","bg","r","g","b","info","room","tracks","loadUserAccess","res","s","localStorage","getItem","d","JSON","parse","atob","i","console","debug","err","user","rootReducer","combineReducers","state","action","type","payload","copy","media","provider","messages","filter","other","modals","pop","setItem","btoa","stringify","saveUserAccess","removeItem","Icon","React","memo","className","icon","size","title","classNames","name","style","IconButton","disabled","displayTitle","kind","onClick","aria-label","clickable","copyToClipboard","value","a","Promise","resolve","elem","document","createElement","setAttribute","position","left","body","appendChild","selection","getSelection","selected","rangeCount","getRangeAt","select","execCommand","removeAllRanges","addRange","removeChild","selectRoom","isRoomLoaded","isRoomLocked","isRoomPlaying","playing","createAction","MESSAGE_ID_GENERATOR","displayMessage","text","duration","dispatch","stamp","Date","getTime","setTimeout","removeMessage","displayError","displayInfo","openModal","prereq","popModal","confirmModal","question","onConfirmed","onCanceled","window","confirm","Head","useDispatch","t","useTranslation","history","useHistory","useSelector","tracksCount","length","onCopy","useCallback","location","href","split","onExit","push","count","LoadingIcon","Cover","playable","image","onPlay","onStop","backgroundImage","Media","actions","cover_small","link","target","rel","artist","picture_small","preview","QueueItem","locked","onRemove","selectTracks","config","appIDs","process","APPS","DEFAULT_APP_ID","createOrGetApp","appId","databaseURL","app","firebase","database","members","ref","rooms","users","FirebaseRoom","_room","child","_info","_members","_secret","isLocked","setSecret","newSecret","oldSecret","wait","reject","once","snapshot","newValues","val","Error","subscribe","cb","on","subscribeMembers","cbAdded","cbRemoved","unsubscribe","off","unsubscribeMembers","update","queue","queue_position","set","timestamp","ServerValue","TIMESTAMP","FirebaseUser","_user","_membership","_values","online","room_id","status","installDisconnect","onDisconnect","cancel","enter","remove","exit","MEDIA_TYPE_DEFINITIONS","label","findMediaInDict","findMedia","dist","list","find","item","findMediaInList","findPreview","oldMedias","newMedias","extractTracks","accesses","contextId","contextType","container","findContextFromTrackIndex","trackIndex","allMedias","index","mediaIndex","mediaFirstTrackIndex","mediaSize","AUDIO_CONTEXT","getContext","AudioContext","webkitAudioContext","decodeAudioData","encodedBuffer","loadAudioBuffer","trackId","url","req","XMLHttpRequest","open","responseType","addEventListener","response","send","AUDIO_BUFFER_CACHES","loadAudioBufferWithCache","buffer","findIndex","splice","fixAudioContext","removeEventListener","context","createBuffer","source","createBufferSource","connect","destination","start","PlayerImpl","chainPlay","analyserNode","gainNode","_node","_buffer","_sourceNode","_sourceNodeStartTime","_trackId","_trackPosition","getOrCreateNode","createGain","gain","createAnalyser","fftSize","play","trackPosition","trackUrl","offset","stop","loop","loopStart","loopEnd","onended","playbackRate","currentTime","getPlayingTrackID","getPlayingTrackPercent","getPlayingTrackPosition","isPlaying","QUEUE_PLAYER","PREVIEW_PLAYER","sleep","delay","asyncJsonp","qs","jsonp","data","message","ConvertAlbum","toString","picture_big","cover_big","readable","map","ConvertTrack","ConvertPlaylist","DEFAULT_API","_call","path","_search","query","options","encodeURIComponent","limit","_load","ids","all","_loadWithRetry","first","includes","subIds","subIndexes","forEach","subMedias","subIndex","searchAlbums","searchPlaylists","public","searchTracks","loadAlbums","albums","loadPlaylists","playlists","creator","loadTracks","DeezerApiImpl","load","indexOf","loadNew","newAccesses","self","newMediasAndTracks","search","setMedias","previewMedia","getState","extractErrorMessage","CACHE","DEFAULT_COLOR","pickColor","jimp","resize","getPixelColor","pixel","createHashHistory","setRoom","values","createRoom","v4","enterRoom","exitRoom","newRoom","_watchRoom","_unwatchPlayer","_unwatchRoom","lockRoom","unlockRoom","ROOM_WATCHER","oldInfo","newInfo","Object","entries","sort","media1","media2","Number","_watchPlayer","PLAYER_TIMER","_computeNextPosition","player","nextIndex","playingTrackID","playingTrackIndex","nextTrackIndex","nextAccess","nextTrack","clearTimeout","startPlayer","stopPlayer","createQueueMerging","accesses1","accesses2","createQueueRemoving","clearQueue","appendToQueue","removeFromQueue","removedTrackIndex","removedMediaFirstTrackIndex","removedMediaIndex","removedTrackCount","keys","setQueuePosition","newTrackIndex","oldTrackIndex","moveBackward","moveForward","Queue","loaded","playingIndex","onSearch","props","QueueList","EmptyQueueList","key","Progress","useState","setValue","useEffect","timer","setInterval","clearInterval","max","Controls","onClear","onLock","onUnlock","onMoveBackward","onMoveForward","Room","useLocation","useParams","substr","backgroundColor","setUser","createUser","connectUser","FIREBASE_CB","disconnectUser","newUser","reconnectUser","Splash","loggedIn","onCreateRoom","onJoinRoom","onConnectUser","to","src","height","alt","Modal","children","renderFoot","onSubmit","has_prev_modal","onClose","onPop","event","preventDefault","hidden","FormModal","renderButtons","CancelButton","ConfirmModal","onCancel","ModalField","InputField","forwardRef","htmlFor","SecretField","onChange","placeholder","onCopyToClipboard","display","flexDirection","justifyContent","flexGrow","marginRight","autoComplete","maxLength","minLength","required","e","ConnectUserModal","setId","idRef","useRef","current","focus","onConnect","trim","onToggle","ROOM_COUNTER","CreateRoomModal","setName","nameRef","onCreate","USER_COUNTER","CreateUserModal","SearchResultCategory","items","onViewMore","SearchModal","queryRef","playingMediaId","setPlayingMediaId","playingMediaProvider","setPlayingMediaProvider","playingMediaType","setPlayingMediaType","setQuery","results","setResults","onSelect","onStartPreview","onStopPreview","JoinRoomModal","onJoin","UnlockRoomModal","secretRef","Modals","currPrereq","setCurrPrereq","prevPrereq","setPrevPrereq","onPopModal","keyDown","keyCode","modal","getModal","in","timeout","unmountOnExit","stopPropagation","role","selectMessages","m1","m2","Messages","App","exact","component","splash","CGU","powered_with","description","errors","invalid","confirm_disconnect","connection","create","disconnect","id_is_invalid","id_placeholder","name_is_invalid","name_placeholder","secret_is_invalid","secret_placeholder","user_creation","clear","confirm_clear","confirm_exit","confirm_lock","copy_link","empty","empty_for_now","key_placeholder","join","link_copied_to_clipboard","loading","room_creation","room_join","room_unlocking","unlock","unlocked","track_count","track_count_plural","by","add","search_placeholder","medias_search","cannot_decode_audio_data","cannot_load_audio_buffer","backward","forward","copy_to_clipboard","secret_copied_to_clipboard","initLocales","navigator","language","userLanguage","i18next","use","initReactI18next","init","fallbackLng","lng","resources","en","translation","fr","interpolation","escapeValue","format","isLocalhost","Boolean","hostname","match","registerValidSW","swUrl","log","serviceWorker","register","then","registration","onupdatefound","installingWorker","installing","onstatechange","controller","onUpdate","onSuccess","catch","URL","origin","fetch","headers","contentType","get","ready","unregister","reload","checkValidServiceWorker","registerServiceWorker","composeEnhancers","compose","store","createStore","applyMiddleware","thunk","withExtraArgument","ReactDOM","getElementById"],"mappings":"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","file":"static/js/main.24c55b42.chunk.js","sourcesContent":["import { Reducer } from \"redux\";\nimport { AxiosError } from \"axios\";\nimport { MediasAction } from \"../actions/medias\";\nimport { StructuredMedias } from \"../utils/medias\";\n\n// ------------------------------------------------------------------\n\nexport type State = {\n\terror: null | AxiosError;\n\tfetching: boolean;\n\tmedias: StructuredMedias;\n};\n\nconst INITIAL_STATE: State = {\n\terror: null,\n\tfetching: false,\n\tmedias: {\n\t\t// keys are ProvideType\n\t\tdeezer: {\n\t\t\t// keys are MediaType\n\t\t\talbum: {},\n\t\t\tplaylist: {},\n\t\t\ttrack: {}\n\t\t}\n\t}\n};\n\n// ------------------------------------------------------------------\n\nexport const mediasReducer: Reducer<State, MediasAction> = (\n\tstate = INITIAL_STATE,\n\taction: MediasAction\n): State => {\n\tswitch (action.type) {\n\t\tcase \"medias/FETCHING\":\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tfetching: true,\n\t\t\t\terror: null\n\t\t\t};\n\t\tcase \"medias/FETCHED\": {\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tfetching: false,\n\t\t\t\terror: null\n\t\t\t};\n\t\t}\n\t\tcase \"medias/ERROR\":\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tfetching: false,\n\t\t\t\terror: action.payload\n\t\t\t};\n\t\tcase \"medias/SET\": {\n\t\t\tconst copy = {\n\t\t\t\t...state,\n\t\t\t\tmedias: {\n\t\t\t\t\t// keys are ProvideType\n\t\t\t\t\tdeezer: {\n\t\t\t\t\t\t// keys are MediaType\n\t\t\t\t\t\talbum: { ...state.medias.deezer.album },\n\t\t\t\t\t\tplaylist: { ...state.medias.deezer.playlist },\n\t\t\t\t\t\ttrack: { ...state.medias.deezer.track }\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t\tfor (const media of action.payload) {\n\t\t\t\tcopy.medias[media.provider][media.type][media.id] = media;\n\t\t\t}\n\t\t\treturn copy;\n\t\t}\n\t\tcase \"medias/RESET\":\n\t\t\treturn INITIAL_STATE;\n\t\tdefault:\n\t\t\treturn state;\n\t}\n};\n","import { Reducer } from \"redux\";\nimport { MessagesAction } from \"../actions/messages\";\nimport { Message } from \"../utils/messages\";\n\n// ------------------------------------------------------------------\n\nexport type State = Message[];\n\nexport const INITIAL_STATE: State = [];\n\n// ------------------------------------------------------------------\n\nexport const messagesReducer: Reducer<State, MessagesAction> = (\n\tstate = INITIAL_STATE,\n\taction\n): State => {\n\tswitch (action.type) {\n\t\tcase \"message/ADD\":\n\t\t\treturn [action.payload, ...state];\n\t\tcase \"message/REMOVE\":\n\t\t\treturn state.filter(other => other.id !== action.payload);\n\t\tcase \"message/RESET\":\n\t\t\treturn INITIAL_STATE;\n\t\tdefault:\n\t\t\treturn state;\n\t}\n};\n","import { Reducer } from \"redux\";\nimport { ModalsAction, ModalPrereq } from \"../actions/modals\";\n\n// ------------------------------------------------------------------\n\nexport type ModalsState = {\n\tstack: ModalPrereq[];\n};\n\n// ------------------------------------------------------------------\n\nexport const initialState: ModalsState = {\n\tstack: []\n};\n\n// ------------------------------------------------------------------\n\nexport const modalsReducer: Reducer<ModalsState, ModalsAction> = (\n\tstate = initialState,\n\taction\n): ModalsState => {\n\tswitch (action.type) {\n\t\tcase \"modals/OPEN\":\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tstack: [action.payload]\n\t\t\t};\n\t\tcase \"modals/CLOSE\":\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tstack: []\n\t\t\t};\n\t\tcase \"modals/PUSH\":\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tstack: [...state.stack, action.payload]\n\t\t\t};\n\t\tcase \"modals/POP\":\n\t\t\tconst copy = [...state.stack];\n\t\t\tcopy.pop();\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tstack: copy\n\t\t\t};\n\t\tdefault:\n\t\t\treturn state;\n\t}\n};\n","import { Reducer } from \"redux\";\nimport { AxiosError } from \"axios\";\nimport { RoomAction } from \"../actions/room\";\nimport { RoomAccess, RoomInfo } from \"../utils/rooms\";\nimport { CombinedColor } from \"../utils/colorpicker\";\nimport { FirebaseRoom } from \"../utils/firebase\";\nimport { ContextualizedTrackAccess, MediaAccess } from \"../utils/medias\";\n\n// ------------------------------------------------------------------\n\nexport type RoomData = {\n\taccess: RoomAccess;\n\tcolor: CombinedColor;\n\tinfo: RoomInfo | null;\n\tmedias: MediaAccess[];\n\troom: ReturnType<typeof FirebaseRoom> | null;\n\ttracks: Array<ContextualizedTrackAccess>; // TODO expanded medias (containers are replaced by their tracks)\n};\n\nexport type State = RoomData & {\n\tfetching: boolean;\n\terror: null | AxiosError;\n};\n\nconst INITIAL_STATE: State = {\n\taccess: { id: \"\", secret: \"\" },\n\tcolor: { fg: \"dark\", bg: { r: 255, g: 255, b: 255 } },\n\terror: null,\n\tfetching: false,\n\tinfo: null,\n\tmedias: [],\n\troom: null,\n\ttracks: []\n};\n\n// ------------------------------------------------------------------\n\nexport const roomReducer: Reducer<State, RoomAction> = (\n\tstate = INITIAL_STATE,\n\taction: RoomAction\n): State => {\n\tswitch (action.type) {\n\t\tcase \"room/FETCHING\":\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tfetching: true,\n\t\t\t\terror: null\n\t\t\t};\n\t\tcase \"room/FETCHED\":\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tfetching: false,\n\t\t\t\terror: null\n\t\t\t};\n\t\tcase \"room/ERROR\":\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tfetching: false,\n\t\t\t\terror: action.payload\n\t\t\t};\n\t\tcase \"room/SET\":\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\t...action.payload\n\t\t\t};\n\t\tcase \"room/RESET\":\n\t\t\treturn INITIAL_STATE;\n\t\tdefault:\n\t\t\treturn state;\n\t}\n};\n","export type UserInfo = {\n\tname: string;\n\tonline: boolean;\n\troom_id: string;\n\tstatus: string;\n\ttimestamp: number;\n};\n\nexport type UserAccess = {\n\tid: string;\n\tsecret: string;\n};\n\n// ------------------------------------------------------------------\n\nexport const loadUserAccess = (): UserAccess => {\n\tconst res: UserAccess = {\n\t\tid: \"\",\n\t\tsecret: \"\"\n\t};\n\tconst s = localStorage.getItem(\"U\");\n\tif (s) {\n\t\ttry {\n\t\t\tconst d = JSON.parse(atob(s));\n\t\t\tif (typeof d.i === \"string\" && typeof d.s === \"string\") {\n\t\t\t\tres.id = d.i;\n\t\t\t\tres.secret = d.s;\n\t\t\t\tconsole.debug(\"Loaded user access: \", res);\n\t\t\t}\n\t\t} catch (err) {}\n\t}\n\treturn res;\n};\n\nexport const deleteUserAccess = () => {\n\tlocalStorage.removeItem(\"U\");\n};\n\nexport const saveUserAccess = ({ id, secret }: UserAccess) => {\n\tlocalStorage.setItem(\n\t\t\"U\",\n\t\tbtoa(\n\t\t\tJSON.stringify({\n\t\t\t\ti: id,\n\t\t\t\ts: secret\n\t\t\t})\n\t\t)\n\t);\n};\n","import { Reducer } from \"redux\";\nimport { AxiosError } from \"axios\";\nimport { UserAction } from \"../actions/user\";\nimport {\n\tdeleteUserAccess,\n\tsaveUserAccess,\n\tloadUserAccess,\n\tUserAccess,\n\tUserInfo\n} from \"../utils/users\";\nimport { FirebaseUser } from \"../utils/firebase\";\n\n// ------------------------------------------------------------------\n\nexport type UserData = {\n\tuser: ReturnType<typeof FirebaseUser> | null;\n\taccess: UserAccess;\n\tinfo: UserInfo | null;\n};\n\nexport type State = UserData & {\n\tfetching: boolean;\n\terror: null | AxiosError;\n};\n\nconst INITIAL_STATE: State = {\n\taccess: { id: \"\", secret: \"\" },\n\terror: null,\n\tfetching: false,\n\tinfo: null,\n\tuser: null\n};\n\n// ------------------------------------------------------------------\n\nexport const userReducer: Reducer<State, UserAction> = (\n\tstate = { ...INITIAL_STATE, access: loadUserAccess() },\n\taction: UserAction\n): State => {\n\tswitch (action.type) {\n\t\tcase \"user/FETCHING\":\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tfetching: true,\n\t\t\t\terror: null\n\t\t\t};\n\t\tcase \"user/FETCHED\": {\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tfetching: false,\n\t\t\t\terror: null\n\t\t\t};\n\t\t}\n\t\tcase \"user/ERROR\":\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tfetching: false,\n\t\t\t\terror: action.payload\n\t\t\t};\n\t\tcase \"user/SET\": {\n\t\t\tconst copy = {\n\t\t\t\t...state,\n\t\t\t\t...action.payload\n\t\t\t};\n\t\t\tsaveUserAccess(copy.access);\n\t\t\treturn copy;\n\t\t}\n\t\tcase \"user/RESET\":\n\t\t\tdeleteUserAccess();\n\t\t\treturn INITIAL_STATE;\n\t\tdefault:\n\t\t\treturn state;\n\t}\n};\n","import { combineReducers } from \"redux\";\nimport { mediasReducer as medias } from \"./medias\";\nimport { messagesReducer as messages } from \"./messages\";\nimport { modalsReducer as modals } from \"./modals\";\nimport { roomReducer as room } from \"./room\";\nimport { userReducer as user } from \"./user\";\n\nexport type RootState = ReturnType<typeof rootReducer>;\n\nexport const rootReducer = combineReducers({\n\tmedias,\n\tmessages,\n\tmodals,\n\troom,\n\tuser\n});\n","import React from \"react\";\nimport FontAwesome from \"react-fontawesome\";\nimport classNames from \"classnames\";\n//\nimport \"./Icon.scss\";\n\n// ------------------------------------------------------------------\n\nexport const Icon = React.memo(\n\t({\n\t\tclassName,\n\t\tcolor,\n\t\ticon,\n\t\tsize = \"M\",\n\t\ttitle\n\t}: {\n\t\tclassName?: string;\n\t\tcolor?: string;\n\t\ticon: string;\n\t\tsize?: \"S\" | \"M\" | \"L\";\n\t\ttitle?: string;\n\t}) => (\n\t\t<FontAwesome\n\t\t\tclassName={classNames(\"Icon\", className, size)}\n\t\t\tname={icon}\n\t\t\tstyle={{ color }}\n\t\t\ttitle={title}\n\t\t/>\n\t)\n);\n","import React from \"react\";\nimport classNames from \"classnames\";\n//\nimport { Icon } from \"./Icon\";\nimport \"./IconButton.scss\";\n\n// ------------------------------------------------------------------\n\ntype ButtonType = \"button\" | \"submit\";\n\nexport const IconButton = React.memo(\n\t({\n\t\tclassName,\n\t\tcolor,\n\t\tdisabled = false,\n\t\tdisplayTitle = false,\n\t\ticon,\n\t\tkind = \"default\",\n\t\tonClick,\n\t\tsize,\n\t\ttitle,\n\t\ttype = \"button\"\n\t}: {\n\t\tclassName?: string;\n\t\tcolor?: string;\n\t\tdisabled?: boolean;\n\t\tdisplayTitle?: boolean;\n\t\ticon: string;\n\t\tkind?: \"default\" | \"primary\" | \"danger\" | \"special\";\n\t\tonClick?: () => void;\n\t\tsize?: \"S\" | \"M\" | \"L\";\n\t\ttitle: string;\n\t\ttype?: ButtonType;\n\t}) => (\n\t\t<button\n\t\t\ttype={type}\n\t\t\taria-label={title}\n\t\t\tclassName={classNames(\"IconButton\", className, kind, {\n\t\t\t\tclickable: !disabled && (!!onClick || type === \"submit\")\n\t\t\t})}\n\t\t\tonClick={disabled ? void 0 : onClick}\n\t\t\ttitle={title}>\n\t\t\t<Icon color={color} icon={icon} size={size} />\n\t\t\t{displayTitle && (\n\t\t\t\t<div className={classNames(\"IconButtonTitle\", size)}>\n\t\t\t\t\t{title}\n\t\t\t\t</div>\n\t\t\t)}\n\t\t</button>\n\t)\n);\n","// https://hackernoon.com/copying-text-to-clipboard-with-javascript-df4d4988697f\nexport const copyToClipboard = async (value: string): Promise<void> =>\n\tawait new Promise(resolve => {\n\t\tconst elem = document.createElement(\"textarea\");\n\t\telem.value = value;\n\t\telem.setAttribute(\"readonly\", \"\");\n\t\telem.style.position = \"absolute\";\n\t\telem.style.left = \"-9999px\";\n\n\t\tdocument.body.appendChild(elem);\n\t\tconst selection = document.getSelection();\n\t\tif (selection !== null) {\n\t\t\tconst selected =\n\t\t\t\tselection.rangeCount > 0 ? selection.getRangeAt(0) : false;\n\t\t\telem.select();\n\t\t\tdocument.execCommand(\"copy\");\n\t\t\tif (selected !== false) {\n\t\t\t\tselection.removeAllRanges();\n\t\t\t\tselection.addRange(selected);\n\t\t\t}\n\t\t}\n\t\tdocument.body.removeChild(elem);\n\t\tresolve();\n\t});\n","import { RootState } from \"../reducers\";\n\nexport const selectRoom = (state: RootState) => state.room.info;\n\nexport const isRoomLoaded = (state: RootState) => !!state.room.room;\n\nexport const isRoomLocked = (state: RootState) => !state.room.access.secret;\n\nexport const isRoomPlaying = (state: RootState) =>\n\tnull !== state.room.info && state.room.info.playing;\n","import { AnyAction } from \"redux\";\nimport { ThunkAction, ThunkDispatch } from \"redux-thunk\";\n//\nimport { Player } from \"../utils/player\";\nimport { RootState } from \"../reducers\";\n\n// ------------------------------------------------------------------\n\nexport type Action<T extends string> = {\n\ttype: T;\n};\n\nexport type ActionWithPayload<T extends string, P> = {\n\ttype: T;\n\tpayload: P;\n};\n\nexport type Extended = {\n\tplayer: Player;\n};\n\nexport type Dispatch = ThunkDispatch<RootState, Extended, AnyAction>;\n\nexport type AsyncAction = ThunkAction<void, RootState, Extended, AnyAction>;\n\nexport function createAction<T extends string>(type: T): Action<T>;\n\nexport function createAction<T extends string, P>(\n\ttype: T,\n\tpayload: P\n): ActionWithPayload<T, P>;\n\nexport function createAction<T extends string, P>(type: T, payload?: P) {\n\treturn payload === void 0 ? { type } : { type, payload };\n}\n","import { createAction, AsyncAction } from \".\";\nimport { Message, MessageType } from \"../utils/messages\";\n\n// ------------------------------------------------------------------\n\nexport type MessagesAction =\n\t| ReturnType<typeof addMessage>\n\t| ReturnType<typeof clearMessages>\n\t| ReturnType<typeof removeMessage>;\n\nconst addMessage = (message: Message) => createAction(\"message/ADD\", message);\n\nconst removeMessage = (id: number) => createAction(\"message/REMOVE\", id);\n\nconst clearMessages = () => createAction(\"message/RESET\");\n\n// ------------------------------------------------------------------\n\nlet MESSAGE_ID_GENERATOR: number = 0;\n\nexport const displayMessage = (\n\ttype: MessageType,\n\ttext: string,\n\tduration: number = 5000\n): AsyncAction => (dispatch): any => {\n\tconst id = MESSAGE_ID_GENERATOR++;\n\tdispatch(addMessage({ id, stamp: new Date().getTime(), text, type }));\n\tsetTimeout(() => dispatch(removeMessage(id)), duration);\n};\n\nexport const displayError = (text: string): AsyncAction => (dispatch): any => {\n\tdispatch(displayMessage(\"error\", text, 3000));\n};\n\nexport const displayInfo = (text: string) => displayMessage(\"info\", text, 3000);\n","import { createAction, AsyncAction } from \".\";\n\n// ------------------------------------------------------------------\n\nexport type ModalPrereqT<T extends string, P> = {\n\ttype: T;\n\tprops: P;\n};\n\nexport type ModalPrereq =\n\t| ModalPrereqT<\n\t\t\t\"Confirm\",\n\t\t\t{\n\t\t\t\tquestion: string;\n\t\t\t\tonCanceled?: () => void;\n\t\t\t\tonConfirmed: () => void;\n\t\t\t}\n\t  >\n\t| ModalPrereqT<\"ConnectUser\", null>\n\t| ModalPrereqT<\"CreateRoom\", null>\n\t| ModalPrereqT<\"CreateUser\", null>\n\t| ModalPrereqT<\"JoinRoom\", null>\n\t| ModalPrereqT<\"Search\", null>\n\t| ModalPrereqT<\"UnlockRoom\", null>;\n\n// ------------------------------------------------------------------\n\nexport type ModalsAction =\n\t| ReturnType<typeof closeModal>\n\t| ReturnType<typeof openModal>\n\t| ReturnType<typeof popModal>\n\t| ReturnType<typeof pushModal>;\n\n// ------------------------------------------------------------------\n\nexport const openModal = (prereq: ModalPrereq) =>\n\tcreateAction(\"modals/OPEN\", prereq);\n\nexport const closeModal = () => createAction(\"modals/CLOSE\");\n\n// ------------------------------------------------------------------\n\nexport const pushModal = (prereq: ModalPrereq) =>\n\tcreateAction(\"modals/PUSH\", prereq);\n\nexport const popModal = () => createAction(\"modals/POP\");\n\n// ------------------------------------------------------------------\n\nexport const confirmModal = (\n\tquestion: string,\n\tonConfirmed: () => void,\n\tonCanceled?: () => void\n): AsyncAction => async () => {\n\t// TODO: open custom ConfirmModal instead of system popup\n\tif (window.confirm(question)) {\n\t\tonConfirmed();\n\t\treturn;\n\t}\n\tif (onCanceled) {\n\t\tonCanceled();\n\t}\n};\n","import React, { useCallback } from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { useTranslation } from \"react-i18next\";\nimport { useHistory } from \"react-router-dom\";\n//\nimport { IconButton } from \"../Common/IconButton\";\nimport { copyToClipboard } from \"../../utils/clipboard\";\nimport { Dispatch } from \"../../actions\";\nimport { RootState } from \"../../reducers\";\nimport { selectRoom } from \"../../selectors/room\";\nimport { displayInfo } from \"../../actions/messages\";\nimport { confirmModal } from \"../../actions/modals\";\nimport { RoomInfo } from \"../../utils/rooms\";\nimport \"./Head.scss\";\n\n// ------------------------------------------------------------------\n\nexport const Head = () => {\n\tconst dispatch = useDispatch<Dispatch>();\n\tconst { t } = useTranslation();\n\tconst history = useHistory();\n\tconst room = useSelector<RootState, RoomInfo | null>(selectRoom);\n\tconst tracksCount = useSelector<RootState, number>(\n\t\tstate => state.room.medias.length\n\t);\n\n\tconst onCopy = useCallback(async () => {\n\t\tawait copyToClipboard(document.location.href.split(\"?\")[0]);\n\t\tdispatch(displayInfo(\"rooms.link_copied_to_clipboard\"));\n\t}, [dispatch]);\n\n\tconst onExit = useCallback(() => {\n\t\tdispatch(\n\t\t\tconfirmModal(t(\"rooms.confirm_exit\"), () => {\n\t\t\t\thistory.push(\"/\");\n\t\t\t})\n\t\t);\n\t}, [t, dispatch, history]);\n\n\treturn (\n\t\t<div className=\"Head\">\n\t\t\t<div className=\"HeadInner\">\n\t\t\t\t<div className=\"RoomLink\">\n\t\t\t\t\t<IconButton\n\t\t\t\t\t\ticon=\"link\"\n\t\t\t\t\t\tonClick={onCopy}\n\t\t\t\t\t\tsize=\"M\"\n\t\t\t\t\t\ttitle={t(\"rooms.copy_link\")}\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div className=\"RoomMeta\">\n\t\t\t\t\t{room ? (\n\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t<div className=\"RoomName\">{room.name}</div>\n\t\t\t\t\t\t\t<div className=\"RoomSize\">\n\t\t\t\t\t\t\t\t&nbsp;--&nbsp;\n\t\t\t\t\t\t\t\t{t(\"rooms.track_count\", { count: tracksCount })}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</>\n\t\t\t\t\t) : null}\n\t\t\t\t</div>\n\t\t\t\t<div className=\"RoomExit\">\n\t\t\t\t\t<IconButton\n\t\t\t\t\t\tonClick={onExit}\n\t\t\t\t\t\ticon=\"sign-out\"\n\t\t\t\t\t\tsize=\"M\"\n\t\t\t\t\t\ttitle={t(\"rooms.exit\")}\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t);\n};\n","import React from \"react\";\nimport { Icon } from \"./Icon\";\n\n// ------------------------------------------------------------------\n\nexport const LoadingIcon = React.memo(\n\t({ size }: { size?: \"S\" | \"M\" | \"L\" }) => (\n\t\t<Icon\n\t\t\tclassName=\"rotating\"\n\t\t\ticon=\"circle-o-notch\"\n\t\t\tsize={size}\n\t\t\ttitle=\"Loading\"\n\t\t/>\n\t)\n);\n","import React from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport classNames from \"classnames\";\n//\nimport { Icon } from \"../Common/Icon\";\nimport \"./Cover.scss\";\n\n// ------------------------------------------------------------------\n\nexport const Cover = React.memo(\n\t({\n\t\tplayable,\n\t\tplaying,\n\t\timage,\n\t\tonPlay,\n\t\tonStop\n\t}: {\n\t\timage: string;\n\t\tonPlay: () => void;\n\t\tonStop: () => void;\n\t\tplayable: boolean;\n\t\tplaying: boolean;\n\t}) => {\n\t\tconst { t } = useTranslation();\n\t\tif (playable) {\n\t\t\treturn (\n\t\t\t\t<div\n\t\t\t\t\tclassName={classNames(\"Cover\", { playable, playing })}\n\t\t\t\t\tstyle={image ? { backgroundImage: `url('${image}')` } : {}}\n\t\t\t\t\tonClick={!playing ? onPlay : onStop}>\n\t\t\t\t\t{!playing ? (\n\t\t\t\t\t\t<Icon icon=\"play\" size=\"S\" title={t(\"player.play\")} />\n\t\t\t\t\t) : (\n\t\t\t\t\t\t<Icon icon=\"pause\" size=\"S\" title={t(\"player.stop\")} />\n\t\t\t\t\t)}\n\t\t\t\t</div>\n\t\t\t);\n\t\t} else {\n\t\t\treturn (\n\t\t\t\t<div\n\t\t\t\t\tclassName={classNames(\"Cover\", { playing })}\n\t\t\t\t\tstyle={image ? { backgroundImage: `url('${image}')` } : {}}>\n\t\t\t\t\t{playing ? (\n\t\t\t\t\t\t<Icon\n\t\t\t\t\t\t\ticon=\"music\"\n\t\t\t\t\t\t\tsize=\"S\"\n\t\t\t\t\t\t\ttitle={t(\"player.playing\")}\n\t\t\t\t\t\t/>\n\t\t\t\t\t) : null}\n\t\t\t\t</div>\n\t\t\t);\n\t\t}\n\t}\n);\n","import React, { ReactNode } from \"react\";\nimport { useTranslation } from \"react-i18next\";\n//\nimport { Cover } from \"./Cover\";\nimport { LoadingIcon } from \"../Common/LoadingIcon\";\nimport { Media as MediaData } from \"../../utils/medias\";\nimport \"./Medias.scss\";\n\n// ------------------------------------------------------------------\n\nexport const Media = React.memo(\n\t({\n\t\tactions,\n\t\tmedia,\n\t\tplayable,\n\t\tplaying,\n\t\tonPlay,\n\t\tonStop\n\t}: {\n\t\tactions?: ReactNode;\n\t\tmedia: MediaData | null;\n\t\tplayable: boolean;\n\t\tplaying: boolean;\n\t\tonPlay: () => void;\n\t\tonStop: () => void;\n\t}) => {\n\t\tconst { t } = useTranslation();\n\t\tif (!media) {\n\t\t\treturn (\n\t\t\t\t<div className=\"Media\">\n\t\t\t\t\t<Cover\n\t\t\t\t\t\tplayable={playable}\n\t\t\t\t\t\tplaying={playing}\n\t\t\t\t\t\timage={\"\"}\n\t\t\t\t\t\tonPlay={onPlay}\n\t\t\t\t\t\tonStop={onStop}\n\t\t\t\t\t/>\n\t\t\t\t\t<div className=\"Metas\">\n\t\t\t\t\t\t<LoadingIcon size=\"M\" />\n\t\t\t\t\t</div>\n\t\t\t\t\t{actions ? <div className=\"Actions\">{actions}</div> : null}\n\t\t\t\t</div>\n\t\t\t);\n\t\t} else if (media.type === \"album\") {\n\t\t\treturn (\n\t\t\t\t<div className=\"Media Album\">\n\t\t\t\t\t<Cover\n\t\t\t\t\t\tplayable={playable}\n\t\t\t\t\t\tplaying={playing}\n\t\t\t\t\t\timage={media.cover_small}\n\t\t\t\t\t\tonPlay={onPlay}\n\t\t\t\t\t\tonStop={onStop}\n\t\t\t\t\t/>\n\t\t\t\t\t<div className=\"Metas\">\n\t\t\t\t\t\t<div className=\"Meta AlbumTitle\">\n\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\thref={media.link}\n\t\t\t\t\t\t\t\ttarget=\"_blank\"\n\t\t\t\t\t\t\t\trel=\"noopener noreferrer\">\n\t\t\t\t\t\t\t\t{media.title}\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className=\"Meta AlbumArtist\">\n\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\thref={media.artist.link}\n\t\t\t\t\t\t\t\ttarget=\"_blank\"\n\t\t\t\t\t\t\t\trel=\"noopener noreferrer\">\n\t\t\t\t\t\t\t\t{t(\"medias.by\", { artist: media.artist.name })}\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t{actions ? <div className=\"Actions\">{actions}</div> : null}\n\t\t\t\t</div>\n\t\t\t);\n\t\t} else if (media.type === \"playlist\") {\n\t\t\treturn (\n\t\t\t\t<div className=\"Media Playlist\">\n\t\t\t\t\t<Cover\n\t\t\t\t\t\tplayable={playable}\n\t\t\t\t\t\tplaying={playing}\n\t\t\t\t\t\timage={media.picture_small}\n\t\t\t\t\t\tonPlay={onPlay}\n\t\t\t\t\t\tonStop={onStop}\n\t\t\t\t\t/>\n\t\t\t\t\t<div className=\"Metas\">\n\t\t\t\t\t\t<div className=\"Meta PlaylistTitle\">\n\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\thref={media.link}\n\t\t\t\t\t\t\t\ttarget=\"_blank\"\n\t\t\t\t\t\t\t\trel=\"noopener noreferrer\">\n\t\t\t\t\t\t\t\t{media.title}\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className=\"Meta PlaylistCreator\">\n\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\thref={media.user.link}\n\t\t\t\t\t\t\t\ttarget=\"_blank\"\n\t\t\t\t\t\t\t\trel=\"noopener noreferrer\">\n\t\t\t\t\t\t\t\t{t(\"medias.by\", { artist: media.user.name })}\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t{actions ? <div className=\"Actions\">{actions}</div> : null}\n\t\t\t\t</div>\n\t\t\t);\n\t\t} else if (media.type === \"track\") {\n\t\t\treturn (\n\t\t\t\t<div className=\"Media Track\">\n\t\t\t\t\t<Cover\n\t\t\t\t\t\tplayable={playable && !!media.preview}\n\t\t\t\t\t\tplaying={playing}\n\t\t\t\t\t\timage={media.album.cover_small}\n\t\t\t\t\t\tonPlay={onPlay}\n\t\t\t\t\t\tonStop={onStop}\n\t\t\t\t\t/>\n\t\t\t\t\t<div className=\"Metas\">\n\t\t\t\t\t\t<div className=\"Meta TrackTitle\">\n\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\thref={media.link}\n\t\t\t\t\t\t\t\ttarget=\"_blank\"\n\t\t\t\t\t\t\t\trel=\"noopener noreferrer\">\n\t\t\t\t\t\t\t\t{media.title}\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className=\"Meta TrackArtist\">\n\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\thref={media.artist.link}\n\t\t\t\t\t\t\t\ttarget=\"_blank\"\n\t\t\t\t\t\t\t\trel=\"noopener noreferrer\">\n\t\t\t\t\t\t\t\t{t(\"medias.by\", { artist: media.artist.name })}\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t{actions ? <div className=\"Actions\">{actions}</div> : null}\n\t\t\t\t</div>\n\t\t\t);\n\t\t} else {\n\t\t\treturn null;\n\t\t}\n\t}\n);\n","import React from \"react\";\nimport { useTranslation } from \"react-i18next\";\n//\nimport { Media } from \"./Medias\";\nimport { IconButton } from \"../Common/IconButton\";\nimport { Track } from \"../../utils/medias\";\n\n// ------------------------------------------------------------------\n\nexport const QueueItem = React.memo(\n\t({\n\t\tlocked,\n\t\ttrack,\n\t\tplaying,\n\t\tonPlay,\n\t\tonRemove,\n\t\tonStop\n\t}: {\n\t\tlocked: boolean;\n\t\ttrack: Track | null; // if null : stiil loading or cannot be loaded or to reload later because of rate limit\n\t\tplaying: boolean;\n\t\tonPlay: () => void;\n\t\tonRemove: () => void;\n\t\tonStop: () => void;\n\t}) => {\n\t\tconst { t } = useTranslation();\n\t\treturn (\n\t\t\t<div className=\"QueueItem\">\n\t\t\t\t<Media\n\t\t\t\t\tmedia={track}\n\t\t\t\t\tplayable={!!track && !locked}\n\t\t\t\t\tplaying={playing}\n\t\t\t\t\tonPlay={onPlay}\n\t\t\t\t\tonStop={onStop}\n\t\t\t\t\tactions={\n\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\tdisabled={locked}\n\t\t\t\t\t\t\ttitle={t(\"medias.remove\")}\n\t\t\t\t\t\t\ticon=\"trash\"\n\t\t\t\t\t\t\tonClick={onRemove}\n\t\t\t\t\t\t/>\n\t\t\t\t\t}\n\t\t\t\t/>\n\t\t\t</div>\n\t\t);\n\t}\n);\n","import { RootState } from \"../reducers\";\nimport { Track } from \"../utils/medias\";\n\n// ------------------------------------------------------------------\n\nexport const selectTracks = (state: RootState): Array<Track | null> => {\n\tconst res: Array<Track | null> = [];\n\tconst {\n\t\tmedias: { medias },\n\t\troom: { tracks }\n\t} = state;\n\tfor (const access of tracks) {\n\t\tconst track = medias[access.provider][access.type][access.id];\n\t\tif (!!track) {\n\t\t\tres.push(track);\n\t\t} else {\n\t\t\tres.push(null); // Stiil loading or cannot be loaded or to reload later because of rate limit\n\t\t}\n\t}\n\treturn res;\n};\n","const config = {\n\tappIDs: (process.env.REACT_APP_DATABASE_ID || \"\").split(\"|\")\n};\n\n// console.debug('[Firebase] Config', config);\n\nexport default config;\n","import * as firebase from \"firebase/app\";\nimport \"firebase/database\";\n//\nimport firebaseConfig from \"../config/firebase\";\nimport { RoomInfo } from \"./rooms\";\nimport { UserInfo } from \"./users\";\n\n// ------------------------------------------------------------------\n\ntype FirebaseCB = (eventType: firebase.database.DataSnapshot) => void;\n\n// ------------------------------------------------------------------\n\nconst APPS: {\n\t[id: string]: {\n\t\tapp: firebase.app.App;\n\t\tdatabase: firebase.database.Database;\n\t\tmembers: firebase.database.Reference;\n\t\trooms: firebase.database.Reference;\n\t\tusers: firebase.database.Reference;\n\t};\n} = {};\n\nconst DEFAULT_APP_ID = firebaseConfig.appIDs[0];\n\nconst createOrGetApp = (appId: string = DEFAULT_APP_ID) => {\n\tlet res = APPS[appId];\n\tif (!res) {\n\t\tconsole.debug(\"[Firebase] Creating app\", { appId });\n\t\tconst databaseURL = `https://${appId}.firebaseio.com`;\n\t\tconst app = firebase.initializeApp({ databaseURL });\n\t\tconst database = firebase.database(app);\n\t\tAPPS[appId] = res = {\n\t\t\tapp,\n\t\t\tdatabase,\n\t\t\tmembers: database.ref(\"members\"),\n\t\t\trooms: database.ref(\"rooms\"),\n\t\t\tusers: database.ref(\"users\")\n\t\t};\n\t}\n\treturn res;\n};\n\n// ------------------------------------------------------------------\n\nexport const FirebaseRoom = ({\n\tid,\n\tsecret\n}: {\n\tid: string;\n\tsecret?: string;\n}) => {\n\tconst app = createOrGetApp();\n\tconst _room = app.rooms.child(id);\n\tconst _info = _room.child(\"info\");\n\tconst _members = app.members.child(id);\n\tlet _secret = secret || \"\";\n\n\tconst isLocked = () => !_secret;\n\n\tconst setSecret = (newSecret: string) => {\n\t\tconsole.debug(\"[Firebase] Setting room secret\", {\n\t\t\toldSecret: _secret,\n\t\t\tnewSecret\n\t\t});\n\t\t_secret = newSecret;\n\t};\n\n\tconst wait = async (): Promise<RoomInfo> =>\n\t\tnew Promise((resolve, reject) => {\n\t\t\tconsole.debug(\"[Firebase] Waiting room...\");\n\t\t\t_info.once(\"value\", snapshot => {\n\t\t\t\tconst newValues = snapshot.val();\n\t\t\t\tif (newValues) {\n\t\t\t\t\tresolve(newValues);\n\t\t\t\t} else {\n\t\t\t\t\treject(new Error(\"rooms.errors.invalid\"));\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\tconst subscribe = (cb: FirebaseCB) => {\n\t\tconsole.debug(\"[Firebase] Subscribing room...\");\n\t\treturn _info.on(\"value\", cb);\n\t};\n\n\tconst unsubscribe = (cb: FirebaseCB) => {\n\t\tconsole.debug(\"[Firebase] Unsubscribing room...\");\n\t\t_info.off(\"value\", cb);\n\t};\n\n\tconst subscribeMembers = (cbAdded: FirebaseCB, cbRemoved: FirebaseCB) => {\n\t\tconsole.debug(\"[Firebase] Subscribing members...\");\n\t\t_members.on(\"child_added\", cbAdded);\n\t\t_members.on(\"child_removed\", cbRemoved);\n\t};\n\n\tconst unsubscribeMembers = (cbAdded: FirebaseCB, cbRemoved: FirebaseCB) => {\n\t\tconsole.debug(\"[Firebase] Unsubscribing members...\");\n\t\t_members.off(\"child_added\", cbAdded);\n\t\t_members.off(\"child_removed\", cbRemoved);\n\t};\n\n\tconst update = async ({\n\t\tname,\n\t\tplaying,\n\t\tqueue,\n\t\tqueue_position\n\t}: Pick<RoomInfo, \"name\" | \"playing\" | \"queue\" | \"queue_position\">) => {\n\t\tconsole.debug(\"[Firebase] Updating room...\", {\n\t\t\tname,\n\t\t\tplaying,\n\t\t\tqueue,\n\t\t\tqueue_position\n\t\t});\n\t\tawait _room.set({\n\t\t\tinfo: {\n\t\t\t\tname,\n\t\t\t\tplaying,\n\t\t\t\tqueue,\n\t\t\t\tqueue_position,\n\t\t\t\ttimestamp: firebase.database.ServerValue.TIMESTAMP\n\t\t\t},\n\t\t\tsecret: _secret\n\t\t});\n\t};\n\n\treturn {\n\t\tid,\n\t\tisLocked,\n\t\tsetSecret,\n\t\twait,\n\t\tsubscribe,\n\t\tsubscribeMembers,\n\t\tunsubscribe,\n\t\tunsubscribeMembers,\n\t\tupdate\n\t};\n};\n\n// ------------------------------------------------------------------\n\nexport const FirebaseUser = ({\n\tid,\n\tsecret\n}: {\n\tid: string;\n\tsecret?: string;\n}) => {\n\tconst app = createOrGetApp();\n\tconst _user = app.users.child(id);\n\tconst _info = _user.child(\"info\");\n\tlet _membership: firebase.database.Reference | null = null;\n\tlet _secret = secret || \"\";\n\tlet _values: UserInfo = {\n\t\tname: \"dummy\",\n\t\tonline: false,\n\t\troom_id: \"\",\n\t\tstatus: \"\",\n\t\ttimestamp: 0\n\t};\n\n\tconst isLocked = () => !_secret;\n\n\tconst setSecret = (newSecret: string) => {\n\t\tconsole.debug(\"[Firebase] Setting user secret...\", {\n\t\t\toldSecret: _secret,\n\t\t\tnewSecret\n\t\t});\n\t\t_secret = newSecret;\n\t};\n\n\tconst wait = async (): Promise<UserInfo> =>\n\t\tnew Promise((resolve, reject) => {\n\t\t\tconsole.debug(\"[Firebase] Waiting user...\");\n\t\t\t_info.once(\"value\", snapshot => {\n\t\t\t\tconst newValues = snapshot.val();\n\t\t\t\tif (newValues) {\n\t\t\t\t\t_values = newValues;\n\t\t\t\t\tresolve(newValues);\n\t\t\t\t} else {\n\t\t\t\t\treject(new Error(\"users.errors.invalid\"));\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\tconst subscribe = (cb: FirebaseCB) => {\n\t\tconsole.debug(\"[Firebase] Subscribing user...\");\n\t\treturn _info.on(\"value\", cb);\n\t};\n\n\tconst unsubscribe = (cb: FirebaseCB) => {\n\t\tconsole.debug(\"[Firebase] Unsubscribing user...\");\n\t\t_info.off(\"value\", cb);\n\t};\n\n\tconst update = async ({\n\t\tname,\n\t\troom_id\n\t}: Partial<Pick<UserInfo, \"name\" | \"room_id\">>) => {\n\t\tconsole.debug(\"[Firebase] Updating user...\", { name, room_id });\n\t\tif (name !== void 0) {\n\t\t\t_values.name = name;\n\t\t}\n\t\tif (room_id !== void 0) {\n\t\t\t_values.room_id = room_id;\n\t\t}\n\t\tawait _user.set({\n\t\t\tinfo: {\n\t\t\t\t..._values,\n\t\t\t\tonline: true,\n\t\t\t\tstatus: \"online\",\n\t\t\t\ttimestamp: firebase.database.ServerValue.TIMESTAMP\n\t\t\t},\n\t\t\tsecret: _secret\n\t\t});\n\t\tinstallDisconnect();\n\t};\n\n\tconst installDisconnect = () => {\n\t\tconsole.debug(\"[Firebase] Installing user disconnect...\");\n\t\t_user.onDisconnect().cancel();\n\t\t_user.onDisconnect().set({\n\t\t\tinfo: {\n\t\t\t\t..._values,\n\t\t\t\tonline: false,\n\t\t\t\troom_id: \"\",\n\t\t\t\tstatus: \"disconnected\",\n\t\t\t\ttimestamp: firebase.database.ServerValue.TIMESTAMP\n\t\t\t},\n\t\t\tsecret: _secret\n\t\t});\n\t};\n\n\tconst enter = async (room: ReturnType<typeof FirebaseRoom>) => {\n\t\tconst app = createOrGetApp();\n\t\tif (_membership) {\n\t\t\tawait _membership.remove();\n\t\t\t_membership = null;\n\t\t}\n\t\tawait update({\n\t\t\troom_id: room.id\n\t\t});\n\t\t_membership = app.members.child(room.id).child(id);\n\t\t_membership.onDisconnect().remove();\n\t\tawait _membership.set({\n\t\t\ttimestamp: firebase.database.ServerValue.TIMESTAMP\n\t\t});\n\t};\n\n\tconst exit = async () => {\n\t\tif (_membership) {\n\t\t\tawait _membership.remove();\n\t\t\t_membership = null;\n\t\t}\n\t\tawait update({\n\t\t\troom_id: \"\"\n\t\t});\n\t};\n\n\treturn {\n\t\tid,\n\t\tenter,\n\t\texit,\n\t\tisLocked,\n\t\tsetSecret,\n\t\twait,\n\t\tsubscribe,\n\t\tunsubscribe,\n\t\tupdate\n\t};\n};\n\n// ------------------------------------------------------------------\n\nexport const FirebaseParty = ({\n\tid,\n\troom\n}: {\n\tid: string;\n\troom: ReturnType<typeof FirebaseRoom>;\n}) => {\n\tconst _members: string[] = [];\n\tconst _users: { [id: string]: ReturnType<typeof FirebaseUser> } = {};\n\tlet _info: RoomInfo = {\n\t\tname: \"\",\n\t\tplaying: false,\n\t\tqueue: {},\n\t\tqueue_position: 0,\n\t\ttimestamp: 0,\n\t\ttype: \"dj\"\n\t};\n\n\tconst _onAdded = (added: firebase.database.DataSnapshot) => {\n\t\tconst userId = added.key;\n\t\tif (userId) {\n\t\t\tconst index = _members.indexOf(userId);\n\t\t\tif (index === -1) {\n\t\t\t\t_members.push(userId);\n\t\t\t\t_users[userId] = FirebaseUser({ id: userId });\n\t\t\t\t_log();\n\t\t\t}\n\t\t}\n\t};\n\n\tconst _onRemoved = (removed: firebase.database.DataSnapshot) => {\n\t\tconst userId = removed.key;\n\t\tif (userId) {\n\t\t\tconst index = _members.indexOf(userId);\n\t\t\tif (index !== -1) {\n\t\t\t\t_members.splice(index, 1);\n\t\t\t\tdelete _users[userId];\n\t\t\t\t_log();\n\t\t\t}\n\t\t}\n\t};\n\n\tconst _onRoomInfo = (snapshot: firebase.database.DataSnapshot) => {\n\t\tconst newValues = snapshot.val() as RoomInfo | null;\n\t\tif (newValues) {\n\t\t\t_info = newValues;\n\t\t\t_log();\n\t\t}\n\t};\n\n\tconst _log = () => {\n\t\tconsole.debug(\"PARTY\", {\n\t\t\t_info,\n\t\t\t_members\n\t\t});\n\t};\n\n\tconst init = () => {\n\t\troom.subscribe(_onRoomInfo);\n\t\troom.subscribeMembers(_onAdded, _onRemoved);\n\t};\n\n\tconst terminate = () => {\n\t\troom.unsubscribe(_onRoomInfo);\n\t\troom.unsubscribeMembers(_onAdded, _onRemoved);\n\t};\n\n\treturn {\n\t\tinit,\n\t\tterminate\n\t};\n};\n","export type ContainerType = \"album\" | \"playlist\";\n\nexport type MediaType = ContainerType | \"track\";\n\nexport const MediaTypes: MediaType[] = [\"album\", \"playlist\", \"track\"];\n\nexport type MediaTypeDefinition = {\n\tlabel: string;\n\tprovider: ProviderType;\n\ttype: MediaType;\n};\n\nexport type ProviderType = \"deezer\";\n\nexport const ProviderTypes: ProviderType[] = [\"deezer\"];\n\nexport type TrackType = \"track\";\n\n// ------------------------------------------------------------------\n\nexport type AlbumAccess = {\n\tid: string;\n\tprovider: ProviderType;\n\ttype: \"album\";\n};\n\nexport type PlaylistAccess = {\n\tid: string;\n\tprovider: ProviderType;\n\ttype: \"playlist\";\n};\n\nexport type TrackAccess = {\n\tid: string;\n\tprovider: ProviderType;\n\ttype: \"track\";\n};\n\nexport type ContainerAccess = AlbumAccess | PlaylistAccess;\n\nexport type MediaAccess = ContainerAccess | TrackAccess;\n\nexport type ContextualizedTrackAccess = {\n\tcontextId: string;\n\tcontextType: MediaType;\n} & TrackAccess;\n\n// ------------------------------------------------------------------\n\nexport type Album = {\n\tartist: {\n\t\tid: string;\n\t\tlink: string;\n\t\tname: string;\n\t\tpicture_big: string;\n\t\tpicture_small: string;\n\t};\n\tcover_big: string;\n\tcover_small: string;\n\tid: string;\n\tlink: string;\n\tprovider: ProviderType;\n\ttitle: string;\n\ttracks?: Track[];\n\ttype: \"album\";\n};\n\nexport type Playlist = {\n\tid: string;\n\tlink: string;\n\tpicture_big: string;\n\tpicture_small: string;\n\tprovider: ProviderType;\n\ttitle: string;\n\ttracks?: Track[];\n\ttype: \"playlist\";\n\tuser: {\n\t\tid: string;\n\t\tlink: string;\n\t\tname: string;\n\t};\n};\n\nexport type Track = {\n\talbum: {\n\t\tcover_big: string;\n\t\tcover_small: string;\n\t\tid: string;\n\t\tlink: string;\n\t\ttitle: string;\n\t};\n\tartist: {\n\t\tid: string;\n\t\tname: string;\n\t\tlink: string;\n\t\tpicture_big: string;\n\t\tpicture_small: string;\n\t};\n\tduration: number;\n\tid: string;\n\tlink: string;\n\tpreview: string;\n\tprovider: ProviderType;\n\ttitle: string;\n\ttype: \"track\";\n};\n\nexport type Container = Album | Playlist;\n\nexport type Media = Container | Track;\n\nexport type StructuredMedias = {\n\t// keys are ProvideType\n\tdeezer: {\n\t\t// keys are MediaType\n\t\talbum: { [id: string]: Album };\n\t\tplaylist: { [id: string]: Playlist };\n\t\ttrack: { [id: string]: Track };\n\t};\n};\n\n// ------------------------------------------------------------------\n\nexport type SearchOptions = {\n\tlimit?: number;\n};\n\nexport type SearchResults = {\n\t// keys are ProviderType\n\tdeezer: {\n\t\t// keys are MediaType\n\t\talbum: Album[];\n\t\tplaylist: Playlist[];\n\t\ttrack: Track[];\n\t};\n};\n\n// ------------------------------------------------------------------\n\nexport const MEDIA_TYPE_DEFINITIONS: MediaTypeDefinition[] = [\n\t{\n\t\tlabel: \"medias.albums\",\n\t\tprovider: \"deezer\",\n\t\ttype: \"album\"\n\t},\n\t{\n\t\tlabel: \"medias.playlists\",\n\t\tprovider: \"deezer\",\n\t\ttype: \"playlist\"\n\t},\n\t{\n\t\tlabel: \"medias.tracks\",\n\t\tprovider: \"deezer\",\n\t\ttype: \"track\"\n\t}\n];\n\n// ------------------------------------------------------------------\n\nconst findMediaInDict = (\n\taccess: MediaAccess,\n\tmedias: StructuredMedias\n): Media | undefined => medias[access.provider][access.type][access.id];\n\n// ------------------------------------------------------------------\n\nconst findMediaInList = (\n\taccess: MediaAccess,\n\tmedias: Media[]\n): Media | undefined =>\n\tmedias.find(\n\t\titem =>\n\t\t\titem.id === access.id &&\n\t\t\titem.provider === access.provider &&\n\t\t\titem.type === access.type\n\t);\n\n// ------------------------------------------------------------------\n\nexport const findMedia = (\n\taccess: MediaAccess,\n\tdist: StructuredMedias,\n\tlist: Media[]\n): Media | undefined =>\n\tfindMediaInDict(access, dist) || findMediaInList(access, list);\n\n// ------------------------------------------------------------------\n\nexport const findPreview = (\n\taccess: MediaAccess,\n\toldMedias: StructuredMedias,\n\tnewMedias: Media[]\n): Track | null => {\n\tconst media = findMedia(access, oldMedias, newMedias);\n\tif (!media) {\n\t\treturn null;\n\t}\n\tif (media.type === \"track\") {\n\t\treturn media;\n\t}\n\tif (media.tracks && media.tracks.length > 0) {\n\t\treturn media.tracks[0];\n\t}\n\treturn null;\n};\n\n// ------------------------------------------------------------------\n\nexport const extractTracks = (\n\taccesses: MediaAccess[],\n\toldMedias: StructuredMedias,\n\tnewMedias: Media[]\n): ContextualizedTrackAccess[] => {\n\tconst tracks: ContextualizedTrackAccess[] = [];\n\tfor (const access of accesses) {\n\t\tif (access.type === \"track\") {\n\t\t\ttracks.push({\n\t\t\t\tcontextId: access.id,\n\t\t\t\tcontextType: access.type,\n\t\t\t\tid: access.id,\n\t\t\t\tprovider: access.provider,\n\t\t\t\ttype: access.type\n\t\t\t});\n\t\t\tcontinue;\n\t\t}\n\n\t\tconst container = findMedia(access, oldMedias, newMedias);\n\t\tif (!container) {\n\t\t\tthrow new Error(\"Media is unknown\");\n\t\t}\n\n\t\tif (\n\t\t\tcontainer.type !== \"track\" &&\n\t\t\tcontainer.tracks &&\n\t\t\tcontainer.tracks.length > 0\n\t\t) {\n\t\t\tfor (const track of container.tracks) {\n\t\t\t\ttracks.push({\n\t\t\t\t\tcontextId: container.id,\n\t\t\t\t\tcontextType: container.type,\n\t\t\t\t\tid: track.id,\n\t\t\t\t\tprovider: track.provider,\n\t\t\t\t\ttype: track.type\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\treturn tracks;\n};\n\n// ------------------------------------------------------------------\n\nexport const findContextFromTrackIndex = (\n\tmedias: MediaAccess[],\n\ttrackIndex: number,\n\tallMedias: StructuredMedias\n): {\n\tmediaFirstTrackIndex: number;\n\tmediaIndex: number;\n\tmediaSize: number;\n} => {\n\tif (trackIndex < 0) {\n\t\tthrow new Error(\"Track index is out of range\");\n\t}\n\tlet index = 0;\n\tfor (let mediaIndex = 0; mediaIndex < medias.length; ++mediaIndex) {\n\t\tconst media = medias[mediaIndex];\n\t\tif (media.type === \"track\") {\n\t\t\tif (trackIndex === index) {\n\t\t\t\treturn {\n\t\t\t\t\tmediaFirstTrackIndex: trackIndex,\n\t\t\t\t\tmediaIndex,\n\t\t\t\t\tmediaSize: 1\n\t\t\t\t};\n\t\t\t}\n\t\t\tindex++;\n\t\t} else {\n\t\t\tconst container = findMediaInDict(media, allMedias);\n\t\t\tif (!container) {\n\t\t\t\tthrow new Error(\"Media is unknown\");\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\tcontainer.type !== \"track\" &&\n\t\t\t\tcontainer.tracks &&\n\t\t\t\tcontainer.tracks.length > 0\n\t\t\t) {\n\t\t\t\tconst mediaFirstTrackIndex = index;\n\t\t\t\tfor (let i = 0; i < container.tracks.length; ++i) {\n\t\t\t\t\tif (trackIndex === index) {\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tmediaFirstTrackIndex,\n\t\t\t\t\t\t\tmediaIndex,\n\t\t\t\t\t\t\tmediaSize: container.tracks.length\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t\tindex++;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tthrow new Error(\"Track index is out of range\");\n};\n","// ------------------------------------------------------------------\n\nlet AUDIO_CONTEXT: AudioContext | null = null;\n\nconst getContext = () => {\n\tif (!AUDIO_CONTEXT) {\n\t\tAUDIO_CONTEXT = new (window.AudioContext ||\n\t\t\t(window as any).webkitAudioContext)();\n\t}\n\treturn AUDIO_CONTEXT;\n};\n\nconst decodeAudioData = (encodedBuffer: ArrayBuffer): Promise<AudioBuffer> =>\n\tnew Promise((resolve, reject) =>\n\t\tgetContext().decodeAudioData(encodedBuffer, resolve, reject)\n\t);\n\nconst loadAudioBuffer = (trackId: string, url: string): Promise<AudioBuffer> =>\n\tnew Promise((resolve, reject) => {\n\t\tconst req = new XMLHttpRequest();\n\t\treq.open(\"GET\", url, true);\n\t\treq.responseType = \"arraybuffer\";\n\t\treq.addEventListener(\n\t\t\t\"error\",\n\t\t\t() => reject(new Error(\"player.errors.cannot_load_audio_buffer\")),\n\t\t\tfalse\n\t\t);\n\t\treq.addEventListener(\n\t\t\t\"load\",\n\t\t\tasync () => {\n\t\t\t\ttry {\n\t\t\t\t\tresolve(await decodeAudioData(req.response as ArrayBuffer));\n\t\t\t\t} catch (error) {\n\t\t\t\t\tconsole.debug(\n\t\t\t\t\t\t\"[Player] An error occurred while decoding audio data\",\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttrackId,\n\t\t\t\t\t\t\turl\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t\treject(new Error(\"player.errors.cannot_decode_audio_data\"));\n\t\t\t\t}\n\t\t\t},\n\t\t\tfalse\n\t\t);\n\t\treq.send();\n\t});\n\nconst AUDIO_BUFFER_CACHES: Array<{ buffer: AudioBuffer; url: string }> = [];\nconst AUDIO_BUFFER_CACHES_MAX_SIZE = 10;\n\nconst loadAudioBufferWithCache = async (\n\ttrackId: string,\n\turl: string\n): Promise<AudioBuffer> => {\n\tif (!url) {\n\t\tconsole.error(\"Track has invalid URL\", { trackId });\n\t\tthrow new Error(\"Invalid URL\");\n\t}\n\tlet buffer: AudioBuffer | null = null;\n\tconst index = AUDIO_BUFFER_CACHES.findIndex(item => item.url === url);\n\tif (index >= 0) {\n\t\t// Found: extract old buffer, it will be repush at the end of cache\n\t\tconsole.debug(\"[Player] Reusing cached audio buffer...\", {\n\t\t\ttrackId,\n\t\t\turl\n\t\t});\n\t\tbuffer = AUDIO_BUFFER_CACHES.splice(index, 1)[0].buffer;\n\t} else {\n\t\t// Not Found\n\t\tconsole.debug(\"[Player] Loading audio buffer...\", { trackId, url });\n\t\tbuffer = await loadAudioBuffer(trackId, url);\n\t}\n\tAUDIO_BUFFER_CACHES.push({ buffer, url });\n\tAUDIO_BUFFER_CACHES.splice(AUDIO_BUFFER_CACHES_MAX_SIZE);\n\treturn buffer;\n};\n\n// ------------------------------------------------------------------\n\n// Fix Safari and iOS Audio Context\n(() => {\n\tconst fixAudioContext = () => {\n\t\tdocument.removeEventListener(\"click\", fixAudioContext);\n\t\tdocument.removeEventListener(\"touchstart\", fixAudioContext);\n\t\tconsole.debug(\"[Player] Fixing audio context...\");\n\t\tconst context = getContext();\n\t\t// Create empty buffer, connect to output, play sound\n\t\tvar buffer = context.createBuffer(1, 1, 22050);\n\t\tvar source = context.createBufferSource();\n\t\tsource.buffer = buffer;\n\t\tsource.connect(context.destination);\n\t\tsource.start(0);\n\t};\n\tdocument.addEventListener(\"click\", fixAudioContext);\n\tdocument.addEventListener(\"touchstart\", fixAudioContext);\n})();\n\n// ------------------------------------------------------------------\n\nexport type Player = {\n\tisPlaying: () => boolean;\n\tgetPlayingTrackID: () => string;\n\tgetPlayingTrackPosition: () => number;\n\tgetPlayingTrackPercent: () => number;\n\tplay: (\n\t\ttrackPosition: number,\n\t\ttrackId: string,\n\t\ttrackUrl: string,\n\t\toffset: number\n\t) => Promise<void>;\n\tstop: () => Promise<void>;\n};\n\n// ------------------------------------------------------------------\n\nconst PlayerImpl = (chainPlay: boolean): Player => {\n\tlet analyserNode: AnalyserNode | null = null;\n\tlet gainNode: GainNode | null = null;\n\tlet _node: AudioNode | null = null;\n\tlet _buffer: AudioBuffer | null = null;\n\tlet _sourceNode: AudioBufferSourceNode | null = null;\n\tlet _sourceNodeStartTime = 0;\n\tlet _trackId = \"\";\n\tlet _trackPosition = -1;\n\n\tconst getOrCreateNode = () => {\n\t\tif (!_node) {\n\t\t\tconst context = getContext();\n\t\t\t_node = context.destination;\n\n\t\t\tgainNode = context.createGain();\n\t\t\tgainNode.gain.value = 1.0;\n\t\t\tgainNode.connect(_node);\n\t\t\t_node = gainNode;\n\n\t\t\tanalyserNode = context.createAnalyser();\n\t\t\tanalyserNode.fftSize = 128;\n\t\t\t// analyserNode.minDecibels = -90;\n\t\t\t// analyserNode.maxDecibels = -10;\n\t\t\tanalyserNode.connect(_node);\n\t\t\t_node = analyserNode;\n\t\t}\n\t\treturn _node;\n\t};\n\n\tconst isPlaying = () => !!_sourceNode;\n\n\tconst getPlayingTrackID = () => _trackId;\n\n\tconst getPlayingTrackPosition = () => _trackPosition;\n\n\t// Percentage [0, 1]\n\tconst getPlayingTrackPercent = () => {\n\t\tif (_buffer && _sourceNode) {\n\t\t\treturn (\n\t\t\t\t(getContext().currentTime - _sourceNodeStartTime) /\n\t\t\t\t_buffer.duration\n\t\t\t);\n\t\t}\n\t\treturn 0;\n\t};\n\n\tconst play = async (\n\t\ttrackPosition: number,\n\t\ttrackId: string,\n\t\ttrackUrl: string,\n\t\toffset: number\n\t) => {\n\t\tawait stop();\n\t\t_buffer = await loadAudioBufferWithCache(trackId, trackUrl); // TODO: warning if loadBuffer takes long for some reason and user clicks stop before end, next part of this function will continue after stop have been requested\n\t\tconsole.debug(\"[Player] Starting audio...\", {\n\t\t\ttrackPosition,\n\t\t\ttrackId,\n\t\t\ttrackUrl\n\t\t});\n\t\t_trackId = trackId;\n\t\t_trackPosition = trackPosition;\n\t\t_sourceNode = getContext().createBufferSource();\n\t\t_sourceNode.buffer = _buffer;\n\t\t_sourceNode.loop = false;\n\t\t_sourceNode.loopStart = 0;\n\t\t_sourceNode.loopEnd = 0;\n\t\t_sourceNode.onended = () => {\n\t\t\tconsole.debug(\"[Player] Audio terminated...\");\n\t\t\t_buffer = null;\n\t\t\t_sourceNode = null;\n\t\t\tif (chainPlay) {\n\t\t\t\t_trackPosition++;\n\t\t\t}\n\t\t};\n\t\t_sourceNode.playbackRate.value = 1.0;\n\t\t_sourceNode.connect(getOrCreateNode());\n\t\t_sourceNode.start(0, offset); // A new BufferSource must be created for each start\n\t\t_sourceNodeStartTime = getContext().currentTime;\n\t};\n\n\tconst stop = (): Promise<void> =>\n\t\tnew Promise(resolve => {\n\t\t\tif (null !== _sourceNode) {\n\t\t\t\tconsole.debug(\"[Player] Stopping audio...\");\n\t\t\t\t_sourceNode.onended = () => {\n\t\t\t\t\tconsole.debug(\"[Player] Forced audio termination...\");\n\t\t\t\t\tresolve();\n\t\t\t\t};\n\t\t\t\t_sourceNode.stop();\n\t\t\t\t_sourceNode = null;\n\t\t\t\t_sourceNodeStartTime = 0;\n\t\t\t\t_trackId = \"\";\n\t\t\t\t_trackPosition = -1;\n\t\t\t} else {\n\t\t\t\tresolve();\n\t\t\t}\n\t\t});\n\n\treturn {\n\t\tgetPlayingTrackID,\n\t\tgetPlayingTrackPercent,\n\t\tgetPlayingTrackPosition,\n\t\tisPlaying,\n\t\tplay,\n\t\tstop\n\t};\n};\n\n// ------------------------------------------------------------------\n\nexport const QUEUE_PLAYER = PlayerImpl(true);\n\nexport const PREVIEW_PLAYER = PlayerImpl(false);\n","export const sleep = (delay: number) =>\n\tnew Promise(resolve => setTimeout(resolve, delay));\n","import jsonp from \"jsonp\";\n\n// ------------------------------------------------------------------\n\nexport const asyncJsonp = (url: string, qs?: string): Promise<any> =>\n\tnew Promise((resolve, reject) => {\n\t\tjsonp(\n\t\t\tqs\n\t\t\t\t? `${url}?${qs}&output=jsonp&callback=`\n\t\t\t\t: `${url}?output=jsonp&callback=`,\n\t\t\tvoid 0,\n\t\t\t(err, data) => {\n\t\t\t\tif (err) {\n\t\t\t\t\treject(new Error(err.message));\n\t\t\t\t} else {\n\t\t\t\t\tresolve(data);\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t});\n","import { sleep } from \".\";\nimport { SearchOptions, Album, MediaType, Playlist, Track } from \"./medias\";\nimport { asyncJsonp } from \"./jsonp\";\n\n// ------------------------------------------------------------------\n\nconst RATE_LIMIT_DELAY = 5000; // ms\n\n// ------------------------------------------------------------------\n\nexport type ApiError = {\n\tcode: number;\n\tmessage: string;\n\ttype: string;\n};\n\nexport type ApiAlbum = {\n\terror?: ApiError;\n\tartist: {\n\t\tid: number;\n\t\tname: string;\n\t\tpicture_big: string;\n\t\tpicture_small: string;\n\t};\n\tcover_big: string;\n\tcover_small: string;\n\tid: number;\n\ttitle: string;\n\ttracks?: { data: ApiTrack[] };\n};\n\nexport type ApiPlaylist = {\n\terror?: ApiError;\n\tcreator?: {\n\t\tid: number;\n\t\tname: string;\n\t};\n\tid: number;\n\tpicture_big: string;\n\tpicture_small: string;\n\tpublic: true;\n\ttitle: string;\n\ttracks?: { data: ApiTrack[] };\n\tuser?: {\n\t\tid: number;\n\t\tname: string;\n\t};\n};\n\nexport type ApiTrack = {\n\terror?: ApiError;\n\talbum: {\n\t\tcover_big: string;\n\t\tcover_small: string;\n\t\tid: number;\n\t\ttitle: string;\n\t};\n\tartist: {\n\t\tid: number;\n\t\tname: string;\n\t\tpicture_big: string;\n\t\tpicture_small: string;\n\t};\n\tduration: number;\n\tid: number;\n\tpreview: string;\n\treadable: boolean;\n\ttitle: string;\n};\n\nexport type ApiSearchResult<T> = {\n\tdata: T[];\n\ttotal: number;\n};\n\n// ------------------------------------------------------------------\n\nconst ConvertAlbum = (album: ApiAlbum): Album => ({\n\tartist: {\n\t\tid: album.artist.id.toString(),\n\t\tname: album.artist.name,\n\t\tlink: `https://www.deezer.com/artist/${album.artist.id}`,\n\t\tpicture_big: album.artist.picture_big,\n\t\tpicture_small: album.artist.picture_small\n\t},\n\tcover_big: album.cover_big,\n\tcover_small: album.cover_small,\n\tid: album.id.toString(),\n\tlink: `https://www.deezer.com/album/${album.id}`,\n\tprovider: \"deezer\",\n\ttitle: album.title,\n\ttracks:\n\t\talbum.tracks !== void 0\n\t\t\t? album.tracks.data\n\t\t\t\t\t.filter(track => track.readable && track.preview)\n\t\t\t\t\t.map(track => ConvertTrack(track, album))\n\t\t\t: void 0,\n\ttype: \"album\"\n});\n\nconst ConvertPlaylist = (\n\tplaylist: ApiPlaylist,\n\tuser: { id: number; name: string }\n): Playlist => ({\n\tid: playlist.id.toString(),\n\tlink: `https://www.deezer.com/playlist/${playlist.id}`,\n\tpicture_big: playlist.picture_big,\n\tpicture_small: playlist.picture_small,\n\tprovider: \"deezer\",\n\ttitle: playlist.title,\n\ttracks:\n\t\tplaylist.tracks !== void 0\n\t\t\t? playlist.tracks.data\n\t\t\t\t\t.filter(track => track.readable && track.preview)\n\t\t\t\t\t.map(track => ConvertTrack(track, track.album))\n\t\t\t: void 0,\n\ttype: \"playlist\",\n\tuser: {\n\t\tid: user.id.toString(),\n\t\tname: user.name,\n\t\tlink: `https://www.deezer.com/profile/${user.id}`\n\t}\n});\n\nconst ConvertTrack = (\n\ttrack: ApiTrack,\n\talbum: { id: number; title: string; cover_big: string; cover_small: string }\n): Track => ({\n\talbum: {\n\t\tid: album.id.toString(),\n\t\tlink: `https://www.deezer.com/album/${album.id}`,\n\t\ttitle: album.title,\n\t\tcover_big: album.cover_big,\n\t\tcover_small: album.cover_small\n\t},\n\tartist: {\n\t\tid: track.artist.id.toString(),\n\t\tname: track.artist.name,\n\t\tlink: `https://www.deezer.com/artist/${track.artist.id}`,\n\t\tpicture_big: track.artist.picture_big,\n\t\tpicture_small: track.artist.picture_small\n\t},\n\tduration: track.duration,\n\tid: track.id.toString(),\n\tlink: `https://www.deezer.com/track/${track.id}`,\n\tpreview: track.preview,\n\tprovider: \"deezer\",\n\ttitle: track.title,\n\ttype: \"track\"\n});\n\n// ------------------------------------------------------------------\n\nexport type DeezerApi = {\n\tsearchAlbums: (query: string, options?: SearchOptions) => Promise<Album[]>;\n\n\tsearchPlaylists: (\n\t\tquery: string,\n\t\toptions?: SearchOptions\n\t) => Promise<Playlist[]>;\n\n\tsearchTracks: (query: string, options?: SearchOptions) => Promise<Track[]>;\n\n\tloadAlbums: (ids: string[]) => Promise<Album[]>;\n\n\tloadPlaylists: (ids: string[]) => Promise<Playlist[]>;\n\n\tloadTracks: (ids: string[]) => Promise<Track[]>;\n};\n\n// ------------------------------------------------------------------\n\nconst DeezerApiImpl = (): DeezerApi => {\n\tconst API_BASE = \"https://api.deezer.com\";\n\n\tconst _call = async <T>(path: string, qs?: string): Promise<T> => {\n\t\t// We have to rely on jsonp because the Deezer api is CORS restricted\n\t\tconsole.debug(\"[Deezer] Requesting... \", { path, qs });\n\t\treturn asyncJsonp(`${API_BASE}/${path}`, qs);\n\t};\n\n\tconst _search = <T>(\n\t\ttype: MediaType,\n\t\tquery: string,\n\t\toptions?: SearchOptions\n\t) =>\n\t\t_call<ApiSearchResult<T>>(\n\t\t\t`search/${type}`,\n\t\t\t`q=${encodeURIComponent(query)}${\n\t\t\t\toptions && options.limit ? `&limit=${options.limit}` : \"\"\n\t\t\t}`\n\t\t);\n\n\tconst _load = <T extends { error?: ApiError }>(\n\t\ttype: MediaType,\n\t\tids: string[]\n\t) =>\n\t\tPromise.all(\n\t\t\tids.map(async id => {\n\t\t\t\tconst media = await _call<T>(`${type}/${id}`);\n\t\t\t\treturn media.error ? null : media;\n\t\t\t})\n\t\t);\n\n\tconst _loadWithRetry = async <T extends { error?: ApiError }>(\n\t\ttype: MediaType,\n\t\tids: string[]\n\t) => {\n\t\tlet first = true;\n\t\tconst medias: Array<T | null> = ids.map(() => null);\n\t\twhile (medias.includes(null)) {\n\t\t\tconst subIds: string[] = [];\n\t\t\tconst subIndexes: number[] = [];\n\t\t\tmedias.forEach((media, index) => {\n\t\t\t\tif (!media) {\n\t\t\t\t\tsubIds.push(ids[index]);\n\t\t\t\t\tsubIndexes.push(index);\n\t\t\t\t}\n\t\t\t});\n\t\t\tif (!first) {\n\t\t\t\tconsole.debug(`[Deezer] Handling rate limit delayed batch...`, {\n\t\t\t\t\tsubIds\n\t\t\t\t});\n\t\t\t\tawait sleep(RATE_LIMIT_DELAY);\n\t\t\t}\n\t\t\tconst subMedias = await _load<T>(type, subIds);\n\t\t\tsubIndexes.forEach((index, subIndex) => {\n\t\t\t\tmedias[index] = subMedias[subIndex];\n\t\t\t});\n\t\t\tfirst = false;\n\t\t}\n\t\treturn medias as T[];\n\t};\n\n\tconst searchAlbums = async (query: string, options?: SearchOptions) => {\n\t\treturn (await _search<ApiAlbum>(\"album\", query, options)).data.map(\n\t\t\tConvertAlbum\n\t\t);\n\t};\n\n\tconst searchPlaylists = async (query: string, options?: SearchOptions) => {\n\t\treturn (await _search<ApiPlaylist>(\"playlist\", query, options)).data\n\t\t\t.filter(playlist => playlist.public)\n\t\t\t.map(playlist => ConvertPlaylist(playlist, playlist.user!));\n\t};\n\n\tconst searchTracks = async (query: string, options?: SearchOptions) => {\n\t\treturn (await _search<ApiTrack>(\"track\", query, options)).data\n\t\t\t.filter(track => track.readable && track.preview)\n\t\t\t.map(track => ConvertTrack(track, track.album));\n\t};\n\n\tconst loadAlbums = async (ids: string[]): Promise<Album[]> => {\n\t\tif (ids.length > 0) {\n\t\t\tconsole.debug(\"[Deezer] Loading albums...\", { ids });\n\t\t\tconst albums = await _loadWithRetry<ApiAlbum>(\"album\", ids);\n\t\t\treturn albums.map(album => ConvertAlbum(album));\n\t\t}\n\t\treturn [];\n\t};\n\n\tconst loadPlaylists = async (ids: string[]): Promise<Playlist[]> => {\n\t\tif (ids.length > 0) {\n\t\t\tconsole.debug(\"[Deezer] Loading playlists...\", { ids });\n\t\t\tconst playlists = await _loadWithRetry<ApiPlaylist>(\n\t\t\t\t\"playlist\",\n\t\t\t\tids\n\t\t\t);\n\t\t\treturn playlists.map(playlist =>\n\t\t\t\tConvertPlaylist(playlist, playlist.creator!)\n\t\t\t);\n\t\t}\n\t\treturn [];\n\t};\n\n\tconst loadTracks = async (ids: string[]): Promise<Track[]> => {\n\t\tif (ids.length > 0) {\n\t\t\tconsole.debug(\"[Deezer] Loading tracks...\", { ids });\n\t\t\tconst tracks = await _loadWithRetry<ApiTrack>(\"track\", ids);\n\t\t\treturn tracks.map(track => ConvertTrack(track, track.album));\n\t\t}\n\t\treturn [];\n\t};\n\n\treturn {\n\t\tsearchAlbums,\n\t\tsearchPlaylists,\n\t\tsearchTracks,\n\t\tloadAlbums,\n\t\tloadPlaylists,\n\t\tloadTracks\n\t};\n};\n\n// ------------------------------------------------------------------\n\nexport const DEFAULT_API = DeezerApiImpl();\n","import {\n\tSearchOptions,\n\tSearchResults,\n\tMedia,\n\tMediaAccess,\n\tStructuredMedias\n} from \"./medias\";\nimport { DEFAULT_API } from \"./deezer\";\n\n// ------------------------------------------------------------------\n\nexport const load = async (accesses: MediaAccess[]): Promise<Media[]> => {\n\tconst ids: {\n\t\tdeezer: { album: string[]; playlist: string[]; track: string[] };\n\t} = {\n\t\t// keys are ProviderType\n\t\tdeezer: {\n\t\t\t// keys are MediaType\n\t\t\talbum: [],\n\t\t\tplaylist: [],\n\t\t\ttrack: []\n\t\t}\n\t};\n\tfor (const access of accesses) {\n\t\tids[access.provider][access.type].push(access.id);\n\t}\n\tconst medias = {\n\t\t// keys are ProviderType\n\t\tdeezer: {\n\t\t\t// keys are MediaType\n\t\t\talbum: await DEFAULT_API.loadAlbums(ids.deezer.album),\n\t\t\tplaylist: await DEFAULT_API.loadPlaylists(ids.deezer.playlist),\n\t\t\ttrack: await DEFAULT_API.loadTracks(ids.deezer.track)\n\t\t}\n\t};\n\treturn accesses.map(\n\t\taccess =>\n\t\t\tmedias[access.provider][access.type][\n\t\t\t\tids[access.provider][access.type].indexOf(access.id)\n\t\t\t]\n\t);\n};\n\n// ------------------------------------------------------------------\n\nexport const loadNew = async (\n\taccesses: MediaAccess[],\n\toldMedias: StructuredMedias\n) => {\n\tconst newAccesses: MediaAccess[] = accesses\n\t\t// Only not already loaded\n\t\t.filter(access => !oldMedias[access.provider][access.type][access.id])\n\t\t// Only unique\n\t\t.filter(\n\t\t\t(value, index, self) =>\n\t\t\t\tindex ===\n\t\t\t\tself.findIndex(\n\t\t\t\t\tother =>\n\t\t\t\t\t\tother.id === value.id &&\n\t\t\t\t\t\tother.provider === value.provider &&\n\t\t\t\t\t\tother.type === value.type\n\t\t\t\t)\n\t\t);\n\tconst newMedias = await load(newAccesses);\n\tconst newMediasAndTracks: Media[] = [];\n\tfor (const media of newMedias) {\n\t\tnewMediasAndTracks.push(media);\n\t\tif (media.type !== \"track\") {\n\t\t\tnewMediasAndTracks.push(...media.tracks!);\n\t\t}\n\t}\n\treturn { newMedias, newMediasAndTracks };\n};\n// ------------------------------------------------------------------\n\nexport const search = async (\n\tquery: string,\n\toptions?: SearchOptions\n): Promise<SearchResults> => {\n\tconst [album, playlist, track] = await Promise.all([\n\t\tDEFAULT_API.searchAlbums(query, options),\n\t\tDEFAULT_API.searchPlaylists(query, options),\n\t\tDEFAULT_API.searchTracks(query, options)\n\t]);\n\treturn {\n\t\t// keys are ProviderType\n\t\tdeezer: {\n\t\t\t// keys are MediaType\n\t\t\talbum: album,\n\t\t\tplaylist: playlist,\n\t\t\ttrack: track\n\t\t}\n\t};\n};\n","import { AxiosError } from \"axios\";\n//\nimport { createAction, AsyncAction } from \".\";\nimport { Media, MediaAccess, findPreview } from \"../utils/medias\";\nimport { PREVIEW_PLAYER } from \"../utils/player\";\nimport { loadNew } from \"../utils/providers\";\n\n// ------------------------------------------------------------------\n\nexport type MediasAction =\n\t| ReturnType<typeof fetching>\n\t| ReturnType<typeof success>\n\t| ReturnType<typeof error>\n\t| ReturnType<typeof resetMedias>\n\t| ReturnType<typeof setMedias>;\n\nconst fetching = () => createAction(\"medias/FETCHING\");\nconst success = () => createAction(\"medias/FETCHED\");\nconst error = (error: AxiosError) => createAction(\"medias/ERROR\", error);\nconst resetMedias = () => createAction(\"medias/RESET\");\nexport const setMedias = (medias: Media[]) =>\n\tcreateAction(\"medias/SET\", medias);\n\n// ------------------------------------------------------------------\n\nexport const previewMedia = (access: MediaAccess): AsyncAction => async (\n\tdispatch,\n\tgetState\n) => {\n\tconst {\n\t\tmedias: { medias: oldMedias }\n\t} = getState();\n\tconst { newMedias } = await loadNew([access], oldMedias);\n\tconst track = findPreview(access, oldMedias, newMedias);\n\tif (!track) {\n\t\tconsole.debug(\"Cannot find track to preview...\");\n\t\treturn;\n\t}\n\tconsole.debug(\"Previewing track...\", {\n\t\tid: track.id,\n\t\tpreview: track.preview\n\t});\n\tawait PREVIEW_PLAYER.play(0, track.id, track.preview, 0);\n};\n","export type MessageType = \"error\" | \"info\";\n\nexport type Message = {\n\tid: number;\n\tstamp: number;\n\ttext: string;\n\ttype: MessageType;\n};\n\nexport const extractErrorMessage = (err: any) =>\n\terr.response && err.response.data && err.response.data.message\n\t\t? err.response.data.message\n\t\t: err.message;\n","import * as jimp from \"jimp\";\n\n// ------------------------------------------------------------------\n\nexport type Color = {\n\tr: number;\n\tg: number;\n\tb: number;\n};\n\nexport type CombinedColor = {\n\tbg: Color;\n\tfg: string;\n};\n\nconst CACHE: { [url: string]: CombinedColor } = {};\n\nconst DEFAULT_COLOR = {\n\tbg: { r: 255, g: 255, b: 255 },\n\tfg: \"dark\"\n};\n\n// ------------------------------------------------------------------\n\n// https://stackoverflow.com/questions/3942878/how-to-decide-font-color-in-white-or-black-depending-on-background-color\nexport const pickColor = async (url: string) => {\n\tlet res = DEFAULT_COLOR;\n\tif (url) {\n\t\tres = CACHE[url];\n\t\tif (!res) {\n\t\t\ttry {\n\t\t\t\tconst image = await jimp.read(url);\n\t\t\t\tconst pixel = await image.resize(1, 1).getPixelColor(0, 0);\n\t\t\t\tconst { r, g, b } = jimp.intToRGBA(pixel);\n\t\t\t\tCACHE[url] = res = {\n\t\t\t\t\tbg: { r, g, b },\n\t\t\t\t\tfg:\n\t\t\t\t\t\tr * 0.299 + g * 0.587 + b * 0.114 > 186\n\t\t\t\t\t\t\t? \"dark\"\n\t\t\t\t\t\t\t: \"light\"\n\t\t\t\t};\n\t\t\t} catch (err) {\n\t\t\t\tconsole.debug(\"An error prevented colorpicking\", err);\n\t\t\t\tCACHE[url] = res = DEFAULT_COLOR;\n\t\t\t}\n\t\t}\n\t}\n\treturn res;\n};\n","import { createHashHistory } from \"history\";\n\nexport default createHashHistory();\n","import { AxiosError } from \"axios\";\nimport { v4 } from \"uuid\";\n//\nimport { createAction, AsyncAction } from \".\";\nimport { displayError } from \"./messages\";\nimport { RoomInfo } from \"../utils/rooms\";\nimport { FirebaseRoom } from \"../utils/firebase\";\nimport { setMedias } from \"./medias\";\nimport {\n\tMediaAccess,\n\tTrackAccess,\n\textractTracks,\n\tContextualizedTrackAccess\n} from \"../utils/medias\";\nimport { extractErrorMessage } from \"../utils/messages\";\nimport { RoomData } from \"../reducers/room\";\nimport { pickColor } from \"../utils/colorpicker\";\nimport { Player } from \"../utils/player\";\nimport { loadNew } from \"../utils/providers\";\nimport history from \"../utils/history\";\n\n// ------------------------------------------------------------------\n\nexport type RoomAction =\n\t| ReturnType<typeof fetching>\n\t| ReturnType<typeof success>\n\t| ReturnType<typeof error>\n\t| ReturnType<typeof resetRoom>\n\t| ReturnType<typeof setRoom>;\n\nconst fetching = () => createAction(\"room/FETCHING\");\nconst success = () => createAction(\"room/FETCHED\");\nconst error = (error: AxiosError) => createAction(\"room/ERROR\", error);\nconst resetRoom = () => createAction(\"room/RESET\");\nconst setRoom = (values: Partial<RoomData>) => createAction(\"room/SET\", values);\n\n// ------------------------------------------------------------------\n\nexport const createRoom = (\n\tname: string,\n\tsecret: string\n): AsyncAction => async dispatch => {\n\ttry {\n\t\tconst id = v4();\n\t\tconsole.debug(\"Creating room...\", { id, secret });\n\t\tawait FirebaseRoom({ id, secret }).update({\n\t\t\tname,\n\t\t\tplaying: false,\n\t\t\tqueue: {},\n\t\t\tqueue_position: 0\n\t\t});\n\t\tdispatch(enterRoom(id, secret));\n\t} catch (err) {\n\t\tdispatch(displayError(extractErrorMessage(err)));\n\t}\n};\n\n// ------------------------------------------------------------------\n\nexport const enterRoom = (id: string, secret: string): AsyncAction => async (\n\tdispatch,\n\tgetState\n) => {\n\tconst {\n\t\troom: { room }\n\t} = getState();\n\tif (room && room.id === id) {\n\t\t// Nothing to do\n\t\treturn;\n\t}\n\tdispatch(exitRoom());\n\ttry {\n\t\tconsole.debug(\"Entering room...\", { id, secret });\n\t\tconst newRoom = FirebaseRoom({ id, secret });\n\t\tdispatch(\n\t\t\tsetRoom({\n\t\t\t\taccess: { id, secret },\n\t\t\t\troom: newRoom,\n\t\t\t\tinfo: await newRoom.wait()\n\t\t\t})\n\t\t);\n\t\tdispatch(_watchRoom(newRoom));\n\t\thistory.push(`/room/${id}?secret=${secret}`); // TODO: should push only if we're not already in it\n\t} catch (err) {\n\t\tdispatch(displayError(extractErrorMessage(err)));\n\t}\n};\n\nexport const exitRoom = (): AsyncAction => async (dispatch, getState) => {\n\tconst {\n\t\troom: { room }\n\t} = getState();\n\tif (!room) {\n\t\t// Nothing to do\n\t\treturn;\n\t}\n\tconsole.debug(\"Exiting room...\");\n\tdispatch(_unwatchPlayer());\n\tdispatch(_unwatchRoom(room));\n\tdispatch(resetRoom());\n};\n\n// ------------------------------------------------------------------\n\nexport const lockRoom = (): AsyncAction => async (dispatch, getState) => {\n\tconst {\n\t\troom: {\n\t\t\troom,\n\t\t\taccess: { id, secret: oldSecret }\n\t\t}\n\t} = getState();\n\tif (!room || room.id !== id || !oldSecret) {\n\t\t// Nothing to do\n\t\treturn;\n\t}\n\tconsole.debug(\"Locking room...\", { id });\n\troom.setSecret(\"\");\n\t// TODO : not history.replace(`/room/${id}`); as it would trigger a page refresh\n\tdispatch(setRoom({ access: { id, secret: \"\" } }));\n};\n\nexport const unlockRoom = (secret: string): AsyncAction => async (\n\tdispatch,\n\tgetState\n) => {\n\tconst {\n\t\troom: {\n\t\t\troom,\n\t\t\taccess: { id, secret: oldSecret }\n\t\t}\n\t} = getState();\n\tif (!room || room.id !== id || oldSecret === secret) {\n\t\t// Nothing to do\n\t\treturn;\n\t}\n\tconsole.debug(\"Unlocking room...\", { id, secret });\n\troom.setSecret(secret);\n\t// TODO : not history.replace(`/room/${id}?secret=${secret}`); as it would trigger a page refresh\n\tdispatch(setRoom({ access: { id, secret } }));\n};\n\n// ------------------------------------------------------------------\n// ------------------------------------------------------------------\n// ------------------------------------------------------------------\n\nlet ROOM_WATCHER: any = null;\n\nconst _watchRoom = (\n\troom: ReturnType<typeof FirebaseRoom>\n): AsyncAction => async (dispatch, getState) => {\n\tconsole.debug(\"Watching room...\");\n\tif (!!ROOM_WATCHER) {\n\t\t// Nothing to do\n\t\treturn;\n\t}\n\tROOM_WATCHER = room.subscribe(\n\t\tasync (snapshot: firebase.database.DataSnapshot) => {\n\t\t\t// TODO: we could add a queue in case too much updates are received\n\t\t\tconst {\n\t\t\t\tmedias: { medias: oldMedias },\n\t\t\t\troom: { info: oldInfo }\n\t\t\t} = getState();\n\t\t\tconst newInfo = snapshot.val() as RoomInfo;\n\t\t\tconsole.debug(\"[Firebase] Received room update...\", newInfo);\n\t\t\tlet medias: MediaAccess[] = [];\n\t\t\tif (newInfo.queue) {\n\t\t\t\tmedias = Object.entries(newInfo.queue)\n\t\t\t\t\t.sort(\n\t\t\t\t\t\t(media1, media2) =>\n\t\t\t\t\t\t\tNumber(media1[0]) - Number(media2[0])\n\t\t\t\t\t)\n\t\t\t\t\t.map(media => media[1]);\n\t\t\t}\n\t\t\tif (oldInfo!.playing !== newInfo.playing) {\n\t\t\t\tif (newInfo.playing) {\n\t\t\t\t\tdispatch(_watchPlayer());\n\t\t\t\t} else {\n\t\t\t\t\tdispatch(_unwatchPlayer());\n\t\t\t\t}\n\t\t\t}\n\t\t\tlet tracks: ContextualizedTrackAccess[] = [];\n\t\t\tif (medias.length > 0) {\n\t\t\t\tconst { newMedias, newMediasAndTracks } = await loadNew(\n\t\t\t\t\tmedias,\n\t\t\t\t\toldMedias\n\t\t\t\t);\n\t\t\t\tif (newMediasAndTracks.length > 0) {\n\t\t\t\t\tdispatch(setMedias(newMediasAndTracks));\n\t\t\t\t}\n\t\t\t\ttracks = extractTracks(medias, oldMedias, newMedias);\n\t\t\t}\n\t\t\tdispatch(\n\t\t\t\tsetRoom({\n\t\t\t\t\tinfo: newInfo,\n\t\t\t\t\tmedias,\n\t\t\t\t\troom,\n\t\t\t\t\ttracks\n\t\t\t\t})\n\t\t\t);\n\t\t}\n\t);\n};\n\nconst _unwatchRoom = (\n\troom: ReturnType<typeof FirebaseRoom>\n): AsyncAction => async () => {\n\tif (!ROOM_WATCHER) {\n\t\t// Nothing to do\n\t\treturn;\n\t}\n\tconsole.debug(\"Unwatching room...\");\n\troom.unsubscribe(ROOM_WATCHER);\n\tROOM_WATCHER = null;\n};\n\n// ------------------------------------------------------------------\n// ------------------------------------------------------------------\n// ------------------------------------------------------------------\n\nlet PLAYER_TIMER: NodeJS.Timeout | null = null;\n\nconst _computeNextPosition = (\n\tplayer: Player,\n\ttracks: TrackAccess[],\n\ttrackIndex: number\n) => {\n\tlet nextIndex = -1;\n\tconst playingTrackID = player.getPlayingTrackID();\n\tconst playingTrackIndex = player.getPlayingTrackPosition() % tracks.length;\n\tif (playingTrackIndex !== trackIndex) {\n\t\tif (player.isPlaying()) {\n\t\t\t// User has clicked an other track or added/removed a track in queue\n\t\t\tif (playingTrackID !== tracks[trackIndex].id) {\n\t\t\t\tnextIndex = trackIndex;\n\t\t\t}\n\t\t} else {\n\t\t\t// Not playing which means previous track has terminated\n\t\t\tnextIndex = playingTrackIndex >= 0 ? playingTrackIndex : trackIndex;\n\t\t}\n\t} else if (playingTrackID !== tracks[trackIndex].id) {\n\t\t// User has deleted playing track\n\t\tnextIndex = trackIndex;\n\t}\n\treturn nextIndex;\n};\n\nconst _watchPlayer = (): AsyncAction => async (\n\tdispatch,\n\tgetState,\n\t{ player }\n) => {\n\t// Don't use setInterval because a step could be triggered before previous one terminated\n\tPLAYER_TIMER = setTimeout(async () => {\n\t\tconst {\n\t\t\troom: { info, tracks },\n\t\t\tmedias: { medias }\n\t\t} = getState();\n\t\tif (tracks.length > 0) {\n\t\t\t// Detect and apply change to queue and player\n\t\t\tconst nextTrackIndex = _computeNextPosition(\n\t\t\t\tplayer,\n\t\t\t\ttracks,\n\t\t\t\tinfo!.queue_position\n\t\t\t);\n\t\t\tif (nextTrackIndex >= 0) {\n\t\t\t\tconst nextAccess = tracks[nextTrackIndex];\n\t\t\t\tconst nextTrack =\n\t\t\t\t\tmedias[nextAccess.provider][nextAccess.type][nextAccess.id];\n\t\t\t\tconsole.debug(\"Detected play change...\", {\n\t\t\t\t\tnextTrack,\n\t\t\t\t\tnextTrackIndex\n\t\t\t\t});\n\n\t\t\t\ttry {\n\t\t\t\t\tconst [color] = await Promise.all([\n\t\t\t\t\t\tpickColor(nextTrack.album.cover_small),\n\t\t\t\t\t\tplayer.play(\n\t\t\t\t\t\t\tnextTrackIndex,\n\t\t\t\t\t\t\tnextTrack.id,\n\t\t\t\t\t\t\tnextTrack.preview,\n\t\t\t\t\t\t\t0\n\t\t\t\t\t\t)\n\t\t\t\t\t]);\n\t\t\t\t\tdispatch(\n\t\t\t\t\t\tsetRoom({\n\t\t\t\t\t\t\tcolor,\n\t\t\t\t\t\t\tinfo: { ...info!, queue_position: nextTrackIndex } // for info update because of player change without firebase\n\t\t\t\t\t\t})\n\t\t\t\t\t);\n\t\t\t\t} catch (err) {\n\t\t\t\t\tdispatch(displayError(extractErrorMessage(err)));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Reschedule time\n\t\t\tdispatch(_watchPlayer());\n\t\t} else {\n\t\t\t// Last track has been removed from queue by user\n\t\t\tconsole.debug(\"No more tracks in queue...\");\n\t\t\tdispatch(setRoom({ info: { ...info!, playing: false } })); // for info update because of player change  without firebase\n\t\t\tawait player.stop();\n\t\t\tPLAYER_TIMER = null;\n\t\t}\n\t}, 250);\n};\n\nconst _unwatchPlayer = (): AsyncAction => async (\n\tdispatch,\n\tgetState,\n\t{ player }\n) => {\n\tif (PLAYER_TIMER) {\n\t\tconsole.debug(\"Unwatching player...\");\n\t\tclearTimeout(PLAYER_TIMER);\n\t\tPLAYER_TIMER = null;\n\t}\n\tawait player.stop();\n};\n","import { AsyncAction } from \".\";\nimport { lockRoom } from \"./room\";\nimport { displayError } from \"./messages\";\nimport { extractErrorMessage } from \"../utils/messages\";\n\n// ------------------------------------------------------------------\n\nexport const startPlayer = (): AsyncAction => async (dispatch, getState) => {\n\tconst {\n\t\troom: { info, room }\n\t} = getState();\n\tif (!room || room.isLocked() || !info) {\n\t\tdispatch(displayError(\"rooms.error.locked\"));\n\t\treturn;\n\t}\n\tif (info.playing) {\n\t\t// Nothing to do\n\t\treturn;\n\t}\n\ttry {\n\t\tconsole.debug(\"Starting player...\");\n\t\tawait room.update({\n\t\t\t...info,\n\t\t\tplaying: true\n\t\t});\n\t} catch (err) {\n\t\tdispatch(displayError(extractErrorMessage(err)));\n\t\tdispatch(lockRoom());\n\t}\n};\n\n// ------------------------------------------------------------------\n\nexport const stopPlayer = (): AsyncAction => async (dispatch, getState) => {\n\tconst {\n\t\troom: { info, room }\n\t} = getState();\n\tif (!room || room.isLocked() || !info) {\n\t\tdispatch(displayError(\"rooms.error.locked\"));\n\t\treturn;\n\t}\n\tif (!info.playing) {\n\t\t// Nothing to do\n\t\treturn;\n\t}\n\ttry {\n\t\tconsole.debug(\"Stopping player...\");\n\t\tawait room.update({\n\t\t\t...info,\n\t\t\tplaying: false\n\t\t});\n\t} catch (err) {\n\t\tdispatch(displayError(extractErrorMessage(err)));\n\t\tdispatch(lockRoom());\n\t}\n};\n","import { MediaAccess } from \"./medias\";\n\nexport type RoomType = \"blind\" | \"dj\";\n\nexport type RoomInfo = {\n\tname: string;\n\tqueue?: RoomQueue;\n\tqueue_position: number;\n\tplaying: boolean;\n\ttimestamp: number;\n\ttype: RoomType;\n};\n\nexport type RoomAccess = {\n\tid: string;\n\tsecret: string;\n};\n\nexport type RoomQueue = {\n\t[index: string]: MediaAccess;\n};\n\n// ------------------------------------------------------------------\n\nexport const createQueueMerging = (\n\taccesses1: MediaAccess[],\n\taccesses2: MediaAccess[]\n): RoomQueue => {\n\tconst queue: RoomQueue = {};\n\t[...accesses1, ...accesses2].forEach(({ id, provider, type }, index) => {\n\t\tqueue[index] = { id, provider, type };\n\t});\n\treturn queue;\n};\n\n// ------------------------------------------------------------------\n\nexport const createQueueRemoving = (\n\taccesses: MediaAccess[],\n\tindex: number,\n\tcount: number\n): RoomQueue => {\n\tif (index < 0 || index >= accesses.length) {\n\t\tthrow new Error(\"Media index is out of range\");\n\t}\n\n\tconst queue: RoomQueue = {};\n\tconst copy = [...accesses];\n\tcopy.splice(index, count);\n\tcopy.forEach(({ id, provider, type }, index) => {\n\t\tqueue[index] = { id, provider, type };\n\t});\n\treturn queue;\n};\n","import { AsyncAction } from \".\";\nimport { displayError } from \"./messages\";\nimport { lockRoom } from \"./room\";\nimport { MediaAccess, findContextFromTrackIndex } from \"../utils/medias\";\nimport { extractErrorMessage } from \"../utils/messages\";\nimport { createQueueMerging, createQueueRemoving } from \"../utils/rooms\";\n\n// ------------------------------------------------------------------\n\nexport const clearQueue = (): AsyncAction => async (dispatch, getState) => {\n\tconst {\n\t\troom: { info, room }\n\t} = getState();\n\tif (!room || room.isLocked() || !info) {\n\t\tdispatch(displayError(\"rooms.error.locked\"));\n\t\treturn;\n\t}\n\ttry {\n\t\tconsole.debug(\"Clearing queue...\");\n\t\tawait room.update({\n\t\t\t...info,\n\t\t\tplaying: false,\n\t\t\tqueue: {},\n\t\t\tqueue_position: 0\n\t\t});\n\t} catch (err) {\n\t\tdispatch(displayError(extractErrorMessage(err)));\n\t\tdispatch(lockRoom());\n\t}\n};\n\n// ------------------------------------------------------------------\n\nexport const appendToQueue = (newMedias: MediaAccess[]): AsyncAction => async (\n\tdispatch,\n\tgetState\n) => {\n\tconst {\n\t\troom: { info, medias: oldMedias, room }\n\t} = getState();\n\tif (!room || room.isLocked() || !info) {\n\t\tdispatch(displayError(\"rooms.error.locked\"));\n\t\treturn;\n\t}\n\tif (newMedias.length === 0) {\n\t\t// Nothing to do\n\t\treturn;\n\t}\n\ttry {\n\t\tconsole.debug(\"Appending medias to queue...\", {\n\t\t\tnewMedias\n\t\t});\n\t\tawait room.update({\n\t\t\t...info,\n\t\t\tqueue: createQueueMerging(oldMedias, newMedias)\n\t\t});\n\t} catch (err) {\n\t\tdispatch(displayError(extractErrorMessage(err)));\n\t\tdispatch(lockRoom());\n\t}\n};\n\n// ------------------------------------------------------------------\n\n// TODO: DECOMPLEXIFY removeFromQueue\nexport const removeFromQueue = (\n\tremovedTrackIndex: number\n): AsyncAction => async (dispatch, getState) => {\n\tconst {\n\t\tmedias: { medias: allMedias },\n\t\troom: { info, medias, room, tracks }\n\t} = getState();\n\tif (!room || room.isLocked() || !info) {\n\t\tdispatch(displayError(\"rooms.error.locked\"));\n\t\treturn;\n\t}\n\tconst {\n\t\tmediaFirstTrackIndex: removedMediaFirstTrackIndex,\n\t\tmediaIndex: removedMediaIndex,\n\t\tmediaSize: removedTrackCount\n\t} = findContextFromTrackIndex(medias, removedTrackIndex, allMedias);\n\tif (removedMediaIndex < 0) {\n\t\t// Nothing to do\n\t\treturn;\n\t}\n\tconst playingTrackIndex = info.queue_position;\n\ttry {\n\t\tconsole.debug(\"Removing track from queue...\", {\n\t\t\tplayingTrackIndex,\n\t\t\tremovedMediaIndex,\n\t\t\tremovedTrackCount,\n\t\t\tremovedTrackIndex,\n\t\t\tremovedMediaFirstTrackIndex\n\t\t});\n\t\tconst queue = createQueueRemoving(medias, removedMediaIndex, 1);\n\t\tif (Object.keys(queue).length === 0) {\n\t\t\tconsole.debug(\"Removing last media from queue...\");\n\t\t\tawait room.update({\n\t\t\t\t...info,\n\t\t\t\tplaying: false,\n\t\t\t\tqueue: {},\n\t\t\t\tqueue_position: 0\n\t\t\t});\n\t\t} else if (playingTrackIndex < removedTrackIndex) {\n\t\t\tawait room.update({\n\t\t\t\t...info,\n\t\t\t\tqueue\n\t\t\t});\n\t\t} else if (\n\t\t\tplayingTrackIndex >= removedMediaFirstTrackIndex &&\n\t\t\tplayingTrackIndex < removedMediaFirstTrackIndex + removedTrackCount\n\t\t) {\n\t\t\tawait room.update({\n\t\t\t\t...info,\n\t\t\t\tqueue,\n\t\t\t\tqueue_position:\n\t\t\t\t\tremovedMediaFirstTrackIndex + removedTrackCount ===\n\t\t\t\t\ttracks.length\n\t\t\t\t\t\t? removedMediaFirstTrackIndex - 1\n\t\t\t\t\t\t: removedMediaFirstTrackIndex\n\t\t\t});\n\t\t} else {\n\t\t\tawait room.update({\n\t\t\t\t...info,\n\t\t\t\tqueue,\n\t\t\t\tqueue_position: playingTrackIndex - removedTrackCount\n\t\t\t});\n\t\t}\n\t} catch (err) {\n\t\tdispatch(displayError(extractErrorMessage(err)));\n\t\tdispatch(lockRoom());\n\t}\n};\n\n// ------------------------------------------------------------------\n\nexport const setQueuePosition = (newTrackIndex: number): AsyncAction => async (\n\tdispatch,\n\tgetState\n) => {\n\tconst {\n\t\troom: { info, room }\n\t} = getState();\n\tif (!room || room.isLocked() || !info) {\n\t\tdispatch(displayError(\"rooms.error.locked\"));\n\t\treturn;\n\t}\n\tconst oldTrackIndex = info.queue_position;\n\tif (oldTrackIndex === newTrackIndex) {\n\t\t// Nothing to do\n\t\treturn;\n\t}\n\ttry {\n\t\tconsole.debug(\"Set queue position...\", {\n\t\t\toldTrackIndex,\n\t\t\tnewTrackIndex\n\t\t});\n\t\tawait room.update({\n\t\t\t...info,\n\t\t\tplaying: true, // important\n\t\t\tqueue_position: newTrackIndex\n\t\t});\n\t} catch (err) {\n\t\tdispatch(displayError(extractErrorMessage(err)));\n\t\tdispatch(lockRoom());\n\t}\n};\n\n// ------------------------------------------------------------------\n\nexport const moveBackward = (): AsyncAction => async (dispatch, getState) => {\n\tconst {\n\t\troom: { info, tracks }\n\t} = getState();\n\tif (!info || tracks.length === 0) {\n\t\t// Nothing to do\n\t\treturn;\n\t}\n\tconsole.debug(\"Moving backward...\");\n\tdispatch(\n\t\tsetQueuePosition(\n\t\t\tinfo.queue_position > 0\n\t\t\t\t? info.queue_position - 1\n\t\t\t\t: tracks.length - 1\n\t\t)\n\t);\n};\n\n// ------------------------------------------------------------------\n\nexport const moveForward = (): AsyncAction => async (dispatch, getState) => {\n\tconst {\n\t\troom: { info, tracks }\n\t} = getState();\n\tif (!info || tracks.length === 0) {\n\t\t// Nothing to do\n\t\treturn;\n\t}\n\tconsole.debug(\"Moving forward...\");\n\tdispatch(setQueuePosition((info.queue_position + 1) % tracks.length));\n};\n","import React, { useCallback } from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { useTranslation } from \"react-i18next\";\n//\nimport { IconButton } from \"../Common/IconButton\";\nimport { LoadingIcon } from \"../Common/LoadingIcon\";\nimport { QueueItem } from \"./QueueItem\";\nimport { Dispatch } from \"../../actions\";\nimport { RootState } from \"../../reducers\";\nimport {\n\tisRoomLoaded,\n\tisRoomLocked,\n\tisRoomPlaying\n} from \"../../selectors/room\";\nimport { selectTracks } from \"../../selectors/medias\";\nimport { Track } from \"../../utils/medias\";\nimport { startPlayer, stopPlayer } from \"../../actions/player\";\nimport { setQueuePosition, removeFromQueue } from \"../../actions/queue\";\nimport { openModal } from \"../../actions/modals\";\nimport \"./Queue.scss\";\n\n// ------------------------------------------------------------------\n\nexport const Queue = () => {\n\tconst dispatch = useDispatch<Dispatch>();\n\tconst loaded = useSelector<RootState, boolean>(isRoomLoaded);\n\tconst locked = useSelector<RootState, boolean>(isRoomLocked);\n\tconst playing = useSelector<RootState, boolean>(isRoomPlaying);\n\tconst playingIndex = useSelector<RootState, number>(state =>\n\t\tnull !== state.room.info ? state.room.info.queue_position : 0\n\t);\n\tconst tracks = useSelector<RootState, Array<Track | null>>(selectTracks);\n\n\tconst onPlay = useCallback(\n\t\t(index: number) => {\n\t\t\tdispatch(startPlayer());\n\t\t\tdispatch(setQueuePosition(index));\n\t\t},\n\t\t[dispatch]\n\t);\n\n\tconst onRemove = useCallback(\n\t\t(index: number) => dispatch(removeFromQueue(index)),\n\t\t[dispatch]\n\t);\n\n\tconst onSearch = useCallback(\n\t\t() => dispatch(openModal({ type: \"Search\", props: null })),\n\t\t[dispatch]\n\t);\n\n\tconst onStop = useCallback(() => dispatch(stopPlayer()), [dispatch]);\n\n\treturn (\n\t\t<div className=\"Queue\">\n\t\t\t{tracks.length > 0 ? (\n\t\t\t\t<QueueList\n\t\t\t\t\tlocked={locked}\n\t\t\t\t\ttracks={tracks}\n\t\t\t\t\tplaying={playing}\n\t\t\t\t\tplayingIndex={playingIndex}\n\t\t\t\t\tonPlay={onPlay}\n\t\t\t\t\tonRemove={onRemove}\n\t\t\t\t\tonStop={onStop}\n\t\t\t\t/>\n\t\t\t) : (\n\t\t\t\t<EmptyQueueList\n\t\t\t\t\tloaded={loaded}\n\t\t\t\t\tlocked={locked}\n\t\t\t\t\tonSearch={onSearch}\n\t\t\t\t/>\n\t\t\t)}\n\t\t</div>\n\t);\n};\n\n// ------------------------------------------------------------------\n\nconst EmptyQueueList = React.memo(\n\t({\n\t\tloaded,\n\t\tlocked,\n\t\tonSearch\n\t}: {\n\t\tloaded: boolean;\n\t\tlocked: boolean;\n\t\tonSearch: () => void;\n\t}) => {\n\t\tconst { t } = useTranslation();\n\t\treturn (\n\t\t\t<div className=\"QueueEmpty\">\n\t\t\t\t{loaded ? (\n\t\t\t\t\t<>\n\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\ttitle=\"...\"\n\t\t\t\t\t\t\ticon=\"shower\"\n\t\t\t\t\t\t\tonClick={onSearch}\n\t\t\t\t\t\t\tsize=\"L\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<span onClick={onSearch}>\n\t\t\t\t\t\t\t{t(locked ? \"rooms.empty_for_now\" : \"rooms.empty\")}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</>\n\t\t\t\t) : (\n\t\t\t\t\t<>\n\t\t\t\t\t\t<LoadingIcon size=\"L\" />\n\t\t\t\t\t\t<span>{t(\"rooms.loading\")}</span>\n\t\t\t\t\t</>\n\t\t\t\t)}\n\t\t\t</div>\n\t\t);\n\t}\n);\n\n// ------------------------------------------------------------------\n\nconst QueueList = React.memo(\n\t({\n\t\tlocked,\n\t\ttracks,\n\t\tplaying,\n\t\tplayingIndex,\n\t\tonPlay,\n\t\tonRemove,\n\t\tonStop\n\t}: {\n\t\tlocked: boolean;\n\t\ttracks: Array<Track | null>;\n\t\tplaying: boolean;\n\t\tplayingIndex: number;\n\t\tonPlay: (index: number) => void;\n\t\tonRemove: (index: number) => void;\n\t\tonStop: () => void;\n\t}) => (\n\t\t<>\n\t\t\t{tracks.map((track, index) => (\n\t\t\t\t<QueueItem\n\t\t\t\t\tkey={index}\n\t\t\t\t\tlocked={locked}\n\t\t\t\t\tplaying={playing && playingIndex === index}\n\t\t\t\t\ttrack={track}\n\t\t\t\t\tonPlay={() => onPlay(index)}\n\t\t\t\t\tonRemove={() => onRemove(index)}\n\t\t\t\t\tonStop={onStop}\n\t\t\t\t/>\n\t\t\t))}\n\t\t</>\n\t)\n);\n","import React, { useEffect, useState } from \"react\";\n//\nimport { QUEUE_PLAYER } from \"../../utils/player\";\nimport \"./Progress.scss\";\n\n// ------------------------------------------------------------------\n\nexport const Progress = () => {\n\tconst [value, setValue] = useState(0);\n\n\tuseEffect(() => {\n\t\tconst timer = setInterval(() => {\n\t\t\tsetValue(QUEUE_PLAYER.getPlayingTrackPercent());\n\t\t}, 250);\n\t\treturn () => {\n\t\t\tclearInterval(timer);\n\t\t};\n\t}, [setValue]);\n\n\treturn (\n\t\t<div className=\"Progress\">\n\t\t\t<progress max={100} value={value * 100} />\n\t\t</div>\n\t);\n};\n","import React, { useCallback } from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { useTranslation } from \"react-i18next\";\n//\nimport { IconButton } from \"../Common/IconButton\";\nimport { Progress } from \"./Progress\";\nimport { Dispatch } from \"../../actions\";\nimport { RootState } from \"../../reducers\";\nimport { isRoomLocked, isRoomPlaying } from \"../../selectors/room\";\nimport { lockRoom } from \"../../actions/room\";\nimport { clearQueue, moveBackward, moveForward } from \"../../actions/queue\";\nimport { stopPlayer, startPlayer } from \"../../actions/player\";\nimport { confirmModal, openModal } from \"../../actions/modals\";\nimport \"./Controls.scss\";\n\n// ------------------------------------------------------------------\n\nexport const Controls = () => {\n\tconst dispatch = useDispatch<Dispatch>();\n\tconst { t } = useTranslation();\n\tconst tracksCount = useSelector<RootState, number>(\n\t\tstate => state.room.medias.length\n\t);\n\tconst locked = useSelector<RootState, boolean>(isRoomLocked);\n\tconst playing = useSelector<RootState, boolean>(isRoomPlaying);\n\tconst onClear = useCallback(() => {\n\t\tdispatch(\n\t\t\tconfirmModal(t(\"rooms.confirm_clear\"), () => {\n\t\t\t\tdispatch(clearQueue());\n\t\t\t\tdispatch(stopPlayer());\n\t\t\t})\n\t\t);\n\t}, [dispatch, t]);\n\n\tconst onLock = useCallback(() => {\n\t\tdispatch(\n\t\t\tconfirmModal(t(\"rooms.confirm_lock\"), () => {\n\t\t\t\tdispatch(lockRoom());\n\t\t\t})\n\t\t);\n\t}, [dispatch, t]);\n\n\tconst onUnlock = useCallback(() => {\n\t\tdispatch(openModal({ type: \"UnlockRoom\", props: null }));\n\t}, [dispatch]);\n\n\tconst onMoveBackward = useCallback(() => dispatch(moveBackward()), [\n\t\tdispatch\n\t]);\n\n\tconst onMoveForward = useCallback(() => dispatch(moveForward()), [\n\t\tdispatch\n\t]);\n\n\tconst onPlay = useCallback(() => dispatch(startPlayer()), [dispatch]);\n\n\tconst onSearch = useCallback(\n\t\t() => dispatch(openModal({ type: \"Search\", props: null })),\n\t\t[dispatch]\n\t);\n\n\tconst onStop = useCallback(() => dispatch(stopPlayer()), [dispatch]);\n\n\treturn (\n\t\t<div className=\"Controls\">\n\t\t\t<div className=\"ControlsInner\">\n\t\t\t\t<div className=\"ControlsSet PlayerControlsSet\">\n\t\t\t\t\t<div className=\"Control\">\n\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\tdisabled={locked || tracksCount === 0}\n\t\t\t\t\t\t\ticon=\"step-backward\"\n\t\t\t\t\t\t\tonClick={onMoveBackward}\n\t\t\t\t\t\t\tsize=\"M\"\n\t\t\t\t\t\t\ttitle={t(\"player.backward\")}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className=\"Control\">\n\t\t\t\t\t\t{!playing ? (\n\t\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\t\tdisabled={locked || tracksCount === 0}\n\t\t\t\t\t\t\t\tonClick={onPlay}\n\t\t\t\t\t\t\t\ticon=\"play\"\n\t\t\t\t\t\t\t\tsize=\"L\"\n\t\t\t\t\t\t\t\ttitle={t(\"player.play\")}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\t\tdisabled={locked || tracksCount === 0}\n\t\t\t\t\t\t\t\tonClick={onStop}\n\t\t\t\t\t\t\t\ticon=\"pause\"\n\t\t\t\t\t\t\t\ttitle={t(\"player.stop\")}\n\t\t\t\t\t\t\t\tsize=\"L\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className=\"Control\">\n\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\tdisabled={locked || tracksCount === 0}\n\t\t\t\t\t\t\ticon=\"step-forward\"\n\t\t\t\t\t\t\tonClick={onMoveForward}\n\t\t\t\t\t\t\tsize=\"M\"\n\t\t\t\t\t\t\ttitle={t(\"player.forward\")}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<Progress />\n\t\t\t\t<div className=\"ControlsSet RoomControlsSet\">\n\t\t\t\t\t<div className=\"Control\">\n\t\t\t\t\t\t{locked ? (\n\t\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\t\ticon=\"lock\"\n\t\t\t\t\t\t\t\tonClick={onUnlock}\n\t\t\t\t\t\t\t\tsize=\"M\"\n\t\t\t\t\t\t\t\ttitle={t(\"rooms.locked\")}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\t\ticon=\"unlock\"\n\t\t\t\t\t\t\t\tonClick={onLock}\n\t\t\t\t\t\t\t\tsize=\"M\"\n\t\t\t\t\t\t\t\ttitle={t(\"rooms.unlocked\")}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className=\"Control\">\n\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\tonClick={onSearch}\n\t\t\t\t\t\t\ticon=\"search\"\n\t\t\t\t\t\t\ttitle={t(\"medias.search\")}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className=\"Control\">\n\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\tdisabled={locked || tracksCount === 0}\n\t\t\t\t\t\t\tonClick={onClear}\n\t\t\t\t\t\t\ticon=\"trash\"\n\t\t\t\t\t\t\ttitle={t(\"rooms.clear\")}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t);\n};\n","import React, { useEffect } from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { useLocation, useParams } from \"react-router-dom\";\nimport classNames from \"classnames\";\nimport qs from \"qs\";\n//\nimport { Head } from \"../components/Room/Head\";\nimport { Queue } from \"../components/Room/Queue\";\nimport { Controls } from \"../components/Room/Controls\";\nimport { RootState } from \"../reducers\";\nimport { CombinedColor } from \"../utils/colorpicker\";\nimport { exitRoom, enterRoom } from \"../actions/room\";\nimport { Dispatch } from \"../actions\";\nimport \"./Room.scss\";\n\n// ------------------------------------------------------------------\n\nexport const Room = () => {\n\tconst dispatch = useDispatch<Dispatch>();\n\tconst { fg, bg } = useSelector<RootState, CombinedColor>(\n\t\tstate => state.room.color\n\t);\n\n\tconst { search } = useLocation();\n\tconst { room_id } = useParams<{\n\t\troom_id: string;\n\t}>();\n\n\tconst { secret } = qs.parse(search.substr(1)) as {\n\t\tsecret?: string;\n\t};\n\n\tuseEffect(() => {\n\t\tdispatch(enterRoom(room_id, secret || \"\"));\n\n\t\treturn () => {\n\t\t\tdispatch(exitRoom());\n\t\t};\n\t}, [dispatch, room_id, secret]);\n\n\tuseEffect(() => {\n\t\tdocument.body.className = fg;\n\t\tdocument.body.style.backgroundColor = `rgb(${bg.r}, ${bg.g}, ${bg.b})`;\n\t}, [bg, fg]);\n\n\treturn (\n\t\t<div className={classNames(\"Room\")}>\n\t\t\t<Head />\n\t\t\t<Queue />\n\t\t\t<Controls />\n\t\t</div>\n\t);\n};\n","import { AxiosError } from \"axios\";\nimport { v4 } from \"uuid\";\n//\nimport { createAction, AsyncAction } from \".\";\nimport { UserInfo } from \"../utils/users\";\nimport { FirebaseUser } from \"../utils/firebase\";\nimport { displayError } from \"./messages\";\nimport { extractErrorMessage } from \"../utils/messages\";\nimport { UserData } from \"../reducers/user\";\n\n// ------------------------------------------------------------------\n\nexport type UserAction =\n\t| ReturnType<typeof fetching>\n\t| ReturnType<typeof success>\n\t| ReturnType<typeof error>\n\t| ReturnType<typeof resetUser>\n\t| ReturnType<typeof setUser>;\n\nconst fetching = () => createAction(\"user/FETCHING\");\nconst success = () => createAction(\"user/FETCHED\");\nconst error = (error: AxiosError) => createAction(\"user/ERROR\", error);\nconst resetUser = () => createAction(\"user/RESET\");\nconst setUser = (values: Partial<UserData>) => createAction(\"user/SET\", values);\n\n// ------------------------------------------------------------------\n\nexport const createUser = (\n\tname: string,\n\tsecret: string\n): AsyncAction => async dispatch => {\n\ttry {\n\t\tconsole.debug(\"Creating user...\");\n\t\tconst id = v4();\n\t\tawait FirebaseUser({ id, secret }).update({ name });\n\t\tdispatch(connectUser(id, secret));\n\t} catch (err) {\n\t\tdispatch(displayError(extractErrorMessage(err)));\n\t}\n};\n\n// ------------------------------------------------------------------\n\nlet FIREBASE_CB: any = null;\n\nexport const connectUser = (id: string, secret: string): AsyncAction => async (\n\tdispatch,\n\tgetState\n) => {\n\tconst {\n\t\tuser: { user }\n\t} = getState();\n\tif (user && user.id === id) {\n\t\t// Nothing to do\n\t\treturn;\n\t}\n\tdispatch(disconnectUser());\n\ttry {\n\t\tconsole.debug(\"Connection user...\", { id, secret });\n\t\tconst newUser = FirebaseUser({ id, secret });\n\t\tdispatch(\n\t\t\tsetUser({\n\t\t\t\taccess: { id, secret },\n\t\t\t\tuser: newUser,\n\t\t\t\tinfo: await newUser.wait()\n\t\t\t})\n\t\t);\n\t\tFIREBASE_CB = newUser.subscribe(\n\t\t\t(snapshot: firebase.database.DataSnapshot) => {\n\t\t\t\tconst newInfo = snapshot.val() as UserInfo;\n\t\t\t\tconsole.debug(\"[Firebase] Received user update...\", newInfo);\n\t\t\t\tdispatch(setUser({ user: newUser, info: newInfo }));\n\t\t\t}\n\t\t);\n\t} catch (err) {\n\t\tdispatch(displayError(extractErrorMessage(err)));\n\t\tdispatch(setUser({ access: { id, secret: \"\" } }));\n\t}\n};\n\nexport const disconnectUser = (): AsyncAction => async (dispatch, getState) => {\n\tconst {\n\t\tuser: {\n\t\t\taccess: { id, secret },\n\t\t\tuser\n\t\t}\n\t} = getState();\n\tif (!id && !secret && !user) {\n\t\t// Nothing to do\n\t\treturn;\n\t}\n\tconsole.debug(\"Disconnecting user...\");\n\tif (user) {\n\t\tuser.unsubscribe(FIREBASE_CB);\n\t\tFIREBASE_CB = null;\n\t}\n\tdispatch(resetUser());\n};\n\nexport const reconnectUser = (): AsyncAction => async (dispatch, getState) => {\n\tconst {\n\t\tuser: {\n\t\t\taccess: { id, secret }\n\t\t}\n\t} = getState();\n\tif (!id || !secret) {\n\t\t// Nothing to do\n\t\treturn;\n\t}\n\tconsole.debug(\"Reconnecting user...\", { id, secret });\n\tdispatch(connectUser(id, secret));\n};\n","import React, { useCallback } from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { Link } from \"react-router-dom\";\nimport { useTranslation } from \"react-i18next\";\n//\nimport { IconButton } from \"../components/Common/IconButton\";\nimport { RootState } from \"../reducers\";\nimport { openModal } from \"../actions/modals\";\nimport { disconnectUser } from \"../actions/user\";\nimport \"./Splash.scss\";\n\n// ------------------------------------------------------------------\n\nexport const Splash = () => {\n\tconst dispatch = useDispatch();\n\tconst loggedIn = useSelector<RootState, boolean>(\n\t\tstate => !!state.user.access.id\n\t);\n\tconst { t } = useTranslation();\n\n\tconst onCreateRoom = useCallback(\n\t\t() => dispatch(openModal({ type: \"CreateRoom\", props: null })),\n\t\t[dispatch]\n\t);\n\n\tconst onJoinRoom = useCallback(\n\t\t() => dispatch(openModal({ type: \"JoinRoom\", props: null })),\n\t\t[dispatch]\n\t);\n\n\tconst onConnectUser = useCallback(\n\t\t() => dispatch(openModal({ type: \"CreateUser\", props: null })),\n\t\t[dispatch]\n\t);\n\n\tconst onDisconnect = useCallback(() => dispatch(disconnectUser()), [\n\t\tdispatch\n\t]);\n\n\treturn (\n\t\t<div className=\"Splash\">\n\t\t\t<div className=\"Top\">\n\t\t\t\t<div className=\"Logo\">\n\t\t\t\t\t<Link to=\"/\">Party</Link>\n\t\t\t\t</div>\n\t\t\t\t<div className=\"PoweredWith\">\n\t\t\t\t\t<span>{t(\"splash.powered_with\")}</span>\n\t\t\t\t\t<a\n\t\t\t\t\t\thref=\"https://www.deezer.com\"\n\t\t\t\t\t\ttarget=\"_blank\"\n\t\t\t\t\t\trel=\"noopener noreferrer\">\n\t\t\t\t\t\t<img\n\t\t\t\t\t\t\tsrc=\"/images/deezer.svg\"\n\t\t\t\t\t\t\theight=\"20px\"\n\t\t\t\t\t\t\ttitle=\"Deezer\"\n\t\t\t\t\t\t\talt=\"Deezer Logo\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</a>\n\t\t\t\t</div>\n\t\t\t\t<div className=\"Description\">\n\t\t\t\t\t<span>{t(\"splash.description\")}</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div className=\"Middle\">\n\t\t\t\t<div className=\"Menu\">\n\t\t\t\t\t{loggedIn ? (\n\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t<div className=\"MenuItem\">\n\t\t\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\t\t\tdisplayTitle={true}\n\t\t\t\t\t\t\t\t\ticon=\"plus\"\n\t\t\t\t\t\t\t\t\tonClick={onCreateRoom}\n\t\t\t\t\t\t\t\t\tsize=\"L\"\n\t\t\t\t\t\t\t\t\ttitle={t(\"rooms.create\")}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div className=\"MenuItem\">\n\t\t\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\t\t\tdisplayTitle={true}\n\t\t\t\t\t\t\t\t\ticon=\"sign-in\"\n\t\t\t\t\t\t\t\t\tonClick={onJoinRoom}\n\t\t\t\t\t\t\t\t\tsize=\"L\"\n\t\t\t\t\t\t\t\t\ttitle={t(\"rooms.join\")}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</>\n\t\t\t\t\t) : (\n\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t<div className=\"MenuItem\">\n\t\t\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\t\t\tdisplayTitle={true}\n\t\t\t\t\t\t\t\t\tonClick={onConnectUser}\n\t\t\t\t\t\t\t\t\ticon=\"sign-in\"\n\t\t\t\t\t\t\t\t\tsize=\"L\"\n\t\t\t\t\t\t\t\t\ttitle={t(\"users.connect\")}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</>\n\t\t\t\t\t)}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div className=\"Bottom\">\n\t\t\t\t<div className=\"Menu\">\n\t\t\t\t\t{loggedIn ? (\n\t\t\t\t\t\t<div className=\"MenuItem\">\n\t\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\t\tdisplayTitle={true}\n\t\t\t\t\t\t\t\ticon=\"sign-out\"\n\t\t\t\t\t\t\t\tonClick={onDisconnect}\n\t\t\t\t\t\t\t\tsize=\"M\"\n\t\t\t\t\t\t\t\ttitle={t(\"users.disconnect\")}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t) : (\n\t\t\t\t\t\t<div className=\"MenuItem\">\n\t\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\t\tdisplayTitle={true}\n\t\t\t\t\t\t\t\ticon=\"info\"\n\t\t\t\t\t\t\t\tonClick={() => {}}\n\t\t\t\t\t\t\t\tsize=\"M\"\n\t\t\t\t\t\t\t\ttitle={t(\"splash.CGU\")}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t);\n};\n","import React, { FormEvent, ReactNode, useCallback } from \"react\";\nimport classNames from \"classnames\";\nimport { useTranslation } from \"react-i18next\";\n//\nimport { IconButton } from \"../Common/IconButton\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { RootState } from \"../../reducers\";\nimport { Dispatch } from \"../../actions\";\nimport { popModal, closeModal } from \"../../actions/modals\";\n\n// ------------------------------------------------------------------\n\nexport const Modal = ({\n\tchildren,\n\tclassName,\n\ttitle,\n\trenderFoot,\n\tonSubmit\n}: {\n\tchildren: ReactNode;\n\tclassName?: string;\n\ttitle: string;\n\trenderFoot?: () => React.ReactNode;\n\tonSubmit?: () => void;\n}) => {\n\tconst dispatch = useDispatch<Dispatch>();\n\tconst { t } = useTranslation();\n\tconst has_prev_modal = useSelector<RootState, boolean>(\n\t\tstate => state.modals.stack.length > 1\n\t);\n\n\tconst onClose = useCallback(() => dispatch(closeModal()), [dispatch]);\n\tconst onPop = useCallback(() => dispatch(popModal()), [dispatch]);\n\n\treturn (\n\t\t<form\n\t\t\tclassName={classNames(\"Modal\", className)}\n\t\t\tonSubmit={(event: FormEvent<HTMLFormElement>) => {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tif (onSubmit) {\n\t\t\t\t\tonSubmit();\n\t\t\t\t}\n\t\t\t}}>\n\t\t\t<div className=\"ModalHead\">\n\t\t\t\t<IconButton\n\t\t\t\t\tkind=\"special\"\n\t\t\t\t\tclassName={classNames(\"ModalHeadBack\", {\n\t\t\t\t\t\thidden: !has_prev_modal\n\t\t\t\t\t})}\n\t\t\t\t\ticon=\"angle-left\"\n\t\t\t\t\ttitle=\"Back\"\n\t\t\t\t\tonClick={onPop}\n\t\t\t\t/>\n\t\t\t\t<div className=\"ModalTitle\">{title}</div>\n\t\t\t\t<IconButton\n\t\t\t\t\tkind=\"special\"\n\t\t\t\t\tclassName=\"ModalHeadClose\"\n\t\t\t\t\tonClick={onClose}\n\t\t\t\t\ttitle={t(\"cancel\")}\n\t\t\t\t\ticon=\"times\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<div className=\"ModalBody\">{children}</div>\n\t\t\t<div className=\"ModalFoot\">{renderFoot && renderFoot()}</div>\n\t\t</form>\n\t);\n};\n","import React, { ReactNode } from \"react\";\nimport classNames from \"classnames\";\n//\nimport { Modal } from \"./Modal\";\nimport \"./FormModal.scss\";\n\n// ------------------------------------------------------------------\n\nexport const FormModal = ({\n\tchildren,\n\tclassName,\n\trenderButtons,\n\ttitle,\n\tonSubmit\n}: {\n\tchildren: ReactNode;\n\tclassName?: string;\n\tonSubmit: () => void;\n\trenderButtons: () => React.ReactNode;\n\ttitle: string;\n}) => (\n\t<Modal\n\t\tclassName={classNames(\"FormModal\", className)}\n\t\ttitle={title}\n\t\trenderFoot={renderButtons}\n\t\tonSubmit={onSubmit}>\n\t\t{children}\n\t</Modal>\n);\n","import React from \"react\";\nimport { useTranslation } from \"react-i18next\";\n//\nimport { IconButton } from \"./IconButton\";\n\n// ------------------------------------------------------------------\n\nexport const CancelButton = ({ onClick }: { onClick: () => void }) => {\n\tconst { t } = useTranslation();\n\treturn (\n\t\t<IconButton\n\t\t\tonClick={onClick}\n\t\t\ttitle={t(\"cancel\")}\n\t\t\tkind=\"default\"\n\t\t\ticon=\"ban\"\n\t\t/>\n\t);\n};\n","import React, { useCallback } from \"react\";\nimport { useTranslation } from \"react-i18next\";\n//\nimport { FormModal } from \"../Modals/FormModal\";\nimport { IconButton } from \"../Common/IconButton\";\nimport { CancelButton } from \"../Common/CancelButton\";\nimport { useDispatch } from \"react-redux\";\nimport { Dispatch } from \"../../actions\";\nimport { popModal } from \"../../actions/modals\";\n\n// ------------------------------------------------------------------\n\nexport const ConfirmModal = ({\n\tquestion,\n\tonCanceled,\n\tonConfirmed\n}: {\n\tquestion: string;\n\tonCanceled?: () => void;\n\tonConfirmed: () => void;\n}) => {\n\tconst dispatch = useDispatch<Dispatch>();\n\tconst { t } = useTranslation();\n\n\tconst onCancel = useCallback(() => {\n\t\tdispatch(popModal());\n\t\tif (onCanceled) {\n\t\t\tonCanceled();\n\t\t}\n\t}, [dispatch, onCanceled]);\n\n\treturn (\n\t\t<FormModal\n\t\t\ttitle={t(\"confirm\")}\n\t\t\tonSubmit={onConfirmed}\n\t\t\trenderButtons={() => (\n\t\t\t\t<>\n\t\t\t\t\t<IconButton\n\t\t\t\t\t\ttitle={t(\"cancel\")}\n\t\t\t\t\t\tkind=\"primary\"\n\t\t\t\t\t\ticon=\"plus\"\n\t\t\t\t\t\ttype=\"submit\"\n\t\t\t\t\t/>\n\t\t\t\t\t<CancelButton onClick={onCancel} />\n\t\t\t\t</>\n\t\t\t)}>\n\t\t\t{question}\n\t\t</FormModal>\n\t);\n};\n","import React, { useCallback } from \"react\";\nimport { useDispatch } from \"react-redux\";\nimport { useTranslation } from \"react-i18next\";\n//\nimport { copyToClipboard } from \"../../utils/clipboard\";\nimport { IconButton } from \"../Common/IconButton\";\nimport { displayInfo } from \"../../actions/messages\";\n\n// ------------------------------------------------------------------\n\nexport const ModalField = ({ children }: { children?: React.ReactNode }) => (\n\t<div className=\"ModalField\">{children}</div>\n);\n\n// ------------------------------------------------------------------\n\nexport const InputField = React.forwardRef(\n\t(\n\t\tprops: { label: string } & React.DetailedHTMLProps<\n\t\t\tReact.InputHTMLAttributes<HTMLInputElement>,\n\t\t\tHTMLInputElement\n\t\t>,\n\t\tref: React.Ref<HTMLInputElement>\n\t) => (\n\t\t<ModalField>\n\t\t\t<div className=\"XXX\">\n\t\t\t\t<label htmlFor={props.id}>{props.label}</label>\n\t\t\t\t<input ref={ref} {...props} />\n\t\t\t</div>\n\t\t</ModalField>\n\t)\n);\n\n// ------------------------------------------------------------------\n\nexport const SECRET_FIELD_SIZE = 36;\n\nexport const SecretField = ({\n\tid,\n\tlabel,\n\tonChange,\n\tplaceholder,\n\tvalue\n}: {\n\tid: string;\n\tlabel: string;\n\tonChange: (value: string) => void;\n\tplaceholder: string;\n\tvalue: string;\n}) => {\n\tconst dispatch = useDispatch();\n\tconst { t } = useTranslation();\n\n\tconst onCopyToClipboard = useCallback(async () => {\n\t\tawait copyToClipboard(value);\n\t\tdispatch(displayInfo(\"secret_copied_to_clipboard\"));\n\t}, [dispatch, value]);\n\n\treturn (\n\t\t<ModalField>\n\t\t\t<div className=\"XXX\">\n\t\t\t\t<label htmlFor={id}>{label}</label>\n\t\t\t\t<div\n\t\t\t\t\tstyle={{\n\t\t\t\t\t\tdisplay: \"flex\",\n\t\t\t\t\t\tflexDirection: \"row\",\n\t\t\t\t\t\tjustifyContent: \"space-between\"\n\t\t\t\t\t}}>\n\t\t\t\t\t<input\n\t\t\t\t\t\tstyle={{\n\t\t\t\t\t\t\tflexGrow: 1,\n\t\t\t\t\t\t\tmarginRight: \"0.5rem\"\n\t\t\t\t\t\t}}\n\t\t\t\t\t\tid={id}\n\t\t\t\t\t\ttype=\"password\"\n\t\t\t\t\t\tautoComplete=\"password\"\n\t\t\t\t\t\tplaceholder={placeholder}\n\t\t\t\t\t\tmaxLength={SECRET_FIELD_SIZE}\n\t\t\t\t\t\tminLength={SECRET_FIELD_SIZE}\n\t\t\t\t\t\trequired={true}\n\t\t\t\t\t\tvalue={value}\n\t\t\t\t\t\tonChange={e => onChange(e.target.value)}\n\t\t\t\t\t/>\n\t\t\t\t\t<IconButton\n\t\t\t\t\t\ticon=\"clipboard\"\n\t\t\t\t\t\tonClick={onCopyToClipboard}\n\t\t\t\t\t\tsize=\"M\"\n\t\t\t\t\t\ttitle={t(\"copy_to_clipboard\")}\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</ModalField>\n\t);\n};\n","import React, { useRef, useState, useEffect, useCallback } from \"react\";\nimport { useDispatch } from \"react-redux\";\nimport { useTranslation } from \"react-i18next\";\n//\nimport { FormModal } from \"../Modals/FormModal\";\nimport { IconButton } from \"../Common/IconButton\";\nimport { CancelButton } from \"../Common/CancelButton\";\nimport { popModal, openModal } from \"../../actions/modals\";\nimport { displayError } from \"../../actions/messages\";\nimport { connectUser } from \"../../actions/user\";\nimport { Dispatch } from \"../../actions\";\nimport { SECRET_FIELD_SIZE, InputField } from \"../Modals/ModalFields\";\n\n// ------------------------------------------------------------------\n\nexport const ConnectUserModal = () => {\n\tconst dispatch = useDispatch<Dispatch>();\n\tconst [id, setId] = useState(\"\");\n\tconst [secret, setSecret] = useState(\"\");\n\tconst idRef = useRef<HTMLInputElement>(null);\n\tconst { t } = useTranslation();\n\n\tuseEffect(() => {\n\t\tif (idRef.current) {\n\t\t\tidRef.current.focus();\n\t\t}\n\t}, [idRef]);\n\n\tconst onClose = useCallback(() => dispatch(popModal()), [dispatch]);\n\n\tconst onConnect = useCallback(() => {\n\t\tif (id.trim().length === 0) {\n\t\t\tdispatch(displayError(\"users.id_is_invalid\"));\n\t\t\treturn;\n\t\t}\n\t\tif (secret.trim().length === 0) {\n\t\t\tdispatch(displayError(\"users.secret_is_invalid\"));\n\t\t\treturn;\n\t\t}\n\t\tdispatch(connectUser(id, secret));\n\t\tdispatch(popModal());\n\t}, [dispatch, id, secret]);\n\n\tconst onToggle = useCallback(\n\t\t() => dispatch(openModal({ type: \"CreateUser\", props: null })),\n\t\t[dispatch]\n\t);\n\n\treturn (\n\t\t<FormModal\n\t\t\ttitle={t(\"users.connection\")}\n\t\t\tonSubmit={onConnect}\n\t\t\trenderButtons={() => (\n\t\t\t\t<>\n\t\t\t\t\t<IconButton\n\t\t\t\t\t\tdisabled={\n\t\t\t\t\t\t\tid.trim().length === 0 ||\n\t\t\t\t\t\t\tid.length !== 36 ||\n\t\t\t\t\t\t\tsecret.length !== SECRET_FIELD_SIZE\n\t\t\t\t\t\t}\n\t\t\t\t\t\ttitle={t(\"users.connect\")}\n\t\t\t\t\t\tkind=\"primary\"\n\t\t\t\t\t\ticon=\"sign-in\"\n\t\t\t\t\t\ttype=\"submit\"\n\t\t\t\t\t/>\n\t\t\t\t\t<CancelButton onClick={onClose} />\n\t\t\t\t\t<IconButton\n\t\t\t\t\t\ttitle={t(\"users.create\")}\n\t\t\t\t\t\tkind=\"default\"\n\t\t\t\t\t\ticon=\"plus\"\n\t\t\t\t\t\tonClick={onToggle}\n\t\t\t\t\t/>\n\t\t\t\t</>\n\t\t\t)}>\n\t\t\t<InputField\n\t\t\t\tid=\"modal-id\"\n\t\t\t\tlabel={t(\"users.id\")}\n\t\t\t\ttype=\"text\"\n\t\t\t\tplaceholder={t(\"users.id_placeholder\")}\n\t\t\t\tmaxLength={36}\n\t\t\t\tminLength={36}\n\t\t\t\trequired={true}\n\t\t\t\tvalue={id}\n\t\t\t\tref={idRef}\n\t\t\t\tonChange={e => setId(e.target.value)}\n\t\t\t/>\n\t\t\t<InputField\n\t\t\t\tid=\"modal-secret\"\n\t\t\t\tlabel={t(\"users.secret\")}\n\t\t\t\ttype=\"password\"\n\t\t\t\tautoComplete=\"password\"\n\t\t\t\tplaceholder={t(\"users.secret_placeholder\")}\n\t\t\t\tmaxLength={36}\n\t\t\t\tminLength={36}\n\t\t\t\trequired={true}\n\t\t\t\tvalue={secret}\n\t\t\t\tonChange={e => setSecret(e.target.value)}\n\t\t\t/>\n\t\t</FormModal>\n\t);\n};\n","import React, { useState, useRef, useEffect, useCallback } from \"react\";\nimport { useDispatch } from \"react-redux\";\nimport { useTranslation } from \"react-i18next\";\nimport { v4 } from \"uuid\";\n//\nimport { FormModal } from \"../Modals/FormModal\";\nimport { IconButton } from \"../Common/IconButton\";\nimport { CancelButton } from \"../Common/CancelButton\";\nimport {\n\tSecretField,\n\tSECRET_FIELD_SIZE,\n\tInputField\n} from \"../Modals/ModalFields\";\nimport { Dispatch } from \"../../actions\";\nimport { popModal } from \"../../actions/modals\";\nimport { createRoom } from \"../../actions/room\";\nimport { displayError } from \"../../actions/messages\";\n\n// ------------------------------------------------------------------\n\nlet ROOM_COUNTER = 1;\n\n// ------------------------------------------------------------------\n\nexport const CreateRoomModal = () => {\n\tconst dispatch = useDispatch<Dispatch>();\n\tconst [name, setName] = useState(\"\");\n\tconst [secret, setSecret] = useState(v4());\n\tconst nameRef = useRef<HTMLInputElement>(null);\n\tconst { t } = useTranslation();\n\n\tuseEffect(() => {\n\t\tsetName(`${t(\"rooms.room\")} ${ROOM_COUNTER}`);\n\t\tif (nameRef.current) {\n\t\t\tnameRef.current.focus();\n\t\t}\n\t}, [t, nameRef]);\n\n\tconst onClose = useCallback(() => dispatch(popModal()), [dispatch]);\n\n\tconst onCreate = useCallback(() => {\n\t\tif (name.trim().length === 0) {\n\t\t\tdispatch(displayError(\"rooms.name_is_invalid\"));\n\t\t\treturn;\n\t\t}\n\t\tif (secret.trim().length === 0) {\n\t\t\tdispatch(displayError(\"rooms.secret_is_invalid\"));\n\t\t\treturn;\n\t\t}\n\t\tdispatch(createRoom(name, secret));\n\t\tdispatch(popModal());\n\t\tROOM_COUNTER++;\n\t}, [dispatch, name, secret]);\n\n\treturn (\n\t\t<FormModal\n\t\t\ttitle={t(\"rooms.room_creation\")}\n\t\t\tonSubmit={onCreate}\n\t\t\trenderButtons={() => (\n\t\t\t\t<>\n\t\t\t\t\t<IconButton\n\t\t\t\t\t\tdisabled={\n\t\t\t\t\t\t\tname.trim().length === 0 ||\n\t\t\t\t\t\t\tsecret.length !== SECRET_FIELD_SIZE\n\t\t\t\t\t\t}\n\t\t\t\t\t\ttitle={t(\"rooms.create\")}\n\t\t\t\t\t\tkind=\"primary\"\n\t\t\t\t\t\ticon=\"plus\"\n\t\t\t\t\t\ttype=\"submit\"\n\t\t\t\t\t/>\n\t\t\t\t\t<CancelButton onClick={onClose} />\n\t\t\t\t</>\n\t\t\t)}>\n\t\t\t<InputField\n\t\t\t\tid=\"modal-name\"\n\t\t\t\tlabel={t(\"rooms.name\")}\n\t\t\t\ttype=\"text\"\n\t\t\t\tplaceholder={t(\"rooms.name_placeholder\")}\n\t\t\t\tmaxLength={100}\n\t\t\t\tminLength={2}\n\t\t\t\trequired={true}\n\t\t\t\tvalue={name}\n\t\t\t\tref={nameRef}\n\t\t\t\tonChange={e => setName(e.target.value)}\n\t\t\t/>\n\t\t\t<SecretField\n\t\t\t\tid=\"modal-secret\"\n\t\t\t\tlabel={t(\"rooms.key\")}\n\t\t\t\tplaceholder={t(\"rooms.key_placeholder\")}\n\t\t\t\tvalue={secret}\n\t\t\t\tonChange={setSecret}\n\t\t\t/>\n\t\t</FormModal>\n\t);\n};\n","import React, { useState, useEffect, useRef, useCallback } from \"react\";\nimport { useDispatch } from \"react-redux\";\nimport { useTranslation } from \"react-i18next\";\nimport { v4 } from \"uuid\";\n//\nimport { FormModal } from \"../Modals/FormModal\";\nimport { IconButton } from \"../Common/IconButton\";\nimport { CancelButton } from \"../Common/CancelButton\";\nimport {\n\tSecretField,\n\tSECRET_FIELD_SIZE,\n\tInputField\n} from \"../Modals/ModalFields\";\nimport { popModal, openModal } from \"../../actions/modals\";\nimport { displayError } from \"../../actions/messages\";\nimport { createUser } from \"../../actions/user\";\nimport { Dispatch } from \"../../actions\";\n\n// ------------------------------------------------------------------\n\nlet USER_COUNTER = 1;\n\n// ------------------------------------------------------------------\n\nexport const CreateUserModal = () => {\n\tconst dispatch = useDispatch<Dispatch>();\n\tconst [name, setName] = useState(\"\");\n\tconst [secret, setSecret] = useState(v4());\n\tconst nameRef = useRef<HTMLInputElement>(null);\n\tconst { t } = useTranslation();\n\n\tuseEffect(() => {\n\t\tsetName(`${t(\"users.user\")} ${USER_COUNTER}`);\n\t\tif (nameRef.current) {\n\t\t\tnameRef.current.focus();\n\t\t}\n\t}, [t, nameRef]);\n\n\tconst onClose = useCallback(() => dispatch(popModal()), [dispatch]);\n\n\tconst onCreate = useCallback(() => {\n\t\tif (name.trim().length === 0) {\n\t\t\tdispatch(displayError(\"users.name_is_invalid\"));\n\t\t\treturn;\n\t\t}\n\t\tif (secret.trim().length === 0) {\n\t\t\tdispatch(displayError(\"users.secret_is_invalid\"));\n\t\t\treturn;\n\t\t}\n\t\tdispatch(createUser(name, secret));\n\t\tdispatch(popModal());\n\t\tUSER_COUNTER++;\n\t}, [dispatch, name, secret]);\n\n\tconst onToggle = useCallback(() => {\n\t\tdispatch(openModal({ type: \"ConnectUser\", props: null }));\n\t}, [dispatch]);\n\n\treturn (\n\t\t<FormModal\n\t\t\ttitle={t(\"users.user_creation\")}\n\t\t\tonSubmit={onCreate}\n\t\t\trenderButtons={() => (\n\t\t\t\t<>\n\t\t\t\t\t<IconButton\n\t\t\t\t\t\tdisabled={\n\t\t\t\t\t\t\tname.trim().length === 0 ||\n\t\t\t\t\t\t\tsecret.length !== SECRET_FIELD_SIZE\n\t\t\t\t\t\t}\n\t\t\t\t\t\ttitle={t(\"users.create\")}\n\t\t\t\t\t\tkind=\"primary\"\n\t\t\t\t\t\ticon=\"plus\"\n\t\t\t\t\t\ttype=\"submit\"\n\t\t\t\t\t/>\n\t\t\t\t\t<CancelButton onClick={onClose} />\n\t\t\t\t\t<IconButton\n\t\t\t\t\t\ttitle={t(\"users.connect\")}\n\t\t\t\t\t\tkind=\"default\"\n\t\t\t\t\t\ticon=\"sign-in\"\n\t\t\t\t\t\tonClick={onToggle}\n\t\t\t\t\t/>\n\t\t\t\t</>\n\t\t\t)}>\n\t\t\t<InputField\n\t\t\t\tid=\"modal-name\"\n\t\t\t\tlabel={t(\"users.name\")}\n\t\t\t\ttype=\"text\"\n\t\t\t\tplaceholder={t(\"users.name_placeholder\")}\n\t\t\t\tmaxLength={100}\n\t\t\t\tminLength={2}\n\t\t\t\trequired={true}\n\t\t\t\tvalue={name}\n\t\t\t\tref={nameRef}\n\t\t\t\tonChange={e => setName(e.target.value)}\n\t\t\t/>\n\t\t\t<SecretField\n\t\t\t\tid=\"modal-secret\"\n\t\t\t\tlabel={t(\"users.secret\")}\n\t\t\t\tplaceholder={t(\"users.secret_placeholder\")}\n\t\t\t\tvalue={secret}\n\t\t\t\tonChange={newSecret => setSecret(newSecret)}\n\t\t\t/>\n\t\t</FormModal>\n\t);\n};\n","import React, { ReactNode } from \"react\";\n//\nimport { Media } from \"../../utils/medias\";\nimport { ModalField } from \"../Modals/ModalFields\";\nimport { IconButton } from \"../Common/IconButton\";\n\n// ------------------------------------------------------------------\n\nexport const SearchResultCategory = ({\n\titems,\n\tlabel,\n\tonViewMore,\n\tcb\n}: {\n\titems: Media[];\n\tlabel: string;\n\tonViewMore: () => void;\n\tcb: (item: Media) => ReactNode;\n}) =>\n\titems.length > 0 ? (\n\t\t<>\n\t\t\t<ModalField>\n\t\t\t\t<div className=\"XXX\">\n\t\t\t\t\t<label>{label}</label>\n\t\t\t\t</div>\n\t\t\t</ModalField>\n\t\t\t{items.map(item => (\n\t\t\t\t<ModalField key={item.id}>\n\t\t\t\t\t<div className=\"SearchResultItem\">{cb(item)}</div>\n\t\t\t\t</ModalField>\n\t\t\t))}\n\t\t\t<ModalField>\n\t\t\t\t<div className=\"XXX\">\n\t\t\t\t\t<IconButton\n\t\t\t\t\t\ticon=\"ellipsis-h\"\n\t\t\t\t\t\tonClick={onViewMore}\n\t\t\t\t\t\ttitle=\"View more...\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</ModalField>\n\t\t</>\n\t) : null;\n","import React, { useRef, useState, useEffect, useCallback } from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { useTranslation } from \"react-i18next\";\n//\nimport { FormModal } from \"../Modals/FormModal\";\nimport { IconButton } from \"../Common/IconButton\";\nimport { CancelButton } from \"../Common/CancelButton\";\nimport { DEFAULT_API } from \"../../utils/deezer\";\nimport { search } from \"../../utils/providers\";\nimport { Media } from \"./Medias\";\nimport {\n\tMEDIA_TYPE_DEFINITIONS,\n\tMediaType,\n\tProviderType,\n\tSearchResults\n} from \"../../utils/medias\";\nimport { SearchResultCategory } from \"./SearchResultCategory\";\nimport { Dispatch } from \"../../actions\";\nimport { popModal } from \"../../actions/modals\";\nimport { previewMedia } from \"../../actions/medias\";\nimport { isRoomLocked } from \"../../selectors/room\";\nimport { RootState } from \"../../reducers\";\nimport { ModalField } from \"../Modals/ModalFields\";\nimport { PREVIEW_PLAYER } from \"../../utils/player\";\nimport { appendToQueue } from \"../../actions/queue\";\nimport \"./SearchModal.scss\";\n\n// ------------------------------------------------------------------\n\nconst SEARCH_RESULTS_COUNT = 5;\nconst VIEW_MORE_RESULTS_COUNT = 50;\n\n// ------------------------------------------------------------------\n\nexport const SearchModal = () => {\n\tconst dispatch = useDispatch<Dispatch>();\n\tconst { t } = useTranslation();\n\tconst queryRef = useRef<HTMLInputElement>(null);\n\tconst locked = useSelector<RootState, boolean>(isRoomLocked);\n\tconst [playingMediaId, setPlayingMediaId] = useState(\"\");\n\tconst [playingMediaProvider, setPlayingMediaProvider] = useState<\n\t\tProviderType\n\t>(\"deezer\");\n\tconst [playingMediaType, setPlayingMediaType] = useState<MediaType>(\n\t\t\"track\"\n\t);\n\tconst [query, setQuery] = useState(\"\");\n\tconst [results, setResults] = useState<SearchResults>({\n\t\t// keys are ProviderType\n\t\tdeezer: {\n\t\t\t// keys are MediaType\n\t\t\talbum: [],\n\t\t\tplaylist: [],\n\t\t\ttrack: []\n\t\t}\n\t});\n\n\tconst onClose = useCallback(() => dispatch(popModal()), [dispatch]);\n\n\tconst onSearch = useCallback(async () => {\n\t\tif (query.trim().length > 0) {\n\t\t\tsetResults(\n\t\t\t\tawait search(query, {\n\t\t\t\t\tlimit: SEARCH_RESULTS_COUNT\n\t\t\t\t})\n\t\t\t);\n\t\t}\n\t}, [query]);\n\n\tconst onSelect = useCallback(\n\t\t(provider: ProviderType, type: MediaType, id: string) =>\n\t\t\tdispatch(appendToQueue([{ provider, type, id }])),\n\t\t[dispatch]\n\t);\n\n\tconst onStartPreview = useCallback(\n\t\t(provider: ProviderType, type: MediaType, id: string) => {\n\t\t\tdispatch(previewMedia({ provider, type, id }));\n\t\t\tsetPlayingMediaId(id);\n\t\t\tsetPlayingMediaProvider(provider);\n\t\t\tsetPlayingMediaType(type);\n\t\t},\n\t\t[dispatch]\n\t);\n\n\tconst onStopPreview = useCallback(async () => {\n\t\tconsole.debug(\"Stop previewing...\");\n\t\tawait PREVIEW_PLAYER.stop();\n\t\tsetPlayingMediaId(\"\");\n\t\tsetPlayingMediaProvider(\"deezer\");\n\t\tsetPlayingMediaType(\"track\");\n\t}, []);\n\n\tconst onViewMore = useCallback(\n\t\tasync (type: MediaType) => {\n\t\t\tconst results: SearchResults = {\n\t\t\t\tdeezer: {\n\t\t\t\t\talbum: [],\n\t\t\t\t\tplaylist: [],\n\t\t\t\t\ttrack: []\n\t\t\t\t}\n\t\t\t};\n\t\t\tswitch (type) {\n\t\t\t\tcase \"album\":\n\t\t\t\t\tresults.deezer.album = await DEFAULT_API.searchAlbums(\n\t\t\t\t\t\tquery,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlimit: VIEW_MORE_RESULTS_COUNT\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"playlist\":\n\t\t\t\t\tresults.deezer.playlist = await DEFAULT_API.searchPlaylists(\n\t\t\t\t\t\tquery,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlimit: VIEW_MORE_RESULTS_COUNT\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"track\":\n\t\t\t\t\tresults.deezer.track = await DEFAULT_API.searchTracks(\n\t\t\t\t\t\tquery,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlimit: VIEW_MORE_RESULTS_COUNT\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\tsetResults(results);\n\t\t},\n\t\t[query, setResults]\n\t);\n\n\tuseEffect(() => {\n\t\tif (queryRef.current) {\n\t\t\tqueryRef.current.focus();\n\t\t}\n\t\treturn () => {\n\t\t\tconsole.debug(\"Stop previewing...\");\n\t\t\t/*await*/ PREVIEW_PLAYER.stop();\n\t\t};\n\t}, [dispatch]);\n\n\treturn (\n\t\t<FormModal\n\t\t\tclassName=\"SearchModal\"\n\t\t\ttitle={t(\"medias.medias_search\")}\n\t\t\tonSubmit={onSearch}\n\t\t\trenderButtons={() => (\n\t\t\t\t<>\n\t\t\t\t\t<IconButton\n\t\t\t\t\t\tdisabled={query.trim().length === 0}\n\t\t\t\t\t\ttitle={t(\"medias.search\")}\n\t\t\t\t\t\tkind=\"primary\"\n\t\t\t\t\t\ticon=\"search\"\n\t\t\t\t\t\ttype=\"submit\"\n\t\t\t\t\t/>\n\t\t\t\t\t<CancelButton onClick={onClose} />\n\t\t\t\t</>\n\t\t\t)}>\n\t\t\t<ModalField>\n\t\t\t\t<input\n\t\t\t\t\tid=\"modal-query\"\n\t\t\t\t\ttype=\"text\"\n\t\t\t\t\tplaceholder={t(\"medias.search_placeholder\")}\n\t\t\t\t\tmaxLength={100}\n\t\t\t\t\tminLength={2}\n\t\t\t\t\trequired={true}\n\t\t\t\t\tvalue={query}\n\t\t\t\t\tref={queryRef}\n\t\t\t\t\tonChange={e => setQuery(e.target.value)}\n\t\t\t\t/>\n\t\t\t</ModalField>\n\t\t\t{MEDIA_TYPE_DEFINITIONS.map(({ label, provider, type }) => (\n\t\t\t\t<SearchResultCategory\n\t\t\t\t\tkey={type}\n\t\t\t\t\tlabel={t(label)}\n\t\t\t\t\titems={results[provider][type]}\n\t\t\t\t\tonViewMore={() => onViewMore(type)}\n\t\t\t\t\tcb={media => (\n\t\t\t\t\t\t<Media\n\t\t\t\t\t\t\tactions={\n\t\t\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\t\t\tdisabled={locked}\n\t\t\t\t\t\t\t\t\ttitle={t(\"medias.add\")}\n\t\t\t\t\t\t\t\t\ticon=\"plus\"\n\t\t\t\t\t\t\t\t\tonClick={() =>\n\t\t\t\t\t\t\t\t\t\tonSelect(provider, type, media.id)\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tmedia={media}\n\t\t\t\t\t\t\tplayable={true}\n\t\t\t\t\t\t\tplaying={\n\t\t\t\t\t\t\t\tplayingMediaProvider === provider &&\n\t\t\t\t\t\t\t\tplayingMediaType === type &&\n\t\t\t\t\t\t\t\tplayingMediaId === media.id\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tonPlay={() =>\n\t\t\t\t\t\t\t\tonStartPreview(provider, type, media.id)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tonStop={onStopPreview}\n\t\t\t\t\t\t/>\n\t\t\t\t\t)}\n\t\t\t\t/>\n\t\t\t))}\n\t\t</FormModal>\n\t);\n};\n","import React, { useState, useRef, useEffect, useCallback } from \"react\";\nimport { useDispatch } from \"react-redux\";\nimport { useTranslation } from \"react-i18next\";\n//\nimport { FormModal } from \"../Modals/FormModal\";\nimport { IconButton } from \"../Common/IconButton\";\nimport { CancelButton } from \"../Common/CancelButton\";\nimport { InputField } from \"../Modals/ModalFields\";\nimport { Dispatch } from \"../../actions\";\nimport { popModal } from \"../../actions/modals\";\nimport { displayError } from \"../../actions/messages\";\nimport { enterRoom } from \"../../actions/room\";\n\n// ------------------------------------------------------------------\n\nexport const JoinRoomModal = () => {\n\tconst dispatch = useDispatch<Dispatch>();\n\tconst [id, setId] = useState(\"\");\n\tconst idRef = useRef<HTMLInputElement>(null);\n\tconst { t } = useTranslation();\n\n\tuseEffect(() => {\n\t\tif (idRef.current) {\n\t\t\tidRef.current.focus();\n\t\t}\n\t}, [idRef]);\n\n\tconst onClose = useCallback(() => dispatch(popModal()), [dispatch]);\n\n\tconst onJoin = useCallback(() => {\n\t\tif (id.trim().length === 0) {\n\t\t\tdispatch(displayError(\"rooms.id_is_invalid\"));\n\t\t\treturn;\n\t\t}\n\t\tdispatch(enterRoom(id, \"\"));\n\t\tdispatch(popModal());\n\t}, [dispatch, id]);\n\n\treturn (\n\t\t<FormModal\n\t\t\ttitle={t(\"rooms.room_join\")}\n\t\t\tonSubmit={onJoin}\n\t\t\trenderButtons={() => (\n\t\t\t\t<>\n\t\t\t\t\t<IconButton\n\t\t\t\t\t\tdisabled={id.trim().length === 0 || id.length !== 36}\n\t\t\t\t\t\ttitle={t(\"rooms.join\")}\n\t\t\t\t\t\tkind=\"primary\"\n\t\t\t\t\t\ticon=\"plus\"\n\t\t\t\t\t\ttype=\"submit\"\n\t\t\t\t\t/>\n\t\t\t\t\t<CancelButton onClick={onClose} />\n\t\t\t\t</>\n\t\t\t)}>\n\t\t\t<InputField\n\t\t\t\tid=\"modal-id\"\n\t\t\t\tlabel={t(\"rooms.id\")}\n\t\t\t\ttype=\"text\"\n\t\t\t\tplaceholder={t(\"rooms.id_placeholder\")}\n\t\t\t\tmaxLength={36}\n\t\t\t\tminLength={36}\n\t\t\t\trequired={true}\n\t\t\t\tvalue={id}\n\t\t\t\tref={idRef}\n\t\t\t\tonChange={e => setId(e.target.value)}\n\t\t\t/>\n\t\t</FormModal>\n\t);\n};\n","import React, { useRef, useState, useEffect, useCallback } from \"react\";\nimport { useDispatch } from \"react-redux\";\nimport { useTranslation } from \"react-i18next\";\n//\nimport { FormModal } from \"../Modals/FormModal\";\nimport { IconButton } from \"../Common/IconButton\";\nimport { CancelButton } from \"../Common/CancelButton\";\nimport { Dispatch } from \"../../actions\";\nimport { popModal } from \"../../actions/modals\";\nimport { unlockRoom } from \"../../actions/room\";\nimport { SECRET_FIELD_SIZE, InputField } from \"../Modals/ModalFields\";\n\n// ------------------------------------------------------------------\n\nexport const UnlockRoomModal = () => {\n\tconst dispatch = useDispatch<Dispatch>();\n\tconst [secret, setSecret] = useState(\"\");\n\tconst secretRef = useRef<HTMLInputElement>(null);\n\tconst { t } = useTranslation();\n\n\tuseEffect(() => {\n\t\tif (secretRef.current) {\n\t\t\tsecretRef.current.focus();\n\t\t}\n\t}, [secretRef]);\n\n\tconst onClose = useCallback(() => dispatch(popModal()), [dispatch]);\n\n\tconst onUnlock = useCallback(() => {\n\t\tdispatch(unlockRoom(secret));\n\t\tdispatch(popModal());\n\t}, [dispatch, secret]);\n\n\treturn (\n\t\t<FormModal\n\t\t\ttitle={t(\"rooms.room_unlocking\")}\n\t\t\tonSubmit={onUnlock}\n\t\t\trenderButtons={() => (\n\t\t\t\t<>\n\t\t\t\t\t<IconButton\n\t\t\t\t\t\tdisabled={secret.length !== SECRET_FIELD_SIZE}\n\t\t\t\t\t\ttitle={t(\"rooms.unlock\")}\n\t\t\t\t\t\tkind=\"primary\"\n\t\t\t\t\t\ticon=\"unlock\"\n\t\t\t\t\t\ttype=\"submit\"\n\t\t\t\t\t/>\n\t\t\t\t\t<CancelButton onClick={onClose} />\n\t\t\t\t</>\n\t\t\t)}>\n\t\t\t<InputField\n\t\t\t\tid=\"modal-secret\"\n\t\t\t\tlabel={t(\"rooms.key\")}\n\t\t\t\ttype=\"password\"\n\t\t\t\tautoComplete=\"password\"\n\t\t\t\tplaceholder={t(\"rooms.key_placeholder\")}\n\t\t\t\tmaxLength={36}\n\t\t\t\tminLength={36}\n\t\t\t\trequired={true}\n\t\t\t\tvalue={secret}\n\t\t\t\tref={secretRef}\n\t\t\t\tonChange={e => setSecret(e.target.value)}\n\t\t\t/>\n\t\t</FormModal>\n\t);\n};\n","import React, { MouseEvent, useState, useEffect, useCallback } from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { CSSTransition } from \"react-transition-group\";\n//\nimport { Dispatch } from \"../../actions\";\nimport { RootState } from \"../../reducers\";\nimport { ModalPrereq, popModal } from \"../../actions/modals\";\nimport { ConfirmModal } from \"./ConfirmModal\";\nimport { ConnectUserModal } from \"../Users/ConnectUserModal\";\nimport { CreateRoomModal } from \"../Room/CreateRoomModal\";\nimport { CreateUserModal } from \"..//Users/CreateUserModal\";\nimport { SearchModal } from \"..//Room/SearchModal\";\nimport { JoinRoomModal } from \"../Room/JoinRoomModal\";\nimport { UnlockRoomModal } from \"../Room/UnlockRoomModal\";\nimport \"./index.scss\";\n\n// ------------------------------------------------------------------\n\nconst TRANSITION_TIMEOUT = 300;\n\n// ------------------------------------------------------------------\n\nexport const getModal = (prereq?: ModalPrereq) => {\n\tif (prereq) {\n\t\tswitch (prereq.type) {\n\t\t\tcase \"Confirm\":\n\t\t\t\treturn <ConfirmModal {...prereq.props} />;\n\t\t\tcase \"ConnectUser\":\n\t\t\t\treturn <ConnectUserModal />;\n\t\t\tcase \"CreateRoom\":\n\t\t\t\treturn <CreateRoomModal />;\n\t\t\tcase \"CreateUser\":\n\t\t\t\treturn <CreateUserModal />;\n\t\t\tcase \"JoinRoom\":\n\t\t\t\treturn <JoinRoomModal />;\n\t\t\tcase \"Search\":\n\t\t\t\treturn <SearchModal />;\n\t\t\tcase \"UnlockRoom\":\n\t\t\t\treturn <UnlockRoomModal />;\n\t\t}\n\t}\n\treturn null;\n};\n\n// ------------------------------------------------------------------\n\nexport const Modals = () => {\n\tconst dispatch = useDispatch<Dispatch>();\n\tconst prereq = useSelector<RootState, ModalPrereq | undefined>(state =>\n\t\tstate.modals.stack.length > 0\n\t\t\t? state.modals.stack[state.modals.stack.length - 1]\n\t\t\t: void 0\n\t);\n\n\tconst [currPrereq, setCurrPrereq] = useState<ModalPrereq | undefined>(\n\t\tvoid 0\n\t);\n\tconst [prevPrereq, setPrevPrereq] = useState<ModalPrereq | undefined>(\n\t\tvoid 0\n\t);\n\n\tconst onPopModal = useCallback(() => dispatch(popModal()), [dispatch]);\n\n\tuseEffect(() => {\n\t\tconst keyDown = (e: KeyboardEvent) => {\n\t\t\tif (e.keyCode === 27) {\n\t\t\t\tonPopModal();\n\t\t\t}\n\t\t};\n\n\t\tdocument.addEventListener(\"keydown\", keyDown);\n\n\t\treturn () => {\n\t\t\tdocument.removeEventListener(\"keydown\", keyDown);\n\t\t};\n\t}, [onPopModal]);\n\n\tuseEffect(() => {\n\t\t// Hide current modal before showing new one (if there is a new one)\n\t\tsetCurrPrereq(void 0);\n\t\tsetPrevPrereq(prereq);\n\t}, [prereq, setCurrPrereq, setPrevPrereq]);\n\n\tuseEffect(() => {\n\t\tif (prereq) {\n\t\t\tsetTimeout(() => {\n\t\t\t\tsetCurrPrereq(prereq);\n\t\t\t}, TRANSITION_TIMEOUT);\n\t\t}\n\t}, [prereq, setCurrPrereq]);\n\n\tconst modal = getModal(currPrereq || prevPrereq);\n\treturn (\n\t\t<CSSTransition\n\t\t\tin={!!currPrereq}\n\t\t\ttimeout={TRANSITION_TIMEOUT}\n\t\t\tunmountOnExit={true}>\n\t\t\t<div\n\t\t\t\tclassName=\"ModalOverlay\"\n\t\t\t\tonClick={e => {\n\t\t\t\t\t// Clicking overlay will close current modal\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t\tonPopModal();\n\t\t\t\t}}>\n\t\t\t\t{modal && (\n\t\t\t\t\t<div\n\t\t\t\t\t\tclassName=\"ModalWrapper\"\n\t\t\t\t\t\trole=\"dialog\"\n\t\t\t\t\t\tonClick={(e: MouseEvent) => {\n\t\t\t\t\t\t\t// Clicking wrapper modal will not progagate to overlay which would close current modal\n\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t}}>\n\t\t\t\t\t\t{modal}\n\t\t\t\t\t</div>\n\t\t\t\t)}\n\t\t\t</div>\n\t\t</CSSTransition>\n\t);\n};\n","import { RootState } from \"../reducers\";\n\n// ------------------------------------------------------------------\n\nexport const selectMessages = (state: RootState) =>\n\tstate.messages.sort((m1, m2) => m1.stamp - m2.stamp);\n","import React from \"react\";\nimport { useSelector } from \"react-redux\";\nimport { useTranslation } from \"react-i18next\";\nimport classNames from \"classnames\";\nimport { TransitionGroup, CSSTransition } from \"react-transition-group\";\n//\nimport { Message } from \"../../utils/messages\";\nimport { selectMessages } from \"../../selectors/messages\";\nimport { RootState } from \"../../reducers\";\nimport \"./Messages.scss\";\n\n// ------------------------------------------------------------------\n\nexport const Messages = () => {\n\tconst { t } = useTranslation();\n\tconst messages = useSelector<RootState, Message[]>(selectMessages);\n\treturn (\n\t\t<div className=\"Messages\">\n\t\t\t<TransitionGroup>\n\t\t\t\t{messages.map(message => (\n\t\t\t\t\t<CSSTransition\n\t\t\t\t\t\tkey={message.id}\n\t\t\t\t\t\tclassNames=\"Message\"\n\t\t\t\t\t\ttimeout={{ enter: 200, exit: 200 }}>\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclassName={classNames(\n\t\t\t\t\t\t\t\t\"Message\",\n\t\t\t\t\t\t\t\t\"Message-\" + message.type\n\t\t\t\t\t\t\t)}>\n\t\t\t\t\t\t\t{t(message.text)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</CSSTransition>\n\t\t\t\t))}\n\t\t\t</TransitionGroup>\n\t\t</div>\n\t);\n};\n","import React, { useEffect } from \"react\";\nimport { useDispatch } from \"react-redux\";\nimport { Redirect, Route, Switch } from \"react-router-dom\";\n//\nimport { Room } from \"./Room\";\nimport { Splash } from \"./Splash\";\nimport { Modals } from \"../components/Modals\";\nimport { Messages } from \"../components/App/Messages\";\nimport { reconnectUser } from \"../actions/user\";\nimport { Dispatch } from \"../actions\";\nimport \"./App.scss\";\n\n// ------------------------------------------------------------------\n\nexport const App = () => {\n\tconst dispatch = useDispatch<Dispatch>();\n\n\tuseEffect(() => {\n\t\tdispatch(reconnectUser());\n\t}, [dispatch]);\n\n\treturn (\n\t\t<div className=\"App\">\n\t\t\t<Modals />\n\t\t\t<Switch>\n\t\t\t\t<Route exact={true} path=\"/room/:room_id\" component={Room} />\n\t\t\t\t<Route exact={true} path=\"/\" component={Splash} />\n\t\t\t\t<Redirect to=\"/\" />\n\t\t\t</Switch>\n\t\t\t<Messages />\n\t\t</div>\n\t);\n};\n","export default {\n\tsplash: {\n\t\tCGU: \"CGU\",\n\t\tpowered_with: \"Powered with\",\n\t\tdescription:\n\t\t\t\"Party is an experimentation to synchronize music listening with your online friends.\"\n\t},\n\tusers: {\n\t\terrors: {\n\t\t\tinvalid: \"User is invalid\"\n\t\t},\n\t\tuser: \"User\",\n\t\tconfirm_disconnect: \"Are you sure you want to disconnect?\",\n\t\tconnect: \"Connect\",\n\t\tconnection: \"Connection\",\n\t\tcreate: \"Create a user\",\n\t\tdisconnect: \"Disconnect\",\n\t\tid: \"User ID\",\n\t\tid_is_invalid: \"ID is invalid\",\n\t\tid_placeholder: \"User ID...\",\n\t\tname_is_invalid: \"Name is invalid\",\n\t\tname_placeholder: \"User Name...\",\n\t\tname: \"User Name\",\n\t\tsecret_is_invalid: \"Secret is invalid\",\n\t\tsecret_placeholder: \"User Secret...\",\n\t\tsecret: \"User Secret\",\n\t\tuser_creation: \"User Registration\"\n\t},\n\trooms: {\n\t\terrors: {\n\t\t\tinvalid: \"Room is invalid\",\n\t\t\tlocked: \"Room is locked\"\n\t\t},\n\t\tclear: \"Clear all tracks\",\n\t\tconfirm_clear: \"Are you sure you want to remove all tracks?\",\n\t\tconfirm_exit: \"Are you sure you want to leave the room?\",\n\t\tconfirm_lock: \"Are you sure you want to lock the room?\",\n\t\tcopy_link: \"Copy Room Link to Clipboard\",\n\t\tcreate: \"Create a room\",\n\t\tempty: \"It's empty here, you should add some tracks...\",\n\t\tempty_for_now: \"It's empty here, the owner has to fill it..\",\n\t\texit: \"Exit Room\",\n\t\tid: \"Room ID\",\n\t\tid_placeholder: \"Room ID...\",\n\t\tkey_placeholder: \"Room Key...\",\n\t\tkey: \"Room Key\",\n\t\tjoin: \"Join a Room\",\n\t\tlink_copied_to_clipboard: \"Room link has been copied to clipboard\",\n\t\tloading: \"Loading...\",\n\t\tlocked: \"Locked (click to unlock)\",\n\t\tname_is_invalid: \"Name is invalid\",\n\t\tname_placeholder: \"Room Name...\",\n\t\tname: \"Room Name\",\n\t\troom_creation: \"Room Creation\",\n\t\troom_join: \"Room Access\",\n\t\troom_unlocking: \"Room Unlocking\",\n\t\troom: \"Room\",\n\t\tsecret_is_invalid: \"Secret is invalid\",\n\t\tunlock: \"Unlock\",\n\t\tunlocked: \"Unlocked (click to lock)\",\n\t\ttrack_count: \"{{count}} track\",\n\t\ttrack_count_plural: \"{{count}} tracks\"\n\t},\n\tmedias: {\n\t\tby: \"by {{artist}}\",\n\t\tadd: \"Add\",\n\t\tremove: \"Remove\",\n\t\tsearch: \"Search Media\",\n\t\tsearch_placeholder: \"Search...\",\n\t\tmedias_search: \"Media Search\",\n\t\talbums: \"Albums\",\n\t\tplaylists: \"Playlists\",\n\t\ttracks: \"Tracks\"\n\t},\n\tplayer: {\n\t\terrors: {\n\t\t\tcannot_decode_audio_data: \"Audio buffer cannot be decoded\",\n\t\t\tcannot_load_audio_buffer: \"Audio buffer loading failed\"\n\t\t},\n\t\tbackward: \"Backward\",\n\t\tforward: \"Forward\",\n\t\tplay: \"Play\",\n\t\tplaying: \"Playing\",\n\t\tstop: \"Stop\"\n\t},\n\tcancel: \"Cancel\",\n\tcopy_to_clipboard: \"Copy to Clipboard\",\n\tsecret_copied_to_clipboard: \"Secret has been copied to clipboard\"\n};\n","export default {\n\tsplash: {\n\t\tCGU: \"CGU\",\n\t\tpowered_with: \"boosté avec\",\n\t\tdescription:\n\t\t\t\"Party est une expérimentation d'écoute synchronisée de musiques avec vos amis en ligne.\"\n\t},\n\tusers: {\n\t\terrors: {\n\t\t\tinvalid: \"L'utilisateur est invalide\"\n\t\t},\n\t\tuser: \"Utilisateur\",\n\t\tconfirm_disconnect: \"Êtes-vous sûr(e) de vouloir vous déconnecter ?\",\n\t\tconnect: \"Se connecter\",\n\t\tconnection: \"Connexion\",\n\t\tcreate: \"Créer un utilisateur\",\n\t\tdisconnect: \"Se déconnecter\",\n\t\tid: \"Identifiant\",\n\t\tid_is_invalid: \"L'identifiant est invalide\",\n\t\tid_placeholder: \"Identifiant...\",\n\t\tname_is_invalid: \"Le nom est invalide\",\n\t\tname_placeholder: \"Nom...\",\n\t\tname: \"Nom\",\n\t\tsecret_is_invalid: \"Le secret est invalide\",\n\t\tsecret_placeholder: \"Secret...\",\n\t\tsecret: \"Secret\",\n\t\tuser_creation: \"Création d'un utilisateur\"\n\t},\n\trooms: {\n\t\terrors: {\n\t\t\tinvalid: \"La salle est invalide\",\n\t\t\tlocked: \"La salle est verrouillée\"\n\t\t},\n\t\tclear: \"Supprimer toutes les pistes\",\n\t\tconfirm_clear:\n\t\t\t\"Êtes-vous sûr(e) de vouloir supprimer toutes les pistes ?\",\n\t\tconfirm_exit: \"Êtes-vous sûr(e) de vouloir quitter la salle ?\",\n\t\tconfirm_lock: \"Êtes-vous sûr(e) de vouloir verrouiller la salle ?\",\n\t\tcopy_link: \"Copier le lien de la salle dans le presse-papier\",\n\t\tcreate: \"Créer une salle\",\n\t\tempty: \"Cette salle est vide, vous devriez ajouter quelques pistes...\",\n\t\tempty_for_now: \"Cette salle est pour le moment vide...\",\n\t\texit: \"Quitter la salle\",\n\t\tid: \"Identifiant\",\n\t\tid_placeholder: \"Identifiant...\",\n\t\tkey_placeholder: \"Clef...\",\n\t\tkey: \"Clef\",\n\t\tjoin: \"Rejoindre une salle\",\n\t\tloading: \"Chargement...\",\n\t\tlink_copied_to_clipboard:\n\t\t\t\"Le lien de la salle a été copié dans le presse-papier\",\n\t\tlocked: \"Verrouillée (cliquer pour déverrouiller)\",\n\t\tname_is_invalid: \"Le nom est invalide\",\n\t\tname_placeholder: \"Nom...\",\n\t\tname: \"Nom\",\n\t\troom: \"Salle\",\n\t\troom_creation: \"Création d'une salle\",\n\t\troom_join: \"Rejoindre une salle\",\n\t\troom_unlocking: \"Déverrouillage de la salle\",\n\t\tsecret_is_invalid: \"Le secret is invalide\",\n\t\tunlock: \"Déverrouiller\",\n\t\tunlocked: \"Déverrouillée (cliquer pour verrouiller)\",\n\t\ttrack_count: \"{{count}} piste\",\n\t\ttrack_count_plural: \"{{count}} pistes\"\n\t},\n\tmedias: {\n\t\tby: \"par {{artist}}\",\n\t\tadd: \"Ajouter\",\n\t\tremove: \"Supprimer\",\n\t\tsearch: \"Chercher des médias\",\n\t\tsearch_placeholder: \"Recherche...\",\n\t\tmedias_search: \"Recherche de médias\",\n\t\talbums: \"Albums\",\n\t\tplaylists: \"Playlists\",\n\t\ttracks: \"Pistes\"\n\t},\n\tplayer: {\n\t\terrors: {\n\t\t\tcannot_decode_audio_data: \"Le buffer audio ne peut pas être décodé\",\n\t\t\tcannot_load_audio_buffer: \"Le buffer audio ne peut pas être chargé\"\n\t\t},\n\t\tbackward: \"Piste précédente\",\n\t\tforward: \"Piste suivante\",\n\t\tplay: \"Lire\",\n\t\tplaying: \"En cours de lecture\",\n\t\tstop: \"Arrêter\"\n\t},\n\tcancel: \"Annuler\",\n\tcopy_to_clipboard: \"Copier dans le presse-papier\",\n\tsecret_copied_to_clipboard: \"Le secret a été copié dans le presse-papier\"\n};\n","import i18next from \"i18next\";\nimport { initReactI18next } from \"react-i18next\";\n//\nimport en from \"../locales/en\";\nimport fr from \"../locales/fr\";\n\n// --------------------------------------------------------------\n\nexport const changeLanguage = (language: string) =>\n\ti18next.changeLanguage(language);\n\n// --------------------------------------------------------------\n\nexport const initLocales = async (): Promise<void> =>\n\tnew Promise((resolve, reject) => {\n\t\tconsole.debug(\"Initializing language...\", {\n\t\t\tcurrent: navigator.language || (navigator as any).userLanguage\n\t\t});\n\t\ti18next.use(initReactI18next).init(\n\t\t\t{\n\t\t\t\tfallbackLng: \"en\",\n\t\t\t\tlng: navigator.language || (navigator as any).userLanguage,\n\t\t\t\tresources: {\n\t\t\t\t\ten: { translation: en },\n\t\t\t\t\t\"en-US\": { translation: en },\n\t\t\t\t\tfr: { translation: fr },\n\t\t\t\t\t\"fr-FR\": { translation: fr }\n\t\t\t\t},\n\t\t\t\tinterpolation: {\n\t\t\t\t\tescapeValue: false, // react is already safe from xss\n\t\t\t\t\tformat: (value, format, lng) => {\n\t\t\t\t\t\t// if (format === \"uppercase\") return value.toUpperCase();\n\t\t\t\t\t\t// if (value instanceof Date) return moment(value).format(format);\n\t\t\t\t\t\treturn value;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\terror => {\n\t\t\t\tif (error) reject(error);\n\t\t\t\tresolve();\n\t\t\t}\n\t\t);\n\t});\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n\twindow.location.hostname === \"localhost\" ||\n\t\t// [::1] is the IPv6 localhost address.\n\t\twindow.location.hostname === \"[::1]\" ||\n\t\t// 127.0.0.0/8 are considered localhost for IPv4.\n\t\twindow.location.hostname.match(\n\t\t\t/^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n\t\t)\n);\n\nexport function register(config?: RegistrationOptions) {\n\tif (process.env.NODE_ENV === \"production\" && \"serviceWorker\" in navigator) {\n\t\tconsole.log(\"PWA register 1\", process.env.PUBLIC_URL);\n\t\t// The URL constructor is available in all browsers that support SW.\n\t\tconst publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n\t\tif (publicUrl.origin !== window.location.origin) {\n\t\t\tconsole.log(\"PWA register 2\");\n\t\t\t// Our service worker won't work if PUBLIC_URL is on a different origin\n\t\t\t// from what our page is served on. This might happen if a CDN is used to\n\t\t\t// serve assets; see https://github.com/facebook/create-react-app/issues/2374\n\t\t\treturn;\n\t\t}\n\n\t\twindow.addEventListener(\"load\", () => {\n\t\t\tconst swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\t\t\tconsole.log(\"PWA register 3\");\n\t\t\tif (isLocalhost) {\n\t\t\t\tconsole.log(\"PWA register 4\");\n\t\t\t\t// This is running on localhost. Let's check if a service worker still exists or not.\n\t\t\t\tcheckValidServiceWorker(swUrl, config);\n\n\t\t\t\t// Add some additional logging to localhost, pointing developers to the\n\t\t\t\t// service worker/PWA documentation.\n\t\t\t\tnavigator.serviceWorker.ready.then(() => {\n\t\t\t\t\tconsole.log(\n\t\t\t\t\t\t\"This web app is being served cache-first by a service \" +\n\t\t\t\t\t\t\t\"worker. To learn more, visit https://bit.ly/CRA-PWA\"\n\t\t\t\t\t);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tconsole.log(\"PWA register 5\");\n\t\t\t\t// Is not localhost. Just register service worker\n\t\t\t\tregisterValidSW(swUrl, config);\n\t\t\t}\n\t\t});\n\t}\n}\n\nfunction registerValidSW(swUrl: string, config?: RegistrationOptions) {\n\tconsole.log(\"PWA registerValidSW 1\");\n\tnavigator.serviceWorker\n\t\t.register(swUrl)\n\t\t.then(registration => {\n\t\t\tconsole.log(\"PWA registerValidSW 2\");\n\t\t\tregistration.onupdatefound = () => {\n\t\t\t\tconsole.log(\"PWA registerValidSW 3\");\n\t\t\t\tconst installingWorker = registration.installing;\n\t\t\t\tif (installingWorker == null) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tconsole.log(\"PWA registerValidSW 4\");\n\t\t\t\tinstallingWorker.onstatechange = () => {\n\t\t\t\t\tconsole.log(\n\t\t\t\t\t\t\"PWA registerValidSW 5\",\n\t\t\t\t\t\tinstallingWorker.state\n\t\t\t\t\t);\n\t\t\t\t\tif (installingWorker.state === \"installed\") {\n\t\t\t\t\t\tif (navigator.serviceWorker.controller) {\n\t\t\t\t\t\t\tconsole.log(\"PWA registerValidSW 6\");\n\t\t\t\t\t\t\t// At this point, the updated precached content has been fetched,\n\t\t\t\t\t\t\t// but the previous service worker will still serve the older\n\t\t\t\t\t\t\t// content until all client tabs are closed.\n\t\t\t\t\t\t\tconsole.log(\n\t\t\t\t\t\t\t\t\"New content is available and will be used when all \" +\n\t\t\t\t\t\t\t\t\t\"tabs for this page are closed. See https://bit.ly/CRA-PWA.\"\n\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\t// Execute callback\n\t\t\t\t\t\t\tif (config && (config as any).onUpdate) {\n\t\t\t\t\t\t\t\t(config as any).onUpdate(registration);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconsole.log(\"PWA registerValidSW 7\");\n\t\t\t\t\t\t\t// At this point, everything has been precached.\n\t\t\t\t\t\t\t// It's the perfect time to display a\n\t\t\t\t\t\t\t// \"Content is cached for offline use.\" message.\n\t\t\t\t\t\t\tconsole.log(\"Content is cached for offline use.\");\n\n\t\t\t\t\t\t\t// Execute callback\n\t\t\t\t\t\t\tif (config && (config as any).onSuccess) {\n\t\t\t\t\t\t\t\t(config as any).onSuccess(registration);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t};\n\t\t})\n\t\t.catch(error => {\n\t\t\tconsole.error(\"Error during service worker registration:\", error);\n\t\t});\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: RegistrationOptions) {\n\tconsole.log(\"PWA checkValidServiceWorker 1\");\n\t// Check if the service worker can be found. If it can't reload the page.\n\tfetch(swUrl, {\n\t\theaders: { \"Service-Worker\": \"script\" }\n\t})\n\t\t.then(response => {\n\t\t\t// Ensure service worker exists, and that we really are getting a JS file.\n\t\t\tconst contentType = response.headers.get(\"content-type\");\n\t\t\tconsole.log(\n\t\t\t\t\"PWA checkValidServiceWorker 2\",\n\t\t\t\tcontentType,\n\t\t\t\tresponse.status\n\t\t\t);\n\t\t\tif (\n\t\t\t\tresponse.status === 404 ||\n\t\t\t\t(contentType != null &&\n\t\t\t\t\tcontentType.indexOf(\"javascript\") === -1)\n\t\t\t) {\n\t\t\t\t// No service worker found. Probably a different app. Reload the page.\n\t\t\t\tnavigator.serviceWorker.ready.then(registration => {\n\t\t\t\t\tregistration.unregister().then(() => {\n\t\t\t\t\t\twindow.location.reload();\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\t// Service worker found. Proceed as normal.\n\t\t\t\tregisterValidSW(swUrl, config);\n\t\t\t}\n\t\t})\n\t\t.catch(() => {\n\t\t\tconsole.log(\n\t\t\t\t\"No internet connection found. App is running in offline mode.\"\n\t\t\t);\n\t\t});\n}\n\nexport function unregister() {\n\tif (\"serviceWorker\" in navigator) {\n\t\tnavigator.serviceWorker.ready\n\t\t\t.then(registration => {\n\t\t\t\tregistration.unregister();\n\t\t\t})\n\t\t\t.catch(error => {\n\t\t\t\tconsole.error(error.message);\n\t\t\t});\n\t}\n}\n","import * as React from \"react\";\nimport * as ReactDOM from \"react-dom\";\nimport { Provider } from \"react-redux\";\nimport { Route, HashRouter } from \"react-router-dom\";\nimport { composeWithDevTools } from \"redux-devtools-extension\";\nimport { applyMiddleware, createStore, compose } from \"redux\";\nimport thunk from \"redux-thunk\";\n//\nimport { rootReducer } from \"./reducers\";\nimport { App } from \"./pages/App\";\nimport { QUEUE_PLAYER } from \"./utils/player\";\nimport { initLocales } from \"./utils/i18n\";\nimport { register as registerServiceWorker } from \"./serviceWorker\";\nimport \"./index.scss\";\n\n// ------------------------------------------------------------------\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nregisterServiceWorker();\n\n// ------------------------------------------------------------------\n\nconst init = async () => {\n\tconst composeEnhancers =\n\t\tprocess.env.NODE_ENV === \"development\"\n\t\t\t? composeWithDevTools({})\n\t\t\t: compose;\n\n\tinitLocales();\n\n\tconst store = createStore(\n\t\trootReducer,\n\t\tcomposeEnhancers(\n\t\t\tapplyMiddleware(\n\t\t\t\tthunk.withExtraArgument({\n\t\t\t\t\tplayer: QUEUE_PLAYER\n\t\t\t\t})\n\t\t\t)\n\t\t)\n\t);\n\n\t// const dispatch: Dispatch = store.dispatch.bind(store);\n\n\treturn store;\n};\n\n// ------------------------------------------------------------------\n\ninit().then(store => {\n\tReactDOM.render(\n\t\t<Provider store={store}>\n\t\t\t<HashRouter>\n\t\t\t\t<Route path=\"/\" component={App} />\n\t\t\t</HashRouter>\n\t\t</Provider>,\n\t\tdocument.getElementById(\"root\")\n\t);\n});\n"],"sourceRoot":""}