{"version":3,"sources":["components/Common/Icon.tsx","components/Common/IconButton.tsx","utils/clipboard.ts","selectors/room.ts","actions/index.ts","reducers/messages.ts","actions/messages.ts","actions/modals.ts","selectors/medias.ts","components/Room/Head.tsx","components/Common/LoadingIcon.tsx","components/Room/Cover.tsx","components/Room/Medias.tsx","components/Room/QueueItem.tsx","config/firebase.ts","utils/firebase.ts","utils/medias.ts","utils/messages.ts","utils/images.ts","utils/colorpicker.ts","utils/index.ts","utils/jsonp.ts","utils/providers/deezer.ts","utils/providers/index.ts","reducers/medias.ts","reducers/room.ts","utils/audio.ts","utils/player.ts","actions/medias.ts","utils/history.ts","actions/room.ts","actions/player.ts","utils/rooms.ts","actions/queue.ts","reducers/modals.ts","components/Room/Queue.tsx","components/Room/Progress.tsx","components/Room/Controls.tsx","utils/games/seabattle.ts","components/SeaBattle/FleetControls.tsx","components/SeaBattle/Assets.tsx","components/SeaBattle/Weapons.tsx","components/SeaBattle/Hits.tsx","components/SeaBattle/Boats.tsx","components/SeaBattle/Fleet.tsx","components/SeaBattle/BattleAssets.tsx","utils/svg.ts","components/SeaBattle/Map.tsx","reducers/games/seabattle.ts","actions/games/seabattle.ts","components/SeaBattle/WeaponsControls.tsx","pages/games/SeaBattle.tsx","utils/keyboards.ts","pages/Room.tsx","utils/users.ts","reducers/user.ts","actions/user.ts","pages/Splash.tsx","components/Modals/Modal.tsx","components/Modals/FormModal.tsx","components/Common/CancelButton.tsx","components/Modals/ConfirmModal.tsx","components/Modals/ModalFields.tsx","components/Users/ConnectUserModal.tsx","components/Room/CreateRoomModal.tsx","components/Users/CreateUserModal.tsx","components/Room/SearchResultCategory.tsx","components/Room/SearchModal.tsx","components/Room/JoinRoomModal.tsx","components/Room/UnlockRoomModal.tsx","components/Modals/index.tsx","selectors/messages.ts","components/Common/Messages.tsx","pages/App.tsx","locales/en.ts","locales/fr.ts","utils/i18n.ts","serviceWorker.ts","reducers/games/index.ts","reducers/index.ts","utils/redux.ts","index.tsx"],"names":["Icon","React","memo","className","color","icon","size","title","classNames","name","style","IconButton","disabled","displayTitle","kind","onClick","type","aria-label","clickable","copyToClipboard","value","a","Promise","resolve","elem","document","createElement","setAttribute","position","left","body","appendChild","selection","getSelection","selected","rangeCount","getRangeAt","select","execCommand","removeAllRanges","addRange","removeChild","selectRoom","state","room","info","isRoomLoaded","isRoomLocked","access","secret","isRoomPlaying","playing","createAction","payload","removeMessage","id","INITIAL_STATE","MESSAGE_ID_GENERATOR","displayMessage","autoclear","duration","extra","text","weight","dispatch","stamp","Date","getTime","setTimeout","displayError","displaySuccess","confirmModal","question","onConfirmed","onCanceled","window","confirm","selectTracks","res","medias","tracks","track","provider","push","selectTracksCount","length","Head","useDispatch","t","useTranslation","history","useHistory","useSelector","mediasCount","tracksCount","onCopy","useCallback","location","href","split","onExit","count","LoadingIcon","Cover","playable","image","onPlay","onStop","backgroundImage","renderMediaInToaster","media","Media","actions","picture_small","link","target","rel","artist","user","preview","album","QueueItem","locked","onRemove","config","appIDs","process","APPS","DEFAULT_APP_ID","createOrGetApp","appId","console","debug","databaseURL","app","firebase","database","members","ref","rooms","users","FirebaseRoom","_room","child","_info","_members","_secret","isLocked","setSecret","newSecret","oldSecret","wait","reject","once","snapshot","newValues","val","Error","subscribe","cb","on","subscribeMembers","cbAdded","cbRemoved","unsubscribe","off","unsubscribeMembers","update","playmode","queue","queue_position","set","timestamp","ServerValue","TIMESTAMP","FirebaseUser","_user","_membership","_values","online","room_id","status","installDisconnect","onDisconnect","cancel","enter","remove","exit","MEDIA_TYPE_DEFINITIONS","label","findMediaInDict","findMedia","dist","list","find","item","findMediaInList","findPreview","oldMedias","newMedias","extractTracks","accesses","contextId","contextType","container","findContextFromTrackIndex","trackIndex","allMedias","index","mediaIndex","mediaFirstTrackIndex","mediaSize","i","extractErrorMessage","err","response","data","message","getImageMainColor","url","jimp","resize","getPixelColor","pixel","r","g","b","CACHE","DEFAULT_COLOR","bg","fg","pickColor","error","sleep","delay","WWW_BASE","ConvertAlbum","toString","picture_big","cover_big","cover_small","filter","readable","map","ConvertTrack","ConvertPlaylist","playlist","DEFAULT_API","_call","path","qs","jsonp","asyncJsonp","_search","query","options","encodeURIComponent","limit","_load","ids","delayedIds","failedIds","loadedMedias","all","code","_loadWithRetry","first","remainingIds","searchAlbums","trim","searchPlaylists","public","searchTracks","loadAlbums","albums","loadPlaylists","playlists","creator","loadTracks","DeezerApiImpl","loadMedias","deezer","flatten","other","loadNewMedias","newAccesses","self","findIndex","newMediasAndTracks","searchMedias","results","setMedias","fetching","setRoom","values","AUDIO_BUFFER_CACHES","AUDIO_CONTEXT","getContext","AudioContext","webkitAudioContext","getCurrentTime","currentTime","decodeAudioData","encodedBuffer","loadAudioBuffer","req","XMLHttpRequest","open","responseType","addEventListener","send","getOrLoadAudioBuffer","buffer","splice","fixAudioContext","removeEventListener","context","createBuffer","source","createBufferSource","connect","destination","start","generateRandomPosition","Math","floor","random","PlayerImpl","_analyserNode","_gainNode","_node","_duration","_sourceNode","_startTime","_trackId","_trackPosition","getOrCreateNode","createGain","gain","createAnalyser","fftSize","play","trackPosition","trackId","trackUrl","offset","stop","loop","loopStart","loopEnd","onended","playbackRate","getPlayingTrackID","getPlayingTrackPercent","getPlayingTrackPosition","isPlaying","QUEUE_PLAYER","PREVIEW_PLAYER","displayMediaInfo","previewMedia","getState","createHashHistory","DEFAULT_QUEUE_INFO_BY_TYPE","dj","seabattle","0","1","2","3","createRoom","v4","enterRoom","exitRoom","newRoom","_watchRoom","_unwatchPlayer","_unwatchRoom","lockRoom","unlockRoom","ROOM_WATCHER","player","newInfo","Object","entries","sort","media1","media2","Number","PLAYER_TIMER","_watchPlayer","_computeNextPosition","nextIndex","playingTrackID","playingTrackIndex","_scheduleTimer","clearTimeout","ms","nextTrackIndex","nextAccess","nextTrack","startPlayer","stopPlayer","RoomTypes","createQueueMerging","accesses1","accesses2","forEach","createQueueRemoving","copy","clearQueue","appendToQueue","removeFromQueue","removedTrackIndex","removedMediaFirstTrackIndex","removedMediaIndex","removedTrackCount","keys","setQueuePosition","newTrackIndex","oldTrackIndex","moveBackward","moveForward","openModal","prereq","popModal","initialState","stack","Queue","loaded","playingIndex","onSearch","props","QueueList","EmptyQueueList","key","Progress","useState","setValue","useEffect","timer","setInterval","clearInterval","max","Controls","onClear","onLock","onUnlock","onMoveBackward","onMoveForward","BoatsOffsetMappings","boat1","x","y","boat2","boat3","HitsOffsetMappings","hitted1","hitted2","missed1","missed2","WeaponsOffsetMappings","bullet1","bullet2","bullet3","mine","SeabattleBoatOrientationMappings","N","E","S","W","SeabattleBoatRotationMappings","SeabattleBoatRotationTransformationMappings","SeabattleBoatTranslationMappings","SeaBattleBoatLengthMappings","SeaBattleMovementIconMappings","forward","backward","checkPositionInGrid","grid","checkPositionInZone","movementIsPossible","fleet","movingBoatIndex","newPosition","newDirection","movingBoat","boat","checkZone","Array","fill","_","boatIndex","boatCount","direction","checkCollisions","FleetControls","onRotateLeft","onRotateRight","Asset","rotate","visibility","stopPropagation","e","Cell","asset","Weapon","Weapons","weapons","weapon","Hit","Hits","hits","hit","Boat","Fleet","hideActiveFleet","selectedBoat","setSelectedBoat","BattleAssets","cx","cy","d","transform","width","height","patternUnits","getSVGPosition","svg","pt","createSVGPoint","tx","matrixTransform","getScreenCTM","inverse","ty","Map","useRef","selectedPosition","setSelectedPosition","selectedVisibility","setSelectedVisibility","selectionPosition","setSelectionPosition","selectionVisibility","setSelectionVisibility","current","onLeave","onOver","viewBox","clientX","clientY","onMouseLeave","onMouseMove","setBoatPosition","playerId","players","player1","player2","moveBoat","movement","games","oldDirection","oldPosition","WeaponControls","selectionPos","SeaBattle","selectedBoat1","setSelectedBoat1","selectedBoat2","setSelectedBoat2","queueReady","selectedBoats","setSelectedBoats","rotateLeft","rotateRight","onKeyDown","repeat","keyCode","preventDefault","selectedBoatIndex","move","Room","search","useLocation","useParams","parse","substr","backgroundColor","loadUserAccess","s","localStorage","getItem","JSON","atob","setUser","createUser","connectUser","FIREBASE_CB","disconnectUser","newUser","reconnectUser","Splash","loggedIn","onCreateRoom","onConnectUser","to","Modal","children","renderFoot","onSubmit","has_prev_modal","modals","onClose","onPop","event","hidden","FormModal","renderButtons","CancelButton","ConfirmModal","onCancel","ModalField","InputField","forwardRef","htmlFor","SecretField","onChange","placeholder","onCopyToClipboard","display","flexDirection","justifyContent","flexGrow","marginRight","autoComplete","maxLength","minLength","required","SelectField","localeCompare","option","ConnectUserModal","setId","idRef","focus","onConnect","onCreate","ROOM_COUNTER","CreateRoomModal","setName","setType","nameRef","onJoin","USER_COUNTER","CreateUserModal","onToggle","SearchResultCategory","items","onViewMore","SearchModal","queryRef","playingMediaId","setPlayingMediaId","playingMediaProvider","setPlayingMediaProvider","playingMediaType","setPlayingMediaType","setQuery","setResults","onSelect","onStartPreview","onStopPreview","JoinRoomModal","UnlockRoomModal","secretRef","Modals","currPrereq","setCurrPrereq","prevPrereq","setPrevPrereq","onPopModal","keyDown","modal","getModal","in","timeout","unmountOnExit","role","selectMessages","messages","m1","m2","Messages","App","exact","component","audio","errors","cannot_decode_audio_data","cannot_load_audio_buffer","splash","CGU","powered_with","description","invalid","confirm_disconnect","connection","create","disconnect","id_is_invalid","id_placeholder","name_is_invalid","name_placeholder","secret_is_invalid","secret_placeholder","user_creation","movement_is_not_possible","types","blind","clear","confirm_clear","confirm_exit","confirm_lock","copy_link","empty","empty_for_now","key_placeholder","type_placeholder","join","link_copied_to_clipboard","loading","room_creation","room_join","room_unlocking","unlock","unlocked","media_count","media_count_plural","track_count","track_count_plural","by","add","search_placeholder","medias_search","copy_to_clipboard","secret_copied_to_clipboard","initLocales","navigator","language","userLanguage","i18next","use","initReactI18next","init","fallbackLng","lng","resources","en","translation","fr","interpolation","escapeValue","format","isLocalhost","Boolean","hostname","match","registerValidSW","swUrl","serviceWorker","register","then","registration","onupdatefound","installingWorker","installing","onstatechange","controller","onUpdate","onSuccess","catch","gamesReducer","combineReducers","action","oldPlayer","newPlayer","rootReducer","pop","setItem","btoa","stringify","saveUserAccess","removeItem","initStore","composeEnhancers","compose","store","createStore","applyMiddleware","thunk","withExtraArgument","bind","URL","origin","fetch","headers","contentType","get","indexOf","ready","unregister","reload","checkValidServiceWorker","registerServiceWorker","ReactDOM","getElementById"],"mappings":"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","file":"static/js/main.f5bd3b95.chunk.js","sourcesContent":["import React from \"react\";\nimport FontAwesome from \"react-fontawesome\";\nimport classNames from \"classnames\";\n//\nimport \"./Icon.scss\";\n\n// ------------------------------------------------------------------\n\nexport const Icon = React.memo(\n\t({\n\t\tclassName,\n\t\tcolor,\n\t\ticon,\n\t\tsize = \"M\",\n\t\ttitle\n\t}: {\n\t\tclassName?: string;\n\t\tcolor?: string;\n\t\ticon: string;\n\t\tsize?: \"S\" | \"M\" | \"L\";\n\t\ttitle?: string;\n\t}) => (\n\t\t<FontAwesome\n\t\t\tclassName={classNames(\"Icon\", className, size)}\n\t\t\tname={icon}\n\t\t\tstyle={{ color }}\n\t\t\ttitle={title}\n\t\t/>\n\t)\n);\n","import React from \"react\";\nimport classNames from \"classnames\";\n//\nimport { Icon } from \"./Icon\";\nimport \"./IconButton.scss\";\n\n// ------------------------------------------------------------------\n\ntype ButtonType = \"button\" | \"submit\";\n\nexport const IconButton = React.memo(\n\t({\n\t\tclassName,\n\t\tcolor,\n\t\tdisabled = false,\n\t\tdisplayTitle = false,\n\t\ticon,\n\t\tkind = \"default\",\n\t\tonClick,\n\t\tsize,\n\t\ttitle,\n\t\ttype = \"button\"\n\t}: {\n\t\tclassName?: string;\n\t\tcolor?: string;\n\t\tdisabled?: boolean;\n\t\tdisplayTitle?: boolean;\n\t\ticon: string;\n\t\tkind?: \"default\" | \"primary\" | \"danger\" | \"special\";\n\t\tonClick?: () => void;\n\t\tsize?: \"S\" | \"M\" | \"L\";\n\t\ttitle: string;\n\t\ttype?: ButtonType;\n\t}) => (\n\t\t<button\n\t\t\ttype={type}\n\t\t\taria-label={title}\n\t\t\tclassName={classNames(\"IconButton\", className, kind, {\n\t\t\t\tclickable: !disabled && (!!onClick || type === \"submit\")\n\t\t\t})}\n\t\t\tonClick={disabled ? void 0 : onClick}\n\t\t\ttitle={title}>\n\t\t\t<Icon color={color} icon={icon} size={size} />\n\t\t\t{displayTitle && (\n\t\t\t\t<div className={classNames(\"IconButtonTitle\", size)}>\n\t\t\t\t\t{title}\n\t\t\t\t</div>\n\t\t\t)}\n\t\t</button>\n\t)\n);\n","// https://hackernoon.com/copying-text-to-clipboard-with-javascript-df4d4988697f\nexport const copyToClipboard = async (value: string): Promise<void> =>\n\tawait new Promise(resolve => {\n\t\tconst elem = document.createElement(\"textarea\");\n\t\telem.value = value;\n\t\telem.setAttribute(\"readonly\", \"\");\n\t\telem.style.position = \"absolute\";\n\t\telem.style.left = \"-9999px\";\n\n\t\tdocument.body.appendChild(elem);\n\t\tconst selection = document.getSelection();\n\t\tif (selection !== null) {\n\t\t\tconst selected =\n\t\t\t\tselection.rangeCount > 0 ? selection.getRangeAt(0) : false;\n\t\t\telem.select();\n\t\t\tdocument.execCommand(\"copy\");\n\t\t\tif (selected !== false) {\n\t\t\t\tselection.removeAllRanges();\n\t\t\t\tselection.addRange(selected);\n\t\t\t}\n\t\t}\n\t\tdocument.body.removeChild(elem);\n\t\tresolve();\n\t});\n","import { RootState } from \"../reducers\";\n\nexport const selectRoom = (state: RootState) => state.room.info;\n\nexport const isRoomLoaded = (state: RootState) => !!state.room.room;\n\nexport const isRoomLocked = (state: RootState) => !state.room.access.secret;\n\nexport const isRoomPlaying = (state: RootState) =>\n\tnull !== state.room.info && state.room.info.playing;\n","import { AnyAction } from \"redux\";\nimport { ThunkAction, ThunkDispatch } from \"redux-thunk\";\n//\nimport { Player } from \"../utils/player\";\nimport { RootState } from \"../reducers\";\n\n// ------------------------------------------------------------------\n\nexport type Action<T extends string> = {\n\ttype: T;\n};\n\nexport type ActionWithPayload<T extends string, P> = {\n\ttype: T;\n\tpayload: P;\n};\n\nexport type Extended = {\n\tplayer: Player;\n};\n\nexport type Dispatch = ThunkDispatch<RootState, Extended, AnyAction>;\n\nexport type AsyncAction = ThunkAction<void, RootState, Extended, AnyAction>;\n\nexport function createAction<T extends string>(type: T): Action<T>;\n\nexport function createAction<T extends string, P>(\n\ttype: T,\n\tpayload: P\n): ActionWithPayload<T, P>;\n\nexport function createAction<T extends string, P>(type: T, payload?: P) {\n\treturn payload === void 0 ? { type } : { type, payload };\n}\n","import { Reducer } from \"redux\";\nimport { Message } from \"../utils/messages\";\nimport { createAction } from \"../actions\";\n\n// ------------------------------------------------------------------\n\ntype MessagesAction =\n\t| ReturnType<typeof addMessage>\n\t| ReturnType<typeof clearMessages>\n\t| ReturnType<typeof removeMessage>;\n\nexport const addMessage = (message: Message) =>\n\tcreateAction(\"message/ADD\", message);\nexport const removeMessage = (id: number) => createAction(\"message/REMOVE\", id);\nexport const clearMessages = () => createAction(\"message/RESET\");\n\n// ------------------------------------------------------------------\n\nexport type State = Message[];\n\nexport const INITIAL_STATE: State = [];\n\n// ------------------------------------------------------------------\n\nexport const messagesReducer: Reducer<State, MessagesAction> = (\n\tstate = INITIAL_STATE,\n\taction\n): State => {\n\tswitch (action.type) {\n\t\tcase \"message/ADD\":\n\t\t\treturn [action.payload, ...state];\n\t\tcase \"message/REMOVE\":\n\t\t\treturn state.filter(other => other.id !== action.payload);\n\t\tcase \"message/RESET\":\n\t\t\treturn INITIAL_STATE;\n\t\tdefault:\n\t\t\treturn state;\n\t}\n};\n","import { AsyncAction } from \".\";\nimport { MessageType } from \"../utils/messages\";\nimport { addMessage, removeMessage } from \"../reducers/messages\";\n\n// ------------------------------------------------------------------\n\nlet MESSAGE_ID_GENERATOR: number = 0;\n\ntype MessageCreationData = {\n\tautoclear?: boolean;\n\tduration?: number;\n\textra?: () => React.ReactNode;\n\ttext?: string;\n\tweight?: number;\n};\n\nexport const displayMessage = (\n\ttype: MessageType,\n\t{\n\t\tautoclear = true,\n\t\tduration = 3000,\n\t\textra,\n\t\ttext,\n\t\tweight = 0\n\t}: MessageCreationData\n): AsyncAction => (dispatch): any => {\n\tconst id = MESSAGE_ID_GENERATOR++;\n\tdispatch(\n\t\taddMessage({\n\t\t\textra,\n\t\t\tid,\n\t\t\tstamp: new Date().getTime(),\n\t\t\ttext,\n\t\t\ttype,\n\t\t\tweight\n\t\t})\n\t);\n\tif (autoclear) {\n\t\tsetTimeout(() => dispatch(removeMessage(id)), duration);\n\t}\n};\n\n// ------------------------------------------------------------------\n\nexport const displayError = (text: string) => displayMessage(\"error\", { text });\n\nexport const displayInfo = (text: string) => displayMessage(\"info\", { text });\n\nexport const displaySuccess = (text: string) =>\n\tdisplayMessage(\"success\", { text });\n","import { AsyncAction } from \".\";\n\n// ------------------------------------------------------------------\n\nexport const confirmModal = (\n\tquestion: string,\n\tonConfirmed: () => void,\n\tonCanceled?: () => void\n): AsyncAction => async () => {\n\t// TODO: open custom ConfirmModal instead of system popup\n\tif (window.confirm(question)) {\n\t\tonConfirmed();\n\t\treturn;\n\t}\n\tif (onCanceled) {\n\t\tonCanceled();\n\t}\n};\n","import { RootState } from \"../reducers\";\nimport { Track } from \"../utils/medias\";\n\n// ------------------------------------------------------------------\n\nexport const selectTracks = (state: RootState): Array<Track | null> => {\n\tconst res: Array<Track | null> = [];\n\tconst {\n\t\tmedias: { medias },\n\t\troom: { tracks }\n\t} = state;\n\tfor (const access of tracks) {\n\t\tconst track = medias[access.provider][access.type][access.id];\n\t\tif (!!track) {\n\t\t\tres.push(track);\n\t\t} else {\n\t\t\tres.push(null); // Stiil loading or cannot be loaded or to reload later because of rate limit\n\t\t}\n\t}\n\treturn res;\n};\n\nexport const selectTracksCount = (state: RootState) => state.room.tracks.length;\n","import React, { useCallback } from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { useTranslation } from \"react-i18next\";\nimport { useHistory } from \"react-router-dom\";\n//\nimport { IconButton } from \"../Common/IconButton\";\nimport { copyToClipboard } from \"../../utils/clipboard\";\nimport { Dispatch } from \"../../actions\";\nimport { RootState } from \"../../reducers\";\nimport { selectRoom } from \"../../selectors/room\";\nimport { displaySuccess } from \"../../actions/messages\";\nimport { confirmModal } from \"../../actions/modals\";\nimport { RoomInfo } from \"../../utils/rooms\";\nimport { selectTracksCount } from \"../../selectors/medias\";\nimport \"./Head.scss\";\n\n// ------------------------------------------------------------------\n\nexport const Head = () => {\n\tconst dispatch = useDispatch<Dispatch>();\n\tconst { t } = useTranslation();\n\tconst history = useHistory();\n\tconst room = useSelector<RootState, RoomInfo | null>(selectRoom);\n\tconst mediasCount = useSelector<RootState, number>(\n\t\tstate => state.room.medias.length\n\t);\n\tconst tracksCount = useSelector<RootState, number>(selectTracksCount);\n\n\tconst onCopy = useCallback(async () => {\n\t\tawait copyToClipboard(document.location.href.split(\"?\")[0]);\n\t\tdispatch(displaySuccess(\"rooms.link_copied_to_clipboard\"));\n\t}, [dispatch]);\n\n\tconst onExit = useCallback(() => {\n\t\tdispatch(\n\t\t\tconfirmModal(t(\"rooms.confirm_exit\"), () => {\n\t\t\t\thistory.push(\"/\");\n\t\t\t})\n\t\t);\n\t}, [t, dispatch, history]);\n\n\treturn (\n\t\t<div className=\"Head\">\n\t\t\t<div className=\"HeadInner\">\n\t\t\t\t<div className=\"RoomLink\">\n\t\t\t\t\t<IconButton\n\t\t\t\t\t\ticon=\"link\"\n\t\t\t\t\t\tonClick={onCopy}\n\t\t\t\t\t\tsize=\"M\"\n\t\t\t\t\t\ttitle={t(\"rooms.copy_link\")}\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div className=\"RoomMeta\">\n\t\t\t\t\t{room ? (\n\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclassName=\"RoomName\"\n\t\t\t\t\t\t\t\ttitle={`${t(\"rooms.media_count\", {\n\t\t\t\t\t\t\t\t\tcount: mediasCount\n\t\t\t\t\t\t\t\t})} / ${t(\"rooms.track_count\", {\n\t\t\t\t\t\t\t\t\tcount: tracksCount\n\t\t\t\t\t\t\t\t})}`}>\n\t\t\t\t\t\t\t\t{room.name}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</>\n\t\t\t\t\t) : null}\n\t\t\t\t</div>\n\t\t\t\t<div className=\"RoomExit\">\n\t\t\t\t\t<IconButton\n\t\t\t\t\t\tonClick={onExit}\n\t\t\t\t\t\ticon=\"sign-out\"\n\t\t\t\t\t\tsize=\"M\"\n\t\t\t\t\t\ttitle={t(\"rooms.exit\")}\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t);\n};\n","import React from \"react\";\nimport { Icon } from \"./Icon\";\n\n// ------------------------------------------------------------------\n\nexport const LoadingIcon = React.memo(\n\t({ size }: { size?: \"S\" | \"M\" | \"L\" }) => (\n\t\t<Icon\n\t\t\tclassName=\"rotating\"\n\t\t\ticon=\"circle-o-notch\"\n\t\t\tsize={size}\n\t\t\ttitle=\"Loading\"\n\t\t/>\n\t)\n);\n","import React from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport classNames from \"classnames\";\n//\nimport { Icon } from \"../Common/Icon\";\nimport \"./Cover.scss\";\n\n// ------------------------------------------------------------------\n\nexport const Cover = React.memo(\n\t({\n\t\tplayable,\n\t\tplaying,\n\t\timage,\n\t\tonPlay,\n\t\tonStop\n\t}: {\n\t\timage: string;\n\t\tonPlay?: () => void;\n\t\tonStop?: () => void;\n\t\tplayable: boolean;\n\t\tplaying: boolean;\n\t}) => {\n\t\tconst { t } = useTranslation();\n\t\tif (playable) {\n\t\t\treturn (\n\t\t\t\t<div\n\t\t\t\t\tclassName={classNames(\"Cover\", { playable, playing })}\n\t\t\t\t\tstyle={image ? { backgroundImage: `url('${image}')` } : {}}\n\t\t\t\t\tonClick={!playing ? onPlay : onStop}>\n\t\t\t\t\t{!playing ? (\n\t\t\t\t\t\t<Icon icon=\"play\" size=\"S\" title={t(\"player.play\")} />\n\t\t\t\t\t) : (\n\t\t\t\t\t\t<Icon icon=\"pause\" size=\"S\" title={t(\"player.stop\")} />\n\t\t\t\t\t)}\n\t\t\t\t</div>\n\t\t\t);\n\t\t} else {\n\t\t\treturn (\n\t\t\t\t<div\n\t\t\t\t\tclassName={classNames(\"Cover\", { playing })}\n\t\t\t\t\tstyle={image ? { backgroundImage: `url('${image}')` } : {}}>\n\t\t\t\t\t{playing ? (\n\t\t\t\t\t\t<Icon\n\t\t\t\t\t\t\ticon=\"music\"\n\t\t\t\t\t\t\tsize=\"S\"\n\t\t\t\t\t\t\ttitle={t(\"player.playing\")}\n\t\t\t\t\t\t/>\n\t\t\t\t\t) : null}\n\t\t\t\t</div>\n\t\t\t);\n\t\t}\n\t}\n);\n","import React, { ReactNode } from \"react\";\nimport { useTranslation } from \"react-i18next\";\n//\nimport { Cover } from \"./Cover\";\nimport { LoadingIcon } from \"../Common/LoadingIcon\";\nimport { Media as MediaData } from \"../../utils/medias\";\nimport \"./Medias.scss\";\n\n// ------------------------------------------------------------------\n\nexport const renderMediaInToaster = (media: MediaData): React.ReactNode => {\n\treturn <Media media={media} playable={false} playing={true} />;\n};\n\n// ------------------------------------------------------------------\n\nexport const Media = React.memo(\n\t({\n\t\tactions,\n\t\tmedia,\n\t\tplayable,\n\t\tplaying,\n\t\tonPlay,\n\t\tonStop\n\t}: {\n\t\tactions?: ReactNode;\n\t\tmedia: MediaData | null;\n\t\tplayable: boolean;\n\t\tplaying: boolean;\n\t\tonPlay?: () => void;\n\t\tonStop?: () => void;\n\t}) => {\n\t\tconst { t } = useTranslation();\n\t\tif (!media) {\n\t\t\treturn (\n\t\t\t\t<div className=\"Media\">\n\t\t\t\t\t<Cover\n\t\t\t\t\t\tplayable={playable}\n\t\t\t\t\t\tplaying={playing}\n\t\t\t\t\t\timage={\"\"}\n\t\t\t\t\t\tonPlay={onPlay}\n\t\t\t\t\t\tonStop={onStop}\n\t\t\t\t\t/>\n\t\t\t\t\t<div className=\"Metas\">\n\t\t\t\t\t\t<LoadingIcon size=\"M\" />\n\t\t\t\t\t</div>\n\t\t\t\t\t{actions ? <div className=\"Actions\">{actions}</div> : null}\n\t\t\t\t</div>\n\t\t\t);\n\t\t}\n\t\tif (media.type === \"album\") {\n\t\t\treturn (\n\t\t\t\t<div className=\"Media Album\">\n\t\t\t\t\t<Cover\n\t\t\t\t\t\tplayable={playable}\n\t\t\t\t\t\tplaying={playing}\n\t\t\t\t\t\timage={media.picture_small}\n\t\t\t\t\t\tonPlay={onPlay}\n\t\t\t\t\t\tonStop={onStop}\n\t\t\t\t\t/>\n\t\t\t\t\t<div className=\"Metas\">\n\t\t\t\t\t\t<div className=\"Meta AlbumTitle\">\n\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\thref={media.link}\n\t\t\t\t\t\t\t\ttarget=\"_blank\"\n\t\t\t\t\t\t\t\trel=\"noopener noreferrer\">\n\t\t\t\t\t\t\t\t{media.title}\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className=\"Meta AlbumArtist\">\n\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\thref={media.artist.link}\n\t\t\t\t\t\t\t\ttarget=\"_blank\"\n\t\t\t\t\t\t\t\trel=\"noopener noreferrer\">\n\t\t\t\t\t\t\t\t{t(\"medias.by\", { artist: media.artist.name })}\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t{actions ? <div className=\"Actions\">{actions}</div> : null}\n\t\t\t\t</div>\n\t\t\t);\n\t\t}\n\t\tif (media.type === \"playlist\") {\n\t\t\treturn (\n\t\t\t\t<div className=\"Media Playlist\">\n\t\t\t\t\t<Cover\n\t\t\t\t\t\tplayable={playable}\n\t\t\t\t\t\tplaying={playing}\n\t\t\t\t\t\timage={media.picture_small}\n\t\t\t\t\t\tonPlay={onPlay}\n\t\t\t\t\t\tonStop={onStop}\n\t\t\t\t\t/>\n\t\t\t\t\t<div className=\"Metas\">\n\t\t\t\t\t\t<div className=\"Meta PlaylistTitle\">\n\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\thref={media.link}\n\t\t\t\t\t\t\t\ttarget=\"_blank\"\n\t\t\t\t\t\t\t\trel=\"noopener noreferrer\">\n\t\t\t\t\t\t\t\t{media.title}\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className=\"Meta PlaylistCreator\">\n\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\thref={media.user.link}\n\t\t\t\t\t\t\t\ttarget=\"_blank\"\n\t\t\t\t\t\t\t\trel=\"noopener noreferrer\">\n\t\t\t\t\t\t\t\t{t(\"medias.by\", { artist: media.user.name })}\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t{actions ? <div className=\"Actions\">{actions}</div> : null}\n\t\t\t\t</div>\n\t\t\t);\n\t\t}\n\t\tif (media.type === \"track\") {\n\t\t\treturn (\n\t\t\t\t<div className=\"Media Track\">\n\t\t\t\t\t<Cover\n\t\t\t\t\t\tplayable={playable && !!media.preview}\n\t\t\t\t\t\tplaying={playing}\n\t\t\t\t\t\timage={media.album.picture_small}\n\t\t\t\t\t\tonPlay={onPlay}\n\t\t\t\t\t\tonStop={onStop}\n\t\t\t\t\t/>\n\t\t\t\t\t<div className=\"Metas\">\n\t\t\t\t\t\t<div className=\"Meta TrackTitle\">\n\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\thref={media.link}\n\t\t\t\t\t\t\t\ttarget=\"_blank\"\n\t\t\t\t\t\t\t\trel=\"noopener noreferrer\">\n\t\t\t\t\t\t\t\t{media.title}\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className=\"Meta TrackArtist\">\n\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\thref={media.artist.link}\n\t\t\t\t\t\t\t\ttarget=\"_blank\"\n\t\t\t\t\t\t\t\trel=\"noopener noreferrer\">\n\t\t\t\t\t\t\t\t{t(\"medias.by\", { artist: media.artist.name })}\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t{actions ? <div className=\"Actions\">{actions}</div> : null}\n\t\t\t\t</div>\n\t\t\t);\n\t\t}\n\t\treturn null;\n\t}\n);\n","import React from \"react\";\nimport { useTranslation } from \"react-i18next\";\n//\nimport { Media } from \"./Medias\";\nimport { IconButton } from \"../Common/IconButton\";\nimport { Track } from \"../../utils/medias\";\n\n// ------------------------------------------------------------------\n\nexport const QueueItem = React.memo(\n\t({\n\t\tlocked,\n\t\ttrack,\n\t\tplaying,\n\t\tonPlay,\n\t\tonRemove,\n\t\tonStop\n\t}: {\n\t\tlocked: boolean;\n\t\ttrack: Track | null; // if null : stiil loading or cannot be loaded or to reload later because of rate limit\n\t\tplaying: boolean;\n\t\tonPlay: () => void;\n\t\tonRemove: () => void;\n\t\tonStop: () => void;\n\t}) => {\n\t\tconst { t } = useTranslation();\n\t\treturn (\n\t\t\t<div className=\"QueueItem\">\n\t\t\t\t<Media\n\t\t\t\t\tmedia={track}\n\t\t\t\t\tplayable={!!track && !locked}\n\t\t\t\t\tplaying={playing}\n\t\t\t\t\tonPlay={onPlay}\n\t\t\t\t\tonStop={onStop}\n\t\t\t\t\tactions={\n\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\tdisabled={locked}\n\t\t\t\t\t\t\ttitle={t(\"medias.remove\")}\n\t\t\t\t\t\t\ticon=\"trash\"\n\t\t\t\t\t\t\tonClick={onRemove}\n\t\t\t\t\t\t/>\n\t\t\t\t\t}\n\t\t\t\t/>\n\t\t\t</div>\n\t\t);\n\t}\n);\n","const config = {\n\tappIDs: (process.env.REACT_APP_DATABASE_ID || \"\").split(\"|\")\n};\n\n// console.debug('[Firebase] Config', config);\n\nexport default config;\n","import * as firebase from \"firebase/app\";\nimport \"firebase/database\";\n//\nimport firebaseConfig from \"../config/firebase\";\nimport { RoomInfo } from \"./rooms\";\nimport { UserInfo } from \"./users\";\n\n// ------------------------------------------------------------------\n\ntype FirebaseCB = (eventType: firebase.database.DataSnapshot) => void;\n\n// ------------------------------------------------------------------\n\nconst APPS: {\n\t[id: string]: {\n\t\tapp: firebase.app.App;\n\t\tdatabase: firebase.database.Database;\n\t\tmembers: firebase.database.Reference;\n\t\trooms: firebase.database.Reference;\n\t\tusers: firebase.database.Reference;\n\t};\n} = {};\n\nconst DEFAULT_APP_ID = firebaseConfig.appIDs[0];\n\nconst createOrGetApp = (appId: string = DEFAULT_APP_ID) => {\n\tlet res = APPS[appId];\n\tif (!res) {\n\t\tconsole.debug(\"[Firebase] Creating app\", { appId });\n\t\tconst databaseURL = `https://${appId}.firebaseio.com`;\n\t\tconst app = firebase.initializeApp({ databaseURL });\n\t\tconst database = firebase.database(app);\n\t\tAPPS[appId] = res = {\n\t\t\tapp,\n\t\t\tdatabase,\n\t\t\tmembers: database.ref(\"members\"),\n\t\t\trooms: database.ref(\"rooms\"),\n\t\t\tusers: database.ref(\"users\")\n\t\t};\n\t}\n\treturn res;\n};\n\n// ------------------------------------------------------------------\n\nexport const FirebaseRoom = ({\n\tid,\n\tsecret\n}: {\n\tid: string;\n\tsecret?: string;\n}) => {\n\tconst app = createOrGetApp();\n\tconst _room = app.rooms.child(id);\n\tconst _info = _room.child(\"info\");\n\tconst _members = app.members.child(id);\n\tlet _secret = secret || \"\";\n\n\tconst isLocked = () => !_secret;\n\n\tconst setSecret = (newSecret: string) => {\n\t\tconsole.debug(\"[Firebase] Setting room secret\", {\n\t\t\toldSecret: _secret,\n\t\t\tnewSecret\n\t\t});\n\t\t_secret = newSecret;\n\t};\n\n\tconst wait = async (): Promise<RoomInfo> =>\n\t\tnew Promise((resolve, reject) => {\n\t\t\tconsole.debug(\"[Firebase] Waiting room...\");\n\t\t\t_info.once(\"value\", snapshot => {\n\t\t\t\tconst newValues = snapshot.val();\n\t\t\t\tif (newValues) {\n\t\t\t\t\tresolve(newValues);\n\t\t\t\t} else {\n\t\t\t\t\treject(new Error(\"rooms.errors.invalid\"));\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\tconst subscribe = (cb: FirebaseCB) => {\n\t\tconsole.debug(\"[Firebase] Subscribing room...\");\n\t\treturn _info.on(\"value\", cb);\n\t};\n\n\tconst unsubscribe = (cb: FirebaseCB) => {\n\t\tconsole.debug(\"[Firebase] Unsubscribing room...\");\n\t\t_info.off(\"value\", cb);\n\t};\n\n\tconst subscribeMembers = (cbAdded: FirebaseCB, cbRemoved: FirebaseCB) => {\n\t\tconsole.debug(\"[Firebase] Subscribing members...\");\n\t\t_members.on(\"child_added\", cbAdded);\n\t\t_members.on(\"child_removed\", cbRemoved);\n\t};\n\n\tconst unsubscribeMembers = (cbAdded: FirebaseCB, cbRemoved: FirebaseCB) => {\n\t\tconsole.debug(\"[Firebase] Unsubscribing members...\");\n\t\t_members.off(\"child_added\", cbAdded);\n\t\t_members.off(\"child_removed\", cbRemoved);\n\t};\n\n\tconst update = async ({\n\t\textra,\n\t\tname,\n\t\tplaying,\n\t\tplaymode,\n\t\tqueue,\n\t\tqueue_position,\n\t\ttype\n\t}: Pick<\n\t\tRoomInfo,\n\t\t| \"extra\"\n\t\t| \"name\"\n\t\t| \"playing\"\n\t\t| \"playmode\"\n\t\t| \"queue\"\n\t\t| \"queue_position\"\n\t\t| \"type\"\n\t>) => {\n\t\tconsole.debug(\"[Firebase] Updating room...\", {\n\t\t\textra: !!extra,\n\t\t\tname,\n\t\t\tplaying,\n\t\t\tplaymode,\n\t\t\tqueue,\n\t\t\tqueue_position\n\t\t});\n\t\tawait _room.set({\n\t\t\tinfo: {\n\t\t\t\textra,\n\t\t\t\tname,\n\t\t\t\tplaying,\n\t\t\t\tplaymode,\n\t\t\t\tqueue,\n\t\t\t\tqueue_position,\n\t\t\t\ttimestamp: firebase.database.ServerValue.TIMESTAMP,\n\t\t\t\ttype\n\t\t\t},\n\t\t\tsecret: _secret\n\t\t});\n\t};\n\n\treturn {\n\t\tid,\n\t\tisLocked,\n\t\tsetSecret,\n\t\twait,\n\t\tsubscribe,\n\t\tsubscribeMembers,\n\t\tunsubscribe,\n\t\tunsubscribeMembers,\n\t\tupdate\n\t};\n};\n\n// ------------------------------------------------------------------\n\nexport const FirebaseUser = ({\n\tid,\n\tsecret\n}: {\n\tid: string;\n\tsecret?: string;\n}) => {\n\tconst app = createOrGetApp();\n\tconst _user = app.users.child(id);\n\tconst _info = _user.child(\"info\");\n\tlet _membership: firebase.database.Reference | null = null;\n\tlet _secret = secret || \"\";\n\tlet _values: UserInfo = {\n\t\tname: \"dummy\",\n\t\tonline: false,\n\t\troom_id: \"\",\n\t\tstatus: \"\",\n\t\ttimestamp: 0\n\t};\n\n\tconst isLocked = () => !_secret;\n\n\tconst setSecret = (newSecret: string) => {\n\t\tconsole.debug(\"[Firebase] Setting user secret...\", {\n\t\t\toldSecret: _secret,\n\t\t\tnewSecret\n\t\t});\n\t\t_secret = newSecret;\n\t};\n\n\tconst wait = async (): Promise<UserInfo> =>\n\t\tnew Promise((resolve, reject) => {\n\t\t\tconsole.debug(\"[Firebase] Waiting user...\");\n\t\t\t_info.once(\"value\", snapshot => {\n\t\t\t\tconst newValues = snapshot.val();\n\t\t\t\tif (newValues) {\n\t\t\t\t\t_values = newValues;\n\t\t\t\t\tresolve(newValues);\n\t\t\t\t} else {\n\t\t\t\t\treject(new Error(\"users.errors.invalid\"));\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\tconst subscribe = (cb: FirebaseCB) => {\n\t\tconsole.debug(\"[Firebase] Subscribing user...\");\n\t\treturn _info.on(\"value\", cb);\n\t};\n\n\tconst unsubscribe = (cb: FirebaseCB) => {\n\t\tconsole.debug(\"[Firebase] Unsubscribing user...\");\n\t\t_info.off(\"value\", cb);\n\t};\n\n\tconst update = async ({\n\t\tname,\n\t\troom_id\n\t}: Partial<Pick<UserInfo, \"name\" | \"room_id\">>) => {\n\t\tconsole.debug(\"[Firebase] Updating user...\", { name, room_id });\n\t\tif (name !== void 0) {\n\t\t\t_values.name = name;\n\t\t}\n\t\tif (room_id !== void 0) {\n\t\t\t_values.room_id = room_id;\n\t\t}\n\t\tawait _user.set({\n\t\t\tinfo: {\n\t\t\t\t..._values,\n\t\t\t\tonline: true,\n\t\t\t\tstatus: \"online\",\n\t\t\t\ttimestamp: firebase.database.ServerValue.TIMESTAMP\n\t\t\t},\n\t\t\tsecret: _secret\n\t\t});\n\t\tinstallDisconnect();\n\t};\n\n\tconst installDisconnect = () => {\n\t\tconsole.debug(\"[Firebase] Installing user disconnect...\");\n\t\t_user.onDisconnect().cancel();\n\t\t_user.onDisconnect().set({\n\t\t\tinfo: {\n\t\t\t\t..._values,\n\t\t\t\tonline: false,\n\t\t\t\troom_id: \"\",\n\t\t\t\tstatus: \"disconnected\",\n\t\t\t\ttimestamp: firebase.database.ServerValue.TIMESTAMP\n\t\t\t},\n\t\t\tsecret: _secret\n\t\t});\n\t};\n\n\tconst enter = async (room: ReturnType<typeof FirebaseRoom>) => {\n\t\tconst app = createOrGetApp();\n\t\tif (_membership) {\n\t\t\tawait _membership.remove();\n\t\t\t_membership = null;\n\t\t}\n\t\tawait update({\n\t\t\troom_id: room.id\n\t\t});\n\t\t_membership = app.members.child(room.id).child(id);\n\t\t_membership.onDisconnect().remove();\n\t\tawait _membership.set({\n\t\t\ttimestamp: firebase.database.ServerValue.TIMESTAMP\n\t\t});\n\t};\n\n\tconst exit = async () => {\n\t\tif (_membership) {\n\t\t\tawait _membership.remove();\n\t\t\t_membership = null;\n\t\t}\n\t\tawait update({\n\t\t\troom_id: \"\"\n\t\t});\n\t};\n\n\treturn {\n\t\tid,\n\t\tenter,\n\t\texit,\n\t\tisLocked,\n\t\tsetSecret,\n\t\twait,\n\t\tsubscribe,\n\t\tunsubscribe,\n\t\tupdate\n\t};\n};\n\n// ------------------------------------------------------------------\n\nexport const FirebaseParty = ({\n\tid,\n\troom\n}: {\n\tid: string;\n\troom: ReturnType<typeof FirebaseRoom>;\n}) => {\n\tconst _members: string[] = [];\n\tconst _users: { [id: string]: ReturnType<typeof FirebaseUser> } = {};\n\tlet _info: RoomInfo = {\n\t\textra: \"\",\n\t\tname: \"\",\n\t\tplaying: false,\n\t\tplaymode: \"default\",\n\t\tqueue_position: 0,\n\t\ttimestamp: 0,\n\t\ttype: \"dj\"\n\t};\n\n\tconst _onAdded = (added: firebase.database.DataSnapshot) => {\n\t\tconst userId = added.key;\n\t\tif (userId) {\n\t\t\tconst index = _members.indexOf(userId);\n\t\t\tif (index === -1) {\n\t\t\t\t_members.push(userId);\n\t\t\t\t_users[userId] = FirebaseUser({ id: userId });\n\t\t\t\t_log();\n\t\t\t}\n\t\t}\n\t};\n\n\tconst _onRemoved = (removed: firebase.database.DataSnapshot) => {\n\t\tconst userId = removed.key;\n\t\tif (userId) {\n\t\t\tconst index = _members.indexOf(userId);\n\t\t\tif (index !== -1) {\n\t\t\t\t_members.splice(index, 1);\n\t\t\t\tdelete _users[userId];\n\t\t\t\t_log();\n\t\t\t}\n\t\t}\n\t};\n\n\tconst _onRoomInfo = (snapshot: firebase.database.DataSnapshot) => {\n\t\tconst newValues = snapshot.val() as RoomInfo | null;\n\t\tif (newValues) {\n\t\t\t_info = newValues;\n\t\t\t_log();\n\t\t}\n\t};\n\n\tconst _log = () => {\n\t\tconsole.debug(\"PARTY\", {\n\t\t\t_info,\n\t\t\t_members\n\t\t});\n\t};\n\n\tconst init = () => {\n\t\troom.subscribe(_onRoomInfo);\n\t\troom.subscribeMembers(_onAdded, _onRemoved);\n\t};\n\n\tconst terminate = () => {\n\t\troom.unsubscribe(_onRoomInfo);\n\t\troom.unsubscribeMembers(_onAdded, _onRemoved);\n\t};\n\n\treturn {\n\t\tinit,\n\t\tterminate\n\t};\n};\n","export type ContainerType = \"album\" | \"playlist\";\n\nexport type MediaType = ContainerType | \"track\";\n\nexport const MediaTypes: MediaType[] = [\"album\", \"playlist\", \"track\"];\n\nexport type MediaTypeDefinition = {\n\tlabel: string;\n\tprovider: ProviderType;\n\ttype: MediaType;\n};\n\nexport type ProviderType = \"deezer\";\n\nexport const ProviderTypes: ProviderType[] = [\"deezer\"];\n\nexport type TrackType = \"track\";\n\n// ------------------------------------------------------------------\n\nexport type AlbumAccess = {\n\tid: string;\n\tprovider: ProviderType;\n\ttype: \"album\";\n};\n\nexport type PlaylistAccess = {\n\tid: string;\n\tprovider: ProviderType;\n\ttype: \"playlist\";\n};\n\nexport type TrackAccess = {\n\tid: string;\n\tprovider: ProviderType;\n\ttype: \"track\";\n};\n\nexport type ContainerAccess = AlbumAccess | PlaylistAccess;\n\nexport type MediaAccess = ContainerAccess | TrackAccess;\n\nexport type ContextualizedTrackAccess = {\n\tcontextId: string;\n\tcontextType: MediaType;\n} & TrackAccess;\n\n// ------------------------------------------------------------------\n\nexport type Album = {\n\tartist: Artist;\n\tid: string;\n\tlink: string;\n\tpicture_big: string;\n\tpicture_small: string;\n\tprovider: ProviderType;\n\ttitle: string;\n\ttracks: Track[];\n\ttype: \"album\";\n};\n\nexport type AlbumLight = {\n\tid: string;\n\tlink: string;\n\tpicture_big: string;\n\tpicture_small: string;\n\ttitle: string;\n};\n\nexport type Artist = {\n\tid: string;\n\tlink: string;\n\tname: string;\n\tpicture_big: string;\n\tpicture_small: string;\n};\n\nexport type Playlist = {\n\tid: string;\n\tlink: string;\n\tpicture_big: string;\n\tpicture_small: string;\n\tprovider: ProviderType;\n\ttitle: string;\n\ttracks: Track[];\n\ttype: \"playlist\";\n\tuser: {\n\t\tid: string;\n\t\tlink: string;\n\t\tname: string;\n\t};\n};\n\nexport type Track = {\n\talbum: AlbumLight;\n\tartist: Artist;\n\tduration: number;\n\tid: string;\n\tlink: string;\n\tpreview: string;\n\tprovider: ProviderType;\n\ttitle: string;\n\ttype: \"track\";\n};\n\nexport type Container = Album | Playlist;\n\nexport type Media = Container | Track;\n\nexport type StructuredMedias = {\n\t// keys are ProvideType\n\tdeezer: {\n\t\t// keys are MediaType\n\t\talbum: { [id: string]: Album };\n\t\tplaylist: { [id: string]: Playlist };\n\t\ttrack: { [id: string]: Track };\n\t};\n};\n\n// ------------------------------------------------------------------\n\nexport const MEDIA_TYPE_DEFINITIONS: MediaTypeDefinition[] = [\n\t{\n\t\tlabel: \"medias.albums\",\n\t\tprovider: \"deezer\",\n\t\ttype: \"album\"\n\t},\n\t{\n\t\tlabel: \"medias.playlists\",\n\t\tprovider: \"deezer\",\n\t\ttype: \"playlist\"\n\t},\n\t{\n\t\tlabel: \"medias.tracks\",\n\t\tprovider: \"deezer\",\n\t\ttype: \"track\"\n\t}\n];\n\n// ------------------------------------------------------------------\n\nconst findMediaInDict = (\n\taccess: MediaAccess,\n\tmedias: StructuredMedias\n): Media | undefined => medias[access.provider][access.type][access.id];\n\n// ------------------------------------------------------------------\n\nconst findMediaInList = (\n\taccess: MediaAccess,\n\tmedias: Media[]\n): Media | undefined =>\n\tmedias.find(\n\t\titem =>\n\t\t\titem.id === access.id &&\n\t\t\titem.provider === access.provider &&\n\t\t\titem.type === access.type\n\t);\n\n// ------------------------------------------------------------------\n\nexport const findMedia = (\n\taccess: MediaAccess,\n\tdist: StructuredMedias,\n\tlist: Media[]\n): Media | undefined =>\n\tfindMediaInDict(access, dist) || findMediaInList(access, list);\n\n// ------------------------------------------------------------------\n\nexport const findPreview = (\n\taccess: MediaAccess,\n\toldMedias: StructuredMedias,\n\tnewMedias: Media[]\n): Track | null => {\n\tconst media = findMedia(access, oldMedias, newMedias);\n\tif (!media) {\n\t\treturn null;\n\t}\n\tif (media.type === \"track\") {\n\t\treturn media;\n\t}\n\tif (media.tracks && media.tracks.length > 0) {\n\t\treturn media.tracks[0];\n\t}\n\treturn null;\n};\n\n// ------------------------------------------------------------------\n\nexport const extractTracks = (\n\taccesses: MediaAccess[],\n\toldMedias: StructuredMedias,\n\tnewMedias: Media[]\n): ContextualizedTrackAccess[] => {\n\tconst tracks: ContextualizedTrackAccess[] = [];\n\tfor (const access of accesses) {\n\t\tif (access.type === \"track\") {\n\t\t\ttracks.push({\n\t\t\t\tcontextId: access.id,\n\t\t\t\tcontextType: access.type,\n\t\t\t\tid: access.id,\n\t\t\t\tprovider: access.provider,\n\t\t\t\ttype: access.type\n\t\t\t});\n\t\t\tcontinue;\n\t\t}\n\n\t\tconst container = findMedia(access, oldMedias, newMedias);\n\t\tif (!container) {\n\t\t\tthrow new Error(\"Media is unknown\");\n\t\t}\n\n\t\tif (\n\t\t\tcontainer.type !== \"track\" &&\n\t\t\tcontainer.tracks &&\n\t\t\tcontainer.tracks.length > 0\n\t\t) {\n\t\t\tfor (const track of container.tracks) {\n\t\t\t\ttracks.push({\n\t\t\t\t\tcontextId: container.id,\n\t\t\t\t\tcontextType: container.type,\n\t\t\t\t\tid: track.id,\n\t\t\t\t\tprovider: track.provider,\n\t\t\t\t\ttype: track.type\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\treturn tracks;\n};\n\n// ------------------------------------------------------------------\n\nexport const findContextFromTrackIndex = (\n\tmedias: MediaAccess[],\n\ttrackIndex: number,\n\tallMedias: StructuredMedias\n): {\n\tmediaFirstTrackIndex: number;\n\tmediaIndex: number;\n\tmediaSize: number;\n} => {\n\tif (trackIndex < 0) {\n\t\tthrow new Error(\"Track index is out of range\");\n\t}\n\tlet index = 0;\n\tfor (let mediaIndex = 0; mediaIndex < medias.length; ++mediaIndex) {\n\t\tconst media = medias[mediaIndex];\n\t\tif (media.type === \"track\") {\n\t\t\tif (trackIndex === index) {\n\t\t\t\treturn {\n\t\t\t\t\tmediaFirstTrackIndex: trackIndex,\n\t\t\t\t\tmediaIndex,\n\t\t\t\t\tmediaSize: 1\n\t\t\t\t};\n\t\t\t}\n\t\t\tindex++;\n\t\t} else {\n\t\t\tconst container = findMediaInDict(media, allMedias);\n\t\t\tif (!container) {\n\t\t\t\tthrow new Error(\"Media is unknown\");\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\tcontainer.type !== \"track\" &&\n\t\t\t\tcontainer.tracks &&\n\t\t\t\tcontainer.tracks.length > 0\n\t\t\t) {\n\t\t\t\tconst mediaFirstTrackIndex = index;\n\t\t\t\tfor (let i = 0; i < container.tracks.length; ++i) {\n\t\t\t\t\tif (trackIndex === index) {\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tmediaFirstTrackIndex,\n\t\t\t\t\t\t\tmediaIndex,\n\t\t\t\t\t\t\tmediaSize: container.tracks.length\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t\tindex++;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tthrow new Error(\"Track index is out of range\");\n};\n","export type MessageType = \"error\" | \"info\" | \"success\";\n\nexport type Message = {\n\textra?: () => React.ReactNode;\n\tid: number;\n\tstamp: number;\n\ttext?: string;\n\ttype: MessageType;\n\tweight: number;\n};\n\nexport const extractErrorMessage = (err: any) =>\n\terr.response && err.response.data && err.response.data.message\n\t\t? err.response.data.message\n\t\t: err.message;\n","import * as jimp from \"jimp\";\n\n// ------------------------------------------------------------------\n\nexport const getImageMainColor = async (url: string) => {\n\tconst image = await jimp.read(url);\n\tconst pixel = await image.resize(1, 1).getPixelColor(0, 0);\n\tconst { r, g, b } = jimp.intToRGBA(pixel);\n\treturn { r, g, b };\n};\n","import { getImageMainColor } from \"./images\";\n\n// ------------------------------------------------------------------\n\nexport type Color = {\n\tr: number;\n\tg: number;\n\tb: number;\n};\n\nexport type CombinedColor = {\n\tbg: Color;\n\tfg: string;\n};\n\nconst CACHE: { [url: string]: CombinedColor } = {};\n\nconst DEFAULT_COLOR = {\n\tbg: { r: 255, g: 255, b: 255 },\n\tfg: \"dark\"\n};\n\n// ------------------------------------------------------------------\n\n// https://stackoverflow.com/questions/3942878/how-to-decide-font-color-in-white-or-black-depending-on-background-color\nexport const pickColor = async (url: string) => {\n\tlet res = DEFAULT_COLOR;\n\tif (url) {\n\t\tres = CACHE[url];\n\t\tif (!res) {\n\t\t\ttry {\n\t\t\t\tconst { r, g, b } = await getImageMainColor(url);\n\t\t\t\tCACHE[url] = res = {\n\t\t\t\t\tbg: { r, g, b },\n\t\t\t\t\tfg:\n\t\t\t\t\t\tr * 0.299 + g * 0.587 + b * 0.114 > 186\n\t\t\t\t\t\t\t? \"dark\"\n\t\t\t\t\t\t\t: \"light\"\n\t\t\t\t};\n\t\t\t} catch (err) {\n\t\t\t\tconsole.error(\"An error prevented colorpicking\", err);\n\t\t\t\tCACHE[url] = res = DEFAULT_COLOR;\n\t\t\t}\n\t\t}\n\t}\n\treturn res;\n};\n","export const sleep = (delay: number) =>\n\tnew Promise(resolve => setTimeout(resolve, delay));\n","import jsonp from \"jsonp\";\n\n// ------------------------------------------------------------------\n\nexport const asyncJsonp = (url: string, qs?: string): Promise<any> =>\n\tnew Promise((resolve, reject) => {\n\t\tjsonp(\n\t\t\tqs\n\t\t\t\t? `${url}?${qs}&output=jsonp&callback=`\n\t\t\t\t: `${url}?output=jsonp&callback=`,\n\t\t\tvoid 0,\n\t\t\t(err, data) => {\n\t\t\t\tif (err) {\n\t\t\t\t\treject(new Error(err.message));\n\t\t\t\t} else {\n\t\t\t\t\tresolve(data);\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t});\n","import { sleep } from \"../\";\nimport { Album, MediaType, Playlist, Track } from \"../medias\";\nimport { SearchOptions } from \"../providers\";\nimport { asyncJsonp } from \"../jsonp\";\n\n// ------------------------------------------------------------------\n\nconst API_BASE = \"https://api.deezer.com\";\nconst WWW_BASE = \"https://www.deezer.com\";\nconst RATE_LIMIT_DELAY = 5000; // ms\n\n// ------------------------------------------------------------------\n\nexport type DeezerApiError = {\n\tcode: number;\n\tmessage: string;\n\ttype: string;\n};\n\nexport type DeezerApiDataCollection<T> = {\n\tdata: T[];\n};\n\nexport type DeezerApiSearchResult<T> = {\n\tdata: T[];\n\ttotal: number;\n};\n\n// ------------------------------------------------------------------\n\nexport type DeezerApiAlbum = {\n\terror?: DeezerApiError;\n\tartist: DeezerApiArtist;\n\tcover_big: string;\n\tcover_small: string;\n\tid: number;\n\ttitle: string;\n\ttracks?: DeezerApiDataCollection<DeezerApiTrack>;\n};\n\nexport type DeezerApiAlbumLight = {\n\tcover_big: string;\n\tcover_small: string;\n\tid: number;\n\ttitle: string;\n};\n\nexport type DeezerApiUser = {\n\tid: number;\n\tname: string;\n};\n\nexport type DeezerApiArtist = {\n\tid: number;\n\tname: string;\n\tpicture_big: string;\n\tpicture_small: string;\n};\n\nexport type DeezerApiPlaylist = {\n\terror?: DeezerApiError;\n\tcreator?: DeezerApiUser;\n\tid: number;\n\tpicture_big: string;\n\tpicture_small: string;\n\tpublic: boolean;\n\ttitle: string;\n\ttracks?: DeezerApiDataCollection<DeezerApiTrack>;\n\tuser?: DeezerApiUser;\n};\n\nexport type DeezerApiTrack = {\n\terror?: DeezerApiError;\n\talbum: DeezerApiAlbumLight;\n\tartist: DeezerApiArtist;\n\tduration: number;\n\tid: number;\n\tpreview: string;\n\treadable: boolean;\n\ttitle: string;\n};\n\n// ------------------------------------------------------------------\n\nconst ConvertAlbum = (album: DeezerApiAlbum): Album => ({\n\tartist: {\n\t\tid: album.artist.id.toString(),\n\t\tname: album.artist.name,\n\t\tlink: `${WWW_BASE}/artist/${album.artist.id}`,\n\t\tpicture_big: album.artist.picture_big,\n\t\tpicture_small: album.artist.picture_small\n\t},\n\tid: album.id.toString(),\n\tlink: `${WWW_BASE}/album/${album.id}`,\n\tpicture_big: album.cover_big,\n\tpicture_small: album.cover_small,\n\tprovider: \"deezer\",\n\ttitle: album.title,\n\ttracks:\n\t\talbum.tracks !== void 0\n\t\t\t? album.tracks.data\n\t\t\t\t\t.filter(track => track.readable && track.preview)\n\t\t\t\t\t.map(track => ConvertTrack(track, album))\n\t\t\t: [],\n\ttype: \"album\"\n});\n\nconst ConvertPlaylist = (\n\tplaylist: DeezerApiPlaylist,\n\tuser: DeezerApiUser\n): Playlist => ({\n\tid: playlist.id.toString(),\n\tlink: `${WWW_BASE}/playlist/${playlist.id}`,\n\tpicture_big: playlist.picture_big,\n\tpicture_small: playlist.picture_small,\n\tprovider: \"deezer\",\n\ttitle: playlist.title,\n\ttracks:\n\t\tplaylist.tracks !== void 0\n\t\t\t? playlist.tracks.data\n\t\t\t\t\t.filter(track => track.readable && track.preview)\n\t\t\t\t\t.map(track => ConvertTrack(track, track.album))\n\t\t\t: [],\n\ttype: \"playlist\",\n\tuser: {\n\t\tid: user.id.toString(),\n\t\tlink: `${WWW_BASE}/profile/${user.id}`,\n\t\tname: user.name\n\t}\n});\n\nconst ConvertTrack = (\n\ttrack: DeezerApiTrack,\n\talbum: DeezerApiAlbumLight\n): Track => ({\n\talbum: {\n\t\tid: album.id.toString(),\n\t\tlink: `${WWW_BASE}/album/${album.id}`,\n\t\ttitle: album.title,\n\t\tpicture_big: album.cover_big,\n\t\tpicture_small: album.cover_small\n\t},\n\tartist: {\n\t\tid: track.artist.id.toString(),\n\t\tname: track.artist.name,\n\t\tlink: `${WWW_BASE}/artist/${track.artist.id}`,\n\t\tpicture_big: track.artist.picture_big,\n\t\tpicture_small: track.artist.picture_small\n\t},\n\tduration: track.duration,\n\tid: track.id.toString(),\n\tlink: `${WWW_BASE}/track/${track.id}`,\n\tpreview: track.preview,\n\tprovider: \"deezer\",\n\ttitle: track.title,\n\ttype: \"track\"\n});\n\n// ------------------------------------------------------------------\n\nexport type DeezerApi = {\n\tsearchAlbums: (query: string, options?: SearchOptions) => Promise<Album[]>;\n\n\tsearchPlaylists: (\n\t\tquery: string,\n\t\toptions?: SearchOptions\n\t) => Promise<Playlist[]>;\n\n\tsearchTracks: (query: string, options?: SearchOptions) => Promise<Track[]>;\n\n\tloadAlbums: (ids: string[]) => Promise<Album[]>;\n\n\tloadPlaylists: (ids: string[]) => Promise<Playlist[]>;\n\n\tloadTracks: (ids: string[]) => Promise<Track[]>;\n};\n\n// ------------------------------------------------------------------\n\nconst DeezerApiImpl = (): DeezerApi => {\n\tconst _call = <T>(path: string, qs?: string): Promise<T> => {\n\t\t// We have to rely on jsonp because the Deezer api is CORS restricted\n\t\tconsole.debug(\"[Deezer] Requesting... \", { path, qs });\n\t\treturn asyncJsonp(`${API_BASE}/${path}`, qs);\n\t};\n\n\tconst _search = <T>(\n\t\ttype: MediaType,\n\t\tquery: string,\n\t\toptions?: SearchOptions\n\t) =>\n\t\t_call<DeezerApiSearchResult<T>>(\n\t\t\t`search/${type}`,\n\t\t\t`q=${encodeURIComponent(query)}${\n\t\t\t\toptions && options.limit ? `&limit=${options.limit}` : \"\"\n\t\t\t}`\n\t\t);\n\n\tconst _load = async <T extends { error?: DeezerApiError }>(\n\t\ttype: MediaType,\n\t\tids: string[]\n\t): Promise<{\n\t\tdelayedIds: string[];\n\t\tfailedIds: string[];\n\t\tloadedMedias: T[];\n\t}> => {\n\t\tconst delayedIds: string[] = [];\n\t\tconst failedIds: string[] = [];\n\t\tconst loadedMedias: T[] = [];\n\t\tawait Promise.all(\n\t\t\tids.map(async id => {\n\t\t\t\tconst media = await _call<T>(`${type}/${id}`);\n\t\t\t\tif (!media.error) {\n\t\t\t\t\tloadedMedias.push(media);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (media.error.code === 4) {\n\t\t\t\t\tdelayedIds.push(id);\n\t\t\t\t\treturn; // Quota limit exceeded, do not throw so that it will be retried later\n\t\t\t\t}\n\t\t\t\tconsole.error(\n\t\t\t\t\t`[Deezer] An error occured while loading ${type}:`,\n\t\t\t\t\tmedia.error\n\t\t\t\t);\n\t\t\t\tfailedIds.push(id);\n\t\t\t})\n\t\t);\n\t\treturn { delayedIds, failedIds, loadedMedias };\n\t};\n\n\tconst _loadWithRetry = async <T extends { error?: DeezerApiError }>(\n\t\ttype: MediaType,\n\t\tids: string[]\n\t): Promise<T[]> => {\n\t\tlet first = true;\n\t\tconst res: T[] = [];\n\t\tlet remainingIds = [...ids];\n\t\twhile (remainingIds.length > 0) {\n\t\t\tif (!first) {\n\t\t\t\tconsole.debug(`[Deezer] Handling rate limit delayed batch...`, {\n\t\t\t\t\tremainingIds\n\t\t\t\t});\n\t\t\t\tawait sleep(RATE_LIMIT_DELAY);\n\t\t\t}\n\t\t\tconst { delayedIds, loadedMedias } = await _load<T>(\n\t\t\t\ttype,\n\t\t\t\tremainingIds\n\t\t\t);\n\t\t\tres.push(...loadedMedias);\n\t\t\tremainingIds = delayedIds;\n\t\t\tfirst = false;\n\t\t}\n\t\treturn res;\n\t};\n\n\tconst searchAlbums = async (\n\t\tquery: string,\n\t\toptions?: SearchOptions\n\t): Promise<Album[]> => {\n\t\tif (query.trim().length === 0) {\n\t\t\treturn [];\n\t\t}\n\t\treturn (\n\t\t\tawait _search<DeezerApiAlbum>(\"album\", query, options)\n\t\t).data.map(ConvertAlbum);\n\t};\n\n\tconst searchPlaylists = async (\n\t\tquery: string,\n\t\toptions?: SearchOptions\n\t): Promise<Playlist[]> => {\n\t\tif (query.trim().length === 0) {\n\t\t\treturn [];\n\t\t}\n\t\treturn (\n\t\t\tawait _search<DeezerApiPlaylist>(\"playlist\", query, options)\n\t\t).data\n\t\t\t.filter(playlist => playlist.public)\n\t\t\t.map(playlist => ConvertPlaylist(playlist, playlist.user!));\n\t};\n\n\tconst searchTracks = async (\n\t\tquery: string,\n\t\toptions?: SearchOptions\n\t): Promise<Track[]> => {\n\t\tif (query.trim().length === 0) {\n\t\t\treturn [];\n\t\t}\n\t\treturn (await _search<DeezerApiTrack>(\"track\", query, options)).data\n\t\t\t.filter(track => track.readable && track.preview)\n\t\t\t.map(track => ConvertTrack(track, track.album));\n\t};\n\n\tconst loadAlbums = async (ids: string[]): Promise<Album[]> => {\n\t\tif (ids.length === 0) {\n\t\t\treturn [];\n\t\t}\n\t\tconsole.debug(\"[Deezer] Loading albums...\", { ids });\n\t\tconst albums = await _loadWithRetry<DeezerApiAlbum>(\"album\", ids);\n\t\treturn albums.map(ConvertAlbum);\n\t};\n\n\tconst loadPlaylists = async (ids: string[]): Promise<Playlist[]> => {\n\t\tif (ids.length === 0) {\n\t\t\treturn [];\n\t\t}\n\t\tconsole.debug(\"[Deezer] Loading playlists...\", { ids });\n\t\tconst playlists = await _loadWithRetry<DeezerApiPlaylist>(\n\t\t\t\"playlist\",\n\t\t\tids\n\t\t);\n\t\treturn playlists.map(playlist =>\n\t\t\tConvertPlaylist(playlist, playlist.creator!)\n\t\t);\n\t};\n\n\tconst loadTracks = async (ids: string[]): Promise<Track[]> => {\n\t\tif (ids.length === 0) {\n\t\t\treturn [];\n\t\t}\n\t\tconsole.debug(\"[Deezer] Loading tracks...\", { ids });\n\t\tconst tracks = await _loadWithRetry<DeezerApiTrack>(\"track\", ids);\n\t\treturn tracks.map(track => ConvertTrack(track, track.album));\n\t};\n\n\treturn {\n\t\tsearchAlbums,\n\t\tsearchPlaylists,\n\t\tsearchTracks,\n\t\tloadAlbums,\n\t\tloadPlaylists,\n\t\tloadTracks\n\t};\n};\n\n// ------------------------------------------------------------------\n\nexport const DEFAULT_API = DeezerApiImpl();\n","import {\n\tMedia,\n\tMediaAccess,\n\tStructuredMedias,\n\tAlbum,\n\tPlaylist,\n\tTrack,\n\tMediaType\n} from \"../medias\";\nimport { DEFAULT_API } from \"./deezer\";\n\n// ------------------------------------------------------------------\n\nexport type SearchOptions = {\n\tlimit?: number;\n};\n\nexport type SearchResults = {\n\t// keys are ProviderType\n\tdeezer: {\n\t\t// keys are MediaType\n\t\talbum: Album[];\n\t\tplaylist: Playlist[];\n\t\ttrack: Track[];\n\t};\n};\n\n// ------------------------------------------------------------------\n\nexport const loadMedias = async (accesses: MediaAccess[]): Promise<Media[]> => {\n\tconst ids: {\n\t\tdeezer: { album: string[]; playlist: string[]; track: string[] };\n\t} = {\n\t\t// keys are ProviderType\n\t\tdeezer: {\n\t\t\t// keys are MediaType\n\t\t\talbum: [],\n\t\t\tplaylist: [],\n\t\t\ttrack: []\n\t\t}\n\t};\n\tfor (const access of accesses) {\n\t\tids[access.provider][access.type].push(access.id);\n\t}\n\tconst medias = {\n\t\t// keys are ProviderType\n\t\tdeezer: {\n\t\t\t// keys are MediaType\n\t\t\talbum: await DEFAULT_API.loadAlbums(ids.deezer.album),\n\t\t\tplaylist: await DEFAULT_API.loadPlaylists(ids.deezer.playlist),\n\t\t\ttrack: await DEFAULT_API.loadTracks(ids.deezer.track)\n\t\t}\n\t};\n\tconst flatten: Media[] = [];\n\tfor (const access of accesses) {\n\t\tconst media = (medias[access.provider][access.type] as Media[]).find(\n\t\t\tother => other.id === access.id\n\t\t);\n\t\tif (media) {\n\t\t\tflatten.push(media);\n\t\t}\n\t}\n\treturn flatten;\n};\n\n// ------------------------------------------------------------------\n\nexport const loadNewMedias = async (\n\taccesses: MediaAccess[],\n\toldMedias: StructuredMedias\n): Promise<{\n\tnewMedias: Media[];\n\tnewMediasAndTracks: Media[];\n}> => {\n\tconst newAccesses: MediaAccess[] = accesses\n\t\t// Only not already loaded\n\t\t.filter(access => !oldMedias[access.provider][access.type][access.id])\n\t\t// Only unique\n\t\t.filter(\n\t\t\t(value, index, self) =>\n\t\t\t\tindex ===\n\t\t\t\tself.findIndex(\n\t\t\t\t\tother =>\n\t\t\t\t\t\tother.id === value.id &&\n\t\t\t\t\t\tother.provider === value.provider &&\n\t\t\t\t\t\tother.type === value.type\n\t\t\t\t)\n\t\t);\n\tconst newMedias = await loadMedias(newAccesses);\n\tconst newMediasAndTracks: Media[] = [];\n\tfor (const media of newMedias) {\n\t\tnewMediasAndTracks.push(media);\n\t\tif (media.type !== \"track\") {\n\t\t\tnewMediasAndTracks.push(...media.tracks);\n\t\t}\n\t}\n\treturn { newMedias, newMediasAndTracks };\n};\n// ------------------------------------------------------------------\n\nexport const searchMedias = async (\n\tquery: string,\n\toptions?: SearchOptions,\n\ttype?: MediaType\n): Promise<SearchResults> => {\n\tif (!type) {\n\t\tconst [album, playlist, track] = await Promise.all([\n\t\t\tDEFAULT_API.searchAlbums(query, options),\n\t\t\tDEFAULT_API.searchPlaylists(query, options),\n\t\t\tDEFAULT_API.searchTracks(query, options)\n\t\t]);\n\t\treturn {\n\t\t\t// keys are ProviderType\n\t\t\tdeezer: {\n\t\t\t\t// keys are MediaType\n\t\t\t\talbum: album,\n\t\t\t\tplaylist: playlist,\n\t\t\t\ttrack: track\n\t\t\t}\n\t\t};\n\t}\n\tconst results: SearchResults = {\n\t\tdeezer: {\n\t\t\talbum: [],\n\t\t\tplaylist: [],\n\t\t\ttrack: []\n\t\t}\n\t};\n\tswitch (type) {\n\t\tcase \"album\":\n\t\t\tresults.deezer.album = await DEFAULT_API.searchAlbums(\n\t\t\t\tquery,\n\t\t\t\toptions\n\t\t\t);\n\t\t\tbreak;\n\t\tcase \"playlist\":\n\t\t\tresults.deezer.playlist = await DEFAULT_API.searchPlaylists(\n\t\t\t\tquery,\n\t\t\t\toptions\n\t\t\t);\n\t\t\tbreak;\n\t\tcase \"track\":\n\t\t\tresults.deezer.track = await DEFAULT_API.searchTracks(\n\t\t\t\tquery,\n\t\t\t\toptions\n\t\t\t);\n\t\t\tbreak;\n\t}\n\treturn results;\n};\n","import { Reducer } from \"redux\";\nimport { AxiosError } from \"axios\";\nimport { StructuredMedias, Media } from \"../utils/medias\";\nimport { createAction } from \"../actions\";\n\n// ------------------------------------------------------------------\n\ntype MediasAction =\n\t| ReturnType<typeof fetching>\n\t| ReturnType<typeof success>\n\t| ReturnType<typeof error>\n\t| ReturnType<typeof resetMedias>\n\t| ReturnType<typeof setMedias>;\n\nexport const fetching = () => createAction(\"medias/FETCHING\");\nexport const success = () => createAction(\"medias/FETCHED\");\nexport const error = (error: AxiosError) => createAction(\"medias/ERROR\", error);\nexport const resetMedias = () => createAction(\"medias/RESET\");\nexport const setMedias = (medias: Media[]) =>\n\tcreateAction(\"medias/SET\", medias);\n\n// ------------------------------------------------------------------\n\nexport type State = {\n\terror: null | AxiosError;\n\tfetching: boolean;\n\tmedias: StructuredMedias;\n};\n\nconst INITIAL_STATE: State = {\n\terror: null,\n\tfetching: false,\n\tmedias: {\n\t\t// keys are ProvideType\n\t\tdeezer: {\n\t\t\t// keys are MediaType\n\t\t\talbum: {},\n\t\t\tplaylist: {},\n\t\t\ttrack: {}\n\t\t}\n\t}\n};\n\n// ------------------------------------------------------------------\n\nexport const mediasReducer: Reducer<State, MediasAction> = (\n\tstate = INITIAL_STATE,\n\taction: MediasAction\n): State => {\n\tswitch (action.type) {\n\t\tcase \"medias/FETCHING\":\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tfetching: true,\n\t\t\t\terror: null\n\t\t\t};\n\t\tcase \"medias/FETCHED\": {\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tfetching: false,\n\t\t\t\terror: null\n\t\t\t};\n\t\t}\n\t\tcase \"medias/ERROR\":\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tfetching: false,\n\t\t\t\terror: action.payload\n\t\t\t};\n\t\tcase \"medias/SET\": {\n\t\t\tconst copy = {\n\t\t\t\t...state,\n\t\t\t\tmedias: {\n\t\t\t\t\t// keys are ProvideType\n\t\t\t\t\tdeezer: {\n\t\t\t\t\t\t// keys are MediaType\n\t\t\t\t\t\talbum: { ...state.medias.deezer.album },\n\t\t\t\t\t\tplaylist: { ...state.medias.deezer.playlist },\n\t\t\t\t\t\ttrack: { ...state.medias.deezer.track }\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t\tfor (const media of action.payload) {\n\t\t\t\tcopy.medias[media.provider][media.type][media.id] = media;\n\t\t\t}\n\t\t\treturn copy;\n\t\t}\n\t\tcase \"medias/RESET\":\n\t\t\treturn INITIAL_STATE;\n\t\tdefault:\n\t\t\treturn state;\n\t}\n};\n","import { Reducer } from \"redux\";\nimport { AxiosError } from \"axios\";\nimport { RoomAccess, RoomInfo } from \"../utils/rooms\";\nimport { CombinedColor } from \"../utils/colorpicker\";\nimport { FirebaseRoom } from \"../utils/firebase\";\nimport { ContextualizedTrackAccess, MediaAccess } from \"../utils/medias\";\nimport { createAction } from \"../actions\";\n\n// ------------------------------------------------------------------\n\ntype RoomAction =\n\t| ReturnType<typeof fetching>\n\t| ReturnType<typeof success>\n\t| ReturnType<typeof error>\n\t| ReturnType<typeof resetRoom>\n\t| ReturnType<typeof setRoom>;\n\nexport const fetching = () => createAction(\"room/FETCHING\");\nexport const success = () => createAction(\"room/FETCHED\");\nexport const error = (error: AxiosError) => createAction(\"room/ERROR\", error);\nexport const resetRoom = () => createAction(\"room/RESET\");\nexport const setRoom = (values: Partial<RoomData>) =>\n\tcreateAction(\"room/SET\", values);\n\n// ------------------------------------------------------------------\n\nexport type RoomData = {\n\taccess: RoomAccess;\n\tcolor: CombinedColor;\n\tinfo: RoomInfo | null;\n\tmedias: MediaAccess[];\n\troom: ReturnType<typeof FirebaseRoom> | null;\n\ttracks: Array<ContextualizedTrackAccess>; // TODO expanded medias (containers are replaced by their tracks)\n};\n\nexport type State = RoomData & {\n\tfetching: boolean;\n\terror: null | AxiosError;\n};\n\nconst INITIAL_STATE: State = {\n\taccess: { id: \"\", secret: \"\" },\n\tcolor: { fg: \"dark\", bg: { r: 255, g: 255, b: 255 } },\n\terror: null,\n\tfetching: false,\n\tinfo: null,\n\tmedias: [],\n\troom: null,\n\ttracks: []\n};\n\n// ------------------------------------------------------------------\n\nexport const roomReducer: Reducer<State, RoomAction> = (\n\tstate = INITIAL_STATE,\n\taction: RoomAction\n): State => {\n\tswitch (action.type) {\n\t\tcase \"room/FETCHING\":\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tfetching: true,\n\t\t\t\terror: null\n\t\t\t};\n\t\tcase \"room/FETCHED\":\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tfetching: false,\n\t\t\t\terror: null\n\t\t\t};\n\t\tcase \"room/ERROR\":\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tfetching: false,\n\t\t\t\terror: action.payload\n\t\t\t};\n\t\tcase \"room/SET\":\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\t...action.payload\n\t\t\t};\n\t\tcase \"room/RESET\":\n\t\t\treturn INITIAL_STATE;\n\t\tdefault:\n\t\t\treturn state;\n\t}\n};\n","const AUDIO_BUFFER_CACHES: Array<{ buffer: AudioBuffer; url: string }> = [];\nconst AUDIO_BUFFER_CACHES_MAX_SIZE = 10;\nlet AUDIO_CONTEXT: AudioContext | null = null;\n\n// ------------------------------------------------------------------\n\nconst getContext = (): AudioContext => {\n\tif (!AUDIO_CONTEXT) {\n\t\tconsole.debug(\"[Audio] Creating context\");\n\t\tAUDIO_CONTEXT = new (window.AudioContext ||\n\t\t\t(window as any).webkitAudioContext)();\n\t}\n\treturn AUDIO_CONTEXT;\n};\n\n// ------------------------------------------------------------------\n\nexport const createAnalyzerNode = () => getContext().createAnalyser();\n\n// ------------------------------------------------------------------\n\nexport const createGainNode = () => getContext().createGain();\n\n// ------------------------------------------------------------------\n\nexport const createSourceNode = () => getContext().createBufferSource();\n\n// ------------------------------------------------------------------\n\nexport const getCurrentTime = () => getContext().currentTime;\n\n// ------------------------------------------------------------------\n\nexport const getDestinationNode = () => getContext().destination;\n\n// ------------------------------------------------------------------\n\nexport const decodeAudioData = (\n\tencodedBuffer: ArrayBuffer\n): Promise<AudioBuffer> =>\n\tnew Promise((resolve, reject) =>\n\t\tgetContext().decodeAudioData(encodedBuffer, resolve, reject)\n\t);\n\n// ------------------------------------------------------------------\n\nexport const loadAudioBuffer = (url: string): Promise<AudioBuffer> =>\n\tnew Promise((resolve, reject) => {\n\t\tconst req = new XMLHttpRequest();\n\t\treq.open(\"GET\", url, true);\n\t\treq.responseType = \"arraybuffer\";\n\t\treq.addEventListener(\n\t\t\t\"error\",\n\t\t\t() => reject(new Error(\"audio.errors.cannot_load_audio_buffer\")),\n\t\t\tfalse\n\t\t);\n\t\treq.addEventListener(\n\t\t\t\"load\",\n\t\t\tasync () => {\n\t\t\t\ttry {\n\t\t\t\t\tresolve(await decodeAudioData(req.response as ArrayBuffer));\n\t\t\t\t} catch (error) {\n\t\t\t\t\tconsole.debug(\n\t\t\t\t\t\t\"[Audio] An error occurred while decoding data\",\n\t\t\t\t\t\t{ error, url }\n\t\t\t\t\t);\n\t\t\t\t\treject(new Error(\"audio.errors.cannot_decode_audio_data\"));\n\t\t\t\t}\n\t\t\t},\n\t\t\tfalse\n\t\t);\n\t\treq.send();\n\t});\n\n// ------------------------------------------------------------------\n\nexport const getOrLoadAudioBuffer = async (\n\turl: string\n): Promise<AudioBuffer> => {\n\tif (!url) {\n\t\tthrow new Error(\"URL is invalid\");\n\t}\n\tlet buffer: AudioBuffer | null = null;\n\tconst index = AUDIO_BUFFER_CACHES.findIndex(item => item.url === url);\n\tif (index >= 0) {\n\t\t// Found: extract old buffer, it will be repush at the end of cache\n\t\tconsole.debug(\"[Audio] Reusing cached buffer...\", {\n\t\t\turl\n\t\t});\n\t\tbuffer = AUDIO_BUFFER_CACHES.splice(index, 1)[0].buffer;\n\t} else {\n\t\t// Not Found\n\t\tconsole.debug(\"[Audio] Loading buffer...\", { url });\n\t\tbuffer = await loadAudioBuffer(url);\n\t}\n\tAUDIO_BUFFER_CACHES.push({ buffer, url });\n\tAUDIO_BUFFER_CACHES.splice(AUDIO_BUFFER_CACHES_MAX_SIZE);\n\treturn buffer;\n};\n\n// ------------------------------------------------------------------\n\n// Fix Safari and iOS Audio Context\n(() => {\n\tconst fixAudioContext = () => {\n\t\tdocument.removeEventListener(\"click\", fixAudioContext);\n\t\tdocument.removeEventListener(\"touchstart\", fixAudioContext);\n\t\tconsole.debug(\"[Audio] Fixing context...\");\n\t\tconst context = getContext();\n\t\t// Create empty buffer, connect to output, play sound\n\t\tvar buffer = context.createBuffer(1, 1, 22050);\n\t\tvar source = context.createBufferSource();\n\t\tsource.buffer = buffer;\n\t\tsource.connect(context.destination);\n\t\tsource.start(0);\n\t};\n\tdocument.addEventListener(\"click\", fixAudioContext);\n\tdocument.addEventListener(\"touchstart\", fixAudioContext);\n})();\n","import {\n\tcreateAnalyzerNode,\n\tcreateGainNode,\n\tcreateSourceNode,\n\tgetCurrentTime,\n\tgetDestinationNode,\n\tgetOrLoadAudioBuffer\n} from \"./audio\";\nimport { PlayMode } from \"./rooms\";\n\n// ------------------------------------------------------------------\n\nexport const generateRandomPosition = () => Math.floor(Math.random() * 1000000);\n\n// ------------------------------------------------------------------\n\nexport type Player = {\n\tisPlaying: () => boolean;\n\tgetPlayingTrackID: () => string;\n\tgetPlayingTrackPosition: () => number;\n\tgetPlayingTrackPercent: () => number;\n\tplay: (\n\t\ttrackPosition: number,\n\t\ttrackId: string,\n\t\ttrackUrl: string,\n\t\toffset: number,\n\t\toptions?: {\n\t\t\tplaymode: PlayMode;\n\t\t}\n\t) => Promise<void>;\n\tstop: () => Promise<void>;\n};\n\n// ------------------------------------------------------------------\n\nconst PlayerImpl = (): Player => {\n\tlet _analyserNode: AnalyserNode | null = null;\n\tlet _gainNode: GainNode | null = null;\n\tlet _node: AudioNode | null = null;\n\tlet _duration = 0;\n\tlet _sourceNode: AudioBufferSourceNode | null = null;\n\tlet _startTime = 0;\n\tlet _trackId = \"\";\n\tlet _trackPosition = -1;\n\n\tconst getOrCreateNode = () => {\n\t\tif (!_node) {\n\t\t\t_node = getDestinationNode();\n\n\t\t\t_gainNode = createGainNode();\n\t\t\t_gainNode.gain.value = 1.0;\n\t\t\t_gainNode.connect(_node);\n\t\t\t_node = _gainNode;\n\n\t\t\t_analyserNode = createAnalyzerNode();\n\t\t\t_analyserNode.fftSize = 128;\n\t\t\t// _analyserNode.minDecibels = -90;\n\t\t\t// _analyserNode.maxDecibels = -10;\n\t\t\t_analyserNode.connect(_node);\n\t\t\t_node = _analyserNode;\n\t\t}\n\t\treturn _node;\n\t};\n\n\tconst isPlaying = () => !!_sourceNode;\n\n\tconst getPlayingTrackID = () => _trackId;\n\n\tconst getPlayingTrackPosition = () => _trackPosition;\n\n\t// Percentage [0, 1]\n\tconst getPlayingTrackPercent = () => {\n\t\tif (_sourceNode) {\n\t\t\treturn (getCurrentTime() - _startTime) / _duration;\n\t\t}\n\t\treturn 0;\n\t};\n\n\tconst play = async (\n\t\ttrackPosition: number,\n\t\ttrackId: string,\n\t\ttrackUrl: string,\n\t\toffset: number,\n\t\toptions?: {\n\t\t\tplaymode: PlayMode;\n\t\t}\n\t) => {\n\t\tawait stop();\n\t\tconst buffer = await getOrLoadAudioBuffer(trackUrl); // TODO: warning if loadBuffer takes long for some reason and user clicks stop before end, next part of this function will continue after stop have been requested\n\t\tconsole.debug(\"[Player] Starting audio...\", {\n\t\t\ttrackPosition,\n\t\t\ttrackId,\n\t\t\ttrackUrl\n\t\t});\n\t\t_duration = buffer.duration;\n\t\t_trackId = trackId;\n\t\t_trackPosition = trackPosition;\n\t\t_sourceNode = createSourceNode();\n\t\t_sourceNode.buffer = buffer;\n\t\t_sourceNode.loop = false;\n\t\t_sourceNode.loopStart = 0;\n\t\t_sourceNode.loopEnd = 0;\n\t\t_sourceNode.onended = () => {\n\t\t\tconsole.debug(\"[Player] Audio terminated...\");\n\t\t\t_duration = 0;\n\t\t\t_sourceNode = null;\n\t\t\t_startTime = 0;\n\t\t\t_trackId = \"\";\n\t\t\tif (options?.playmode === \"shuffle\") {\n\t\t\t\t_trackPosition += generateRandomPosition();\n\t\t\t} else {\n\t\t\t\t_trackPosition++;\n\t\t\t}\n\t\t};\n\t\t_sourceNode.playbackRate.value = 1.0;\n\t\t_sourceNode.connect(getOrCreateNode());\n\t\t_sourceNode.start(0, offset); // A new BufferSource must be created for each start\n\t\t_startTime = getCurrentTime();\n\t};\n\n\tconst stop = (): Promise<void> =>\n\t\tnew Promise(resolve => {\n\t\t\tif (null !== _sourceNode) {\n\t\t\t\tconsole.debug(\"[Player] Stopping play...\");\n\t\t\t\t_sourceNode.onended = () => {\n\t\t\t\t\tconsole.debug(\"[Player] Forced audio termination...\");\n\t\t\t\t\tresolve();\n\t\t\t\t};\n\t\t\t\t_sourceNode.stop();\n\t\t\t\t_duration = 0;\n\t\t\t\t_sourceNode = null;\n\t\t\t\t_startTime = 0;\n\t\t\t\t_trackId = \"\";\n\t\t\t\t_trackPosition = -1;\n\t\t\t} else {\n\t\t\t\tresolve();\n\t\t\t}\n\t\t});\n\n\treturn {\n\t\tgetPlayingTrackID,\n\t\tgetPlayingTrackPercent,\n\t\tgetPlayingTrackPosition,\n\t\tisPlaying,\n\t\tplay,\n\t\tstop\n\t};\n};\n\n// ------------------------------------------------------------------\n\nexport const QUEUE_PLAYER = PlayerImpl();\n\nexport const PREVIEW_PLAYER = PlayerImpl();\n","import { AsyncAction } from \".\";\nimport { MediaAccess, findPreview, Media } from \"../utils/medias\";\nimport { PREVIEW_PLAYER } from \"../utils/player\";\nimport { loadNewMedias } from \"../utils/providers\";\nimport { displayError, displayMessage } from \"./messages\";\nimport { extractErrorMessage } from \"../utils/messages\";\nimport { renderMediaInToaster } from \"../components/Room/Medias\";\n\n// ------------------------------------------------------------------\n\nexport const displayMediaInfo = (media: Media): AsyncAction => async dispatch =>\n\tdispatch(\n\t\tdisplayMessage(\"info\", {\n\t\t\tduration: 5000,\n\t\t\textra: () => renderMediaInToaster(media),\n\t\t\tweight: 1000\n\t\t})\n\t);\n\n// ------------------------------------------------------------------\n\nexport const previewMedia = (access: MediaAccess): AsyncAction => async (\n\tdispatch,\n\tgetState\n) => {\n\ttry {\n\t\tconst {\n\t\t\tmedias: { medias: oldMedias }\n\t\t} = getState();\n\t\tconst { newMedias } = await loadNewMedias([access], oldMedias);\n\t\tconst track = findPreview(access, oldMedias, newMedias);\n\t\tif (!track) {\n\t\t\tthrow new Error(\"[Medias] Cannot find track to preview...\");\n\t\t}\n\t\tconsole.debug(\"[Medias] Previewing track...\", { track });\n\t\tawait PREVIEW_PLAYER.play(0, track.id, track.preview, 0);\n\t} catch (err) {\n\t\tdispatch(displayError(extractErrorMessage(err)));\n\t}\n};\n","import { createHashHistory } from \"history\";\n\nexport default createHashHistory();\n","import { v4 } from \"uuid\";\n//\nimport { AsyncAction, Dispatch } from \".\";\nimport { displayError } from \"./messages\";\nimport { RoomInfo, RoomType } from \"../utils/rooms\";\nimport { FirebaseRoom } from \"../utils/firebase\";\nimport {\n\tMediaAccess,\n\tTrackAccess,\n\textractTracks,\n\tContextualizedTrackAccess\n} from \"../utils/medias\";\nimport { extractErrorMessage } from \"../utils/messages\";\nimport { pickColor } from \"../utils/colorpicker\";\nimport { Player } from \"../utils/player\";\nimport { loadNewMedias } from \"../utils/providers\";\nimport { RootState } from \"../reducers\";\nimport { setMedias } from \"../reducers/medias\";\nimport { setRoom, resetRoom } from \"../reducers/room\";\nimport { displayMediaInfo } from \"./medias\";\nimport history from \"../utils/history\";\n\n// ------------------------------------------------------------------\n\nconst DEFAULT_QUEUE_INFO_BY_TYPE: {\n\t[type: string]: Pick<RoomInfo, \"playing\" | \"playmode\" | \"queue\">;\n} = {\n\tdj: {\n\t\tplaying: false,\n\t\tplaymode: \"default\",\n\t\tqueue: {}\n\t},\n\tseabattle: {\n\t\tplaying: true,\n\t\tplaymode: \"shuffle\",\n\t\tqueue: {\n\t\t\t0: {\n\t\t\t\tid: \"301013\", // Pirates Of The Caribbean OST\n\t\t\t\tprovider: \"deezer\",\n\t\t\t\ttype: \"album\"\n\t\t\t},\n\t\t\t1: {\n\t\t\t\tid: \"7358507\", // Stalingrad OST\n\t\t\t\tprovider: \"deezer\",\n\t\t\t\ttype: \"album\"\n\t\t\t},\n\t\t\t2: {\n\t\t\t\tid: \"558976\", // Master & Commander OST\n\t\t\t\tprovider: \"deezer\",\n\t\t\t\ttype: \"album\"\n\t\t\t},\n\t\t\t3: {\n\t\t\t\tid: \"87375582\", // Le chant du loup OST\n\t\t\t\tprovider: \"deezer\",\n\t\t\t\ttype: \"album\"\n\t\t\t}\n\t\t}\n\t}\n};\n\n// ------------------------------------------------------------------\n\nexport const createRoom = (\n\tname: string,\n\tsecret: string,\n\ttype: RoomType\n): AsyncAction => async dispatch => {\n\ttry {\n\t\tconst id = v4();\n\t\tconsole.debug(\"[Room] Creating...\", { id, secret });\n\n\t\tawait FirebaseRoom({ id, secret }).update({\n\t\t\textra: \"\",\n\t\t\tname,\n\t\t\tqueue_position: 0,\n\t\t\ttype,\n\t\t\t...DEFAULT_QUEUE_INFO_BY_TYPE[type]\n\t\t});\n\t\tdispatch(enterRoom(id, secret));\n\t} catch (err) {\n\t\tdispatch(displayError(extractErrorMessage(err)));\n\t}\n};\n\n// ------------------------------------------------------------------\n\nexport const enterRoom = (id: string, secret: string): AsyncAction => async (\n\tdispatch,\n\tgetState\n) => {\n\tconst {\n\t\troom: { room }\n\t} = getState();\n\tif (room && room.id === id) {\n\t\t// Nothing to do\n\t\treturn;\n\t}\n\tdispatch(exitRoom());\n\ttry {\n\t\tconsole.debug(\"[Room] Entering...\", { id, secret });\n\t\tconst newRoom = FirebaseRoom({ id, secret });\n\t\tdispatch(\n\t\t\tsetRoom({\n\t\t\t\taccess: { id, secret },\n\t\t\t\troom: newRoom,\n\t\t\t\tinfo: await newRoom.wait()\n\t\t\t})\n\t\t);\n\t\tdispatch(_watchRoom(newRoom));\n\t\thistory.push(`/room/${id}?secret=${secret}`); // TODO: should push only if we're not already in it\n\t} catch (err) {\n\t\tdispatch(displayError(extractErrorMessage(err)));\n\t}\n};\n\nexport const exitRoom = (): AsyncAction => async (dispatch, getState) => {\n\tconst {\n\t\troom: { room }\n\t} = getState();\n\tif (!room) {\n\t\t// Nothing to do\n\t\treturn;\n\t}\n\tconsole.debug(\"[Room] Exiting...\");\n\tdispatch(_unwatchPlayer());\n\tdispatch(_unwatchRoom(room));\n\tdispatch(resetRoom());\n};\n\n// ------------------------------------------------------------------\n\nexport const lockRoom = (): AsyncAction => async (dispatch, getState) => {\n\tconst {\n\t\troom: {\n\t\t\troom,\n\t\t\taccess: { id, secret: oldSecret }\n\t\t}\n\t} = getState();\n\tif (!room || room.id !== id || !oldSecret) {\n\t\t// Nothing to do\n\t\treturn;\n\t}\n\tconsole.debug(\"[Room] Locking...\", { id });\n\troom.setSecret(\"\");\n\t// TODO : not history.replace(`/room/${id}`); as it would trigger a page refresh\n\tdispatch(setRoom({ access: { id, secret: \"\" } }));\n};\n\nexport const unlockRoom = (secret: string): AsyncAction => async (\n\tdispatch,\n\tgetState\n) => {\n\tconst {\n\t\troom: {\n\t\t\troom,\n\t\t\taccess: { id, secret: oldSecret }\n\t\t}\n\t} = getState();\n\tif (!room || room.id !== id || oldSecret === secret) {\n\t\t// Nothing to do\n\t\treturn;\n\t}\n\tconsole.debug(\"[Room] Unlocking...\", { id, secret });\n\troom.setSecret(secret);\n\t// TODO : not history.replace(`/room/${id}?secret=${secret}`); as it would trigger a page refresh\n\tdispatch(setRoom({ access: { id, secret } }));\n};\n\n// ------------------------------------------------------------------\n// ------------------------------------------------------------------\n// ------------------------------------------------------------------\n\nlet ROOM_WATCHER: any = null;\n\nconst _watchRoom = (\n\troom: ReturnType<typeof FirebaseRoom>\n): AsyncAction => async (dispatch, getState, { player }) => {\n\tconsole.debug(\"[Room] Watching...\");\n\tif (!!ROOM_WATCHER) {\n\t\t// Nothing to do\n\t\treturn;\n\t}\n\tROOM_WATCHER = room.subscribe(\n\t\tasync (snapshot: firebase.database.DataSnapshot) => {\n\t\t\t// TODO: we could add a queue in case too much updates are received\n\t\t\tconst {\n\t\t\t\tmedias: { medias: oldMedias }\n\t\t\t} = getState();\n\t\t\tconst newInfo = snapshot.val() as RoomInfo | null;\n\t\t\tconsole.debug(\"[Room] Received room update...\", { newInfo });\n\t\t\tif (!newInfo) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tlet medias: MediaAccess[] = [];\n\t\t\tif (newInfo.queue) {\n\t\t\t\tmedias = Object.entries(newInfo.queue)\n\t\t\t\t\t.sort(\n\t\t\t\t\t\t(media1, media2) =>\n\t\t\t\t\t\t\tNumber(media1[0]) - Number(media2[0])\n\t\t\t\t\t)\n\t\t\t\t\t.map(media => media[1]);\n\t\t\t}\n\t\t\tif (newInfo.playing !== player.isPlaying()) {\n\t\t\t\tif (newInfo.playing) {\n\t\t\t\t\tif (!!PLAYER_TIMER) {\n\t\t\t\t\t\tconsole.debug(\"************ ARG ************\");\n\t\t\t\t\t}\n\t\t\t\t\tdispatch(_watchPlayer());\n\t\t\t\t} else {\n\t\t\t\t\tdispatch(_unwatchPlayer());\n\t\t\t\t}\n\t\t\t}\n\t\t\tlet tracks: ContextualizedTrackAccess[] = [];\n\t\t\tif (medias.length > 0) {\n\t\t\t\tconst { newMedias, newMediasAndTracks } = await loadNewMedias(\n\t\t\t\t\tmedias,\n\t\t\t\t\toldMedias\n\t\t\t\t);\n\t\t\t\tif (newMediasAndTracks.length > 0) {\n\t\t\t\t\tdispatch(setMedias(newMediasAndTracks));\n\t\t\t\t}\n\t\t\t\ttracks = extractTracks(medias, oldMedias, newMedias);\n\t\t\t}\n\t\t\tdispatch(\n\t\t\t\tsetRoom({\n\t\t\t\t\tinfo: newInfo,\n\t\t\t\t\tmedias,\n\t\t\t\t\troom,\n\t\t\t\t\ttracks\n\t\t\t\t})\n\t\t\t);\n\t\t}\n\t);\n};\n\nconst _unwatchRoom = (\n\troom: ReturnType<typeof FirebaseRoom>\n): AsyncAction => async () => {\n\tif (!ROOM_WATCHER) {\n\t\t// Nothing to do\n\t\treturn;\n\t}\n\tconsole.debug(\"Unwatching room...\");\n\troom.unsubscribe(ROOM_WATCHER);\n\tROOM_WATCHER = null;\n};\n\n// ------------------------------------------------------------------\n// ------------------------------------------------------------------\n// ------------------------------------------------------------------\n\nlet PLAYER_TIMER: NodeJS.Timeout | null = null;\n\nconst _computeNextPosition = (\n\tplayer: Player,\n\ttracks: TrackAccess[],\n\ttrackIndex: number\n) => {\n\tlet nextIndex = -1;\n\tconst playingTrackID = player.getPlayingTrackID();\n\tconst playingTrackIndex = player.getPlayingTrackPosition() % tracks.length;\n\tif (playingTrackIndex !== trackIndex) {\n\t\tif (player.isPlaying()) {\n\t\t\t// User has clicked an other track or added/removed a track in queue\n\t\t\tif (playingTrackID !== tracks[trackIndex].id) {\n\t\t\t\tnextIndex = trackIndex;\n\t\t\t}\n\t\t} else {\n\t\t\t// Not playing which means previous track has terminated\n\t\t\tnextIndex = playingTrackIndex >= 0 ? playingTrackIndex : trackIndex;\n\t\t}\n\t} else if (playingTrackID !== tracks[trackIndex].id) {\n\t\t// User has deleted playing track\n\t\tnextIndex = trackIndex;\n\t}\n\treturn nextIndex;\n};\n\nconst _watchPlayer = (): AsyncAction => async (\n\tdispatch,\n\tgetState,\n\t{ player }\n) => {\n\tif (!PLAYER_TIMER) {\n\t\tconsole.debug(\"[Room] Watching player... ********************\");\n\t\t_scheduleTimer(dispatch, getState, player, 250);\n\t}\n};\n\nconst _unwatchPlayer = (): AsyncAction => async (\n\tdispatch,\n\tgetState,\n\t{ player }\n) => {\n\tif (PLAYER_TIMER) {\n\t\tconsole.debug(\"[Room] Unwatching player... ********************\");\n\t\tclearTimeout(PLAYER_TIMER);\n\t\tPLAYER_TIMER = null;\n\t}\n\tawait player.stop();\n};\n\n// Don't use setInterval because a step could be triggered before previous one terminated\nconst _scheduleTimer = (\n\tdispatch: Dispatch,\n\tgetState: () => RootState,\n\tplayer: Player,\n\tms: number\n) => {\n\tPLAYER_TIMER = setTimeout(async () => {\n\t\tconst {\n\t\t\troom: { info, tracks },\n\t\t\tmedias: { medias }\n\t\t} = getState();\n\n\t\tif (tracks.length === 0) {\n\t\t\t// Last track has been removed from queue by user\n\t\t\tconsole.debug(\"[Room] No more tracks in queue...\");\n\t\t\tdispatch(setRoom({ info: { ...info!, playing: false } })); // for info update because of player change  without firebase\n\t\t\tawait player.stop();\n\t\t\tPLAYER_TIMER = null;\n\t\t\treturn;\n\t\t}\n\n\t\t// Detect and apply change to queue and player\n\t\tconst nextTrackIndex = _computeNextPosition(\n\t\t\tplayer,\n\t\t\ttracks,\n\t\t\tinfo!.queue_position\n\t\t);\n\n\t\tif (nextTrackIndex >= 0) {\n\t\t\tconst nextAccess = tracks[nextTrackIndex];\n\t\t\tconst nextTrack =\n\t\t\t\tmedias[nextAccess.provider][nextAccess.type][nextAccess.id];\n\t\t\tconsole.debug(\"Detected play change...\", {\n\t\t\t\tnextTrack,\n\t\t\t\tnextTrackIndex\n\t\t\t});\n\n\t\t\ttry {\n\t\t\t\tconst [color] = await Promise.all([\n\t\t\t\t\tpickColor(nextTrack.album.picture_small),\n\t\t\t\t\tplayer.play(\n\t\t\t\t\t\tnextTrackIndex,\n\t\t\t\t\t\tnextTrack.id,\n\t\t\t\t\t\tnextTrack.preview,\n\t\t\t\t\t\t0,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tplaymode: info!.playmode\n\t\t\t\t\t\t}\n\t\t\t\t\t)\n\t\t\t\t]);\n\t\t\t\tdispatch(displayMediaInfo(nextTrack));\n\t\t\t\tdispatch(\n\t\t\t\t\tsetRoom({\n\t\t\t\t\t\tcolor,\n\t\t\t\t\t\tinfo: { ...info!, queue_position: nextTrackIndex } // for info update because of player change without firebase\n\t\t\t\t\t})\n\t\t\t\t);\n\t\t\t} catch (err) {\n\t\t\t\tdispatch(displayError(extractErrorMessage(err)));\n\t\t\t}\n\t\t}\n\n\t\t// Reschedule time\n\t\t// console.debug(\"[Room] Rescheduling\");\n\t\t_scheduleTimer(dispatch, getState, player, ms);\n\t}, ms);\n};\n","import { AsyncAction } from \".\";\nimport { lockRoom } from \"./room\";\nimport { displayError } from \"./messages\";\nimport { extractErrorMessage } from \"../utils/messages\";\n\n// ------------------------------------------------------------------\n\nexport const startPlayer = (): AsyncAction => async (dispatch, getState) => {\n\tconst {\n\t\troom: { info, room }\n\t} = getState();\n\tif (!room || room.isLocked() || !info) {\n\t\tdispatch(displayError(\"rooms.error.locked\"));\n\t\treturn;\n\t}\n\tif (info.playing) {\n\t\t// Nothing to do\n\t\treturn;\n\t}\n\ttry {\n\t\tconsole.debug(\"[Player] Starting...\");\n\t\tawait room.update({\n\t\t\t...info,\n\t\t\tplaying: true\n\t\t});\n\t} catch (err) {\n\t\tdispatch(displayError(extractErrorMessage(err)));\n\t\tdispatch(lockRoom());\n\t}\n};\n\n// ------------------------------------------------------------------\n\nexport const stopPlayer = (): AsyncAction => async (dispatch, getState) => {\n\tconst {\n\t\troom: { info, room }\n\t} = getState();\n\tif (!room || room.isLocked() || !info) {\n\t\tdispatch(displayError(\"rooms.error.locked\"));\n\t\treturn;\n\t}\n\tif (!info.playing) {\n\t\t// Nothing to do\n\t\treturn;\n\t}\n\ttry {\n\t\tconsole.debug(\"[Player] Stopping...\");\n\t\tawait room.update({\n\t\t\t...info,\n\t\t\tplaying: false\n\t\t});\n\t} catch (err) {\n\t\tdispatch(displayError(extractErrorMessage(err)));\n\t\tdispatch(lockRoom());\n\t}\n};\n","import { MediaAccess } from \"./medias\";\n\nexport type PlayMode = \"default\" | \"shuffle\"; // TODO: Implement Shuffle mode\n\nexport type RoomType = \"blind\" | \"dj\" | \"seabattle\";\n\nexport const RoomTypes = [\n\t// \"blind\",\n\t\"dj\",\n\t\"seabattle\"\n];\n\nexport type RoomInfo = {\n\textra: string;\n\tname: string;\n\tqueue?: RoomQueue;\n\tqueue_position: number;\n\tplaying: boolean;\n\tplaymode: PlayMode;\n\ttimestamp: number;\n\ttype: RoomType;\n};\n\nexport type RoomAccess = {\n\tid: string;\n\tsecret: string;\n};\n\nexport type RoomQueue = {\n\t[index: string]: MediaAccess;\n};\n\n// ------------------------------------------------------------------\n\nexport const createQueueMerging = (\n\taccesses1: MediaAccess[],\n\taccesses2: MediaAccess[]\n): RoomQueue => {\n\tconst queue: RoomQueue = {};\n\t[...accesses1, ...accesses2].forEach(({ id, provider, type }, index) => {\n\t\tqueue[index] = { id, provider, type };\n\t});\n\treturn queue;\n};\n\n// ------------------------------------------------------------------\n\nexport const createQueueRemoving = (\n\taccesses: MediaAccess[],\n\tindex: number,\n\tcount: number\n): RoomQueue => {\n\tif (index < 0 || index >= accesses.length) {\n\t\tthrow new Error(\"Media index is out of range\");\n\t}\n\n\tconst queue: RoomQueue = {};\n\tconst copy = [...accesses];\n\tcopy.splice(index, count);\n\tcopy.forEach(({ id, provider, type }, index) => {\n\t\tqueue[index] = { id, provider, type };\n\t});\n\treturn queue;\n};\n","import { AsyncAction } from \".\";\nimport { displayError } from \"./messages\";\nimport { lockRoom } from \"./room\";\nimport { MediaAccess, findContextFromTrackIndex } from \"../utils/medias\";\nimport { extractErrorMessage } from \"../utils/messages\";\nimport { createQueueMerging, createQueueRemoving } from \"../utils/rooms\";\nimport { generateRandomPosition } from \"../utils/player\";\n\n// ------------------------------------------------------------------\n\nexport const clearQueue = (): AsyncAction => async (dispatch, getState) => {\n\tconst {\n\t\troom: { info, room }\n\t} = getState();\n\tif (!room || room.isLocked() || !info) {\n\t\tdispatch(displayError(\"rooms.error.locked\"));\n\t\treturn;\n\t}\n\ttry {\n\t\tconsole.debug(\"[Queue] Clearing medias...\");\n\t\tawait room.update({\n\t\t\t...info,\n\t\t\tplaying: false,\n\t\t\tqueue: {},\n\t\t\tqueue_position: 0\n\t\t});\n\t} catch (err) {\n\t\tdispatch(displayError(extractErrorMessage(err)));\n\t\tdispatch(lockRoom());\n\t}\n};\n\n// ------------------------------------------------------------------\n\nexport const appendToQueue = (newMedias: MediaAccess[]): AsyncAction => async (\n\tdispatch,\n\tgetState\n) => {\n\tconst {\n\t\troom: { info, medias: oldMedias, room }\n\t} = getState();\n\tif (!room || room.isLocked() || !info) {\n\t\tdispatch(displayError(\"rooms.error.locked\"));\n\t\treturn;\n\t}\n\tif (newMedias.length === 0) {\n\t\t// Nothing to do\n\t\treturn;\n\t}\n\ttry {\n\t\tconsole.debug(\"[Queue] Appending medias...\", {\n\t\t\tnewMedias\n\t\t});\n\t\tawait room.update({\n\t\t\t...info,\n\t\t\tqueue: createQueueMerging(oldMedias, newMedias)\n\t\t});\n\t} catch (err) {\n\t\tdispatch(displayError(extractErrorMessage(err)));\n\t\tdispatch(lockRoom());\n\t}\n};\n\n// ------------------------------------------------------------------\n\n// TODO: DECOMPLEXIFY removeFromQueue\nexport const removeFromQueue = (\n\tremovedTrackIndex: number\n): AsyncAction => async (dispatch, getState) => {\n\tconst {\n\t\tmedias: { medias: allMedias },\n\t\troom: { info, medias, room, tracks }\n\t} = getState();\n\tif (!room || room.isLocked() || !info) {\n\t\tdispatch(displayError(\"rooms.error.locked\"));\n\t\treturn;\n\t}\n\tconst {\n\t\tmediaFirstTrackIndex: removedMediaFirstTrackIndex,\n\t\tmediaIndex: removedMediaIndex,\n\t\tmediaSize: removedTrackCount\n\t} = findContextFromTrackIndex(medias, removedTrackIndex, allMedias);\n\tif (removedMediaIndex < 0) {\n\t\t// Nothing to do\n\t\treturn;\n\t}\n\tconst playingTrackIndex = info.queue_position;\n\ttry {\n\t\tconsole.debug(\"[Queue] Removing track...\", {\n\t\t\tplayingTrackIndex,\n\t\t\tremovedMediaIndex,\n\t\t\tremovedTrackCount,\n\t\t\tremovedTrackIndex,\n\t\t\tremovedMediaFirstTrackIndex\n\t\t});\n\t\tconst queue = createQueueRemoving(medias, removedMediaIndex, 1);\n\t\tif (Object.keys(queue).length === 0) {\n\t\t\tconsole.debug(\"[Queue] Removing last media...\");\n\t\t\tawait room.update({\n\t\t\t\t...info,\n\t\t\t\tplaying: false,\n\t\t\t\tqueue: {},\n\t\t\t\tqueue_position: 0\n\t\t\t});\n\t\t} else if (playingTrackIndex < removedTrackIndex) {\n\t\t\tawait room.update({\n\t\t\t\t...info,\n\t\t\t\tqueue\n\t\t\t});\n\t\t} else if (\n\t\t\tplayingTrackIndex >= removedMediaFirstTrackIndex &&\n\t\t\tplayingTrackIndex < removedMediaFirstTrackIndex + removedTrackCount\n\t\t) {\n\t\t\tawait room.update({\n\t\t\t\t...info,\n\t\t\t\tqueue,\n\t\t\t\tqueue_position:\n\t\t\t\t\tremovedMediaFirstTrackIndex + removedTrackCount ===\n\t\t\t\t\ttracks.length\n\t\t\t\t\t\t? removedMediaFirstTrackIndex - 1\n\t\t\t\t\t\t: removedMediaFirstTrackIndex\n\t\t\t});\n\t\t} else {\n\t\t\tawait room.update({\n\t\t\t\t...info,\n\t\t\t\tqueue,\n\t\t\t\tqueue_position: playingTrackIndex - removedTrackCount\n\t\t\t});\n\t\t}\n\t} catch (err) {\n\t\tdispatch(displayError(extractErrorMessage(err)));\n\t\tdispatch(lockRoom());\n\t}\n};\n\n// ------------------------------------------------------------------\n\nexport const setQueuePosition = (newTrackIndex: number): AsyncAction => async (\n\tdispatch,\n\tgetState\n) => {\n\tconst {\n\t\troom: { info, room }\n\t} = getState();\n\tif (!room || room.isLocked() || !info) {\n\t\tdispatch(displayError(\"rooms.error.locked\"));\n\t\treturn;\n\t}\n\tconst oldTrackIndex = info.queue_position;\n\tif (oldTrackIndex === newTrackIndex) {\n\t\t// Nothing to do\n\t\treturn;\n\t}\n\ttry {\n\t\tconsole.debug(\"[Queue] Set position...\", {\n\t\t\toldTrackIndex,\n\t\t\tnewTrackIndex\n\t\t});\n\t\tawait room.update({\n\t\t\t...info,\n\t\t\tplaying: true, // important\n\t\t\tqueue_position: newTrackIndex\n\t\t});\n\t} catch (err) {\n\t\tdispatch(displayError(extractErrorMessage(err)));\n\t\tdispatch(lockRoom());\n\t}\n};\n\n// ------------------------------------------------------------------\n\nexport const moveBackward = (): AsyncAction => async (dispatch, getState) => {\n\tconst {\n\t\troom: { info, tracks }\n\t} = getState();\n\tif (!info || tracks.length === 0) {\n\t\t// Nothing to do\n\t\treturn;\n\t}\n\tconsole.debug(\"[Queue] Moving backward...\");\n\tdispatch(\n\t\tsetQueuePosition(\n\t\t\tinfo.queue_position > 0\n\t\t\t\t? info.queue_position - 1\n\t\t\t\t: tracks.length - 1\n\t\t)\n\t);\n};\n\n// ------------------------------------------------------------------\n\nexport const moveForward = (): AsyncAction => async (dispatch, getState) => {\n\tconst {\n\t\troom: { info, tracks }\n\t} = getState();\n\tif (!info || tracks.length === 0) {\n\t\t// Nothing to do\n\t\treturn;\n\t}\n\tif (info.playmode === \"shuffle\") {\n\t\tconsole.debug(\"[Queue] Randomizing next track...\");\n\t\tdispatch(setQueuePosition(generateRandomPosition() % tracks.length));\n\t} else {\n\t\tconsole.debug(\"[Queue] Moving forward...\");\n\t\tdispatch(setQueuePosition((info.queue_position + 1) % tracks.length));\n\t}\n};\n","import { Reducer } from \"redux\";\nimport { createAction } from \"../actions\";\n\n// ------------------------------------------------------------------\n\nexport type ModalPrereqT<T extends string, P> = {\n\ttype: T;\n\tprops: P;\n};\n\nexport type ModalPrereq =\n\t| ModalPrereqT<\n\t\t\t\"Confirm\",\n\t\t\t{\n\t\t\t\tquestion: string;\n\t\t\t\tonCanceled?: () => void;\n\t\t\t\tonConfirmed: () => void;\n\t\t\t}\n\t  >\n\t| ModalPrereqT<\"ConnectUser\", null>\n\t| ModalPrereqT<\"CreateRoom\", null>\n\t| ModalPrereqT<\"CreateUser\", null>\n\t| ModalPrereqT<\"JoinRoom\", null>\n\t| ModalPrereqT<\"Search\", null>\n\t| ModalPrereqT<\"UnlockRoom\", null>;\n\n// ------------------------------------------------------------------\n\ntype ModalsAction =\n\t| ReturnType<typeof closeModal>\n\t| ReturnType<typeof openModal>\n\t| ReturnType<typeof popModal>\n\t| ReturnType<typeof pushModal>;\n\n// ------------------------------------------------------------------\n\nexport const openModal = (prereq: ModalPrereq) =>\n\tcreateAction(\"modals/OPEN\", prereq);\n\nexport const closeModal = () => createAction(\"modals/CLOSE\");\n\n// ------------------------------------------------------------------\n\nexport const pushModal = (prereq: ModalPrereq) =>\n\tcreateAction(\"modals/PUSH\", prereq);\n\nexport const popModal = () => createAction(\"modals/POP\");\n\n// ------------------------------------------------------------------\n\nexport type ModalsState = {\n\tstack: ModalPrereq[];\n};\n\n// ------------------------------------------------------------------\n\nexport const initialState: ModalsState = {\n\tstack: []\n};\n\n// ------------------------------------------------------------------\n\nexport const modalsReducer: Reducer<ModalsState, ModalsAction> = (\n\tstate = initialState,\n\taction\n): ModalsState => {\n\tswitch (action.type) {\n\t\tcase \"modals/OPEN\":\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tstack: [action.payload]\n\t\t\t};\n\t\tcase \"modals/CLOSE\":\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tstack: []\n\t\t\t};\n\t\tcase \"modals/PUSH\":\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tstack: [...state.stack, action.payload]\n\t\t\t};\n\t\tcase \"modals/POP\":\n\t\t\tconst copy = [...state.stack];\n\t\t\tcopy.pop();\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tstack: copy\n\t\t\t};\n\t\tdefault:\n\t\t\treturn state;\n\t}\n};\n","import React, { useCallback } from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { useTranslation } from \"react-i18next\";\n//\nimport { IconButton } from \"../Common/IconButton\";\nimport { LoadingIcon } from \"../Common/LoadingIcon\";\nimport { QueueItem } from \"./QueueItem\";\nimport { Dispatch } from \"../../actions\";\nimport { RootState } from \"../../reducers\";\nimport {\n\tisRoomLoaded,\n\tisRoomLocked,\n\tisRoomPlaying\n} from \"../../selectors/room\";\nimport { selectTracks } from \"../../selectors/medias\";\nimport { Track } from \"../../utils/medias\";\nimport { startPlayer, stopPlayer } from \"../../actions/player\";\nimport { setQueuePosition, removeFromQueue } from \"../../actions/queue\";\nimport { openModal } from \"../../reducers/modals\";\nimport \"./Queue.scss\";\n\n// ------------------------------------------------------------------\n\nexport const Queue = () => {\n\tconst dispatch = useDispatch<Dispatch>();\n\tconst loaded = useSelector<RootState, boolean>(isRoomLoaded);\n\tconst locked = useSelector<RootState, boolean>(isRoomLocked);\n\tconst playing = useSelector<RootState, boolean>(isRoomPlaying);\n\tconst playingIndex = useSelector<RootState, number>(state =>\n\t\tnull !== state.room.info ? state.room.info.queue_position : 0\n\t);\n\tconst tracks = useSelector<RootState, Array<Track | null>>(selectTracks);\n\n\tconst onPlay = useCallback(\n\t\t(index: number) => {\n\t\t\tdispatch(startPlayer());\n\t\t\tdispatch(setQueuePosition(index));\n\t\t},\n\t\t[dispatch]\n\t);\n\n\tconst onRemove = useCallback(\n\t\t(index: number) => dispatch(removeFromQueue(index)),\n\t\t[dispatch]\n\t);\n\n\tconst onSearch = useCallback(\n\t\t() => dispatch(openModal({ type: \"Search\", props: null })),\n\t\t[dispatch]\n\t);\n\n\tconst onStop = useCallback(() => dispatch(stopPlayer()), [dispatch]);\n\n\treturn (\n\t\t<div className=\"Queue\">\n\t\t\t{tracks.length > 0 ? (\n\t\t\t\t<QueueList\n\t\t\t\t\tlocked={locked}\n\t\t\t\t\ttracks={tracks}\n\t\t\t\t\tplaying={playing}\n\t\t\t\t\tplayingIndex={playingIndex}\n\t\t\t\t\tonPlay={onPlay}\n\t\t\t\t\tonRemove={onRemove}\n\t\t\t\t\tonStop={onStop}\n\t\t\t\t/>\n\t\t\t) : (\n\t\t\t\t<EmptyQueueList\n\t\t\t\t\tloaded={loaded}\n\t\t\t\t\tlocked={locked}\n\t\t\t\t\tonSearch={onSearch}\n\t\t\t\t/>\n\t\t\t)}\n\t\t</div>\n\t);\n};\n\n// ------------------------------------------------------------------\n\nconst EmptyQueueList = React.memo(\n\t({\n\t\tloaded,\n\t\tlocked,\n\t\tonSearch\n\t}: {\n\t\tloaded: boolean;\n\t\tlocked: boolean;\n\t\tonSearch: () => void;\n\t}) => {\n\t\tconst { t } = useTranslation();\n\t\treturn (\n\t\t\t<div className=\"QueueEmpty\">\n\t\t\t\t{loaded ? (\n\t\t\t\t\t<>\n\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\ttitle=\"...\"\n\t\t\t\t\t\t\ticon=\"shower\"\n\t\t\t\t\t\t\tonClick={onSearch}\n\t\t\t\t\t\t\tsize=\"L\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<span onClick={onSearch}>\n\t\t\t\t\t\t\t{t(locked ? \"rooms.empty_for_now\" : \"rooms.empty\")}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</>\n\t\t\t\t) : (\n\t\t\t\t\t<>\n\t\t\t\t\t\t<LoadingIcon size=\"L\" />\n\t\t\t\t\t\t<span>{t(\"rooms.loading\")}</span>\n\t\t\t\t\t</>\n\t\t\t\t)}\n\t\t\t</div>\n\t\t);\n\t}\n);\n\n// ------------------------------------------------------------------\n\nconst QueueList = React.memo(\n\t({\n\t\tlocked,\n\t\ttracks,\n\t\tplaying,\n\t\tplayingIndex,\n\t\tonPlay,\n\t\tonRemove,\n\t\tonStop\n\t}: {\n\t\tlocked: boolean;\n\t\ttracks: Array<Track | null>;\n\t\tplaying: boolean;\n\t\tplayingIndex: number;\n\t\tonPlay: (index: number) => void;\n\t\tonRemove: (index: number) => void;\n\t\tonStop: () => void;\n\t}) => (\n\t\t<>\n\t\t\t{tracks.map((track, index) => (\n\t\t\t\t<QueueItem\n\t\t\t\t\tkey={index}\n\t\t\t\t\tlocked={locked}\n\t\t\t\t\tplaying={playing && playingIndex === index}\n\t\t\t\t\ttrack={track}\n\t\t\t\t\tonPlay={() => onPlay(index)}\n\t\t\t\t\tonRemove={() => onRemove(index)}\n\t\t\t\t\tonStop={onStop}\n\t\t\t\t/>\n\t\t\t))}\n\t\t</>\n\t)\n);\n","import React, { useEffect, useState } from \"react\";\n//\nimport { QUEUE_PLAYER } from \"../../utils/player\";\nimport \"./Progress.scss\";\n\n// ------------------------------------------------------------------\n\nexport const Progress = () => {\n\tconst [value, setValue] = useState(0);\n\n\tuseEffect(() => {\n\t\tconst timer = setInterval(() => {\n\t\t\tsetValue(QUEUE_PLAYER.getPlayingTrackPercent());\n\t\t}, 250);\n\t\treturn () => {\n\t\t\tclearInterval(timer);\n\t\t};\n\t}, [setValue]);\n\n\treturn (\n\t\t<div className=\"Progress\">\n\t\t\t<progress max={100} value={value * 100} />\n\t\t</div>\n\t);\n};\n","import React, { useCallback } from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { useTranslation } from \"react-i18next\";\n//\nimport { IconButton } from \"../Common/IconButton\";\nimport { Progress } from \"./Progress\";\nimport { Dispatch } from \"../../actions\";\nimport { RootState } from \"../../reducers\";\nimport { isRoomLocked, isRoomPlaying } from \"../../selectors/room\";\nimport { lockRoom } from \"../../actions/room\";\nimport { clearQueue, moveBackward, moveForward } from \"../../actions/queue\";\nimport { stopPlayer, startPlayer } from \"../../actions/player\";\nimport { confirmModal } from \"../../actions/modals\";\nimport { openModal } from \"../../reducers/modals\";\nimport \"./Controls.scss\";\n\n// ------------------------------------------------------------------\n\nexport const Controls = () => {\n\tconst dispatch = useDispatch<Dispatch>();\n\tconst { t } = useTranslation();\n\tconst tracksCount = useSelector<RootState, number>(\n\t\tstate => state.room.medias.length\n\t);\n\tconst locked = useSelector<RootState, boolean>(isRoomLocked);\n\tconst playing = useSelector<RootState, boolean>(isRoomPlaying);\n\tconst onClear = useCallback(() => {\n\t\tdispatch(\n\t\t\tconfirmModal(t(\"rooms.confirm_clear\"), () => {\n\t\t\t\tdispatch(clearQueue());\n\t\t\t\tdispatch(stopPlayer());\n\t\t\t})\n\t\t);\n\t}, [dispatch, t]);\n\n\tconst onLock = useCallback(() => {\n\t\tdispatch(\n\t\t\tconfirmModal(t(\"rooms.confirm_lock\"), () => {\n\t\t\t\tdispatch(lockRoom());\n\t\t\t})\n\t\t);\n\t}, [dispatch, t]);\n\n\tconst onUnlock = useCallback(() => {\n\t\tdispatch(openModal({ type: \"UnlockRoom\", props: null }));\n\t}, [dispatch]);\n\n\tconst onMoveBackward = useCallback(() => dispatch(moveBackward()), [\n\t\tdispatch\n\t]);\n\n\tconst onMoveForward = useCallback(() => dispatch(moveForward()), [\n\t\tdispatch\n\t]);\n\n\tconst onPlay = useCallback(() => dispatch(startPlayer()), [dispatch]);\n\n\tconst onSearch = useCallback(\n\t\t() => dispatch(openModal({ type: \"Search\", props: null })),\n\t\t[dispatch]\n\t);\n\n\tconst onStop = useCallback(() => dispatch(stopPlayer()), [dispatch]);\n\n\treturn (\n\t\t<div className=\"Controls\">\n\t\t\t<div className=\"ControlsInner\">\n\t\t\t\t<div className=\"ControlsSet PlayerControlsSet\">\n\t\t\t\t\t<div className=\"Control\">\n\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\tdisabled={locked || tracksCount === 0}\n\t\t\t\t\t\t\ticon=\"step-backward\"\n\t\t\t\t\t\t\tonClick={onMoveBackward}\n\t\t\t\t\t\t\tsize=\"M\"\n\t\t\t\t\t\t\ttitle={t(\"player.backward\")}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className=\"Control\">\n\t\t\t\t\t\t{!playing ? (\n\t\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\t\tdisabled={locked || tracksCount === 0}\n\t\t\t\t\t\t\t\tonClick={onPlay}\n\t\t\t\t\t\t\t\ticon=\"play\"\n\t\t\t\t\t\t\t\tsize=\"L\"\n\t\t\t\t\t\t\t\ttitle={t(\"player.play\")}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\t\tdisabled={locked || tracksCount === 0}\n\t\t\t\t\t\t\t\tonClick={onStop}\n\t\t\t\t\t\t\t\ticon=\"pause\"\n\t\t\t\t\t\t\t\ttitle={t(\"player.stop\")}\n\t\t\t\t\t\t\t\tsize=\"L\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className=\"Control\">\n\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\tdisabled={locked || tracksCount === 0}\n\t\t\t\t\t\t\ticon=\"step-forward\"\n\t\t\t\t\t\t\tonClick={onMoveForward}\n\t\t\t\t\t\t\tsize=\"M\"\n\t\t\t\t\t\t\ttitle={t(\"player.forward\")}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<Progress />\n\t\t\t\t<div className=\"ControlsSet RoomControlsSet\">\n\t\t\t\t\t<div className=\"Control\">\n\t\t\t\t\t\t{locked ? (\n\t\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\t\ticon=\"lock\"\n\t\t\t\t\t\t\t\tonClick={onUnlock}\n\t\t\t\t\t\t\t\tsize=\"M\"\n\t\t\t\t\t\t\t\ttitle={t(\"rooms.locked\")}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\t\ticon=\"unlock\"\n\t\t\t\t\t\t\t\tonClick={onLock}\n\t\t\t\t\t\t\t\tsize=\"M\"\n\t\t\t\t\t\t\t\ttitle={t(\"rooms.unlocked\")}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className=\"Control\">\n\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\tonClick={onSearch}\n\t\t\t\t\t\t\ticon=\"search\"\n\t\t\t\t\t\t\ttitle={t(\"medias.search\")}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className=\"Control\">\n\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\tdisabled={locked || tracksCount === 0}\n\t\t\t\t\t\t\tonClick={onClear}\n\t\t\t\t\t\t\ticon=\"trash\"\n\t\t\t\t\t\t\ttitle={t(\"rooms.clear\")}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t);\n};\n","export const GRID_CELL_COUNT = 10;\nexport const GRID_CELL_UNIT_SIZE = 40;\n\n// ------------------------------------------------------------------\n\nexport type SeaBattleAssetPosition = { x: number; y: number };\n\nexport type SeaBattleAssetVisibility = \"hidden\" | \"visible\";\n\nexport type SeaBattleCellType = \"cell-selected\" | \"cell-selection\";\n\nexport type SeaBattleAssetType =\n\t| OrientedBoatType\n\t| SeaBattleCellType\n\t| SeaBattleHitType\n\t| SeaBattleWeaponType;\n\nexport type SeaBattleAssetData = {\n\tcolor?: string;\n\tposition: SeaBattleAssetPosition;\n\trotate?: string;\n\tvisibility?: SeaBattleAssetVisibility;\n};\n\n// ------------------------------------------------------------------\n\nexport type SeaBattleDirection = \"N\" | \"E\" | \"S\" | \"W\";\n\nexport type SeaBattleMovementType =\n\t| \"move-forward\"\n\t| \"move-backward\"\n\t| \"rotate-left\"\n\t| \"rotate-right\";\n\nexport type SeaBattleBoatStatus = \"ok\" | \"ko\";\n\nexport type SeaBattleBoatType = \"boat1\" | \"boat2\" | \"boat3\";\n\nexport type SeaBattleBoatData = SeaBattleAssetData & {\n\tdirection: SeaBattleDirection;\n\tstatus: SeaBattleBoatStatus;\n\ttype: SeaBattleBoatType;\n};\n\nexport type OrientedBoatType =\n\t| \"boat1-N\"\n\t| \"boat1-E\"\n\t| \"boat1-S\"\n\t| \"boat1-W\"\n\t| \"boat2-N\"\n\t| \"boat2-E\"\n\t| \"boat2-S\"\n\t| \"boat2-W\"\n\t| \"boat3-N\"\n\t| \"boat3-E\"\n\t| \"boat3-S\"\n\t| \"boat3-W\";\n\nexport const BoatsOffsetMappings = {\n\tboat1: { x: 6, y: 6 },\n\tboat2: { x: 6, y: 6 },\n\tboat3: { x: 6, y: 6 }\n};\n\n// ------------------------------------------------------------------\n\nexport type SeaBattleCellData = SeaBattleAssetData & {\n\ttype: SeaBattleCellType;\n};\n\n// ------------------------------------------------------------------\n\nexport type SeaBattleHitType = \"hitted1\" | \"hitted2\" | \"missed1\" | \"missed2\";\n\nexport type SeaBattleHitData = SeaBattleAssetData & { type: SeaBattleHitType };\n\nexport const HitsOffsetMappings = {\n\thitted1: { x: 10, y: 10 },\n\thitted2: { x: 10, y: 10 },\n\tmissed1: { x: 10, y: 10 },\n\tmissed2: { x: 10, y: 10 }\n};\n\n// ------------------------------------------------------------------\n\nexport type SeaBattleWeaponType = \"bullet1\" | \"bullet2\" | \"bullet3\" | \"mine\";\n\nexport type SeaBattleWeaponData = SeaBattleAssetData & {\n\ttype: SeaBattleWeaponType;\n};\n\nexport const WeaponsOffsetMappings = {\n\tbullet1: { x: 12, y: 16 },\n\tbullet2: { x: 12, y: 16 },\n\tbullet3: { x: 12, y: 16 },\n\tmine: { x: 12, y: 12 }\n};\n\n// ------------------------------------------------------------------\n\nexport type SeaBattlePlayerData = {\n\tfleet: SeaBattleBoatData[];\n\thits: SeaBattleHitData[];\n\tweapons: SeaBattleWeaponData[];\n};\n\n// ------------------------------------------------------------------\n\nexport type SeaBattleData = {\n\tplayers: { [id: string]: SeaBattlePlayerData };\n};\n\n// ------------------------------------------------------------------\n// ------------------------------------------------------------------\n// ------------------------------------------------------------------\n// ------------------------------------------------------------------\n\nexport const SeabattleBoatOrientationMappings: {\n\t[type: string]: { [direction: string]: OrientedBoatType };\n} = {\n\tboat1: {\n\t\tN: \"boat1-N\",\n\t\tE: \"boat1-E\",\n\t\tS: \"boat1-S\",\n\t\tW: \"boat1-W\"\n\t},\n\tboat2: {\n\t\tN: \"boat2-N\",\n\t\tE: \"boat2-E\",\n\t\tS: \"boat2-S\",\n\t\tW: \"boat2-W\"\n\t},\n\tboat3: {\n\t\tN: \"boat3-N\",\n\t\tE: \"boat3-E\",\n\t\tS: \"boat3-S\",\n\t\tW: \"boat3-W\"\n\t}\n};\n\nexport const SeabattleBoatRotationMappings: {\n\t[direction: string]: { [rotation: string]: SeaBattleDirection };\n} = {\n\tN: {\n\t\t\"rotate-left\": \"W\",\n\t\t\"rotate-right\": \"E\"\n\t},\n\tE: {\n\t\t\"rotate-left\": \"N\",\n\t\t\"rotate-right\": \"S\"\n\t},\n\tS: {\n\t\t\"rotate-left\": \"E\",\n\t\t\"rotate-right\": \"W\"\n\t},\n\tW: {\n\t\t\"rotate-left\": \"S\",\n\t\t\"rotate-right\": \"N\"\n\t}\n};\n\nexport const SeabattleBoatRotationTransformationMappings: {\n\t[type: string]: {\n\t\t[direction: string]: SeaBattleAssetPosition;\n\t};\n} = {\n\tboat1: {\n\t\tN: { x: 0, y: 0 },\n\t\tE: { x: 0, y: 0 },\n\t\tS: { x: 0, y: 0 },\n\t\tW: { x: 0, y: 0 }\n\t},\n\tboat2: {\n\t\tN: { x: 0, y: -1 },\n\t\tE: { x: 1, y: 0 },\n\t\tS: { x: 0, y: 1 },\n\t\tW: { x: -1, y: 0 }\n\t},\n\tboat3: {\n\t\tN: { x: 0, y: -2 },\n\t\tE: { x: 2, y: 0 },\n\t\tS: { x: 0, y: 2 },\n\t\tW: { x: -2, y: 0 }\n\t}\n};\n\nexport const SeabattleBoatTranslationMappings: {\n\t[direction: string]: { [rotation: string]: SeaBattleAssetPosition };\n} = {\n\tN: {\n\t\t\"move-forward\": { x: 0, y: -1 },\n\t\t\"move-backward\": { x: 0, y: 1 }\n\t},\n\tE: {\n\t\t\"move-forward\": { x: 1, y: 0 },\n\t\t\"move-backward\": { x: -1, y: 0 }\n\t},\n\tS: {\n\t\t\"move-forward\": { x: 0, y: 1 },\n\t\t\"move-backward\": { x: 0, y: -1 }\n\t},\n\tW: {\n\t\t\"move-forward\": { x: -1, y: 0 },\n\t\t\"move-backward\": { x: 1, y: 0 }\n\t}\n};\n\nexport const SeaBattleBoatLengthMappings = {\n\tboat1: 1,\n\tboat2: 2,\n\tboat3: 3\n};\n\nexport const SeaBattleMovementIconMappings = {\n\tN: {\n\t\tforward: \"arrow-up\",\n\t\tbackward: \"arrow-down\"\n\t},\n\tE: {\n\t\tforward: \"arrow-right\",\n\t\tbackward: \"arrow-left\"\n\t},\n\tS: {\n\t\tforward: \"arrow-down\",\n\t\tbackward: \"arrow-up\"\n\t},\n\tW: {\n\t\tforward: \"arrow-left\",\n\t\tbackward: \"arrow-right\"\n\t}\n};\n\n// ------------------------------------------------------------------\n// ------------------------------------------------------------------\n// ------------------------------------------------------------------\n// ------------------------------------------------------------------\n\nconst checkPositionInGrid = (\n\tgrid: number[][],\n\tposition: SeaBattleAssetPosition\n) => grid[position.y][position.x] === 0;\n\nconst checkPositionInZone = (position: SeaBattleAssetPosition) =>\n\tposition.x >= 0 &&\n\tposition.x < GRID_CELL_COUNT &&\n\tposition.y >= 0 &&\n\tposition.y < GRID_CELL_COUNT;\n\nconst checkZone = (\n\tboat: SeaBattleBoatData,\n\tnewPosition: SeaBattleAssetPosition,\n\tnewDirection: SeaBattleDirection\n) => {\n\tif (!checkPositionInZone(newPosition)) {\n\t\treturn false;\n\t}\n\tconst offset = SeaBattleBoatLengthMappings[boat.type] - 1;\n\tswitch (newDirection) {\n\t\tcase \"N\":\n\t\t\treturn checkPositionInZone({\n\t\t\t\tx: newPosition.x,\n\t\t\t\ty: newPosition.y - offset\n\t\t\t});\n\t\tcase \"E\":\n\t\t\treturn checkPositionInZone({\n\t\t\t\tx: newPosition.x + offset,\n\t\t\t\ty: newPosition.y\n\t\t\t});\n\t\tcase \"S\":\n\t\t\treturn checkPositionInZone({\n\t\t\t\tx: newPosition.x,\n\t\t\t\ty: newPosition.y + offset\n\t\t\t});\n\t\tcase \"W\":\n\t\t\treturn checkPositionInZone({\n\t\t\t\tx: newPosition.x - offset,\n\t\t\t\ty: newPosition.y\n\t\t\t});\n\t}\n};\n\nconst checkCollisions = (\n\tfleet: SeaBattleBoatData[],\n\tmovingBoat: SeaBattleBoatData,\n\tnewPosition: SeaBattleAssetPosition,\n\tnewDirection: SeaBattleDirection\n) => {\n\tconst grid = Array<number>(GRID_CELL_COUNT)\n\t\t.fill(0)\n\t\t.map(_ => Array<number>(GRID_CELL_COUNT).fill(0));\n\tfor (\n\t\tlet boatIndex = 0, boatCount = fleet.length;\n\t\tboatIndex < boatCount;\n\t\t++boatIndex\n\t) {\n\t\tconst boat = fleet[boatIndex];\n\t\tif (movingBoat === boat) {\n\t\t\tcontinue; // Ignore moving boat\n\t\t}\n\t\tswitch (boat.direction) {\n\t\t\tcase \"N\":\n\t\t\t\tfor (\n\t\t\t\t\tlet i = 0;\n\t\t\t\t\ti < SeaBattleBoatLengthMappings[boat.type];\n\t\t\t\t\t++i\n\t\t\t\t) {\n\t\t\t\t\tgrid[boat.position.y - i][boat.position.x] += 1;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase \"E\":\n\t\t\t\tfor (\n\t\t\t\t\tlet i = 0;\n\t\t\t\t\ti < SeaBattleBoatLengthMappings[boat.type];\n\t\t\t\t\t++i\n\t\t\t\t) {\n\t\t\t\t\tgrid[boat.position.y][boat.position.x + i] += 1;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase \"S\":\n\t\t\t\tfor (\n\t\t\t\t\tlet i = 0;\n\t\t\t\t\ti < SeaBattleBoatLengthMappings[boat.type];\n\t\t\t\t\t++i\n\t\t\t\t) {\n\t\t\t\t\tgrid[boat.position.y + i][boat.position.x] += 1;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase \"W\":\n\t\t\t\tfor (\n\t\t\t\t\tlet i = 0;\n\t\t\t\t\ti < SeaBattleBoatLengthMappings[boat.type];\n\t\t\t\t\t++i\n\t\t\t\t) {\n\t\t\t\t\tgrid[boat.position.y][boat.position.x - i] += 1;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\t// console.debug(\"[Seabattle] Collision grid\", grid);\n\n\tif (!checkPositionInGrid(grid, newPosition)) {\n\t\treturn false;\n\t}\n\tswitch (newDirection) {\n\t\tcase \"N\":\n\t\t\tfor (\n\t\t\t\tlet i = 0;\n\t\t\t\ti < SeaBattleBoatLengthMappings[movingBoat.type];\n\t\t\t\t++i\n\t\t\t) {\n\t\t\t\tif (\n\t\t\t\t\t!checkPositionInGrid(grid, {\n\t\t\t\t\t\tx: newPosition.x,\n\t\t\t\t\t\ty: newPosition.y - i\n\t\t\t\t\t})\n\t\t\t\t) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t\tbreak;\n\t\tcase \"E\":\n\t\t\tfor (\n\t\t\t\tlet i = 0;\n\t\t\t\ti < SeaBattleBoatLengthMappings[movingBoat.type];\n\t\t\t\t++i\n\t\t\t) {\n\t\t\t\tif (\n\t\t\t\t\t!checkPositionInGrid(grid, {\n\t\t\t\t\t\tx: newPosition.x + i,\n\t\t\t\t\t\ty: newPosition.y\n\t\t\t\t\t})\n\t\t\t\t) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t\tbreak;\n\t\tcase \"S\":\n\t\t\tfor (\n\t\t\t\tlet i = 0;\n\t\t\t\ti < SeaBattleBoatLengthMappings[movingBoat.type];\n\t\t\t\t++i\n\t\t\t) {\n\t\t\t\tif (\n\t\t\t\t\t!checkPositionInGrid(grid, {\n\t\t\t\t\t\tx: newPosition.x,\n\t\t\t\t\t\ty: newPosition.y + i\n\t\t\t\t\t})\n\t\t\t\t) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t\tbreak;\n\t\tcase \"W\":\n\t\t\tfor (\n\t\t\t\tlet i = 0;\n\t\t\t\ti < SeaBattleBoatLengthMappings[movingBoat.type];\n\t\t\t\t++i\n\t\t\t) {\n\t\t\t\tif (\n\t\t\t\t\t!checkPositionInGrid(grid, {\n\t\t\t\t\t\tx: newPosition.x - i,\n\t\t\t\t\t\ty: newPosition.y\n\t\t\t\t\t})\n\t\t\t\t) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t\tbreak;\n\t}\n\treturn true;\n};\n\nexport const movementIsPossible = (\n\tfleet: SeaBattleBoatData[],\n\tmovingBoatIndex: number,\n\tnewPosition: SeaBattleAssetPosition,\n\tnewDirection: SeaBattleDirection\n) => {\n\tconst movingBoat = fleet[movingBoatIndex];\n\tif (!checkZone(movingBoat, newPosition, newDirection)) {\n\t\tconsole.debug(\"[Seabattle] Boat blocked by zone\");\n\t\treturn false;\n\t}\n\tif (!checkCollisions(fleet, movingBoat, newPosition, newDirection)) {\n\t\tconsole.debug(\"[Seabattle] Boat blocked by collision\");\n\t\treturn false;\n\t}\n\treturn true;\n};\n","import React, { useCallback } from \"react\";\n//\nimport { IconButton } from \"../Common/IconButton\";\nimport {\n\tSeaBattleBoatData,\n\tSeaBattleMovementIconMappings\n} from \"../../utils/games/seabattle\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { moveForward } from \"../../actions/queue\";\nimport { Dispatch } from \"../../actions\";\nimport { useTranslation } from \"react-i18next\";\nimport { RootState } from \"../../reducers\";\n\n// ------------------------------------------------------------------\n\nexport const FleetControls = ({\n\tboat,\n\tdisabled = false,\n\tonMoveBackward,\n\tonMoveForward,\n\tonRotateLeft,\n\tonRotateRight\n}: {\n\tboat?: SeaBattleBoatData;\n\tdisabled?: boolean;\n\tonMoveBackward: () => void;\n\tonMoveForward: () => void;\n\tonRotateLeft: () => void;\n\tonRotateRight: () => void;\n}) => {\n\tconst { t } = useTranslation();\n\tconst dispatch = useDispatch<Dispatch>();\n\tconst tracksCount = useSelector<RootState, number>(\n\t\tstate => state.room.medias.length\n\t);\n\n\tconst nextTrack = useCallback(() => dispatch(moveForward()), [dispatch]);\n\n\treturn (\n\t\t<div className=\"SeaBattleControls\">\n\t\t\t<IconButton\n\t\t\t\tdisabled={disabled}\n\t\t\t\ticon=\"rotate-left\"\n\t\t\t\ttitle=\"Rotate Left\"\n\t\t\t\tonClick={onRotateLeft}\n\t\t\t/>\n\t\t\t<IconButton\n\t\t\t\tdisabled={disabled}\n\t\t\t\ticon={\n\t\t\t\t\tboat?.direction\n\t\t\t\t\t\t? SeaBattleMovementIconMappings[boat.direction].backward\n\t\t\t\t\t\t: \"arrow-down\"\n\t\t\t\t}\n\t\t\t\ttitle=\"Move Backward\"\n\t\t\t\tonClick={onMoveBackward}\n\t\t\t/>\n\t\t\t<IconButton\n\t\t\t\tdisabled={tracksCount === 0}\n\t\t\t\ticon=\"step-forward\"\n\t\t\t\tonClick={nextTrack}\n\t\t\t\tsize=\"M\"\n\t\t\t\ttitle={t(\"player.forward\")}\n\t\t\t/>\n\t\t\t<IconButton\n\t\t\t\tdisabled={disabled}\n\t\t\t\ticon={\n\t\t\t\t\tboat?.direction\n\t\t\t\t\t\t? SeaBattleMovementIconMappings[boat.direction].forward\n\t\t\t\t\t\t: \"arrow-up\"\n\t\t\t\t}\n\t\t\t\ttitle=\"Move Forward\"\n\t\t\t\tonClick={onMoveForward}\n\t\t\t/>\n\t\t\t<IconButton\n\t\t\t\tdisabled={disabled}\n\t\t\t\ticon=\"rotate-right\"\n\t\t\t\ttitle=\"Rotate Right\"\n\t\t\t\tonClick={onRotateRight}\n\t\t\t/>\n\t\t</div>\n\t);\n};\n","import React from \"react\";\nimport {\n\tSeaBattleAssetData,\n\tSeaBattleAssetType,\n\tSeaBattleCellData\n} from \"../../utils/games/seabattle\";\n\n// ------------------------------------------------------------------\n\nexport const Asset = ({\n\tdata: { color, position, rotate, visibility },\n\tclassName,\n\tonClick,\n\tstopPropagation = false,\n\ttype\n}: {\n\tclassName?: string;\n\tdata: SeaBattleAssetData;\n\tonClick?: () => void;\n\tstopPropagation?: boolean;\n\ttype: SeaBattleAssetType;\n}) => (\n\t<use\n\t\tonClick={e => {\n\t\t\tif (stopPropagation) {\n\t\t\t\te.stopPropagation();\n\t\t\t}\n\t\t\tif (onClick) {\n\t\t\t\tonClick();\n\t\t\t}\n\t\t}}\n\t\tclassName={className}\n\t\thref={`#${type}`}\n\t\trotate={rotate}\n\t\tfill={color}\n\t\tvisibility={visibility}\n\t\t{...position}\n\t/>\n);\n\n// ------------------------------------------------------------------\n\nexport const Cell = ({ type, ...asset }: SeaBattleCellData) => (\n\t<Asset className=\"SeaBattleCell\" type={type} data={asset} />\n);\n","import React from \"react\";\n//\nimport { Asset } from \"./Assets\";\nimport {\n\tSeaBattleWeaponData,\n\tWeaponsOffsetMappings,\n\tGRID_CELL_UNIT_SIZE\n} from \"../../utils/games/seabattle\";\n\n// ------------------------------------------------------------------\n\nexport const Weapon = ({ type, ...asset }: SeaBattleWeaponData) => (\n\t<Asset\n\t\tclassName=\"SeaBattleWeapon\"\n\t\ttype={type}\n\t\tdata={{\n\t\t\t...asset,\n\t\t\tposition: {\n\t\t\t\tx:\n\t\t\t\t\tWeaponsOffsetMappings[type].x +\n\t\t\t\t\tasset.position.x * GRID_CELL_UNIT_SIZE,\n\t\t\t\ty:\n\t\t\t\t\tWeaponsOffsetMappings[type].y +\n\t\t\t\t\tasset.position.y * GRID_CELL_UNIT_SIZE\n\t\t\t}\n\t\t}}\n\t/>\n);\n// ------------------------------------------------------------------\n\nexport const Weapons = ({ weapons }: { weapons: SeaBattleWeaponData[] }) => {\n\treturn (\n\t\t<>\n\t\t\t{weapons.map((weapon, index) => (\n\t\t\t\t<Weapon key={index} {...weapon} />\n\t\t\t))}\n\t\t</>\n\t);\n};\n","import React from \"react\";\n//\nimport { Asset } from \"./Assets\";\nimport {\n\tSeaBattleHitData,\n\tGRID_CELL_UNIT_SIZE,\n\tHitsOffsetMappings\n} from \"../../utils/games/seabattle\";\n\n// ------------------------------------------------------------------\n\nexport const Hit = ({ type, ...asset }: SeaBattleHitData) => (\n\t<Asset\n\t\tclassName=\"SeaBattleHit\"\n\t\ttype={type}\n\t\tdata={{\n\t\t\t...asset,\n\t\t\tposition: {\n\t\t\t\tx:\n\t\t\t\t\tHitsOffsetMappings[type].x +\n\t\t\t\t\tasset.position.x * GRID_CELL_UNIT_SIZE,\n\t\t\t\ty:\n\t\t\t\t\tHitsOffsetMappings[type].y +\n\t\t\t\t\tasset.position.y * GRID_CELL_UNIT_SIZE\n\t\t\t}\n\t\t}}\n\t/>\n);\n\n// ------------------------------------------------------------------\n\nexport const Hits = ({ hits }: { hits: SeaBattleHitData[] }) => {\n\treturn (\n\t\t<>\n\t\t\t{hits.map((hit, index) => (\n\t\t\t\t<Hit key={index} {...hit} />\n\t\t\t))}\n\t\t</>\n\t);\n};\n","import React from \"react\";\nimport classNames from \"classnames\";\n//\nimport { Asset } from \"./Assets\";\nimport {\n\tSeaBattleBoatData,\n\tSeabattleBoatOrientationMappings,\n\tGRID_CELL_UNIT_SIZE,\n\tBoatsOffsetMappings\n} from \"../../utils/games/seabattle\";\n\n// ------------------------------------------------------------------\n\nexport const Boat = ({\n\tboat: { direction = \"E\", type, status = \"ok\", ...asset },\n\tonClick,\n\tselected\n}: {\n\tboat: SeaBattleBoatData;\n\tonClick?: () => void;\n\tselected: boolean;\n}) => (\n\t<Asset\n\t\tclassName={classNames(\"SeaBattleBoat\", status, {\n\t\t\tclickable: !!onClick,\n\t\t\tselected\n\t\t})}\n\t\tonClick={onClick}\n\t\tstopPropagation={true}\n\t\tdata={{\n\t\t\t...asset,\n\t\t\tposition: {\n\t\t\t\tx:\n\t\t\t\t\tBoatsOffsetMappings[type].x +\n\t\t\t\t\tasset.position.x * GRID_CELL_UNIT_SIZE,\n\t\t\t\ty:\n\t\t\t\t\tBoatsOffsetMappings[type].y +\n\t\t\t\t\tasset.position.y * GRID_CELL_UNIT_SIZE\n\t\t\t}\n\t\t}}\n\t\ttype={SeabattleBoatOrientationMappings[type][direction]}\n\t/>\n);\n","import React from \"react\";\n//\nimport { Boat } from \"./Boats\";\nimport { SeaBattleBoatData } from \"../../utils/games/seabattle\";\n\n// ------------------------------------------------------------------\n\nexport const Fleet = ({\n\tfleet,\n\thideActiveFleet,\n\tselectedBoat,\n\tsetSelectedBoat\n}: {\n\tfleet: SeaBattleBoatData[];\n\thideActiveFleet?: boolean;\n\tselectedBoat?: number;\n\tsetSelectedBoat?: (index: number) => void;\n}) => {\n\treturn (\n\t\t<>\n\t\t\t{fleet\n\t\t\t\t.filter(boat => !hideActiveFleet || boat.status === \"ko\")\n\t\t\t\t.map((boat, index) => (\n\t\t\t\t\t<Boat\n\t\t\t\t\t\tkey={index}\n\t\t\t\t\t\tboat={boat}\n\t\t\t\t\t\tonClick={\n\t\t\t\t\t\t\tsetSelectedBoat && boat.status === \"ok\"\n\t\t\t\t\t\t\t\t? () => {\n\t\t\t\t\t\t\t\t\t\tsetSelectedBoat(\n\t\t\t\t\t\t\t\t\t\t\tindex === selectedBoat ? -1 : index\n\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t  }\n\t\t\t\t\t\t\t\t: void 0\n\t\t\t\t\t\t}\n\t\t\t\t\t\tselected={selectedBoat === index}\n\t\t\t\t\t/>\n\t\t\t\t))}\n\t\t</>\n\t);\n};\n","import React from \"react\";\nimport { GRID_CELL_UNIT_SIZE } from \"../../utils/games/seabattle\";\n\n// ------------------------------------------------------------------\n\nconst SEA_COLOR1 = \"#a6dbf8\";\nconst SEA_COLOR2 = \"#50a3db\";\n\n// ------------------------------------------------------------------\n\nexport const BattleAssets = () => (\n\t<defs>\n\t\t<circle id=\"missed1\" cx=\"10\" cy=\"10\" r=\"8\" fill=\"#fff\" />\n\t\t<circle id=\"missed2\" cx=\"10\" cy=\"10\" r=\"8\" fill=\"#fff7\" />\n\t\t<circle id=\"hitted1\" cx=\"10\" cy=\"10\" r=\"8\" fill=\"#ffcf02\" />\n\t\t<circle id=\"hitted2\" cx=\"10\" cy=\"10\" r=\"8\" fill=\"#e52524\" />\n\t\t<path id=\"cell\" d=\"M0,0V40H40V0ZM36,36H4V4H36Z\" />\n\t\t<use id=\"cell-selected\" href=\"#cell\" fill=\"#FF0\" />\n\t\t<use id=\"cell-selection\" href=\"#cell\" fill=\"#555\" />\n\t\t<path\n\t\t\tid=\"bullet1\"\n\t\t\td=\"M16,4C16,8.46,0,8,0,8V0S16-.46,16,4Z\"\n\t\t\tfill=\"#afafaf\"\n\t\t/>\n\t\t<path\n\t\t\tid=\"bullet2\"\n\t\t\td=\"M16,4C16,8.46,0,8,0,8V0S16-.46,16,4Z\"\n\t\t\tfill=\"#676766\"\n\t\t/>\n\t\t<path\n\t\t\tid=\"bullet3\"\n\t\t\td=\"M16,4C16,8.46,0,8,0,8V0S16-.46,16,4Z\"\n\t\t\tfill=\"#000000\"\n\t\t/>\n\t\t<path\n\t\t\tid=\"mine\"\n\t\t\td=\"M16,9V7H13.77a5.92,5.92,0,0,0-1-2.41L14.35,3,13,1.65,11.39,3.23A5.92,5.92,0,0,0,9,2.23V0H7V2.23a5.92,5.92,0,0,0-2.41,1L3,1.65,1.65,3,3.23,4.61A5.92,5.92,0,0,0,2.23,7H0V9H2.23a5.92,5.92,0,0,0,1,2.41L1.65,13,3,14.35l1.58-1.58a5.92,5.92,0,0,0,2.41,1V16H9V13.77a5.92,5.92,0,0,0,2.41-1L13,14.35,14.35,13l-1.58-1.58a5.92,5.92,0,0,0,1-2.41Z\"\n\t\t\tfill=\"#000000\"\n\t\t/>\n\t\t<path id=\"boat1\" d=\"M28,14C28,19,14,28,14,28H0V0H14S28,9.05,28,14Z\" />\n\t\t<use id=\"boat1-E\" href=\"#boat1\" />\n\t\t<use id=\"boat1-N\" href=\"#boat1\" transform=\"rotate(-90, 14, 14)\" />\n\t\t<use id=\"boat1-S\" href=\"#boat1\" transform=\"rotate(90, 14, 14)\" />\n\t\t<use id=\"boat1-W\" href=\"#boat1\" transform=\"rotate(180, 14, 14)\" />\n\t\t<path\n\t\t\tid=\"boat2\"\n\t\t\td=\"M68,14C68,19,51.89,28,51.89,28H0V0H51.89S68,9.05,68,14Z\"\n\t\t/>\n\t\t<use id=\"boat2-E\" href=\"#boat2\" />\n\t\t<use id=\"boat2-N\" href=\"#boat2\" transform=\"rotate(-90, 14, 14)\" />\n\t\t<use id=\"boat2-S\" href=\"#boat2\" transform=\"rotate(90, 14, 14)\" />\n\t\t<use id=\"boat2-W\" href=\"#boat2\" transform=\"rotate(180, 14, 14)\" />\n\t\t<path\n\t\t\tid=\"boat3\"\n\t\t\td=\"M108,14C108,19,91.24,28,91.24,28H0V0H91.24S108,9.05,108,14Z\"\n\t\t/>\n\t\t<use id=\"boat3-E\" href=\"#boat3\" />\n\t\t<use id=\"boat3-N\" href=\"#boat3\" transform=\"rotate(-90, 14, 14)\" />\n\t\t<use id=\"boat3-S\" href=\"#boat3\" transform=\"rotate(90, 14, 14)\" />\n\t\t<use id=\"boat3-W\" href=\"#boat3\" transform=\"rotate(180, 14, 14)\" />\n\t\t<pattern\n\t\t\tid=\"sea-grid\"\n\t\t\twidth=\"80\"\n\t\t\theight=\"80\"\n\t\t\tpatternUnits=\"userSpaceOnUse\">\n\t\t\t<g>\n\t\t\t\t<rect\n\t\t\t\t\twidth={GRID_CELL_UNIT_SIZE}\n\t\t\t\t\theight={GRID_CELL_UNIT_SIZE}\n\t\t\t\t\tfill={SEA_COLOR1}\n\t\t\t\t\tx=\"0\"\n\t\t\t\t\ty=\"0\"\n\t\t\t\t/>\n\t\t\t\t<rect\n\t\t\t\t\twidth={GRID_CELL_UNIT_SIZE}\n\t\t\t\t\theight={GRID_CELL_UNIT_SIZE}\n\t\t\t\t\tfill={SEA_COLOR2}\n\t\t\t\t\tx={GRID_CELL_UNIT_SIZE}\n\t\t\t\t\ty=\"0\"\n\t\t\t\t/>\n\t\t\t\t<rect\n\t\t\t\t\twidth={GRID_CELL_UNIT_SIZE}\n\t\t\t\t\theight={GRID_CELL_UNIT_SIZE}\n\t\t\t\t\tfill={SEA_COLOR2}\n\t\t\t\t\tx=\"0\"\n\t\t\t\t\ty={GRID_CELL_UNIT_SIZE}\n\t\t\t\t/>\n\t\t\t\t<rect\n\t\t\t\t\twidth={GRID_CELL_UNIT_SIZE}\n\t\t\t\t\theight={GRID_CELL_UNIT_SIZE}\n\t\t\t\t\tfill={SEA_COLOR1}\n\t\t\t\t\tx={GRID_CELL_UNIT_SIZE}\n\t\t\t\t\ty={GRID_CELL_UNIT_SIZE}\n\t\t\t\t/>\n\t\t\t</g>\n\t\t</pattern>\n\t</defs>\n);\n","export const getSVGPosition = (\n\tsvg: SVGSVGElement,\n\t{ x, y }: { x: number; y: number }\n) => {\n\tvar pt = svg.createSVGPoint();\n\tpt.x = x;\n\tpt.y = y;\n\tpt = pt.matrixTransform(svg.getScreenCTM()!.inverse());\n\treturn { tx: pt.x, ty: pt.y };\n};\n","import React, { useCallback, useRef, useState } from \"react\";\nimport { Cell } from \"./Assets\";\nimport { Weapons } from \"./Weapons\";\nimport { Hits } from \"./Hits\";\nimport { Fleet } from \"./Fleet\";\nimport {\n\tSeaBattleAssetPosition,\n\tSeaBattlePlayerData,\n\tSeaBattleAssetVisibility,\n\tGRID_CELL_UNIT_SIZE\n} from \"../../utils/games/seabattle\";\nimport { BattleAssets } from \"./BattleAssets\";\nimport { getSVGPosition } from \"../../utils/svg\";\n\n// ------------------------------------------------------------------\n\n// Order is important : Weapons under Boats under Hits\nexport const Map = ({\n\thideActiveFleet = false,\n\tplayer: { fleet, hits, weapons },\n\tselectedBoat,\n\tsetSelectedBoat\n}: {\n\thideActiveFleet?: boolean;\n\tplayer: SeaBattlePlayerData;\n\tselectedBoat?: number;\n\tsetSelectedBoat?: (index: number) => void;\n}) => {\n\tconst svg = useRef<SVGSVGElement>(null);\n\tconst [selectedPosition, setSelectedPosition] = useState<\n\t\tSeaBattleAssetPosition\n\t>({\n\t\tx: 0,\n\t\ty: 0\n\t});\n\tconst [selectedVisibility, setSelectedVisibility] = useState<\n\t\tSeaBattleAssetVisibility\n\t>(\"hidden\");\n\tconst [selectionPosition, setSelectionPosition] = useState<\n\t\tSeaBattleAssetPosition\n\t>({\n\t\tx: 0,\n\t\ty: 0\n\t});\n\tconst [selectionVisibility, setSelectionVisibility] = useState<\n\t\tSeaBattleAssetVisibility\n\t>(\"hidden\");\n\n\tconst onClick = useCallback((position: SeaBattleAssetPosition) => {\n\t\tconst { tx, ty } = getSVGPosition(svg.current!, position);\n\t\tsetSelectedPosition({\n\t\t\tx: Math.floor(tx / GRID_CELL_UNIT_SIZE) * GRID_CELL_UNIT_SIZE,\n\t\t\ty: Math.floor(ty / GRID_CELL_UNIT_SIZE) * GRID_CELL_UNIT_SIZE\n\t\t});\n\t\tsetSelectedVisibility(\"visible\");\n\t}, []);\n\n\tconst onLeave = useCallback(() => {\n\t\tsetSelectionVisibility(\"hidden\");\n\t}, []);\n\n\tconst onOver = useCallback((position: SeaBattleAssetPosition) => {\n\t\tconst { tx, ty } = getSVGPosition(svg.current!, position);\n\t\tsetSelectionPosition({\n\t\t\tx: Math.floor(tx / GRID_CELL_UNIT_SIZE) * GRID_CELL_UNIT_SIZE,\n\t\t\ty: Math.floor(ty / GRID_CELL_UNIT_SIZE) * GRID_CELL_UNIT_SIZE\n\t\t});\n\t\tsetSelectionVisibility(\"visible\");\n\t}, []);\n\n\treturn (\n\t\t<svg\n\t\t\tclassName=\"SeaBattleMap\"\n\t\t\tviewBox=\"0 0 400 400\"\n\t\t\tref={svg}\n\t\t\tonClick={e => onClick({ x: e.clientX, y: e.clientY })}\n\t\t\tonMouseLeave={onLeave}\n\t\t\tonMouseMove={e => onOver({ x: e.clientX, y: e.clientY })}>\n\t\t\t<BattleAssets />\n\t\t\t<rect width=\"400\" height=\"400\" fill=\"url(#sea-grid)\" />\n\t\t\t<Cell\n\t\t\t\ttype=\"cell-selection\"\n\t\t\t\tposition={selectionPosition}\n\t\t\t\tvisibility={selectionVisibility}\n\t\t\t/>\n\t\t\t<Cell\n\t\t\t\ttype=\"cell-selected\"\n\t\t\t\tposition={selectedPosition}\n\t\t\t\tvisibility={selectedVisibility}\n\t\t\t/>\n\t\t\t<Weapons weapons={weapons} />\n\t\t\t<Fleet\n\t\t\t\thideActiveFleet={hideActiveFleet}\n\t\t\t\tfleet={fleet}\n\t\t\t\tselectedBoat={selectedBoat}\n\t\t\t\tsetSelectedBoat={setSelectedBoat}\n\t\t\t/>\n\t\t\t<Hits hits={hits} />\n\t\t</svg>\n\t);\n};\n","import { Reducer } from \"redux\";\nimport { AxiosError } from \"axios\";\n//\nimport { createAction } from \"../../actions\";\nimport {\n\tSeaBattleData,\n\tSeaBattleAssetPosition,\n\tSeaBattleDirection\n} from \"../../utils/games/seabattle\";\n\n// ------------------------------------------------------------------\n\ntype SeabattleAction =\n\t| ReturnType<typeof fetching>\n\t| ReturnType<typeof success>\n\t| ReturnType<typeof error>\n\t| ReturnType<typeof reset>\n\t| ReturnType<typeof setBoatPosition>;\n\nexport const fetching = () => createAction(\"games/seabattle/FETCHING\");\nexport const success = () => createAction(\"games/seabattle/FETCHED\");\nexport const error = (error: AxiosError) =>\n\tcreateAction(\"games/seabattle/ERROR\", error);\nexport const reset = () => createAction(\"games/seabattle/RESET\", error);\nexport const setBoatPosition = ({\n\tplayerId,\n\tboatIndex,\n\tdirection,\n\tposition\n}: {\n\tplayerId: string;\n\tboatIndex: number;\n\tdirection: SeaBattleDirection;\n\tposition: SeaBattleAssetPosition;\n}) =>\n\tcreateAction(\"games/seabattle/SET_BOAT_POSITION\", {\n\t\tdirection,\n\t\tplayerId,\n\t\tboatIndex,\n\t\tposition\n\t});\n\n// ------------------------------------------------------------------\n\nexport type State = SeaBattleData & {\n\tfetching: boolean;\n\terror: null | AxiosError;\n};\n\nconst INITIAL_STATE: State = {\n\terror: null,\n\tfetching: false,\n\tplayers: {\n\t\tplayer1: {\n\t\t\tfleet: [\n\t\t\t\t{\n\t\t\t\t\ttype: \"boat1\",\n\t\t\t\t\tdirection: \"E\",\n\t\t\t\t\tposition: { x: 0, y: 0 },\n\t\t\t\t\tstatus: \"ok\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttype: \"boat1\",\n\t\t\t\t\tdirection: \"E\",\n\t\t\t\t\tposition: { x: 1, y: 0 },\n\t\t\t\t\tstatus: \"ko\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttype: \"boat2\",\n\t\t\t\t\tdirection: \"E\",\n\t\t\t\t\tposition: { x: 0, y: 1 },\n\t\t\t\t\tstatus: \"ok\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttype: \"boat2\",\n\t\t\t\t\tdirection: \"E\",\n\t\t\t\t\tposition: { x: 2, y: 1 },\n\t\t\t\t\tstatus: \"ko\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttype: \"boat3\",\n\t\t\t\t\tdirection: \"E\",\n\t\t\t\t\tposition: { x: 0, y: 2 },\n\t\t\t\t\tstatus: \"ok\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttype: \"boat3\",\n\t\t\t\t\tdirection: \"E\",\n\t\t\t\t\tposition: { x: 3, y: 2 },\n\t\t\t\t\tstatus: \"ko\"\n\t\t\t\t}\n\t\t\t],\n\t\t\thits: [\n\t\t\t\t{ position: { x: 0, y: 1 }, type: \"hitted1\" },\n\t\t\t\t{ position: { x: 0, y: 2 }, type: \"hitted2\" },\n\t\t\t\t{ position: { x: 0, y: 3 }, type: \"missed1\" },\n\t\t\t\t{ position: { x: 0, y: 4 }, type: \"missed2\" }\n\t\t\t],\n\t\t\tweapons: [{ position: { x: 0, y: 5 }, type: \"mine\" }]\n\t\t},\n\t\tplayer2: {\n\t\t\tfleet: [\n\t\t\t\t{\n\t\t\t\t\ttype: \"boat1\",\n\t\t\t\t\tdirection: \"E\",\n\t\t\t\t\tposition: { x: 0, y: 0 },\n\t\t\t\t\tstatus: \"ok\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttype: \"boat1\",\n\t\t\t\t\tdirection: \"E\",\n\t\t\t\t\tposition: { x: 1, y: 0 },\n\t\t\t\t\tstatus: \"ko\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttype: \"boat2\",\n\t\t\t\t\tdirection: \"E\",\n\t\t\t\t\tposition: { x: 0, y: 1 },\n\t\t\t\t\tstatus: \"ok\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttype: \"boat2\",\n\t\t\t\t\tdirection: \"E\",\n\t\t\t\t\tposition: { x: 2, y: 1 },\n\t\t\t\t\tstatus: \"ko\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttype: \"boat3\",\n\t\t\t\t\tdirection: \"E\",\n\t\t\t\t\tposition: { x: 0, y: 2 },\n\t\t\t\t\tstatus: \"ok\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttype: \"boat3\",\n\t\t\t\t\tdirection: \"E\",\n\t\t\t\t\tposition: { x: 3, y: 2 },\n\t\t\t\t\tstatus: \"ko\"\n\t\t\t\t}\n\t\t\t],\n\t\t\thits: [\n\t\t\t\t{ position: { x: 0, y: 1 }, type: \"hitted1\" },\n\t\t\t\t{ position: { x: 0, y: 2 }, type: \"hitted2\" },\n\t\t\t\t{ position: { x: 0, y: 3 }, type: \"missed1\" },\n\t\t\t\t{ position: { x: 0, y: 4 }, type: \"missed2\" }\n\t\t\t],\n\t\t\tweapons: [{ position: { x: 0, y: 5 }, type: \"mine\" }]\n\t\t}\n\t}\n};\n\n// ------------------------------------------------------------------\n\nexport const seabattleReducer: Reducer<State, SeabattleAction> = (\n\tstate = { ...INITIAL_STATE },\n\taction: SeabattleAction\n): State => {\n\tswitch (action.type) {\n\t\tcase \"games/seabattle/FETCHING\":\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tfetching: true,\n\t\t\t\terror: null\n\t\t\t};\n\t\tcase \"games/seabattle/FETCHED\": {\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tfetching: false,\n\t\t\t\terror: null\n\t\t\t};\n\t\t}\n\t\tcase \"games/seabattle/ERROR\":\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tfetching: false,\n\t\t\t\terror: action.payload\n\t\t\t};\n\t\tcase \"games/seabattle/SET_BOAT_POSITION\": {\n\t\t\tconst oldPlayer = state.players[action.payload.playerId];\n\t\t\tconst newPlayer = {\n\t\t\t\t...oldPlayer,\n\t\t\t\tfleet: [...oldPlayer.fleet]\n\t\t\t};\n\t\t\tnewPlayer.fleet[action.payload.boatIndex] = {\n\t\t\t\t...oldPlayer.fleet[action.payload.boatIndex],\n\t\t\t\tdirection: action.payload.direction,\n\t\t\t\tposition: action.payload.position\n\t\t\t};\n\t\t\tconst copy = {\n\t\t\t\t...state,\n\t\t\t\tplayers: {\n\t\t\t\t\t...state.players,\n\t\t\t\t\t[action.payload.playerId]: newPlayer\n\t\t\t\t}\n\t\t\t};\n\t\t\treturn copy;\n\t\t}\n\t\tcase \"games/seabattle/RESET\":\n\t\t\treturn INITIAL_STATE;\n\t\tdefault:\n\t\t\treturn state;\n\t}\n};\n","import { AsyncAction } from \"..\";\nimport { displayError } from \"../messages\";\nimport { extractErrorMessage } from \"../../utils/messages\";\nimport {\n\tSeaBattleMovementType,\n\tSeabattleBoatRotationMappings,\n\tSeabattleBoatTranslationMappings,\n\tSeabattleBoatRotationTransformationMappings,\n\tmovementIsPossible\n} from \"../../utils/games/seabattle\";\nimport { setBoatPosition } from \"../../reducers/games/seabattle\";\n\n// ------------------------------------------------------------------\n\nexport const moveBoat = ({\n\tplayerId,\n\tboatIndex,\n\tmovement\n}: {\n\tplayerId: string;\n\tboatIndex: number;\n\tmovement: SeaBattleMovementType;\n}): AsyncAction => async (dispatch, getState) => {\n\ttry {\n\t\tconst {\n\t\t\tgames: {\n\t\t\t\tseabattle: { players }\n\t\t\t}\n\t\t} = getState();\n\n\t\tconst { fleet } = players[playerId];\n\t\tif (boatIndex < 0 || boatIndex >= fleet.length) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst { direction: oldDirection, position: oldPosition, type } = fleet[\n\t\t\tboatIndex\n\t\t];\n\n\t\tlet newPosition = { ...oldPosition };\n\t\tif (movement === \"move-forward\" || movement === \"move-backward\") {\n\t\t\tnewPosition.x +=\n\t\t\t\tSeabattleBoatTranslationMappings[oldDirection][movement].x;\n\t\t\tnewPosition.y +=\n\t\t\t\tSeabattleBoatTranslationMappings[oldDirection][movement].y;\n\t\t}\n\n\t\tlet newDirection = oldDirection;\n\t\tif (movement === \"rotate-left\" || movement === \"rotate-right\") {\n\t\t\tnewDirection =\n\t\t\t\tSeabattleBoatRotationMappings[oldDirection][movement];\n\t\t\tnewPosition.x +=\n\t\t\t\tSeabattleBoatRotationTransformationMappings[type][\n\t\t\t\t\toldDirection\n\t\t\t\t].x;\n\t\t\tnewPosition.y +=\n\t\t\t\tSeabattleBoatRotationTransformationMappings[type][\n\t\t\t\t\toldDirection\n\t\t\t\t].y;\n\t\t}\n\n\t\tif (!movementIsPossible(fleet, boatIndex, newPosition, newDirection)) {\n\t\t\tconsole.debug(\"[SeaBattle] Movement is not possible...\", {\n\t\t\t\tplayerId,\n\t\t\t\tboatIndex,\n\t\t\t\tmovement,\n\t\t\t\toldDirection,\n\t\t\t\tnewDirection,\n\t\t\t\toldPosition,\n\t\t\t\tnewPosition\n\t\t\t});\n\t\t\tdispatch(displayError(\"games.seabattle.movement_is_not_possible\"));\n\t\t\treturn;\n\t\t}\n\n\t\tconsole.debug(\"[SeaBattle] Moving boat...\", {\n\t\t\tplayerId,\n\t\t\tboatIndex,\n\t\t\tmovement,\n\t\t\tnewDirection,\n\t\t\tnewPosition\n\t\t});\n\t\tdispatch(\n\t\t\tsetBoatPosition({\n\t\t\t\tplayerId,\n\t\t\t\tboatIndex,\n\t\t\t\tdirection: newDirection,\n\t\t\t\tposition: newPosition\n\t\t\t})\n\t\t);\n\t} catch (err) {\n\t\tdispatch(displayError(extractErrorMessage(err)));\n\t}\n};\n","import React, { useRef, useCallback, useState } from \"react\";\n//\nimport { IconButton } from \"../Common/IconButton\";\nimport { getSVGPosition } from \"../../utils/svg\";\nimport {\n\tSeaBattleAssetVisibility,\n\tSeaBattleAssetPosition,\n\tGRID_CELL_UNIT_SIZE,\n\tSeaBattleWeaponData\n} from \"../../utils/games/seabattle\";\nimport { BattleAssets } from \"./BattleAssets\";\nimport { Cell } from \"./Assets\";\nimport { Weapons } from \"./Weapons\";\n\n// ------------------------------------------------------------------\n\nexport const WeaponControls = ({ disabled = true }: { disabled?: boolean }) => {\n\tconst svg = useRef<SVGSVGElement>(null);\n\tconst [selectedPosition, setSelectedPosition] = useState<\n\t\tSeaBattleAssetPosition\n\t>({\n\t\tx: 0,\n\t\ty: 0\n\t});\n\tconst [selectedVisibility, setSelectedVisibility] = useState<\n\t\tSeaBattleAssetVisibility\n\t>(\"hidden\");\n\tconst [selectionPos, setSelectionPosition] = useState<\n\t\tSeaBattleAssetPosition\n\t>({\n\t\tx: 0,\n\t\ty: 0\n\t});\n\tconst [selectionVisibility, setSelectionVisibility] = useState<\n\t\tSeaBattleAssetVisibility\n\t>(\"hidden\");\n\n\tconst onClick = useCallback((position: SeaBattleAssetPosition) => {\n\t\tconst { tx, ty } = getSVGPosition(svg.current!, position);\n\t\tsetSelectedPosition({\n\t\t\tx: Math.floor(tx / GRID_CELL_UNIT_SIZE) * GRID_CELL_UNIT_SIZE,\n\t\t\ty: Math.floor(ty / GRID_CELL_UNIT_SIZE) * GRID_CELL_UNIT_SIZE\n\t\t});\n\t\tsetSelectedVisibility(\"visible\");\n\t}, []);\n\n\tconst onOver = useCallback((position: SeaBattleAssetPosition) => {\n\t\tconst { tx, ty } = getSVGPosition(svg.current!, position);\n\t\tsetSelectionPosition({\n\t\t\tx: Math.floor(tx / GRID_CELL_UNIT_SIZE) * GRID_CELL_UNIT_SIZE,\n\t\t\ty: Math.floor(ty / GRID_CELL_UNIT_SIZE) * GRID_CELL_UNIT_SIZE\n\t\t});\n\t\tsetSelectionVisibility(\"visible\");\n\t}, []);\n\n\tconst onLeave = useCallback(() => {\n\t\tsetSelectionVisibility(\"hidden\");\n\t}, []);\n\n\tconst weapons: SeaBattleWeaponData[] = [\n\t\t{ position: { x: 0, y: 0 }, type: \"bullet1\" },\n\t\t{ position: { x: 1, y: 0 }, type: \"bullet2\" },\n\t\t{ position: { x: 2, y: 0 }, type: \"bullet3\" },\n\t\t{ position: { x: 3, y: 0 }, type: \"mine\" }\n\t];\n\n\treturn (\n\t\t<div className=\"SeaBattleControls\">\n\t\t\t<IconButton\n\t\t\t\tdisabled={true}\n\t\t\t\ticon=\"caret-up\"\n\t\t\t\ttitle=\"Previous enemy\"\n\t\t\t\tonClick={() => {}}\n\t\t\t/>\n\t\t\t<svg\n\t\t\t\tclassName=\"SeaBattleWeaponControls\"\n\t\t\t\tviewBox=\"0 0 160 40\"\n\t\t\t\tref={svg}\n\t\t\t\tonClick={e => onClick({ x: e.clientX, y: e.clientY })}\n\t\t\t\tonMouseLeave={onLeave}\n\t\t\t\tonMouseMove={e => onOver({ x: e.clientX, y: e.clientY })}>\n\t\t\t\t<BattleAssets />\n\t\t\t\t<rect width=\"400\" height=\"400\" fill=\"url(#sea-grid)\" />\n\t\t\t\t<Cell\n\t\t\t\t\ttype=\"cell-selection\"\n\t\t\t\t\tposition={selectionPos}\n\t\t\t\t\tvisibility={selectionVisibility}\n\t\t\t\t/>\n\t\t\t\t<Cell\n\t\t\t\t\ttype=\"cell-selected\"\n\t\t\t\t\tposition={selectedPosition}\n\t\t\t\t\tvisibility={selectedVisibility}\n\t\t\t\t/>\n\t\t\t\t<Weapons weapons={weapons} />\n\t\t\t</svg>\n\t\t\t<IconButton\n\t\t\t\tdisabled={true}\n\t\t\t\ticon=\"caret-down\"\n\t\t\t\ttitle=\"Next enemy\"\n\t\t\t\tonClick={() => {}}\n\t\t\t/>\n\t\t</div>\n\t);\n};\n","import React, { useState, useEffect, useCallback } from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\n//\nimport { FleetControls } from \"../../components/SeaBattle/FleetControls\";\nimport { Map } from \"../../components/SeaBattle/Map\";\nimport { RootState } from \"../../reducers\";\nimport { SeaBattlePlayerData } from \"../../utils/games/seabattle\";\nimport { Dispatch } from \"../../actions\";\nimport { moveBoat } from \"../../actions/games/seabattle\";\nimport { KEY_UP, KEY_DOWN, KEY_LEFT, KEY_RIGHT } from \"../../utils/keyboards\";\nimport { WeaponControls } from \"../../components/SeaBattle/WeaponsControls\";\nimport { startPlayer } from \"../../actions/player\";\nimport { setQueuePosition } from \"../../actions/queue\";\nimport { generateRandomPosition } from \"../../utils/player\";\nimport \"./SeaBattle.scss\";\nimport { selectTracksCount } from \"../../selectors/medias\";\n\n// ------------------------------------------------------------------\n\nexport const SeaBattle = () => {\n\tconst dispatch = useDispatch<Dispatch>();\n\tconst [selectedBoat1, setSelectedBoat1] = useState<number>(-1);\n\tconst [selectedBoat2, setSelectedBoat2] = useState<number>(-1);\n\n\tconst queueReady = useSelector<RootState, boolean>(\n\t\tstate => !!state.room.info\n\t);\n\n\tconst tracksCount = useSelector<RootState, number>(selectTracksCount);\n\n\tconst player1 = useSelector<RootState, SeaBattlePlayerData>(\n\t\tstate => state.games.seabattle.players.player1\n\t);\n\tconst player2 = useSelector<RootState, SeaBattlePlayerData>(\n\t\tstate => state.games.seabattle.players.player2\n\t);\n\n\tconst players: SeaBattlePlayerData[] = [player1, player2];\n\tconst selectedBoats: number[] = [selectedBoat1, selectedBoat2];\n\tconst setSelectedBoats: Array<(index: number) => void> = [\n\t\tsetSelectedBoat1,\n\t\tsetSelectedBoat2\n\t];\n\tconst activePlayer = 0;\n\n\tuseEffect(() => {\n\t\tif (queueReady && tracksCount > 0) {\n\t\t\tconst x = generateRandomPosition() % tracksCount;\n\t\t\tdispatch(setQueuePosition(x));\n\t\t\tdispatch(startPlayer());\n\t\t}\n\t}, [dispatch, queueReady, tracksCount]);\n\n\tconst moveForward = useCallback(() => {\n\t\tdispatch(\n\t\t\tmoveBoat({\n\t\t\t\tboatIndex: selectedBoats[activePlayer],\n\t\t\t\tplayerId: \"player1\",\n\t\t\t\tmovement: \"move-forward\"\n\t\t\t})\n\t\t);\n\t}, [dispatch, selectedBoats]);\n\n\tconst moveBackward = useCallback(() => {\n\t\tdispatch(\n\t\t\tmoveBoat({\n\t\t\t\tboatIndex: selectedBoats[activePlayer],\n\t\t\t\tplayerId: \"player1\",\n\t\t\t\tmovement: \"move-backward\"\n\t\t\t})\n\t\t);\n\t}, [dispatch, selectedBoats]);\n\n\tconst rotateLeft = useCallback(() => {\n\t\tdispatch(\n\t\t\tmoveBoat({\n\t\t\t\tboatIndex: selectedBoats[activePlayer],\n\t\t\t\tplayerId: \"player1\",\n\t\t\t\tmovement: \"rotate-left\"\n\t\t\t})\n\t\t);\n\t}, [dispatch, selectedBoats]);\n\n\tconst rotateRight = useCallback(() => {\n\t\tdispatch(\n\t\t\tmoveBoat({\n\t\t\t\tboatIndex: selectedBoats[activePlayer],\n\t\t\t\tplayerId: \"player1\",\n\t\t\t\tmovement: \"rotate-right\"\n\t\t\t})\n\t\t);\n\t}, [dispatch, selectedBoats]);\n\n\tconst onKeyDown = useCallback(\n\t\t(e: KeyboardEvent) => {\n\t\t\tif (\n\t\t\t\te.repeat ||\n\t\t\t\t(e.keyCode !== KEY_UP &&\n\t\t\t\t\te.keyCode !== KEY_DOWN &&\n\t\t\t\t\te.keyCode !== KEY_LEFT &&\n\t\t\t\t\te.keyCode !== KEY_RIGHT)\n\t\t\t) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\te.preventDefault(); // to prevent scrolling with keyboard\n\t\t\tconst player = players[activePlayer];\n\t\t\tif (!player) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst selectedBoatIndex = selectedBoats[activePlayer];\n\t\t\tif (selectedBoatIndex < 0) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst selectedBoat = player.fleet[selectedBoatIndex];\n\t\t\tconst MoveMappings: {\n\t\t\t\t[direction: string]: { [key: string]: () => void };\n\t\t\t} = {\n\t\t\t\tN: {\n\t\t\t\t\t[KEY_UP]: moveForward,\n\t\t\t\t\t[KEY_DOWN]: moveBackward,\n\t\t\t\t\t[KEY_LEFT]: rotateLeft,\n\t\t\t\t\t[KEY_RIGHT]: rotateRight\n\t\t\t\t},\n\t\t\t\tE: {\n\t\t\t\t\t[KEY_UP]: rotateLeft,\n\t\t\t\t\t[KEY_DOWN]: rotateRight,\n\t\t\t\t\t[KEY_LEFT]: moveBackward,\n\t\t\t\t\t[KEY_RIGHT]: moveForward\n\t\t\t\t},\n\t\t\t\tS: {\n\t\t\t\t\t[KEY_UP]: moveBackward,\n\t\t\t\t\t[KEY_DOWN]: moveForward,\n\t\t\t\t\t[KEY_LEFT]: rotateRight,\n\t\t\t\t\t[KEY_RIGHT]: rotateLeft\n\t\t\t\t},\n\t\t\t\tW: {\n\t\t\t\t\t[KEY_UP]: rotateRight,\n\t\t\t\t\t[KEY_DOWN]: rotateLeft,\n\t\t\t\t\t[KEY_LEFT]: moveForward,\n\t\t\t\t\t[KEY_RIGHT]: moveBackward\n\t\t\t\t}\n\t\t\t};\n\t\t\tconst move = MoveMappings[selectedBoat.direction][e.keyCode];\n\t\t\tif (move) {\n\t\t\t\tmove();\n\t\t\t}\n\t\t},\n\t\t[\n\t\t\tmoveForward,\n\t\t\tmoveBackward,\n\t\t\trotateLeft,\n\t\t\trotateRight,\n\t\t\tplayers,\n\t\t\tselectedBoats\n\t\t]\n\t);\n\n\tuseEffect(() => {\n\t\tdocument.addEventListener(\"keydown\", onKeyDown);\n\n\t\treturn () => {\n\t\t\tdocument.removeEventListener(\"keydown\", onKeyDown);\n\t\t};\n\t}, [onKeyDown]);\n\n\treturn (\n\t\t<div className=\"SeaBattle\">\n\t\t\t<div className=\"SeaBattlePlayer current\">\n\t\t\t\t<FleetControls\n\t\t\t\t\tboat={\n\t\t\t\t\t\tselectedBoats[activePlayer] >= 0\n\t\t\t\t\t\t\t? players[activePlayer].fleet[\n\t\t\t\t\t\t\t\t\tselectedBoats[activePlayer]\n\t\t\t\t\t\t\t  ]\n\t\t\t\t\t\t\t: void 0\n\t\t\t\t\t}\n\t\t\t\t\tdisabled={selectedBoats[activePlayer] < 0}\n\t\t\t\t\tonMoveForward={moveForward}\n\t\t\t\t\tonMoveBackward={moveBackward}\n\t\t\t\t\tonRotateLeft={rotateLeft}\n\t\t\t\t\tonRotateRight={rotateRight}\n\t\t\t\t/>\n\t\t\t\t<Map\n\t\t\t\t\tplayer={players[0]}\n\t\t\t\t\tselectedBoat={selectedBoats[0]}\n\t\t\t\t\tsetSelectedBoat={setSelectedBoats[0]}\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<div className=\"SeaBattlePlayer other\">\n\t\t\t\t<WeaponControls disabled={selectedBoats[activePlayer] < 0} />\n\t\t\t\t<Map player={players[1]} hideActiveFleet={true} />\n\t\t\t</div>\n\t\t</div>\n\t);\n};\n","export const KEY_UP = 38;\nexport const KEY_DOWN = 40;\nexport const KEY_LEFT = 37;\nexport const KEY_RIGHT = 39;\n","import React, { useEffect } from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { useLocation, useParams } from \"react-router-dom\";\nimport classNames from \"classnames\";\nimport qs from \"qs\";\n//\nimport { Head } from \"../components/Room/Head\";\nimport { Queue } from \"../components/Room/Queue\";\nimport { Controls } from \"../components/Room/Controls\";\nimport { RootState } from \"../reducers\";\nimport { CombinedColor } from \"../utils/colorpicker\";\nimport { exitRoom, enterRoom } from \"../actions/room\";\nimport { Dispatch } from \"../actions\";\nimport { RoomInfo } from \"../utils/rooms\";\nimport { SeaBattle } from \"./games/SeaBattle\";\nimport \"./Room.scss\";\n\n// ------------------------------------------------------------------\n\nexport const Room = () => {\n\tconst dispatch = useDispatch<Dispatch>();\n\tconst { fg, bg } = useSelector<RootState, CombinedColor>(\n\t\tstate => state.room.color\n\t);\n\tconst info = useSelector<RootState, RoomInfo | null>(\n\t\tstate => state.room.info\n\t);\n\n\tconst { search } = useLocation();\n\tconst { room_id } = useParams<{\n\t\troom_id: string;\n\t}>();\n\n\tconst { secret } = qs.parse(search.substr(1)) as {\n\t\tsecret?: string;\n\t};\n\n\tuseEffect(() => {\n\t\tdispatch(enterRoom(room_id, secret || \"\"));\n\n\t\treturn () => {\n\t\t\tdispatch(exitRoom());\n\t\t};\n\t}, [dispatch, room_id, secret]);\n\n\tuseEffect(() => {\n\t\tdocument.body.className = fg;\n\t\tdocument.body.style.backgroundColor = `rgb(${bg.r}, ${bg.g}, ${bg.b})`;\n\t}, [bg, fg]);\n\n\treturn (\n\t\t<div className={classNames(\"Room\")}>\n\t\t\t<Head />\n\t\t\t{(() => {\n\t\t\t\tif (!info) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\t\t\t\tswitch (info.type) {\n\t\t\t\t\tcase \"blind\":\n\t\t\t\t\t\treturn null;\n\t\t\t\t\tcase \"dj\":\n\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t<Queue />\n\t\t\t\t\t\t\t\t<Controls />\n\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t);\n\t\t\t\t\tcase \"seabattle\":\n\t\t\t\t\t\treturn <SeaBattle />;\n\t\t\t\t}\n\t\t\t})()}\n\t\t</div>\n\t);\n};\n","export type UserInfo = {\n\tname: string;\n\tonline: boolean;\n\troom_id: string;\n\tstatus: string;\n\ttimestamp: number;\n};\n\nexport type UserAccess = {\n\tid: string;\n\tsecret: string;\n};\n\n// ------------------------------------------------------------------\n\nexport const loadUserAccess = (): UserAccess => {\n\tconst res: UserAccess = {\n\t\tid: \"\",\n\t\tsecret: \"\"\n\t};\n\tconst s = localStorage.getItem(\"U\");\n\tif (s) {\n\t\ttry {\n\t\t\tconst d = JSON.parse(atob(s));\n\t\t\tif (typeof d.i === \"string\" && typeof d.s === \"string\") {\n\t\t\t\tres.id = d.i;\n\t\t\t\tres.secret = d.s;\n\t\t\t\tconsole.debug(\"Loaded user access: \", res);\n\t\t\t}\n\t\t} catch (err) {}\n\t}\n\treturn res;\n};\n\nexport const deleteUserAccess = () => {\n\tlocalStorage.removeItem(\"U\");\n};\n\nexport const saveUserAccess = ({ id, secret }: UserAccess) => {\n\tlocalStorage.setItem(\n\t\t\"U\",\n\t\tbtoa(\n\t\t\tJSON.stringify({\n\t\t\t\ti: id,\n\t\t\t\ts: secret\n\t\t\t})\n\t\t)\n\t);\n};\n","import { Reducer } from \"redux\";\nimport { AxiosError } from \"axios\";\nimport {\n\tdeleteUserAccess,\n\tsaveUserAccess,\n\tloadUserAccess,\n\tUserAccess,\n\tUserInfo\n} from \"../utils/users\";\nimport { FirebaseUser } from \"../utils/firebase\";\nimport { createAction } from \"../actions\";\n\n// ------------------------------------------------------------------\n\ntype UserAction =\n\t| ReturnType<typeof fetching>\n\t| ReturnType<typeof success>\n\t| ReturnType<typeof error>\n\t| ReturnType<typeof resetUser>\n\t| ReturnType<typeof setUser>;\n\nexport const fetching = () => createAction(\"user/FETCHING\");\nexport const success = () => createAction(\"user/FETCHED\");\nexport const error = (error: AxiosError) => createAction(\"user/ERROR\", error);\nexport const resetUser = () => createAction(\"user/RESET\");\nexport const setUser = (values: Partial<UserData>) =>\n\tcreateAction(\"user/SET\", values);\n\n// ------------------------------------------------------------------\n\nexport type UserData = {\n\tuser: ReturnType<typeof FirebaseUser> | null;\n\taccess: UserAccess;\n\tinfo: UserInfo | null;\n};\n\nexport type State = UserData & {\n\tfetching: boolean;\n\terror: null | AxiosError;\n};\n\nconst INITIAL_STATE: State = {\n\taccess: { id: \"\", secret: \"\" },\n\terror: null,\n\tfetching: false,\n\tinfo: null,\n\tuser: null\n};\n\n// ------------------------------------------------------------------\n\nexport const userReducer: Reducer<State, UserAction> = (\n\tstate = { ...INITIAL_STATE, access: loadUserAccess() },\n\taction: UserAction\n): State => {\n\tswitch (action.type) {\n\t\tcase \"user/FETCHING\":\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tfetching: true,\n\t\t\t\terror: null\n\t\t\t};\n\t\tcase \"user/FETCHED\": {\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tfetching: false,\n\t\t\t\terror: null\n\t\t\t};\n\t\t}\n\t\tcase \"user/ERROR\":\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tfetching: false,\n\t\t\t\terror: action.payload\n\t\t\t};\n\t\tcase \"user/SET\": {\n\t\t\tconst copy = {\n\t\t\t\t...state,\n\t\t\t\t...action.payload\n\t\t\t};\n\t\t\tsaveUserAccess(copy.access);\n\t\t\treturn copy;\n\t\t}\n\t\tcase \"user/RESET\":\n\t\t\tdeleteUserAccess();\n\t\t\treturn INITIAL_STATE;\n\t\tdefault:\n\t\t\treturn state;\n\t}\n};\n","import { v4 } from \"uuid\";\n//\nimport { AsyncAction } from \".\";\nimport { UserInfo } from \"../utils/users\";\nimport { FirebaseUser } from \"../utils/firebase\";\nimport { displayError } from \"./messages\";\nimport { extractErrorMessage } from \"../utils/messages\";\nimport { setUser, resetUser } from \"../reducers/user\";\n\n// ------------------------------------------------------------------\n\nexport const createUser = (\n\tname: string,\n\tsecret: string\n): AsyncAction => async dispatch => {\n\ttry {\n\t\tconsole.debug(\"[User] Creating...\");\n\t\tconst id = v4();\n\t\tawait FirebaseUser({ id, secret }).update({ name });\n\t\tdispatch(connectUser(id, secret));\n\t} catch (err) {\n\t\tdispatch(displayError(extractErrorMessage(err)));\n\t}\n};\n\n// ------------------------------------------------------------------\n\nlet FIREBASE_CB: any = null;\n\nexport const connectUser = (id: string, secret: string): AsyncAction => async (\n\tdispatch,\n\tgetState\n) => {\n\tconst {\n\t\tuser: { user }\n\t} = getState();\n\tif (user && user.id === id) {\n\t\t// Nothing to do\n\t\treturn;\n\t}\n\tdispatch(disconnectUser());\n\ttry {\n\t\tconsole.debug(\"[User] Connecting...\", { id, secret });\n\t\tconst newUser = FirebaseUser({ id, secret });\n\t\tdispatch(\n\t\t\tsetUser({\n\t\t\t\taccess: { id, secret },\n\t\t\t\tuser: newUser,\n\t\t\t\tinfo: await newUser.wait()\n\t\t\t})\n\t\t);\n\t\tFIREBASE_CB = newUser.subscribe(\n\t\t\t(snapshot: firebase.database.DataSnapshot) => {\n\t\t\t\tconst newInfo = snapshot.val() as UserInfo | null;\n\t\t\t\tconsole.debug(\"[User] Received user update...\", newInfo);\n\t\t\t\tdispatch(setUser({ user: newUser, info: newInfo }));\n\t\t\t}\n\t\t);\n\t} catch (err) {\n\t\tdispatch(displayError(extractErrorMessage(err)));\n\t\tdispatch(setUser({ access: { id, secret: \"\" } }));\n\t}\n};\n\nexport const disconnectUser = (): AsyncAction => async (dispatch, getState) => {\n\tconst {\n\t\tuser: {\n\t\t\taccess: { id, secret },\n\t\t\tuser\n\t\t}\n\t} = getState();\n\tif (!id && !secret && !user) {\n\t\t// Nothing to do\n\t\treturn;\n\t}\n\tconsole.debug(\"[User] Disconnecting...\");\n\tif (user) {\n\t\tuser.unsubscribe(FIREBASE_CB);\n\t\tFIREBASE_CB = null;\n\t}\n\tdispatch(resetUser());\n};\n\nexport const reconnectUser = (): AsyncAction => async (dispatch, getState) => {\n\tconst {\n\t\tuser: {\n\t\t\taccess: { id, secret }\n\t\t}\n\t} = getState();\n\tif (!id || !secret) {\n\t\t// Nothing to do\n\t\treturn;\n\t}\n\tconsole.debug(\"[User] Reconnecting...\", { id, secret });\n\tdispatch(connectUser(id, secret));\n};\n","import React, { useCallback } from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { Link } from \"react-router-dom\";\nimport { useTranslation } from \"react-i18next\";\n//\nimport { IconButton } from \"../components/Common/IconButton\";\nimport { RootState } from \"../reducers\";\nimport { openModal } from \"../reducers/modals\";\nimport { disconnectUser } from \"../actions/user\";\nimport \"./Splash.scss\";\n\n// ------------------------------------------------------------------\n\nexport const Splash = () => {\n\tconst dispatch = useDispatch();\n\tconst loggedIn = useSelector<RootState, boolean>(\n\t\tstate => !!state.user.access.id\n\t);\n\tconst { t } = useTranslation();\n\n\tconst onCreateRoom = useCallback(\n\t\t() => dispatch(openModal({ type: \"CreateRoom\", props: null })),\n\t\t[dispatch]\n\t);\n\n\tconst onConnectUser = useCallback(\n\t\t() => dispatch(openModal({ type: \"CreateUser\", props: null })),\n\t\t[dispatch]\n\t);\n\n\tconst onDisconnect = useCallback(() => dispatch(disconnectUser()), [\n\t\tdispatch\n\t]);\n\n\t/*\n\t<div className=\"PoweredWith\">\n\t\t<span>{t(\"splash.powered_with\")}</span>\n\t\t<a\n\t\t\thref=\"https://www.deezer.com\"\n\t\t\ttarget=\"_blank\"\n\t\t\trel=\"noopener noreferrer\">\n\t\t\t<img\n\t\t\t\tsrc=\"/images/deezer.svg\"\n\t\t\t\theight=\"20px\"\n\t\t\t\ttitle=\"Deezer\"\n\t\t\t\talt=\"Deezer Logo\"\n\t\t\t/>\n\t\t</a>\n\t</div>\n\t*/\n\n\treturn (\n\t\t<div className=\"Splash\">\n\t\t\t<div className=\"Top\">\n\t\t\t\t<div className=\"Logo\">\n\t\t\t\t\t<Link to=\"/\">Party</Link>\n\t\t\t\t</div>\n\t\t\t\t<div className=\"Description\">\n\t\t\t\t\t<span>{t(\"splash.description\")}</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div className=\"Middle\">\n\t\t\t\t<div className=\"Menu\">\n\t\t\t\t\t{loggedIn ? (\n\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t<div className=\"MenuItem\">\n\t\t\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\t\t\ticon=\"plus\"\n\t\t\t\t\t\t\t\t\tonClick={onCreateRoom}\n\t\t\t\t\t\t\t\t\tsize=\"L\"\n\t\t\t\t\t\t\t\t\ttitle={t(\"rooms.create\")}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</>\n\t\t\t\t\t) : (\n\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t<div className=\"MenuItem\">\n\t\t\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\t\t\tonClick={onConnectUser}\n\t\t\t\t\t\t\t\t\ticon=\"sign-in\"\n\t\t\t\t\t\t\t\t\tsize=\"L\"\n\t\t\t\t\t\t\t\t\ttitle={t(\"users.connect\")}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</>\n\t\t\t\t\t)}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div className=\"Bottom\">\n\t\t\t\t<div className=\"Menu\">\n\t\t\t\t\t{loggedIn ? (\n\t\t\t\t\t\t<div className=\"MenuItem\">\n\t\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\t\ticon=\"sign-out\"\n\t\t\t\t\t\t\t\tonClick={onDisconnect}\n\t\t\t\t\t\t\t\tsize=\"M\"\n\t\t\t\t\t\t\t\ttitle={t(\"users.disconnect\")}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t) : (\n\t\t\t\t\t\t<div className=\"MenuItem\">\n\t\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\t\ticon=\"info\"\n\t\t\t\t\t\t\t\tonClick={() => {}}\n\t\t\t\t\t\t\t\tsize=\"M\"\n\t\t\t\t\t\t\t\ttitle={t(\"splash.CGU\")}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t);\n};\n","import React, { FormEvent, ReactNode, useCallback } from \"react\";\nimport classNames from \"classnames\";\nimport { useTranslation } from \"react-i18next\";\n//\nimport { IconButton } from \"../Common/IconButton\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { RootState } from \"../../reducers\";\nimport { Dispatch } from \"../../actions\";\nimport { popModal, closeModal } from \"../../reducers/modals\";\n\n// ------------------------------------------------------------------\n\nexport const Modal = ({\n\tchildren,\n\tclassName,\n\ttitle,\n\trenderFoot,\n\tonSubmit\n}: {\n\tchildren: ReactNode;\n\tclassName?: string;\n\ttitle: string;\n\trenderFoot?: () => React.ReactNode;\n\tonSubmit?: () => void;\n}) => {\n\tconst dispatch = useDispatch<Dispatch>();\n\tconst { t } = useTranslation();\n\tconst has_prev_modal = useSelector<RootState, boolean>(\n\t\tstate => state.modals.stack.length > 1\n\t);\n\n\tconst onClose = useCallback(() => dispatch(closeModal()), [dispatch]);\n\tconst onPop = useCallback(() => dispatch(popModal()), [dispatch]);\n\n\treturn (\n\t\t<form\n\t\t\tclassName={classNames(\"Modal\", className)}\n\t\t\tonSubmit={(event: FormEvent<HTMLFormElement>) => {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tif (onSubmit) {\n\t\t\t\t\tonSubmit();\n\t\t\t\t}\n\t\t\t}}>\n\t\t\t<div className=\"ModalHead\">\n\t\t\t\t<IconButton\n\t\t\t\t\tkind=\"special\"\n\t\t\t\t\tclassName={classNames(\"ModalHeadBack\", {\n\t\t\t\t\t\thidden: !has_prev_modal\n\t\t\t\t\t})}\n\t\t\t\t\ticon=\"angle-left\"\n\t\t\t\t\ttitle=\"Back\"\n\t\t\t\t\tonClick={onPop}\n\t\t\t\t/>\n\t\t\t\t<div className=\"ModalTitle\">{title}</div>\n\t\t\t\t<IconButton\n\t\t\t\t\tkind=\"special\"\n\t\t\t\t\tclassName=\"ModalHeadClose\"\n\t\t\t\t\tonClick={onClose}\n\t\t\t\t\ttitle={t(\"cancel\")}\n\t\t\t\t\ticon=\"times\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<div className=\"ModalBody\">{children}</div>\n\t\t\t<div className=\"ModalFoot\">{renderFoot && renderFoot()}</div>\n\t\t</form>\n\t);\n};\n","import React, { ReactNode } from \"react\";\nimport classNames from \"classnames\";\n//\nimport { Modal } from \"./Modal\";\nimport \"./FormModal.scss\";\n\n// ------------------------------------------------------------------\n\nexport const FormModal = ({\n\tchildren,\n\tclassName,\n\trenderButtons,\n\ttitle,\n\tonSubmit\n}: {\n\tchildren: ReactNode;\n\tclassName?: string;\n\tonSubmit: () => void;\n\trenderButtons: () => React.ReactNode;\n\ttitle: string;\n}) => (\n\t<Modal\n\t\tclassName={classNames(\"FormModal\", className)}\n\t\ttitle={title}\n\t\trenderFoot={renderButtons}\n\t\tonSubmit={onSubmit}>\n\t\t{children}\n\t</Modal>\n);\n","import React from \"react\";\nimport { useTranslation } from \"react-i18next\";\n//\nimport { IconButton } from \"./IconButton\";\n\n// ------------------------------------------------------------------\n\nexport const CancelButton = ({ onClick }: { onClick: () => void }) => {\n\tconst { t } = useTranslation();\n\treturn (\n\t\t<IconButton\n\t\t\tonClick={onClick}\n\t\t\ttitle={t(\"cancel\")}\n\t\t\tkind=\"default\"\n\t\t\ticon=\"ban\"\n\t\t/>\n\t);\n};\n","import React, { useCallback } from \"react\";\nimport { useTranslation } from \"react-i18next\";\n//\nimport { FormModal } from \"../Modals/FormModal\";\nimport { IconButton } from \"../Common/IconButton\";\nimport { CancelButton } from \"../Common/CancelButton\";\nimport { useDispatch } from \"react-redux\";\nimport { Dispatch } from \"../../actions\";\nimport { popModal } from \"../../reducers/modals\";\n\n// ------------------------------------------------------------------\n\nexport const ConfirmModal = ({\n\tquestion,\n\tonCanceled,\n\tonConfirmed\n}: {\n\tquestion: string;\n\tonCanceled?: () => void;\n\tonConfirmed: () => void;\n}) => {\n\tconst dispatch = useDispatch<Dispatch>();\n\tconst { t } = useTranslation();\n\n\tconst onCancel = useCallback(() => {\n\t\tdispatch(popModal());\n\t\tif (onCanceled) {\n\t\t\tonCanceled();\n\t\t}\n\t}, [dispatch, onCanceled]);\n\n\treturn (\n\t\t<FormModal\n\t\t\ttitle={t(\"confirm\")}\n\t\t\tonSubmit={onConfirmed}\n\t\t\trenderButtons={() => (\n\t\t\t\t<>\n\t\t\t\t\t<IconButton\n\t\t\t\t\t\ttitle={t(\"cancel\")}\n\t\t\t\t\t\tkind=\"primary\"\n\t\t\t\t\t\ticon=\"plus\"\n\t\t\t\t\t\ttype=\"submit\"\n\t\t\t\t\t/>\n\t\t\t\t\t<CancelButton onClick={onCancel} />\n\t\t\t\t</>\n\t\t\t)}>\n\t\t\t{question}\n\t\t</FormModal>\n\t);\n};\n","import React, { useCallback } from \"react\";\nimport { useDispatch } from \"react-redux\";\nimport { useTranslation } from \"react-i18next\";\n//\nimport { copyToClipboard } from \"../../utils/clipboard\";\nimport { IconButton } from \"../Common/IconButton\";\nimport { displaySuccess } from \"../../actions/messages\";\n\n// ------------------------------------------------------------------\n\nexport const ModalField = ({ children }: { children?: React.ReactNode }) => (\n\t<div className=\"ModalField\">{children}</div>\n);\n\n// ------------------------------------------------------------------\n\nexport const InputField = React.forwardRef(\n\t(\n\t\tprops: { label: string } & React.DetailedHTMLProps<\n\t\t\tReact.InputHTMLAttributes<HTMLInputElement>,\n\t\t\tHTMLInputElement\n\t\t>,\n\t\tref: React.Ref<HTMLInputElement>\n\t) => (\n\t\t<ModalField>\n\t\t\t<div className=\"XXX\">\n\t\t\t\t<label htmlFor={props.id}>{props.label}</label>\n\t\t\t\t<input ref={ref} {...props} />\n\t\t\t</div>\n\t\t</ModalField>\n\t)\n);\n\n// ------------------------------------------------------------------\n\nexport const SECRET_FIELD_SIZE = 36;\n\nexport const SecretField = ({\n\tid,\n\tlabel,\n\tonChange,\n\tplaceholder,\n\tvalue\n}: {\n\tid: string;\n\tlabel: string;\n\tonChange: (value: string) => void;\n\tplaceholder: string;\n\tvalue: string;\n}) => {\n\tconst dispatch = useDispatch();\n\tconst { t } = useTranslation();\n\n\tconst onCopyToClipboard = useCallback(async () => {\n\t\tawait copyToClipboard(value);\n\t\tdispatch(displaySuccess(\"secret_copied_to_clipboard\"));\n\t}, [dispatch, value]);\n\n\treturn (\n\t\t<ModalField>\n\t\t\t<div className=\"XXX\">\n\t\t\t\t<label htmlFor={id}>{label}</label>\n\t\t\t\t<div\n\t\t\t\t\tstyle={{\n\t\t\t\t\t\tdisplay: \"flex\",\n\t\t\t\t\t\tflexDirection: \"row\",\n\t\t\t\t\t\tjustifyContent: \"space-between\"\n\t\t\t\t\t}}>\n\t\t\t\t\t<input\n\t\t\t\t\t\tstyle={{\n\t\t\t\t\t\t\tflexGrow: 1,\n\t\t\t\t\t\t\tmarginRight: \"0.5rem\"\n\t\t\t\t\t\t}}\n\t\t\t\t\t\tid={id}\n\t\t\t\t\t\ttype=\"password\"\n\t\t\t\t\t\tautoComplete=\"password\"\n\t\t\t\t\t\tplaceholder={placeholder}\n\t\t\t\t\t\tmaxLength={SECRET_FIELD_SIZE}\n\t\t\t\t\t\tminLength={SECRET_FIELD_SIZE}\n\t\t\t\t\t\trequired={true}\n\t\t\t\t\t\tvalue={value}\n\t\t\t\t\t\tonChange={e => onChange(e.target.value)}\n\t\t\t\t\t/>\n\t\t\t\t\t<IconButton\n\t\t\t\t\t\ticon=\"clipboard\"\n\t\t\t\t\t\tonClick={onCopyToClipboard}\n\t\t\t\t\t\tsize=\"M\"\n\t\t\t\t\t\ttitle={t(\"copy_to_clipboard\")}\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</ModalField>\n\t);\n};\n\n// ------------------------------------------------------------------\n\nexport const SelectField = React.forwardRef(\n\t(\n\t\tprops: {\n\t\t\tlabel: string;\n\t\t\toptions: Array<{ id: string; label: string }>;\n\t\t} & React.DetailedHTMLProps<\n\t\t\tReact.InputHTMLAttributes<HTMLSelectElement>,\n\t\t\tHTMLSelectElement\n\t\t>,\n\t\tref: React.Ref<HTMLSelectElement>\n\t) => (\n\t\t<ModalField>\n\t\t\t<div className=\"XXX\">\n\t\t\t\t<label htmlFor={props.id}>{props.label}</label>\n\t\t\t\t<select ref={ref} {...props}>\n\t\t\t\t\t{props.options\n\t\t\t\t\t\t.sort((a, b) => a.label.localeCompare(b.label))\n\t\t\t\t\t\t.map(option => (\n\t\t\t\t\t\t\t<option key={option.id} value={option.id}>\n\t\t\t\t\t\t\t\t{option.label}\n\t\t\t\t\t\t\t</option>\n\t\t\t\t\t\t))}\n\t\t\t\t</select>\n\t\t\t</div>\n\t\t</ModalField>\n\t)\n);\n","import React, { useRef, useState, useEffect, useCallback } from \"react\";\nimport { useDispatch } from \"react-redux\";\nimport { useTranslation } from \"react-i18next\";\n//\nimport { FormModal } from \"../Modals/FormModal\";\nimport { IconButton } from \"../Common/IconButton\";\nimport { CancelButton } from \"../Common/CancelButton\";\nimport { popModal, openModal } from \"../../reducers/modals\";\nimport { displayError } from \"../../actions/messages\";\nimport { connectUser } from \"../../actions/user\";\nimport { Dispatch } from \"../../actions\";\nimport { SECRET_FIELD_SIZE, InputField } from \"../Modals/ModalFields\";\n\n// ------------------------------------------------------------------\n\nexport const ConnectUserModal = () => {\n\tconst dispatch = useDispatch<Dispatch>();\n\tconst [id, setId] = useState(\"\");\n\tconst [secret, setSecret] = useState(\"\");\n\tconst idRef = useRef<HTMLInputElement>(null);\n\tconst { t } = useTranslation();\n\n\tuseEffect(() => {\n\t\tif (idRef.current) {\n\t\t\tidRef.current.focus();\n\t\t}\n\t}, [idRef]);\n\n\tconst onClose = useCallback(() => dispatch(popModal()), [dispatch]);\n\n\tconst onConnect = useCallback(() => {\n\t\tif (id.trim().length === 0) {\n\t\t\tdispatch(displayError(\"users.id_is_invalid\"));\n\t\t\treturn;\n\t\t}\n\t\tif (secret.trim().length === 0) {\n\t\t\tdispatch(displayError(\"users.secret_is_invalid\"));\n\t\t\treturn;\n\t\t}\n\t\tdispatch(connectUser(id, secret));\n\t\tdispatch(popModal());\n\t}, [dispatch, id, secret]);\n\n\tconst onCreate = useCallback(\n\t\t() => dispatch(openModal({ type: \"CreateUser\", props: null })),\n\t\t[dispatch]\n\t);\n\n\treturn (\n\t\t<FormModal\n\t\t\ttitle={t(\"users.connection\")}\n\t\t\tonSubmit={onConnect}\n\t\t\trenderButtons={() => (\n\t\t\t\t<>\n\t\t\t\t\t<IconButton\n\t\t\t\t\t\tdisabled={\n\t\t\t\t\t\t\tid.trim().length === 0 ||\n\t\t\t\t\t\t\tid.length !== 36 ||\n\t\t\t\t\t\t\tsecret.length !== SECRET_FIELD_SIZE\n\t\t\t\t\t\t}\n\t\t\t\t\t\ttitle={t(\"users.connect\")}\n\t\t\t\t\t\tkind=\"primary\"\n\t\t\t\t\t\ticon=\"sign-in\"\n\t\t\t\t\t\ttype=\"submit\"\n\t\t\t\t\t/>\n\t\t\t\t\t<CancelButton onClick={onClose} />\n\t\t\t\t\t<IconButton\n\t\t\t\t\t\ttitle={t(\"users.create\")}\n\t\t\t\t\t\tkind=\"default\"\n\t\t\t\t\t\ticon=\"plus\"\n\t\t\t\t\t\tonClick={onCreate}\n\t\t\t\t\t/>\n\t\t\t\t</>\n\t\t\t)}>\n\t\t\t<InputField\n\t\t\t\tid=\"modal-id\"\n\t\t\t\tlabel={t(\"users.id\")}\n\t\t\t\ttype=\"text\"\n\t\t\t\tplaceholder={t(\"users.id_placeholder\")}\n\t\t\t\tmaxLength={36}\n\t\t\t\tminLength={36}\n\t\t\t\trequired={true}\n\t\t\t\tvalue={id}\n\t\t\t\tref={idRef}\n\t\t\t\tonChange={e => setId(e.target.value)}\n\t\t\t/>\n\t\t\t<InputField\n\t\t\t\tid=\"modal-secret\"\n\t\t\t\tlabel={t(\"users.secret\")}\n\t\t\t\ttype=\"password\"\n\t\t\t\tautoComplete=\"password\"\n\t\t\t\tplaceholder={t(\"users.secret_placeholder\")}\n\t\t\t\tmaxLength={36}\n\t\t\t\tminLength={36}\n\t\t\t\trequired={true}\n\t\t\t\tvalue={secret}\n\t\t\t\tonChange={e => setSecret(e.target.value)}\n\t\t\t/>\n\t\t</FormModal>\n\t);\n};\n","import React, { useState, useRef, useEffect, useCallback } from \"react\";\nimport { useDispatch } from \"react-redux\";\nimport { useTranslation } from \"react-i18next\";\nimport { v4 } from \"uuid\";\n//\nimport { FormModal } from \"../Modals/FormModal\";\nimport { IconButton } from \"../Common/IconButton\";\nimport { CancelButton } from \"../Common/CancelButton\";\nimport {\n\tInputField,\n\tSecretField,\n\tSECRET_FIELD_SIZE,\n\tSelectField\n} from \"../Modals/ModalFields\";\nimport { Dispatch } from \"../../actions\";\nimport { popModal, openModal } from \"../../reducers/modals\";\nimport { createRoom } from \"../../actions/room\";\nimport { displayError } from \"../../actions/messages\";\nimport { RoomType, RoomTypes } from \"../../utils/rooms\";\n\n// ------------------------------------------------------------------\n\nlet ROOM_COUNTER = 1;\n\n// ------------------------------------------------------------------\n\nexport const CreateRoomModal = () => {\n\tconst dispatch = useDispatch<Dispatch>();\n\tconst [name, setName] = useState(\"\");\n\tconst [secret, setSecret] = useState(v4());\n\tconst [type, setType] = useState<RoomType>(\"dj\");\n\tconst nameRef = useRef<HTMLInputElement>(null);\n\tconst { t } = useTranslation();\n\n\tuseEffect(() => {\n\t\tsetName(`${t(\"rooms.room\")} ${ROOM_COUNTER}`);\n\t\tif (nameRef.current) {\n\t\t\tnameRef.current.focus();\n\t\t}\n\t}, [t, nameRef]);\n\n\tconst onClose = useCallback(() => dispatch(popModal()), [dispatch]);\n\n\tconst onCreate = useCallback(() => {\n\t\tif (name.trim().length === 0) {\n\t\t\tdispatch(displayError(\"rooms.name_is_invalid\"));\n\t\t\treturn;\n\t\t}\n\t\tif (secret.trim().length === 0) {\n\t\t\tdispatch(displayError(\"rooms.secret_is_invalid\"));\n\t\t\treturn;\n\t\t}\n\t\tdispatch(createRoom(name, secret, type));\n\t\tdispatch(popModal());\n\t\tROOM_COUNTER++;\n\t}, [dispatch, name, secret, type]);\n\n\tconst onJoin = useCallback(\n\t\t() => dispatch(openModal({ type: \"JoinRoom\", props: null })),\n\t\t[dispatch]\n\t);\n\n\treturn (\n\t\t<FormModal\n\t\t\ttitle={t(\"rooms.room_creation\")}\n\t\t\tonSubmit={onCreate}\n\t\t\trenderButtons={() => (\n\t\t\t\t<>\n\t\t\t\t\t<IconButton\n\t\t\t\t\t\tdisabled={\n\t\t\t\t\t\t\tname.trim().length === 0 ||\n\t\t\t\t\t\t\tsecret.length !== SECRET_FIELD_SIZE\n\t\t\t\t\t\t}\n\t\t\t\t\t\ttitle={t(\"rooms.create\")}\n\t\t\t\t\t\tkind=\"primary\"\n\t\t\t\t\t\ticon=\"plus\"\n\t\t\t\t\t\ttype=\"submit\"\n\t\t\t\t\t/>\n\t\t\t\t\t<CancelButton onClick={onClose} />\n\t\t\t\t\t<IconButton\n\t\t\t\t\t\ttitle={t(\"rooms.join\")}\n\t\t\t\t\t\tkind=\"default\"\n\t\t\t\t\t\ticon=\"sign-in\"\n\t\t\t\t\t\tonClick={onJoin}\n\t\t\t\t\t/>\n\t\t\t\t</>\n\t\t\t)}>\n\t\t\t<InputField\n\t\t\t\tid=\"modal-name\"\n\t\t\t\tlabel={t(\"rooms.name\")}\n\t\t\t\ttype=\"text\"\n\t\t\t\tplaceholder={t(\"rooms.name_placeholder\")}\n\t\t\t\tmaxLength={100}\n\t\t\t\tminLength={2}\n\t\t\t\trequired={true}\n\t\t\t\tvalue={name}\n\t\t\t\tref={nameRef}\n\t\t\t\tonChange={e => setName(e.target.value)}\n\t\t\t/>\n\t\t\t<SecretField\n\t\t\t\tid=\"modal-secret\"\n\t\t\t\tlabel={t(\"rooms.key\")}\n\t\t\t\tplaceholder={t(\"rooms.key_placeholder\")}\n\t\t\t\tvalue={secret}\n\t\t\t\tonChange={setSecret}\n\t\t\t/>\n\t\t\t<SelectField\n\t\t\t\tid=\"modal-type\"\n\t\t\t\tlabel={t(\"rooms.type\")}\n\t\t\t\tplaceholder={t(\"rooms.type_placeholder\")}\n\t\t\t\toptions={RoomTypes.map(type => ({\n\t\t\t\t\tid: type,\n\t\t\t\t\tlabel: t(`rooms.types.${type}`)\n\t\t\t\t}))}\n\t\t\t\tvalue={type}\n\t\t\t\tonChange={e => setType(e.target.value as RoomType)}\n\t\t\t/>\n\t\t</FormModal>\n\t);\n};\n","import React, { useState, useEffect, useRef, useCallback } from \"react\";\nimport { useDispatch } from \"react-redux\";\nimport { useTranslation } from \"react-i18next\";\nimport { v4 } from \"uuid\";\n//\nimport { FormModal } from \"../Modals/FormModal\";\nimport { IconButton } from \"../Common/IconButton\";\nimport { CancelButton } from \"../Common/CancelButton\";\nimport {\n\tSecretField,\n\tSECRET_FIELD_SIZE,\n\tInputField\n} from \"../Modals/ModalFields\";\nimport { popModal, openModal } from \"../../reducers/modals\";\nimport { displayError } from \"../../actions/messages\";\nimport { createUser } from \"../../actions/user\";\nimport { Dispatch } from \"../../actions\";\n\n// ------------------------------------------------------------------\n\nlet USER_COUNTER = 1;\n\n// ------------------------------------------------------------------\n\nexport const CreateUserModal = () => {\n\tconst dispatch = useDispatch<Dispatch>();\n\tconst [name, setName] = useState(\"\");\n\tconst [secret, setSecret] = useState(v4());\n\tconst nameRef = useRef<HTMLInputElement>(null);\n\tconst { t } = useTranslation();\n\n\tuseEffect(() => {\n\t\tsetName(`${t(\"users.user\")} ${USER_COUNTER}`);\n\t\tif (nameRef.current) {\n\t\t\tnameRef.current.focus();\n\t\t}\n\t}, [t, nameRef]);\n\n\tconst onClose = useCallback(() => dispatch(popModal()), [dispatch]);\n\n\tconst onCreate = useCallback(() => {\n\t\tif (name.trim().length === 0) {\n\t\t\tdispatch(displayError(\"users.name_is_invalid\"));\n\t\t\treturn;\n\t\t}\n\t\tif (secret.trim().length === 0) {\n\t\t\tdispatch(displayError(\"users.secret_is_invalid\"));\n\t\t\treturn;\n\t\t}\n\t\tdispatch(createUser(name, secret));\n\t\tdispatch(popModal());\n\t\tUSER_COUNTER++;\n\t}, [dispatch, name, secret]);\n\n\tconst onToggle = useCallback(() => {\n\t\tdispatch(openModal({ type: \"ConnectUser\", props: null }));\n\t}, [dispatch]);\n\n\treturn (\n\t\t<FormModal\n\t\t\ttitle={t(\"users.user_creation\")}\n\t\t\tonSubmit={onCreate}\n\t\t\trenderButtons={() => (\n\t\t\t\t<>\n\t\t\t\t\t<IconButton\n\t\t\t\t\t\tdisabled={\n\t\t\t\t\t\t\tname.trim().length === 0 ||\n\t\t\t\t\t\t\tsecret.length !== SECRET_FIELD_SIZE\n\t\t\t\t\t\t}\n\t\t\t\t\t\ttitle={t(\"users.create\")}\n\t\t\t\t\t\tkind=\"primary\"\n\t\t\t\t\t\ticon=\"plus\"\n\t\t\t\t\t\ttype=\"submit\"\n\t\t\t\t\t/>\n\t\t\t\t\t<CancelButton onClick={onClose} />\n\t\t\t\t\t<IconButton\n\t\t\t\t\t\ttitle={t(\"users.connect\")}\n\t\t\t\t\t\tkind=\"default\"\n\t\t\t\t\t\ticon=\"sign-in\"\n\t\t\t\t\t\tonClick={onToggle}\n\t\t\t\t\t/>\n\t\t\t\t</>\n\t\t\t)}>\n\t\t\t<InputField\n\t\t\t\tid=\"modal-name\"\n\t\t\t\tlabel={t(\"users.name\")}\n\t\t\t\ttype=\"text\"\n\t\t\t\tplaceholder={t(\"users.name_placeholder\")}\n\t\t\t\tmaxLength={100}\n\t\t\t\tminLength={2}\n\t\t\t\trequired={true}\n\t\t\t\tvalue={name}\n\t\t\t\tref={nameRef}\n\t\t\t\tonChange={e => setName(e.target.value)}\n\t\t\t/>\n\t\t\t<SecretField\n\t\t\t\tid=\"modal-secret\"\n\t\t\t\tlabel={t(\"users.secret\")}\n\t\t\t\tplaceholder={t(\"users.secret_placeholder\")}\n\t\t\t\tvalue={secret}\n\t\t\t\tonChange={newSecret => setSecret(newSecret)}\n\t\t\t/>\n\t\t</FormModal>\n\t);\n};\n","import React, { ReactNode } from \"react\";\n//\nimport { Media } from \"../../utils/medias\";\nimport { ModalField } from \"../Modals/ModalFields\";\nimport { IconButton } from \"../Common/IconButton\";\n\n// ------------------------------------------------------------------\n\nexport const SearchResultCategory = ({\n\titems,\n\tlabel,\n\tonViewMore,\n\tcb\n}: {\n\titems: Media[];\n\tlabel: string;\n\tonViewMore: () => void;\n\tcb: (item: Media) => ReactNode;\n}) =>\n\titems.length > 0 ? (\n\t\t<>\n\t\t\t<ModalField>\n\t\t\t\t<div className=\"XXX\">\n\t\t\t\t\t<label>{label}</label>\n\t\t\t\t</div>\n\t\t\t</ModalField>\n\t\t\t{items.map(item => (\n\t\t\t\t<ModalField key={item.id}>\n\t\t\t\t\t<div className=\"SearchResultItem\">{cb(item)}</div>\n\t\t\t\t</ModalField>\n\t\t\t))}\n\t\t\t<ModalField>\n\t\t\t\t<div className=\"XXX\">\n\t\t\t\t\t<IconButton\n\t\t\t\t\t\ticon=\"ellipsis-h\"\n\t\t\t\t\t\tonClick={onViewMore}\n\t\t\t\t\t\ttitle=\"View more...\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</ModalField>\n\t\t</>\n\t) : null;\n","import React, { useRef, useState, useEffect, useCallback } from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { useTranslation } from \"react-i18next\";\n//\nimport { FormModal } from \"../Modals/FormModal\";\nimport { IconButton } from \"../Common/IconButton\";\nimport { CancelButton } from \"../Common/CancelButton\";\nimport { searchMedias } from \"../../utils/providers\";\nimport { Media } from \"./Medias\";\nimport {\n\tMEDIA_TYPE_DEFINITIONS,\n\tMediaType,\n\tProviderType\n} from \"../../utils/medias\";\nimport { SearchResults } from \"../../utils/providers\";\nimport { SearchResultCategory } from \"./SearchResultCategory\";\nimport { Dispatch } from \"../../actions\";\nimport { popModal } from \"../../reducers/modals\";\nimport { previewMedia } from \"../../actions/medias\";\nimport { isRoomLocked } from \"../../selectors/room\";\nimport { RootState } from \"../../reducers\";\nimport { ModalField } from \"../Modals/ModalFields\";\nimport { PREVIEW_PLAYER } from \"../../utils/player\";\nimport { appendToQueue } from \"../../actions/queue\";\nimport \"./SearchModal.scss\";\n\n// ------------------------------------------------------------------\n\nconst SEARCH_RESULTS_COUNT = 5;\nconst VIEW_MORE_RESULTS_COUNT = 50;\n\n// ------------------------------------------------------------------\n\nexport const SearchModal = () => {\n\tconst dispatch = useDispatch<Dispatch>();\n\tconst { t } = useTranslation();\n\tconst queryRef = useRef<HTMLInputElement>(null);\n\tconst locked = useSelector<RootState, boolean>(isRoomLocked);\n\tconst [playingMediaId, setPlayingMediaId] = useState(\"\");\n\tconst [playingMediaProvider, setPlayingMediaProvider] = useState<\n\t\tProviderType\n\t>(\"deezer\");\n\tconst [playingMediaType, setPlayingMediaType] = useState<MediaType>(\n\t\t\"track\"\n\t);\n\tconst [query, setQuery] = useState(\"\");\n\tconst [results, setResults] = useState<SearchResults>({\n\t\t// keys are ProviderType\n\t\tdeezer: {\n\t\t\t// keys are MediaType\n\t\t\talbum: [],\n\t\t\tplaylist: [],\n\t\t\ttrack: []\n\t\t}\n\t});\n\n\tconst onClose = useCallback(() => dispatch(popModal()), [dispatch]);\n\n\tconst onSearch = useCallback(async () => {\n\t\tif (query.trim().length > 0) {\n\t\t\tsetResults(\n\t\t\t\tawait searchMedias(query, {\n\t\t\t\t\tlimit: SEARCH_RESULTS_COUNT\n\t\t\t\t})\n\t\t\t);\n\t\t}\n\t}, [query]);\n\n\tconst onSelect = useCallback(\n\t\t(provider: ProviderType, type: MediaType, id: string) =>\n\t\t\tdispatch(appendToQueue([{ provider, type, id }])),\n\t\t[dispatch]\n\t);\n\n\tconst onStartPreview = useCallback(\n\t\t(provider: ProviderType, type: MediaType, id: string) => {\n\t\t\tdispatch(previewMedia({ provider, type, id }));\n\t\t\tsetPlayingMediaId(id);\n\t\t\tsetPlayingMediaProvider(provider);\n\t\t\tsetPlayingMediaType(type);\n\t\t},\n\t\t[dispatch]\n\t);\n\n\tconst onStopPreview = useCallback(async () => {\n\t\tconsole.debug(\"Stop previewing...\");\n\t\tawait PREVIEW_PLAYER.stop();\n\t\tsetPlayingMediaId(\"\");\n\t\tsetPlayingMediaProvider(\"deezer\");\n\t\tsetPlayingMediaType(\"track\");\n\t}, []);\n\n\tconst onViewMore = useCallback(\n\t\tasync (type: MediaType) => {\n\t\t\tsetResults(\n\t\t\t\tawait searchMedias(\n\t\t\t\t\tquery,\n\t\t\t\t\t{\n\t\t\t\t\t\tlimit: VIEW_MORE_RESULTS_COUNT\n\t\t\t\t\t},\n\t\t\t\t\ttype\n\t\t\t\t)\n\t\t\t);\n\t\t},\n\t\t[query, setResults]\n\t);\n\n\tuseEffect(() => {\n\t\tif (queryRef.current) {\n\t\t\tqueryRef.current.focus();\n\t\t}\n\t\treturn () => {\n\t\t\tconsole.debug(\"Stop previewing...\");\n\t\t\t/*await*/ PREVIEW_PLAYER.stop();\n\t\t};\n\t}, [dispatch]);\n\n\treturn (\n\t\t<FormModal\n\t\t\tclassName=\"SearchModal\"\n\t\t\ttitle={t(\"medias.medias_search\")}\n\t\t\tonSubmit={onSearch}\n\t\t\trenderButtons={() => (\n\t\t\t\t<>\n\t\t\t\t\t<IconButton\n\t\t\t\t\t\tdisabled={query.trim().length === 0}\n\t\t\t\t\t\ttitle={t(\"medias.search\")}\n\t\t\t\t\t\tkind=\"primary\"\n\t\t\t\t\t\ticon=\"search\"\n\t\t\t\t\t\ttype=\"submit\"\n\t\t\t\t\t/>\n\t\t\t\t\t<CancelButton onClick={onClose} />\n\t\t\t\t</>\n\t\t\t)}>\n\t\t\t<ModalField>\n\t\t\t\t<input\n\t\t\t\t\tid=\"modal-query\"\n\t\t\t\t\ttype=\"text\"\n\t\t\t\t\tplaceholder={t(\"medias.search_placeholder\")}\n\t\t\t\t\tmaxLength={100}\n\t\t\t\t\tminLength={2}\n\t\t\t\t\trequired={true}\n\t\t\t\t\tvalue={query}\n\t\t\t\t\tref={queryRef}\n\t\t\t\t\tonChange={e => setQuery(e.target.value)}\n\t\t\t\t/>\n\t\t\t</ModalField>\n\t\t\t{MEDIA_TYPE_DEFINITIONS.map(({ label, provider, type }) => (\n\t\t\t\t<SearchResultCategory\n\t\t\t\t\tkey={type}\n\t\t\t\t\tlabel={t(label)}\n\t\t\t\t\titems={results[provider][type]}\n\t\t\t\t\tonViewMore={() => onViewMore(type)}\n\t\t\t\t\tcb={media => (\n\t\t\t\t\t\t<Media\n\t\t\t\t\t\t\tactions={\n\t\t\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\t\t\tdisabled={locked}\n\t\t\t\t\t\t\t\t\ttitle={t(\"medias.add\")}\n\t\t\t\t\t\t\t\t\ticon=\"plus\"\n\t\t\t\t\t\t\t\t\tonClick={() =>\n\t\t\t\t\t\t\t\t\t\tonSelect(provider, type, media.id)\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tmedia={media}\n\t\t\t\t\t\t\tplayable={true}\n\t\t\t\t\t\t\tplaying={\n\t\t\t\t\t\t\t\tplayingMediaProvider === provider &&\n\t\t\t\t\t\t\t\tplayingMediaType === type &&\n\t\t\t\t\t\t\t\tplayingMediaId === media.id\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tonPlay={() =>\n\t\t\t\t\t\t\t\tonStartPreview(provider, type, media.id)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tonStop={onStopPreview}\n\t\t\t\t\t\t/>\n\t\t\t\t\t)}\n\t\t\t\t/>\n\t\t\t))}\n\t\t</FormModal>\n\t);\n};\n","import React, { useState, useRef, useEffect, useCallback } from \"react\";\nimport { useDispatch } from \"react-redux\";\nimport { useTranslation } from \"react-i18next\";\n//\nimport { FormModal } from \"../Modals/FormModal\";\nimport { IconButton } from \"../Common/IconButton\";\nimport { CancelButton } from \"../Common/CancelButton\";\nimport { InputField } from \"../Modals/ModalFields\";\nimport { Dispatch } from \"../../actions\";\nimport { popModal, openModal } from \"../../reducers/modals\";\nimport { displayError } from \"../../actions/messages\";\nimport { enterRoom } from \"../../actions/room\";\n\n// ------------------------------------------------------------------\n\nexport const JoinRoomModal = () => {\n\tconst dispatch = useDispatch<Dispatch>();\n\tconst [id, setId] = useState(\"\");\n\tconst idRef = useRef<HTMLInputElement>(null);\n\tconst { t } = useTranslation();\n\n\tuseEffect(() => {\n\t\tif (idRef.current) {\n\t\t\tidRef.current.focus();\n\t\t}\n\t}, [idRef]);\n\n\tconst onClose = useCallback(() => dispatch(popModal()), [dispatch]);\n\n\tconst onJoin = useCallback(() => {\n\t\tif (id.trim().length === 0) {\n\t\t\tdispatch(displayError(\"rooms.id_is_invalid\"));\n\t\t\treturn;\n\t\t}\n\t\tdispatch(enterRoom(id, \"\"));\n\t\tdispatch(popModal());\n\t}, [dispatch, id]);\n\n\tconst onCreate = useCallback(\n\t\t() => dispatch(openModal({ type: \"CreateRoom\", props: null })),\n\t\t[dispatch]\n\t);\n\n\treturn (\n\t\t<FormModal\n\t\t\ttitle={t(\"rooms.room_join\")}\n\t\t\tonSubmit={onJoin}\n\t\t\trenderButtons={() => (\n\t\t\t\t<>\n\t\t\t\t\t<IconButton\n\t\t\t\t\t\tdisabled={id.trim().length === 0 || id.length !== 36}\n\t\t\t\t\t\ttitle={t(\"rooms.join\")}\n\t\t\t\t\t\tkind=\"primary\"\n\t\t\t\t\t\ticon=\"sign-in\"\n\t\t\t\t\t\ttype=\"submit\"\n\t\t\t\t\t/>\n\t\t\t\t\t<CancelButton onClick={onClose} />\n\t\t\t\t\t<IconButton\n\t\t\t\t\t\ttitle={t(\"rooms.create\")}\n\t\t\t\t\t\tkind=\"default\"\n\t\t\t\t\t\ticon=\"plus\"\n\t\t\t\t\t\tonClick={onCreate}\n\t\t\t\t\t/>\n\t\t\t\t</>\n\t\t\t)}>\n\t\t\t<InputField\n\t\t\t\tid=\"modal-id\"\n\t\t\t\tlabel={t(\"rooms.id\")}\n\t\t\t\ttype=\"text\"\n\t\t\t\tplaceholder={t(\"rooms.id_placeholder\")}\n\t\t\t\tmaxLength={36}\n\t\t\t\tminLength={36}\n\t\t\t\trequired={true}\n\t\t\t\tvalue={id}\n\t\t\t\tref={idRef}\n\t\t\t\tonChange={e => setId(e.target.value)}\n\t\t\t/>\n\t\t</FormModal>\n\t);\n};\n","import React, { useRef, useState, useEffect, useCallback } from \"react\";\nimport { useDispatch } from \"react-redux\";\nimport { useTranslation } from \"react-i18next\";\n//\nimport { FormModal } from \"../Modals/FormModal\";\nimport { IconButton } from \"../Common/IconButton\";\nimport { CancelButton } from \"../Common/CancelButton\";\nimport { Dispatch } from \"../../actions\";\nimport { popModal } from \"../../reducers/modals\";\nimport { unlockRoom } from \"../../actions/room\";\nimport { SECRET_FIELD_SIZE, InputField } from \"../Modals/ModalFields\";\n\n// ------------------------------------------------------------------\n\nexport const UnlockRoomModal = () => {\n\tconst dispatch = useDispatch<Dispatch>();\n\tconst [secret, setSecret] = useState(\"\");\n\tconst secretRef = useRef<HTMLInputElement>(null);\n\tconst { t } = useTranslation();\n\n\tuseEffect(() => {\n\t\tif (secretRef.current) {\n\t\t\tsecretRef.current.focus();\n\t\t}\n\t}, [secretRef]);\n\n\tconst onClose = useCallback(() => dispatch(popModal()), [dispatch]);\n\n\tconst onUnlock = useCallback(() => {\n\t\tdispatch(unlockRoom(secret));\n\t\tdispatch(popModal());\n\t}, [dispatch, secret]);\n\n\treturn (\n\t\t<FormModal\n\t\t\ttitle={t(\"rooms.room_unlocking\")}\n\t\t\tonSubmit={onUnlock}\n\t\t\trenderButtons={() => (\n\t\t\t\t<>\n\t\t\t\t\t<IconButton\n\t\t\t\t\t\tdisabled={secret.length !== SECRET_FIELD_SIZE}\n\t\t\t\t\t\ttitle={t(\"rooms.unlock\")}\n\t\t\t\t\t\tkind=\"primary\"\n\t\t\t\t\t\ticon=\"unlock\"\n\t\t\t\t\t\ttype=\"submit\"\n\t\t\t\t\t/>\n\t\t\t\t\t<CancelButton onClick={onClose} />\n\t\t\t\t</>\n\t\t\t)}>\n\t\t\t<InputField\n\t\t\t\tid=\"modal-secret\"\n\t\t\t\tlabel={t(\"rooms.key\")}\n\t\t\t\ttype=\"password\"\n\t\t\t\tautoComplete=\"password\"\n\t\t\t\tplaceholder={t(\"rooms.key_placeholder\")}\n\t\t\t\tmaxLength={36}\n\t\t\t\tminLength={36}\n\t\t\t\trequired={true}\n\t\t\t\tvalue={secret}\n\t\t\t\tref={secretRef}\n\t\t\t\tonChange={e => setSecret(e.target.value)}\n\t\t\t/>\n\t\t</FormModal>\n\t);\n};\n","import React, { MouseEvent, useState, useEffect, useCallback } from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { CSSTransition } from \"react-transition-group\";\n//\nimport { Dispatch } from \"../../actions\";\nimport { RootState } from \"../../reducers\";\nimport { ModalPrereq, popModal } from \"../../reducers/modals\";\nimport { ConfirmModal } from \"./ConfirmModal\";\nimport { ConnectUserModal } from \"../Users/ConnectUserModal\";\nimport { CreateRoomModal } from \"../Room/CreateRoomModal\";\nimport { CreateUserModal } from \"..//Users/CreateUserModal\";\nimport { SearchModal } from \"..//Room/SearchModal\";\nimport { JoinRoomModal } from \"../Room/JoinRoomModal\";\nimport { UnlockRoomModal } from \"../Room/UnlockRoomModal\";\nimport \"./index.scss\";\n\n// ------------------------------------------------------------------\n\nconst TRANSITION_TIMEOUT = 300;\n\n// ------------------------------------------------------------------\n\nexport const getModal = (prereq?: ModalPrereq) => {\n\tif (prereq) {\n\t\tswitch (prereq.type) {\n\t\t\tcase \"Confirm\":\n\t\t\t\treturn <ConfirmModal {...prereq.props} />;\n\t\t\tcase \"ConnectUser\":\n\t\t\t\treturn <ConnectUserModal />;\n\t\t\tcase \"CreateRoom\":\n\t\t\t\treturn <CreateRoomModal />;\n\t\t\tcase \"CreateUser\":\n\t\t\t\treturn <CreateUserModal />;\n\t\t\tcase \"JoinRoom\":\n\t\t\t\treturn <JoinRoomModal />;\n\t\t\tcase \"Search\":\n\t\t\t\treturn <SearchModal />;\n\t\t\tcase \"UnlockRoom\":\n\t\t\t\treturn <UnlockRoomModal />;\n\t\t}\n\t}\n\treturn null;\n};\n\n// ------------------------------------------------------------------\n\nexport const Modals = () => {\n\tconst dispatch = useDispatch<Dispatch>();\n\tconst prereq = useSelector<RootState, ModalPrereq | undefined>(state =>\n\t\tstate.modals.stack.length > 0\n\t\t\t? state.modals.stack[state.modals.stack.length - 1]\n\t\t\t: void 0\n\t);\n\n\tconst [currPrereq, setCurrPrereq] = useState<ModalPrereq | undefined>(\n\t\tvoid 0\n\t);\n\tconst [prevPrereq, setPrevPrereq] = useState<ModalPrereq | undefined>(\n\t\tvoid 0\n\t);\n\n\tconst onPopModal = useCallback(() => dispatch(popModal()), [dispatch]);\n\n\tuseEffect(() => {\n\t\tconst keyDown = (e: KeyboardEvent) => {\n\t\t\tif (e.keyCode === 27) {\n\t\t\t\tonPopModal();\n\t\t\t}\n\t\t};\n\n\t\tdocument.addEventListener(\"keydown\", keyDown);\n\n\t\treturn () => {\n\t\t\tdocument.removeEventListener(\"keydown\", keyDown);\n\t\t};\n\t}, [onPopModal]);\n\n\tuseEffect(() => {\n\t\t// Hide current modal before showing new one (if there is a new one)\n\t\tsetCurrPrereq(void 0);\n\t\tsetPrevPrereq(prereq);\n\t}, [prereq, setCurrPrereq, setPrevPrereq]);\n\n\tuseEffect(() => {\n\t\tif (prereq) {\n\t\t\tsetTimeout(() => {\n\t\t\t\tsetCurrPrereq(prereq);\n\t\t\t}, TRANSITION_TIMEOUT);\n\t\t}\n\t}, [prereq, setCurrPrereq]);\n\n\tconst modal = getModal(currPrereq || prevPrereq);\n\treturn (\n\t\t<CSSTransition\n\t\t\tin={!!currPrereq}\n\t\t\ttimeout={TRANSITION_TIMEOUT}\n\t\t\tunmountOnExit={true}>\n\t\t\t<div\n\t\t\t\tclassName=\"ModalOverlay\"\n\t\t\t\tonClick={e => {\n\t\t\t\t\t// Clicking overlay will close current modal\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t\tonPopModal();\n\t\t\t\t}}>\n\t\t\t\t{modal && (\n\t\t\t\t\t<div\n\t\t\t\t\t\tclassName=\"ModalWrapper\"\n\t\t\t\t\t\trole=\"dialog\"\n\t\t\t\t\t\tonClick={(e: MouseEvent) => {\n\t\t\t\t\t\t\t// Clicking wrapper modal will not progagate to overlay which would close current modal\n\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t}}>\n\t\t\t\t\t\t{modal}\n\t\t\t\t\t</div>\n\t\t\t\t)}\n\t\t\t</div>\n\t\t</CSSTransition>\n\t);\n};\n","import { RootState } from \"../reducers\";\n\n// ------------------------------------------------------------------\n\nexport const selectMessages = (state: RootState) =>\n\tstate.messages.sort((m1, m2) =>\n\t\tm1.weight !== m2.weight ? m1.weight - m2.weight : m1.stamp - m2.stamp\n\t);\n","import React from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { useTranslation } from \"react-i18next\";\nimport classNames from \"classnames\";\nimport { TransitionGroup, CSSTransition } from \"react-transition-group\";\n//\nimport { Message } from \"../../utils/messages\";\nimport { selectMessages } from \"../../selectors/messages\";\nimport { RootState } from \"../../reducers\";\nimport { IconButton } from \"../Common/IconButton\";\nimport { Dispatch } from \"../../actions\";\nimport { removeMessage } from \"../../reducers/messages\";\nimport \"./Messages.scss\";\n\n// ------------------------------------------------------------------\n\nexport const Messages = () => {\n\tconst { t } = useTranslation();\n\tconst dispatch = useDispatch<Dispatch>();\n\tconst messages = useSelector<RootState, Message[]>(selectMessages);\n\treturn (\n\t\t<div className=\"Messages\">\n\t\t\t<TransitionGroup>\n\t\t\t\t{messages.map(({ extra, id, text, type }) => (\n\t\t\t\t\t<CSSTransition\n\t\t\t\t\t\tkey={id}\n\t\t\t\t\t\tclassNames=\"Message\"\n\t\t\t\t\t\ttimeout={{ enter: 200, exit: 200 }}>\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclassName={classNames(\n\t\t\t\t\t\t\t\t\"Message\",\n\t\t\t\t\t\t\t\t\"Message-\" + type\n\t\t\t\t\t\t\t)}>\n\t\t\t\t\t\t\t<div className=\"MessageBody\">\n\t\t\t\t\t\t\t\t{text ? t(text) : null}\n\t\t\t\t\t\t\t\t{extra ? extra() : null}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div className=\"MessageActions\">\n\t\t\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\t\t\ticon=\"close\"\n\t\t\t\t\t\t\t\t\ttitle={t(\"clear\")}\n\t\t\t\t\t\t\t\t\tonClick={() => dispatch(removeMessage(id))}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</CSSTransition>\n\t\t\t\t))}\n\t\t\t</TransitionGroup>\n\t\t</div>\n\t);\n};\n","import React, { useEffect } from \"react\";\nimport { useDispatch } from \"react-redux\";\nimport { Redirect, Route, Switch } from \"react-router-dom\";\n//\nimport { Room } from \"./Room\";\nimport { Splash } from \"./Splash\";\nimport { Modals } from \"../components/Modals\";\nimport { Messages } from \"../components/Common/Messages\";\nimport { reconnectUser } from \"../actions/user\";\nimport { Dispatch } from \"../actions\";\nimport \"./App.scss\";\n\n// ------------------------------------------------------------------\n\nexport const App = () => {\n\tconst dispatch = useDispatch<Dispatch>();\n\n\tuseEffect(() => {\n\t\tdispatch(reconnectUser());\n\t}, [dispatch]);\n\n\treturn (\n\t\t<div className=\"App\">\n\t\t\t<Modals />\n\t\t\t<Switch>\n\t\t\t\t<Route exact={true} path=\"/room/:room_id\" component={Room} />\n\t\t\t\t<Route exact={true} path=\"/\" component={Splash} />\n\t\t\t\t<Redirect to=\"/\" />\n\t\t\t</Switch>\n\t\t\t<Messages />\n\t\t</div>\n\t);\n};\n","export default {\n\taudio: {\n\t\terrors: {\n\t\t\tcannot_decode_audio_data: \"Audio buffer cannot be decoded\",\n\t\t\tcannot_load_audio_buffer: \"Audio buffer loading failed\"\n\t\t}\n\t},\n\tsplash: {\n\t\tCGU: \"CGU\",\n\t\tpowered_with: \"Powered with\",\n\t\tdescription: \"Collaborative & Musical Games Experimentation\"\n\t},\n\tusers: {\n\t\terrors: {\n\t\t\tinvalid: \"User is invalid\"\n\t\t},\n\t\tuser: \"User\",\n\t\tconfirm_disconnect: \"Are you sure you want to disconnect?\",\n\t\tconnect: \"Connect\",\n\t\tconnection: \"Connection\",\n\t\tcreate: \"Create a user\",\n\t\tdisconnect: \"Disconnect\",\n\t\tid: \"User ID\",\n\t\tid_is_invalid: \"ID is invalid\",\n\t\tid_placeholder: \"User ID...\",\n\t\tname_is_invalid: \"Name is invalid\",\n\t\tname_placeholder: \"User Name...\",\n\t\tname: \"User Name\",\n\t\tsecret_is_invalid: \"Secret is invalid\",\n\t\tsecret_placeholder: \"User Secret...\",\n\t\tsecret: \"User Secret\",\n\t\tuser_creation: \"User Registration\"\n\t},\n\tgames: {\n\t\tseabattle: {\n\t\t\tmovement_is_not_possible: \"This movement is not possible!\"\n\t\t}\n\t},\n\trooms: {\n\t\terrors: {\n\t\t\tinvalid: \"Room is invalid\",\n\t\t\tlocked: \"Room is locked\"\n\t\t},\n\t\ttypes: {\n\t\t\tblind: \"Blind Test\",\n\t\t\tdj: \"DJ\",\n\t\t\tseabattle: \"Sea Battle\"\n\t\t},\n\t\tclear: \"Clear all tracks\",\n\t\tconfirm_clear: \"Are you sure you want to remove all tracks?\",\n\t\tconfirm_exit: \"Are you sure you want to leave the room?\",\n\t\tconfirm_lock: \"Are you sure you want to lock the room?\",\n\t\tcopy_link: \"Copy Room Link to Clipboard\",\n\t\tcreate: \"Create a room\",\n\t\tempty: \"It's empty here, you should add some tracks...\",\n\t\tempty_for_now: \"It's empty here, the owner has to fill it..\",\n\t\texit: \"Exit Room\",\n\t\tid: \"Room ID\",\n\t\tid_placeholder: \"Room ID...\",\n\t\tkey_placeholder: \"Room Key...\",\n\t\ttype_placeholder: \"Room Type...\",\n\t\tkey: \"Room Key\",\n\t\ttype: \"Room Type\",\n\t\tjoin: \"Join a Room\",\n\t\tlink_copied_to_clipboard: \"Room link has been copied to clipboard\",\n\t\tloading: \"Loading...\",\n\t\tlocked: \"Locked (click to unlock)\",\n\t\tname_is_invalid: \"Name is invalid\",\n\t\tname_placeholder: \"Room Name...\",\n\t\tname: \"Room Name\",\n\t\troom_creation: \"Room Creation\",\n\t\troom_join: \"Room Access\",\n\t\troom_unlocking: \"Room Unlocking\",\n\t\troom: \"Room\",\n\t\tsecret_is_invalid: \"Secret is invalid\",\n\t\tunlock: \"Unlock\",\n\t\tunlocked: \"Unlocked (click to lock)\",\n\t\tmedia_count: \"{{count}} media\",\n\t\tmedia_count_plural: \"{{count}} medias\",\n\t\ttrack_count: \"{{count}} track\",\n\t\ttrack_count_plural: \"{{count}} tracks\"\n\t},\n\tmedias: {\n\t\tby: \"by {{artist}}\",\n\t\tadd: \"Add\",\n\t\tremove: \"Remove\",\n\t\tsearch: \"Search Media\",\n\t\tsearch_placeholder: \"Search...\",\n\t\tmedias_search: \"Media Search\",\n\t\talbums: \"Albums\",\n\t\tplaylists: \"Playlists\",\n\t\ttracks: \"Tracks\"\n\t},\n\tplayer: {\n\t\tbackward: \"Backward\",\n\t\tforward: \"Forward\",\n\t\tplay: \"Play\",\n\t\tplaying: \"Playing\",\n\t\tstop: \"Stop\"\n\t},\n\tcancel: \"Cancel\",\n\tclear: \"Clear\",\n\tcopy_to_clipboard: \"Copy to Clipboard\",\n\tsecret_copied_to_clipboard: \"Secret has been copied to clipboard\"\n};\n","export default {\n\taudio: {\n\t\terrors: {\n\t\t\tcannot_decode_audio_data: \"Le buffer audio ne peut pas tre dcod\",\n\t\t\tcannot_load_audio_buffer: \"Le buffer audio ne peut pas tre charg\"\n\t\t}\n\t},\n\tsplash: {\n\t\tCGU: \"CGU\",\n\t\tpowered_with: \"Utilise\",\n\t\tdescription: \"Exprimentation de jeux collaboratifs et musicaux\"\n\t},\n\tusers: {\n\t\terrors: {\n\t\t\tinvalid: \"L'utilisateur est invalide\"\n\t\t},\n\t\tuser: \"Utilisateur\",\n\t\tconfirm_disconnect: \"tes-vous sr(e) de vouloir vous dconnecter ?\",\n\t\tconnect: \"Se connecter\",\n\t\tconnection: \"Connexion\",\n\t\tcreate: \"Crer un utilisateur\",\n\t\tdisconnect: \"Se dconnecter\",\n\t\tid: \"Identifiant\",\n\t\tid_is_invalid: \"L'identifiant est invalide\",\n\t\tid_placeholder: \"Identifiant...\",\n\t\tname_is_invalid: \"Le nom est invalide\",\n\t\tname_placeholder: \"Nom...\",\n\t\tname: \"Nom\",\n\t\tsecret_is_invalid: \"Le secret est invalide\",\n\t\tsecret_placeholder: \"Secret...\",\n\t\tsecret: \"Secret\",\n\t\tuser_creation: \"Cration d'un utilisateur\"\n\t},\n\tgames: {\n\t\tseabattle: {\n\t\t\tmovement_is_not_possible: \"Ce dplacement est impossible !\"\n\t\t}\n\t},\n\trooms: {\n\t\terrors: {\n\t\t\tinvalid: \"La salle est invalide\",\n\t\t\tlocked: \"La salle est verrouille\"\n\t\t},\n\t\ttypes: {\n\t\t\tblind: \"Blind Test\",\n\t\t\tdj: \"DJ\",\n\t\t\tseabattle: \"Bataille Navale\"\n\t\t},\n\t\tclear: \"Supprimer toutes les pistes\",\n\t\tconfirm_clear:\n\t\t\t\"tes-vous sr(e) de vouloir supprimer toutes les pistes ?\",\n\t\tconfirm_exit: \"tes-vous sr(e) de vouloir quitter la salle ?\",\n\t\tconfirm_lock: \"tes-vous sr(e) de vouloir verrouiller la salle ?\",\n\t\tcopy_link: \"Copier le lien de la salle dans le presse-papier\",\n\t\tcreate: \"Crer une salle\",\n\t\tempty: \"Cette salle est vide, vous devriez ajouter quelques pistes...\",\n\t\tempty_for_now: \"Cette salle est pour le moment vide...\",\n\t\texit: \"Quitter la salle\",\n\t\tid: \"Identifiant\",\n\t\tid_placeholder: \"Identifiant...\",\n\t\tkey_placeholder: \"Clef...\",\n\t\ttype_placeholder: \"Type...\",\n\t\tkey: \"Clef\",\n\t\ttype: \"Type\",\n\t\tjoin: \"Rejoindre une salle\",\n\t\tloading: \"Chargement...\",\n\t\tlink_copied_to_clipboard:\n\t\t\t\"Le lien de la salle a t copi dans le presse-papier\",\n\t\tlocked: \"Verrouille (cliquer pour dverrouiller)\",\n\t\tname_is_invalid: \"Le nom est invalide\",\n\t\tname_placeholder: \"Nom...\",\n\t\tname: \"Nom\",\n\t\troom: \"Salle\",\n\t\troom_creation: \"Cration d'une salle\",\n\t\troom_join: \"Rejoindre une salle\",\n\t\troom_unlocking: \"Dverrouillage de la salle\",\n\t\tsecret_is_invalid: \"Le secret is invalide\",\n\t\tunlock: \"Dverrouiller\",\n\t\tunlocked: \"Dverrouille (cliquer pour verrouiller)\",\n\t\tmedia_count: \"{{count}} media\",\n\t\tmedia_count_plural: \"{{count}} medias\",\n\t\ttrack_count: \"{{count}} piste\",\n\t\ttrack_count_plural: \"{{count}} pistes\"\n\t},\n\tmedias: {\n\t\tby: \"par {{artist}}\",\n\t\tadd: \"Ajouter\",\n\t\tremove: \"Supprimer\",\n\t\tsearch: \"Chercher des mdias\",\n\t\tsearch_placeholder: \"Recherche...\",\n\t\tmedias_search: \"Recherche de mdias\",\n\t\talbums: \"Albums\",\n\t\tplaylists: \"Playlists\",\n\t\ttracks: \"Pistes\"\n\t},\n\tplayer: {\n\t\tbackward: \"Piste prcdente\",\n\t\tforward: \"Piste suivante\",\n\t\tplay: \"Lire\",\n\t\tplaying: \"En cours de lecture\",\n\t\tstop: \"Arrter\"\n\t},\n\tcancel: \"Annuler\",\n\tclear: \"Supprimer\",\n\tcopy_to_clipboard: \"Copier dans le presse-papier\",\n\tsecret_copied_to_clipboard: \"Le secret a t copi dans le presse-papier\"\n};\n","import i18next from \"i18next\";\nimport { initReactI18next } from \"react-i18next\";\n//\nimport en from \"../locales/en\";\nimport fr from \"../locales/fr\";\n\n// --------------------------------------------------------------\n\ntype Language = \"en\" | \"fr\";\n\n// --------------------------------------------------------------\n\nexport const changeLanguage = (language: Language) =>\n\ti18next.changeLanguage(language);\n\n// --------------------------------------------------------------\n\nexport const initLocales = async (): Promise<void> =>\n\tnew Promise((resolve, reject) => {\n\t\tconsole.debug(\"Initializing language...\", {\n\t\t\tcurrent: navigator.language || (navigator as any).userLanguage\n\t\t});\n\t\ti18next.use(initReactI18next).init(\n\t\t\t{\n\t\t\t\tfallbackLng: \"en\",\n\t\t\t\tlng: navigator.language || (navigator as any).userLanguage,\n\t\t\t\tresources: {\n\t\t\t\t\ten: { translation: en },\n\t\t\t\t\t\"en-US\": { translation: en },\n\t\t\t\t\tfr: { translation: fr },\n\t\t\t\t\t\"fr-FR\": { translation: fr }\n\t\t\t\t},\n\t\t\t\tinterpolation: {\n\t\t\t\t\tescapeValue: false, // react is already safe from xss\n\t\t\t\t\tformat: (value, format, lng) => {\n\t\t\t\t\t\t// if (format === \"uppercase\") return value.toUpperCase();\n\t\t\t\t\t\t// if (value instanceof Date) return moment(value).format(format);\n\t\t\t\t\t\treturn value;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\terror => {\n\t\t\t\tif (error) reject(error);\n\t\t\t\tresolve();\n\t\t\t}\n\t\t);\n\t});\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n\twindow.location.hostname === \"localhost\" ||\n\t\t// [::1] is the IPv6 localhost address.\n\t\twindow.location.hostname === \"[::1]\" ||\n\t\t// 127.0.0.0/8 are considered localhost for IPv4.\n\t\twindow.location.hostname.match(\n\t\t\t/^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n\t\t)\n);\n\nexport function register(config?: RegistrationOptions) {\n\tif (process.env.NODE_ENV === \"production\" && \"serviceWorker\" in navigator) {\n\t\tconsole.debug(\"PWA register 1\", process.env.PUBLIC_URL);\n\t\t// The URL constructor is available in all browsers that support SW.\n\t\tconst publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n\t\tif (publicUrl.origin !== window.location.origin) {\n\t\t\tconsole.debug(\"PWA register 2\");\n\t\t\t// Our service worker won't work if PUBLIC_URL is on a different origin\n\t\t\t// from what our page is served on. This might happen if a CDN is used to\n\t\t\t// serve assets; see https://github.com/facebook/create-react-app/issues/2374\n\t\t\treturn;\n\t\t}\n\n\t\twindow.addEventListener(\"load\", () => {\n\t\t\tconst swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\t\t\tconsole.debug(\"PWA register 3\");\n\t\t\tif (isLocalhost) {\n\t\t\t\tconsole.debug(\"PWA register 4\");\n\t\t\t\t// This is running on localhost. Let's check if a service worker still exists or not.\n\t\t\t\tcheckValidServiceWorker(swUrl, config);\n\n\t\t\t\t// Add some additional logging to localhost, pointing developers to the\n\t\t\t\t// service worker/PWA documentation.\n\t\t\t\tnavigator.serviceWorker.ready.then(() => {\n\t\t\t\t\tconsole.debug(\n\t\t\t\t\t\t\"This web app is being served cache-first by a service \" +\n\t\t\t\t\t\t\t\"worker. To learn more, visit https://bit.ly/CRA-PWA\"\n\t\t\t\t\t);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tconsole.debug(\"PWA register 5\");\n\t\t\t\t// Is not localhost. Just register service worker\n\t\t\t\tregisterValidSW(swUrl, config);\n\t\t\t}\n\t\t});\n\t}\n}\n\nfunction registerValidSW(swUrl: string, config?: RegistrationOptions) {\n\tconsole.debug(\"PWA registerValidSW 1\");\n\tnavigator.serviceWorker\n\t\t.register(swUrl)\n\t\t.then(registration => {\n\t\t\tconsole.debug(\"PWA registerValidSW 2\");\n\t\t\tregistration.onupdatefound = () => {\n\t\t\t\tconsole.debug(\"PWA registerValidSW 3\");\n\t\t\t\tconst installingWorker = registration.installing;\n\t\t\t\tif (installingWorker == null) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tconsole.debug(\"PWA registerValidSW 4\");\n\t\t\t\tinstallingWorker.onstatechange = () => {\n\t\t\t\t\tconsole.debug(\n\t\t\t\t\t\t\"PWA registerValidSW 5\",\n\t\t\t\t\t\tinstallingWorker.state\n\t\t\t\t\t);\n\t\t\t\t\tif (installingWorker.state === \"installed\") {\n\t\t\t\t\t\tif (navigator.serviceWorker.controller) {\n\t\t\t\t\t\t\tconsole.debug(\"PWA registerValidSW 6\");\n\t\t\t\t\t\t\t// At this point, the updated precached content has been fetched,\n\t\t\t\t\t\t\t// but the previous service worker will still serve the older\n\t\t\t\t\t\t\t// content until all client tabs are closed.\n\t\t\t\t\t\t\tconsole.debug(\n\t\t\t\t\t\t\t\t\"New content is available and will be used when all \" +\n\t\t\t\t\t\t\t\t\t\"tabs for this page are closed. See https://bit.ly/CRA-PWA.\"\n\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\t// Execute callback\n\t\t\t\t\t\t\tif (config && (config as any).onUpdate) {\n\t\t\t\t\t\t\t\t(config as any).onUpdate(registration);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconsole.debug(\"PWA registerValidSW 7\");\n\t\t\t\t\t\t\t// At this point, everything has been precached.\n\t\t\t\t\t\t\t// It's the perfect time to display a\n\t\t\t\t\t\t\t// \"Content is cached for offline use.\" message.\n\t\t\t\t\t\t\tconsole.debug(\"Content is cached for offline use.\");\n\n\t\t\t\t\t\t\t// Execute callback\n\t\t\t\t\t\t\tif (config && (config as any).onSuccess) {\n\t\t\t\t\t\t\t\t(config as any).onSuccess(registration);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t};\n\t\t})\n\t\t.catch(error => {\n\t\t\tconsole.error(\"Error during service worker registration:\", error);\n\t\t});\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: RegistrationOptions) {\n\tconsole.debug(\"PWA checkValidServiceWorker 1\");\n\t// Check if the service worker can be found. If it can't reload the page.\n\tfetch(swUrl, {\n\t\theaders: { \"Service-Worker\": \"script\" }\n\t})\n\t\t.then(response => {\n\t\t\t// Ensure service worker exists, and that we really are getting a JS file.\n\t\t\tconst contentType = response.headers.get(\"content-type\");\n\t\t\tconsole.debug(\n\t\t\t\t\"PWA checkValidServiceWorker 2\",\n\t\t\t\tcontentType,\n\t\t\t\tresponse.status\n\t\t\t);\n\t\t\tif (\n\t\t\t\tresponse.status === 404 ||\n\t\t\t\t(contentType != null &&\n\t\t\t\t\tcontentType.indexOf(\"javascript\") === -1)\n\t\t\t) {\n\t\t\t\t// No service worker found. Probably a different app. Reload the page.\n\t\t\t\tnavigator.serviceWorker.ready.then(registration => {\n\t\t\t\t\tregistration.unregister().then(() => {\n\t\t\t\t\t\twindow.location.reload();\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\t// Service worker found. Proceed as normal.\n\t\t\t\tregisterValidSW(swUrl, config);\n\t\t\t}\n\t\t})\n\t\t.catch(() => {\n\t\t\tconsole.debug(\n\t\t\t\t\"No internet connection found. App is running in offline mode.\"\n\t\t\t);\n\t\t});\n}\n\nexport function unregister() {\n\tif (\"serviceWorker\" in navigator) {\n\t\tnavigator.serviceWorker.ready\n\t\t\t.then(registration => {\n\t\t\t\tregistration.unregister();\n\t\t\t})\n\t\t\t.catch(error => {\n\t\t\t\tconsole.error(error.message);\n\t\t\t});\n\t}\n}\n","import { combineReducers } from \"redux\";\nimport { seabattleReducer as seabattle } from \"./seabattle\";\n\nexport type GamesState = ReturnType<typeof gamesReducer>;\n\nexport const gamesReducer = combineReducers({\n\tseabattle\n});\n","import { combineReducers } from \"redux\";\nimport { gamesReducer as games } from \"./games\";\nimport { mediasReducer as medias } from \"./medias\";\nimport { messagesReducer as messages } from \"./messages\";\nimport { modalsReducer as modals } from \"./modals\";\nimport { roomReducer as room } from \"./room\";\nimport { userReducer as user } from \"./user\";\n\nexport type RootState = ReturnType<typeof rootReducer>;\n\nexport const rootReducer = combineReducers({\n\tgames,\n\tmedias,\n\tmessages,\n\tmodals,\n\troom,\n\tuser\n});\n","import { composeWithDevTools } from \"redux-devtools-extension\";\nimport { applyMiddleware, createStore, compose } from \"redux\";\nimport thunk from \"redux-thunk\";\n//\nimport { rootReducer, RootState } from \"../reducers\";\nimport { QUEUE_PLAYER } from \"./player\";\n\n// ------------------------------------------------------------------\n\nexport const initStore = (initialState?: RootState) => {\n\tconst composeEnhancers =\n\t\tprocess.env.NODE_ENV === \"development\"\n\t\t\t? composeWithDevTools({})\n\t\t\t: compose;\n\n\tconst store = createStore(\n\t\trootReducer,\n\t\tinitialState,\n\t\tcomposeEnhancers(\n\t\t\tapplyMiddleware(\n\t\t\t\tthunk.withExtraArgument({\n\t\t\t\t\tplayer: QUEUE_PLAYER\n\t\t\t\t})\n\t\t\t)\n\t\t)\n\t);\n\n\treturn {\n\t\tdispatch: store.dispatch.bind(store),\n\t\tgetState: store.getState.bind(store),\n\t\tstore\n\t};\n};\n","import * as React from \"react\";\nimport * as ReactDOM from \"react-dom\";\nimport { Provider } from \"react-redux\";\nimport { Route, HashRouter } from \"react-router-dom\";\n//\nimport { App } from \"./pages/App\";\nimport { initLocales } from \"./utils/i18n\";\nimport { register as registerServiceWorker } from \"./serviceWorker\";\nimport { initStore } from \"./utils/redux\";\nimport \"./index.scss\";\n\n// ------------------------------------------------------------------\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nregisterServiceWorker();\n\n// ------------------------------------------------------------------\n\nconst init = async () => {\n\tinitLocales();\n\treturn initStore();\n};\n\n// ------------------------------------------------------------------\n\ninit().then(({ store }) => {\n\tReactDOM.render(\n\t\t<Provider store={store}>\n\t\t\t<HashRouter>\n\t\t\t\t<Route path=\"/\" component={App} />\n\t\t\t</HashRouter>\n\t\t</Provider>,\n\t\tdocument.getElementById(\"root\")\n\t);\n});\n"],"sourceRoot":""}