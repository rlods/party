{"version":3,"sources":["reducers/medias.ts","reducers/messages.ts","reducers/modals.ts","reducers/player.ts","reducers/room.ts","utils/users.ts","reducers/user.ts","reducers/index.ts","components/Common/Icon.tsx","components/Common/IconButton.tsx","utils/clipboard.ts","selectors/room.ts","actions/index.ts","actions/messages.ts","actions/modals.ts","components/Room/Head.tsx","components/Common/LoadingIcon.tsx","components/Room/Cover.tsx","components/Room/Medias.tsx","components/Room/QueueItem.tsx","config/firebase.ts","utils/index.ts","utils/firebase.ts","utils/messages.ts","actions/queue.ts","actions/medias.ts","utils/history.ts","actions/room.ts","utils/colorpicker.ts","actions/player.ts","components/Room/Queue.tsx","selectors/medias.ts","components/Room/Progress.tsx","components/Room/Controls.tsx","pages/Room.tsx","actions/user.ts","pages/Splash.tsx","components/Modals/Modal.tsx","components/Modals/FormModal.tsx","components/Common/CancelButton.tsx","components/Modals/ConfirmModal.tsx","components/Modals/SecretField.tsx","components/Users/ConnectUserModal.tsx","components/Room/CreateRoomModal.tsx","components/Users/CreateUserModal.tsx","utils/deezer.ts","utils/medias.ts","components/Room/SearchResultCategory.tsx","components/Room/SearchModal.tsx","components/Room/UnlockRoomModal.tsx","components/Modals/index.tsx","selectors/messages.ts","components/App/Messages.tsx","pages/App.tsx","utils/player.ts","locales/en.ts","locales/fr.ts","utils/i18n.ts","serviceWorker.ts","index.tsx"],"names":["INITIAL_STATE","fetching","error","medias","album","playlist","track","initialState","stack","playing","track_percent","room","access","id","secret","color","fg","bg","r","g","b","info","position","loadUserAccess","res","s","localStorage","getItem","d","JSON","parse","atob","i","console","debug","err","user","rootReducer","combineReducers","state","action","type","payload","copy","media","messages","filter","other","modals","pop","player","setItem","btoa","stringify","saveUserAccess","removeItem","Icon","React","memo","className","icon","size","title","classNames","name","style","IconButton","disabled","displayTitle","kind","onClick","aria-label","clickable","copyToClipboard","value","a","Promise","resolve","elem","document","createElement","setAttribute","left","body","appendChild","selection","getSelection","selected","rangeCount","getRangeAt","select","execCommand","removeAllRanges","addRange","removeChild","extractRoom","isRoomLoaded","isRoomLocked","createAction","MESSAGE_ID_GENERATOR","displayMessage","text","duration","dispatch","stamp","Date","getTime","setTimeout","removeMessage","displayError","displayInfo","openModal","prereq","popModal","confirmModal","question","onConfirmed","onCanceled","window","confirm","Head","useDispatch","t","useTranslation","history","useHistory","useSelector","tracksCount","length","onCopy","useCallback","location","href","split","onExit","push","count","LoadingIcon","Cover","playable","image","onPlay","onStop","backgroundImage","Media","actions","mediaType","cover_small","link","target","rel","artist","picture_small","preview","QueueItem","locked","onRemove","config","appIDs","process","sleep","delay","onlyUnique","index","self","indexOf","getFromDictOrList","dict","list","getFromDict","find","item","getFromList","APPS","DEFAULT_APP_ID","createOrGetApp","appId","databaseURL","app","firebase","database","members","ref","rooms","users","FirebaseRoom","_room","child","_info","_members","_secret","_values","queue","queue_position","timestamp","getInfo","isLocked","setSecret","newSecret","oldSecret","wait","reject","once","snapshot","newValues","val","Error","subscribeInfo","cb","on","subscribeMembers","cbAdded","cbRemoved","unsubscribeInfo","off","unsubscribeMembers","update","set","ServerValue","TIMESTAMP","FirebaseUser","_user","_membership","online","room_id","status","installDisconnect","onDisconnect","cancel","enter","remove","exit","extractErrorMessage","response","data","message","clearQueue","getState","lockRoom","appendInQueue","provider","trackIds","queueMedias","map","forEach","removeFromQueue","oldIndex","splice","mediaAccess","setQueuePosition","newPosition","oldPosition","moveBackward","moveForward","loadMedias","mediaIds","enqueue","deezer","previewPlayer","oldTracks","newTrackIds","trackId","newTracks","loadTracks","play","oldContainers","newContainerIds","containerId","newContainers","loadContainers","newContainersAndTracks","container","tracks","createHashHistory","setRoom","values","createRoom","v4","enterRoom","FIREBASE_CB","exitRoom","newRoom","newInfo","Object","entries","sort","media1","media2","Number","replace","unlockRoom","CACHE","DEFAULT_COLOR","pickColor","url","jimp","resize","getPixelColor","pixel","setPlayer","startPlayer","queuePlayer","PLAYER_TIMER1","PLAYER_TIMER2","_installTimer1","_installTimer2","stopPlayer","_","clearTimeout","stop","stopPreview","_1","_2","_computeNextPosition","queueTrackPosition","nextPosition","playingTrackID","getPlayingTrackID","playingTrackPosition","getPlayingTrackPosition","isPlaying","nextTrackPosition","nextIndex","nextTrack","all","getPlayingTrackPercent","Queue","loaded","playingIndex","mediaAccesses","extractMedias","onSearch","props","QueueList","EmptyQueueList","key","Progress","max","Controls","onClear","onLock","onUnlock","onMoveBackward","onMoveForward","Room","search","useLocation","useParams","qs","substr","useEffect","backgroundColor","setUser","createUser","connectUser","disconnectUser","newUser","reconnectUser","Splash","loggedIn","onCreateRoom","onConnectUser","to","src","height","alt","Modal","children","renderFoot","onSubmit","has_prev_modal","onClose","onPop","event","preventDefault","hidden","FormModal","renderButtons","CancelButton","ConfirmModal","onCancel","SecretField","label","onChange","placeholder","onCopyToClipboard","htmlFor","display","flexDirection","justifyContent","flexGrow","marginRight","autoComplete","maxLength","minLength","required","e","ConnectUserModal","useState","setId","idRef","useRef","current","focus","onConnect","trim","onToggle","ROOM_COUNTER","CreateRoomModal","setName","nameRef","onCreate","USER_COUNTER","CreateUserModal","ConvertAlbum","toString","picture_big","cover_big","readable","ConvertTrack","ConvertPlaylist","DEFAULT_API","_asyncJsonp","jsonp","_call","path","fullpath","_search","query","encodeURIComponent","_load","ids","_loadWithRetry","first","includes","subIds","subIndexes","subMedias","subIndex","searchAlbums","searchPlaylists","public","searchTracks","loadAlbums","albums","loadPlaylists","playlists","creator","DeezerApi","MEDIA_TYPE_DEFINITIONS","SearchResultCategory","items","slice","SearchModal","queryRef","playingMediaId","setPlayingMediaId","playingMediaType","setPlayingMediaType","setQuery","results","setResults","onSelect","mediaId","onStartPreview","onStopPreview","UnlockRoomModal","secretRef","Modals","currPrereq","setCurrPrereq","prevPrereq","setPrevPrereq","onPopModal","keyDown","keyCode","addEventListener","removeEventListener","modal","getModal","in","timeout","unmountOnExit","stopPropagation","role","extractMessages","m1","m2","Messages","App","exact","component","AUDIO_CONTEXT","getContext","AudioContext","webkitAudioContext","decodeAudioData","encodedBuffer","loadAudioBuffer","req","XMLHttpRequest","open","responseType","send","AUDIO_BUFFER_CACHES","loadAudioBufferWithCache","buffer","findIndex","fixAudioContext","context","createBuffer","source","createBufferSource","connect","destination","start","Player","chainPlay","analyserNode","gainNode","_node","_buffer","_sourceNode","_sourceNodeStartTime","_trackId","_trackPosition","getOrCreateNode","createGain","gain","createAnalyser","fftSize","trackPosition","trackUrl","offset","loop","loopStart","loopEnd","onended","playbackRate","currentTime","splash","CGU","powered_with","errors","invalid","confirm_disconnect","connection","create","disconnect","user_creation","id_is_invalid","id_placeholder","user_id","name_is_invalid","name_placeholder","secret_is_invalid","secret_placeholder","clear","confirm_clear","confirm_exit","confirm_lock","copy_link","empty","empty_for_now","key_placeholder","link_copied_to_clipboard","loading","room_creation","room_unlocking","unlock","unlocked","track_count","track_count_plural","by","add","search_placeholder","medias_search","cannot_decode_audio_data","cannot_load_audio_buffer","backward","forward","copy_to_clipboard","secret_copied_to_clipboard","initLocales","navigator","language","userLanguage","i18next","use","initReactI18next","init","fallbackLng","lng","resources","en","translation","fr","interpolation","escapeValue","format","Boolean","hostname","match","serviceWorker","ready","then","registration","unregister","catch","composeEnhancers","compose","store","createStore","applyMiddleware","thunk","withExtraArgument","ReactDOM","getElementById"],"mappings":"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","file":"static/js/main.24f8003b.chunk.js","sourcesContent":["import { Reducer } from \"redux\";\nimport { AxiosError } from \"axios\";\nimport { MediasAction } from \"../actions/medias\";\nimport { Track, Album, Playlist } from \"../utils/medias\";\n\n// ------------------------------------------------------------------\n\nexport type State = {\n\tfetching: boolean;\n\terror: null | AxiosError;\n\tmedias: {\n\t\t// keys are MediaType\n\t\talbum: { [id: string]: Album };\n\t\tplaylist: { [id: string]: Playlist };\n\t\ttrack: { [id: string]: Track };\n\t};\n};\n\nconst INITIAL_STATE: State = {\n\tfetching: false,\n\terror: null,\n\tmedias: {\n\t\t// keys are MediaType\n\t\talbum: {},\n\t\tplaylist: {},\n\t\ttrack: {}\n\t}\n};\n\n// ------------------------------------------------------------------\n\nexport const mediasReducer: Reducer<State, MediasAction> = (\n\tstate = INITIAL_STATE,\n\taction: MediasAction\n): State => {\n\tswitch (action.type) {\n\t\tcase \"medias/FETCHING\":\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tfetching: true,\n\t\t\t\terror: null\n\t\t\t};\n\t\tcase \"medias/FETCHED\": {\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tfetching: false,\n\t\t\t\terror: null\n\t\t\t};\n\t\t}\n\t\tcase \"medias/ERROR\":\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tfetching: false,\n\t\t\t\terror: action.payload\n\t\t\t};\n\t\tcase \"medias/SET\": {\n\t\t\tconst copy = {\n\t\t\t\t...state,\n\t\t\t\tmedias: {\n\t\t\t\t\talbum: { ...state.medias.album },\n\t\t\t\t\tplaylist: { ...state.medias.playlist },\n\t\t\t\t\ttrack: { ...state.medias.track }\n\t\t\t\t}\n\t\t\t};\n\t\t\tfor (const media of action.payload) {\n\t\t\t\tcopy.medias[media.type][media.id] = media;\n\t\t\t}\n\t\t\treturn copy;\n\t\t}\n\t\tcase \"medias/RESET\":\n\t\t\treturn INITIAL_STATE;\n\t\tdefault:\n\t\t\treturn state;\n\t}\n};\n","import { Reducer } from \"redux\";\nimport { MessagesAction } from \"../actions/messages\";\nimport { Message } from \"../utils/messages\";\n\n// ------------------------------------------------------------------\n\nexport type State = Message[];\n\nexport const INITIAL_STATE: State = [];\n\n// ------------------------------------------------------------------\n\nexport const messagesReducer: Reducer<State, MessagesAction> = (\n\tstate = INITIAL_STATE,\n\taction\n): State => {\n\tswitch (action.type) {\n\t\tcase \"message/ADD\":\n\t\t\treturn [action.payload, ...state];\n\t\tcase \"message/REMOVE\":\n\t\t\treturn state.filter(other => other.id !== action.payload);\n\t\tcase \"message/RESET\":\n\t\t\treturn INITIAL_STATE;\n\t\tdefault:\n\t\t\treturn state;\n\t}\n};\n","import { Reducer } from \"redux\";\nimport { ModalsAction, ModalPrereq } from \"../actions/modals\";\n\n// ------------------------------------------------------------------\n\nexport type ModalsState = {\n\tstack: ModalPrereq[];\n};\n\n// ------------------------------------------------------------------\n\nexport const initialState: ModalsState = {\n\tstack: []\n};\n\n// ------------------------------------------------------------------\n\nexport const modalsReducer: Reducer<ModalsState, ModalsAction> = (\n\tstate = initialState,\n\taction\n): ModalsState => {\n\tswitch (action.type) {\n\t\tcase \"modals/OPEN\":\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tstack: [action.payload]\n\t\t\t};\n\t\tcase \"modals/CLOSE\":\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tstack: []\n\t\t\t};\n\t\tcase \"modals/PUSH\":\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tstack: [...state.stack, action.payload]\n\t\t\t};\n\t\tcase \"modals/POP\":\n\t\t\tconst copy = [...state.stack];\n\t\t\tcopy.pop();\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tstack: copy\n\t\t\t};\n\t\tdefault:\n\t\t\treturn state;\n\t}\n};\n","import { Reducer } from \"redux\";\nimport { PlayerAction } from \"../actions/player\";\n\n// ------------------------------------------------------------------\n\nexport type State = {\n\tplaying: boolean;\n\ttrack_percent: number;\n};\n\nexport const INITIAL_STATE: State = {\n\tplaying: false,\n\ttrack_percent: 0\n};\n\n// ------------------------------------------------------------------\n\nexport const playerReducer: Reducer<State, PlayerAction> = (\n\tstate = INITIAL_STATE,\n\taction\n): State => {\n\tswitch (action.type) {\n\t\tcase \"player/SET\":\n\t\t\treturn { ...state, ...action.payload };\n\t\tcase \"player/RESET\":\n\t\t\treturn INITIAL_STATE;\n\t\tdefault:\n\t\t\treturn state;\n\t}\n};\n","import { Reducer } from \"redux\";\nimport { AxiosError } from \"axios\";\nimport { RoomAction } from \"../actions/room\";\nimport { RoomAccess, RoomInfo } from \"../utils/rooms\";\nimport { CombinedColor } from \"../utils/colorpicker\";\nimport { FirebaseRoom } from \"../utils/firebase\";\nimport { MediaAccess } from \"../utils/medias\";\n\n// ------------------------------------------------------------------\n\nexport type RoomData = {\n\troom: ReturnType<typeof FirebaseRoom> | null;\n\taccess: RoomAccess;\n\tcolor: CombinedColor;\n\tinfo: RoomInfo | null;\n\tmedias: MediaAccess[];\n\tplaying: boolean;\n\tposition: number;\n};\n\nexport type State = RoomData & {\n\tfetching: boolean;\n\terror: null | AxiosError;\n};\n\nconst INITIAL_STATE: State = {\n\tfetching: false,\n\terror: null,\n\troom: null,\n\taccess: { id: \"\", secret: \"\" },\n\tcolor: { fg: \"dark\", bg: { r: 255, g: 255, b: 255 } },\n\tinfo: null,\n\tmedias: [],\n\tplaying: false,\n\tposition: 0\n};\n\n// ------------------------------------------------------------------\n\nexport const roomReducer: Reducer<State, RoomAction> = (\n\tstate = INITIAL_STATE,\n\taction: RoomAction\n): State => {\n\tswitch (action.type) {\n\t\tcase \"room/FETCHING\":\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tfetching: true,\n\t\t\t\terror: null\n\t\t\t};\n\t\tcase \"room/FETCHED\": {\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tfetching: false,\n\t\t\t\terror: null\n\t\t\t};\n\t\t}\n\t\tcase \"room/ERROR\":\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tfetching: false,\n\t\t\t\terror: action.payload\n\t\t\t};\n\t\tcase \"room/SET\": {\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\t...action.payload\n\t\t\t};\n\t\t}\n\t\tcase \"room/RESET\":\n\t\t\treturn INITIAL_STATE;\n\t\tdefault:\n\t\t\treturn state;\n\t}\n};\n","export type UserInfo = {\n\tname: string;\n\tonline: boolean;\n\troom_id: string;\n\tstatus: string;\n\ttimestamp: number;\n};\n\nexport type UserAccess = {\n\tid: string;\n\tsecret: string;\n};\n\n// ------------------------------------------------------------------\n\nexport const loadUserAccess = (): UserAccess => {\n\tconst res: UserAccess = {\n\t\tid: \"\",\n\t\tsecret: \"\"\n\t};\n\tconst s = localStorage.getItem(\"U\");\n\tif (s) {\n\t\ttry {\n\t\t\tconst d = JSON.parse(atob(s));\n\t\t\tif (typeof d.i === \"string\" && typeof d.s === \"string\") {\n\t\t\t\tres.id = d.i;\n\t\t\t\tres.secret = d.s;\n\t\t\t\tconsole.debug(\"Loaded user access: \", res);\n\t\t\t}\n\t\t} catch (err) {}\n\t}\n\treturn res;\n};\n\nexport const deleteUserAccess = () => {\n\tlocalStorage.removeItem(\"U\");\n};\n\nexport const saveUserAccess = ({ id, secret }: UserAccess) => {\n\tlocalStorage.setItem(\n\t\t\"U\",\n\t\tbtoa(\n\t\t\tJSON.stringify({\n\t\t\t\ti: id,\n\t\t\t\ts: secret\n\t\t\t})\n\t\t)\n\t);\n};\n","import { Reducer } from \"redux\";\nimport { AxiosError } from \"axios\";\nimport { UserAction } from \"../actions/user\";\nimport {\n\tdeleteUserAccess,\n\tsaveUserAccess,\n\tloadUserAccess,\n\tUserAccess,\n\tUserInfo\n} from \"../utils/users\";\nimport { FirebaseUser } from \"../utils/firebase\";\n\n// ------------------------------------------------------------------\n\nexport type UserData = {\n\tuser: ReturnType<typeof FirebaseUser> | null;\n\taccess: UserAccess;\n\tinfo: UserInfo | null;\n};\n\nexport type State = UserData & {\n\tfetching: boolean;\n\terror: null | AxiosError;\n};\n\nconst INITIAL_STATE: State = {\n\tfetching: false,\n\terror: null,\n\tuser: null,\n\taccess: { id: \"\", secret: \"\" },\n\tinfo: null\n};\n\n// ------------------------------------------------------------------\n\nexport const userReducer: Reducer<State, UserAction> = (\n\tstate = { ...INITIAL_STATE, access: loadUserAccess() },\n\taction: UserAction\n): State => {\n\tswitch (action.type) {\n\t\tcase \"user/FETCHING\":\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tfetching: true,\n\t\t\t\terror: null\n\t\t\t};\n\t\tcase \"user/FETCHED\": {\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tfetching: false,\n\t\t\t\terror: null\n\t\t\t};\n\t\t}\n\t\tcase \"user/ERROR\":\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tfetching: false,\n\t\t\t\terror: action.payload\n\t\t\t};\n\t\tcase \"user/SET\": {\n\t\t\tconst copy = {\n\t\t\t\t...state,\n\t\t\t\t...action.payload\n\t\t\t};\n\t\t\tsaveUserAccess(copy.access);\n\t\t\treturn copy;\n\t\t}\n\t\tcase \"user/RESET\":\n\t\t\tdeleteUserAccess();\n\t\t\treturn INITIAL_STATE;\n\t\tdefault:\n\t\t\treturn state;\n\t}\n};\n","import { combineReducers } from \"redux\";\nimport { mediasReducer as medias } from \"./medias\";\nimport { messagesReducer as messages } from \"./messages\";\nimport { modalsReducer as modals } from \"./modals\";\nimport { playerReducer as player } from \"./player\";\nimport { roomReducer as room } from \"./room\";\nimport { userReducer as user } from \"./user\";\n\nexport type RootState = ReturnType<typeof rootReducer>;\n\nexport const rootReducer = combineReducers({\n\tmedias,\n\tmessages,\n\tmodals,\n\tplayer,\n\troom,\n\tuser\n});\n","import React from \"react\";\nimport FontAwesome from \"react-fontawesome\";\nimport classNames from \"classnames\";\n//\nimport \"./Icon.scss\";\n\n// ------------------------------------------------------------------\n\nexport const Icon = React.memo(\n\t({\n\t\tclassName,\n\t\tcolor,\n\t\ticon,\n\t\tsize = \"M\",\n\t\ttitle\n\t}: {\n\t\tclassName?: string;\n\t\tcolor?: string;\n\t\ticon: string;\n\t\tsize?: \"S\" | \"M\" | \"L\";\n\t\ttitle?: string;\n\t}) => (\n\t\t<FontAwesome\n\t\t\tclassName={classNames(\"Icon\", className, size)}\n\t\t\tname={icon}\n\t\t\tstyle={{ color }}\n\t\t\ttitle={title}\n\t\t/>\n\t)\n);\n","import React from \"react\";\nimport classNames from \"classnames\";\n//\nimport { Icon } from \"./Icon\";\nimport \"./IconButton.scss\";\n\n// ------------------------------------------------------------------\n\ntype ButtonType = \"button\" | \"submit\";\n\nexport const IconButton = React.memo(\n\t({\n\t\tclassName,\n\t\tcolor,\n\t\tdisabled = false,\n\t\tdisplayTitle = false,\n\t\ticon,\n\t\tkind = \"default\",\n\t\tonClick,\n\t\tsize,\n\t\ttitle,\n\t\ttype = \"button\"\n\t}: {\n\t\tclassName?: string;\n\t\tcolor?: string;\n\t\tdisabled?: boolean;\n\t\tdisplayTitle?: boolean;\n\t\ticon: string;\n\t\tkind?: \"default\" | \"primary\" | \"danger\" | \"special\";\n\t\tonClick?: () => void;\n\t\tsize?: \"S\" | \"M\" | \"L\";\n\t\ttitle: string;\n\t\ttype?: ButtonType;\n\t}) => (\n\t\t<button\n\t\t\ttype={type}\n\t\t\taria-label={title}\n\t\t\tclassName={classNames(\"IconButton\", className, kind, size, {\n\t\t\t\tclickable: !disabled && (!!onClick || type === \"submit\")\n\t\t\t})}\n\t\t\tonClick={disabled ? void 0 : onClick}\n\t\t\ttitle={title}>\n\t\t\t<Icon color={color} icon={icon} size={size} />\n\t\t\t{displayTitle && (\n\t\t\t\t<div className={classNames(\"IconButtonTitle\", size)}>\n\t\t\t\t\t{title}\n\t\t\t\t</div>\n\t\t\t)}\n\t\t</button>\n\t)\n);\n","// https://hackernoon.com/copying-text-to-clipboard-with-javascript-df4d4988697f\nexport const copyToClipboard = async (value: string): Promise<void> =>\n\tawait new Promise(resolve => {\n\t\tconst elem = document.createElement(\"textarea\");\n\t\telem.value = value;\n\t\telem.setAttribute(\"readonly\", \"\");\n\t\telem.style.position = \"absolute\";\n\t\telem.style.left = \"-9999px\";\n\n\t\tdocument.body.appendChild(elem);\n\t\tconst selection = document.getSelection();\n\t\tif (selection !== null) {\n\t\t\tconst selected =\n\t\t\t\tselection.rangeCount > 0 ? selection.getRangeAt(0) : false;\n\t\t\telem.select();\n\t\t\tdocument.execCommand(\"copy\");\n\t\t\tif (selected !== false) {\n\t\t\t\tselection.removeAllRanges();\n\t\t\t\tselection.addRange(selected);\n\t\t\t}\n\t\t}\n\t\tdocument.body.removeChild(elem);\n\t\tresolve();\n\t});\n","import { RootState } from \"../reducers\";\n\nexport const extractRoom = (state: RootState) => state.room.info;\n\nexport const isRoomLoaded = (state: RootState) => !!state.room.room;\n\nexport const isRoomLocked = (state: RootState) => !state.room.access.secret;\n","import { AnyAction } from \"redux\";\nimport { ThunkAction, ThunkDispatch } from \"redux-thunk\";\n//\nimport { RootState } from \"../reducers\";\nimport { Player } from \"../utils/player\";\nimport { DeezerApi } from \"../utils/deezer\";\n\n// ------------------------------------------------------------------\n\nexport type Action<T extends string> = {\n\ttype: T;\n};\n\nexport type ActionWithPayload<T extends string, P> = {\n\ttype: T;\n\tpayload: P;\n};\n\nexport type Extended = {\n\tdeezer: ReturnType<typeof DeezerApi>;\n\tpreviewPlayer: ReturnType<typeof Player>;\n\tqueuePlayer: ReturnType<typeof Player>;\n};\n\nexport type Dispatch = ThunkDispatch<RootState, Extended, AnyAction>;\n\nexport type AsyncAction = ThunkAction<void, RootState, Extended, AnyAction>;\n\nexport function createAction<T extends string>(type: T): Action<T>;\n\nexport function createAction<T extends string, P>(\n\ttype: T,\n\tpayload: P\n): ActionWithPayload<T, P>;\n\nexport function createAction<T extends string, P>(type: T, payload?: P) {\n\treturn payload === void 0 ? { type } : { type, payload };\n}\n","import { createAction, AsyncAction } from \".\";\nimport { Message, MessageType } from \"../utils/messages\";\n\n// ------------------------------------------------------------------\n\nexport type MessagesAction =\n\t| ReturnType<typeof addMessage>\n\t| ReturnType<typeof clearMessages>\n\t| ReturnType<typeof removeMessage>;\n\nconst addMessage = (message: Message) => createAction(\"message/ADD\", message);\n\nconst removeMessage = (id: number) => createAction(\"message/REMOVE\", id);\n\nconst clearMessages = () => createAction(\"message/RESET\");\n\n// ------------------------------------------------------------------\n\nlet MESSAGE_ID_GENERATOR: number = 0;\n\nexport const displayMessage = (\n\ttype: MessageType,\n\ttext: string,\n\tduration: number = 5000\n): AsyncAction => (dispatch): any => {\n\tconst id = MESSAGE_ID_GENERATOR++;\n\tdispatch(addMessage({ id, stamp: new Date().getTime(), text, type }));\n\tsetTimeout(() => dispatch(removeMessage(id)), duration);\n};\n\nexport const displayError = (text: string): AsyncAction => (dispatch): any => {\n\tdispatch(displayMessage(\"error\", text, 3000));\n};\n\nexport const displayInfo = (text: string) => displayMessage(\"info\", text, 3000);\n","import { createAction, AsyncAction } from \".\";\n\n// ------------------------------------------------------------------\n\nexport type ModalPrereqT<T extends string, P> = {\n\ttype: T;\n\tprops: P;\n};\n\nexport type ModalPrereq =\n\t| ModalPrereqT<\n\t\t\t\"Confirm\",\n\t\t\t{\n\t\t\t\tquestion: string;\n\t\t\t\tonCanceled?: () => void;\n\t\t\t\tonConfirmed: () => void;\n\t\t\t}\n\t  >\n\t| ModalPrereqT<\"ConnectUser\", null>\n\t| ModalPrereqT<\"CreateRoom\", null>\n\t| ModalPrereqT<\"CreateUser\", null>\n\t| ModalPrereqT<\"Search\", null>\n\t| ModalPrereqT<\"UnlockRoom\", null>;\n\n// ------------------------------------------------------------------\n\nexport type ModalsAction =\n\t| ReturnType<typeof closeModal>\n\t| ReturnType<typeof openModal>\n\t| ReturnType<typeof popModal>\n\t| ReturnType<typeof pushModal>;\n\n// ------------------------------------------------------------------\n\nexport const openModal = (prereq: ModalPrereq) =>\n\tcreateAction(\"modals/OPEN\", prereq);\n\nexport const closeModal = () => createAction(\"modals/CLOSE\");\n\n// ------------------------------------------------------------------\n\nexport const pushModal = (prereq: ModalPrereq) =>\n\tcreateAction(\"modals/PUSH\", prereq);\n\nexport const popModal = () => createAction(\"modals/POP\");\n\n// ------------------------------------------------------------------\n\nexport const confirmModal = (\n\tquestion: string,\n\tonConfirmed: () => void,\n\tonCanceled?: () => void\n): AsyncAction => async () => {\n\t// TODO: open custom ConfirmModal instead of system popup\n\tif (window.confirm(question)) {\n\t\tonConfirmed();\n\t} else if (onCanceled) {\n\t\tonCanceled();\n\t}\n};\n","import React, { useCallback } from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { useTranslation } from \"react-i18next\";\nimport { useHistory } from \"react-router-dom\";\n//\nimport { IconButton } from \"../Common/IconButton\";\nimport { copyToClipboard } from \"../../utils/clipboard\";\nimport { Dispatch } from \"../../actions\";\nimport { RootState } from \"../../reducers\";\nimport { extractRoom } from \"../../selectors/room\";\nimport { displayInfo } from \"../../actions/messages\";\nimport { confirmModal } from \"../../actions/modals\";\nimport { RoomInfo } from \"../../utils/rooms\";\nimport \"./Head.scss\";\n\n// ------------------------------------------------------------------\n\nexport const Head = () => {\n\tconst dispatch = useDispatch<Dispatch>();\n\tconst { t } = useTranslation();\n\tconst history = useHistory();\n\tconst room = useSelector<RootState, RoomInfo | null>(extractRoom);\n\tconst tracksCount = useSelector<RootState, number>(\n\t\tstate => state.room.medias.length\n\t);\n\n\tconst onCopy = useCallback(async () => {\n\t\tawait copyToClipboard(document.location.href.split(\"?\")[0]);\n\t\tdispatch(displayInfo(\"rooms.link_copied_to_clipboard\"));\n\t}, [dispatch]);\n\n\tconst onExit = useCallback(() => {\n\t\tdispatch(\n\t\t\tconfirmModal(t(\"rooms.confirm_exit\"), () => {\n\t\t\t\thistory.push(\"/\");\n\t\t\t})\n\t\t);\n\t}, [t, dispatch, history]);\n\n\treturn (\n\t\t<div className=\"Head\">\n\t\t\t<div className=\"RoomLink\">\n\t\t\t\t<IconButton\n\t\t\t\t\ticon=\"link\"\n\t\t\t\t\tonClick={onCopy}\n\t\t\t\t\tsize=\"M\"\n\t\t\t\t\ttitle={t(\"rooms.copy_link\")}\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<div className=\"RoomMeta\">\n\t\t\t\t{room ? (\n\t\t\t\t\t<>\n\t\t\t\t\t\t<div className=\"RoomName\">{room.name}</div>\n\t\t\t\t\t\t<div className=\"RoomSize\">\n\t\t\t\t\t\t\t&nbsp;--&nbsp;\n\t\t\t\t\t\t\t{t(\"rooms.track_count\", { count: tracksCount })}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</>\n\t\t\t\t) : null}\n\t\t\t</div>\n\t\t\t<div className=\"RoomExit\">\n\t\t\t\t<IconButton\n\t\t\t\t\tonClick={onExit}\n\t\t\t\t\ticon=\"sign-out\"\n\t\t\t\t\tsize=\"M\"\n\t\t\t\t\ttitle={t(\"rooms.exit\")}\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t);\n};\n","import React from \"react\";\nimport { Icon } from \"./Icon\";\n\n// ------------------------------------------------------------------\n\nexport const LoadingIcon = React.memo(\n\t({ size }: { size?: \"S\" | \"M\" | \"L\" }) => (\n\t\t<Icon\n\t\t\tclassName=\"rotating\"\n\t\t\ticon=\"circle-o-notch\"\n\t\t\tsize={size}\n\t\t\ttitle=\"Loading\"\n\t\t/>\n\t)\n);\n","import React from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport classNames from \"classnames\";\n//\nimport { Icon } from \"../Common/Icon\";\nimport \"./Cover.scss\";\n\n// ------------------------------------------------------------------\n\nexport const Cover = React.memo(\n\t({\n\t\tplayable,\n\t\tplaying,\n\t\timage,\n\t\tonPlay,\n\t\tonStop\n\t}: {\n\t\timage: string;\n\t\tonPlay: () => void;\n\t\tonStop: () => void;\n\t\tplayable: boolean;\n\t\tplaying: boolean;\n\t}) => {\n\t\tconst { t } = useTranslation();\n\t\tif (playable) {\n\t\t\treturn (\n\t\t\t\t<div\n\t\t\t\t\tclassName={classNames(\"Cover\", { playable, playing })}\n\t\t\t\t\tstyle={image ? { backgroundImage: `url('${image}')` } : {}}\n\t\t\t\t\tonClick={!playing ? onPlay : onStop}>\n\t\t\t\t\t{!playing ? (\n\t\t\t\t\t\t<Icon icon=\"play\" title={t(\"player.play\")} />\n\t\t\t\t\t) : (\n\t\t\t\t\t\t<Icon icon=\"pause\" title={t(\"player.stop\")} />\n\t\t\t\t\t)}\n\t\t\t\t</div>\n\t\t\t);\n\t\t} else {\n\t\t\treturn (\n\t\t\t\t<div\n\t\t\t\t\tclassName={classNames(\"Cover\", { playing })}\n\t\t\t\t\tstyle={image ? { backgroundImage: `url('${image}')` } : {}}>\n\t\t\t\t\t{playing ? (\n\t\t\t\t\t\t<Icon icon=\"music\" title={t(\"player.playing\")} />\n\t\t\t\t\t) : null}\n\t\t\t\t</div>\n\t\t\t);\n\t\t}\n\t}\n);\n","import React, { ReactNode } from \"react\";\nimport { useTranslation } from \"react-i18next\";\n//\nimport { Cover } from \"./Cover\";\nimport { LoadingIcon } from \"../Common/LoadingIcon\";\nimport {\n\tAlbum,\n\tPlaylist,\n\tTrack,\n\tMedia as MediaData,\n\tMediaType\n} from \"../../utils/medias\";\nimport \"./Medias.scss\";\n\n// ------------------------------------------------------------------\n\nexport const Media = React.memo(\n\t({\n\t\tactions,\n\t\tmedia,\n\t\tmediaType,\n\t\tplayable,\n\t\tplaying,\n\t\tonPlay,\n\t\tonStop\n\t}: {\n\t\tactions?: ReactNode;\n\t\tmedia: MediaData | null;\n\t\tmediaType: MediaType;\n\t\tplayable: boolean;\n\t\tplaying: boolean;\n\t\tonPlay: () => void;\n\t\tonStop: () => void;\n\t}) => {\n\t\tconst { t } = useTranslation();\n\t\tif (!media) {\n\t\t\treturn (\n\t\t\t\t<div className=\"Media\">\n\t\t\t\t\t{actions}\n\t\t\t\t\t<Cover\n\t\t\t\t\t\tplayable={playable}\n\t\t\t\t\t\tplaying={playing}\n\t\t\t\t\t\timage={\"\"}\n\t\t\t\t\t\tonPlay={onPlay}\n\t\t\t\t\t\tonStop={onStop}\n\t\t\t\t\t/>\n\t\t\t\t\t<div className=\"Metas\">\n\t\t\t\t\t\t<LoadingIcon size=\"M\" />\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t);\n\t\t} else if (mediaType === \"album\") {\n\t\t\tconst album = media as Album;\n\t\t\treturn (\n\t\t\t\t<div className=\"Media Album\">\n\t\t\t\t\t{actions}\n\t\t\t\t\t<Cover\n\t\t\t\t\t\tplayable={playable}\n\t\t\t\t\t\tplaying={playing}\n\t\t\t\t\t\timage={album.cover_small}\n\t\t\t\t\t\tonPlay={onPlay}\n\t\t\t\t\t\tonStop={onStop}\n\t\t\t\t\t/>\n\t\t\t\t\t<div className=\"Metas\">\n\t\t\t\t\t\t<div className=\"Meta AlbumTitle\">\n\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\thref={album.link}\n\t\t\t\t\t\t\t\ttarget=\"_blank\"\n\t\t\t\t\t\t\t\trel=\"noopener noreferrer\">\n\t\t\t\t\t\t\t\t{album.title}\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className=\"Meta AlbumArtist\">\n\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\thref={album.artist.link}\n\t\t\t\t\t\t\t\ttarget=\"_blank\"\n\t\t\t\t\t\t\t\trel=\"noopener noreferrer\">\n\t\t\t\t\t\t\t\t{t(\"medias.by\", { artist: album.artist.name })}\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t);\n\t\t} else if (mediaType === \"playlist\") {\n\t\t\tconst playlist = media as Playlist;\n\t\t\treturn (\n\t\t\t\t<div className=\"Media Playlist\">\n\t\t\t\t\t{actions}\n\t\t\t\t\t<Cover\n\t\t\t\t\t\tplayable={playable}\n\t\t\t\t\t\tplaying={playing}\n\t\t\t\t\t\timage={playlist.picture_small}\n\t\t\t\t\t\tonPlay={onPlay}\n\t\t\t\t\t\tonStop={onStop}\n\t\t\t\t\t/>\n\t\t\t\t\t<div className=\"Metas\">\n\t\t\t\t\t\t<div className=\"Meta PlaylistTitle\">\n\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\thref={media.link}\n\t\t\t\t\t\t\t\ttarget=\"_blank\"\n\t\t\t\t\t\t\t\trel=\"noopener noreferrer\">\n\t\t\t\t\t\t\t\t{media.title}\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className=\"Meta PlaylistCreator\">\n\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\thref={playlist.user.link}\n\t\t\t\t\t\t\t\ttarget=\"_blank\"\n\t\t\t\t\t\t\t\trel=\"noopener noreferrer\">\n\t\t\t\t\t\t\t\t{t(\"medias.by\", { artist: playlist.user.name })}\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t);\n\t\t} else if (mediaType === \"track\") {\n\t\t\tconst track = media as Track;\n\t\t\treturn (\n\t\t\t\t<div className=\"Media Track\">\n\t\t\t\t\t{actions}\n\t\t\t\t\t<Cover\n\t\t\t\t\t\tplayable={playable && !!track.preview}\n\t\t\t\t\t\tplaying={playing}\n\t\t\t\t\t\timage={track.album.cover_small}\n\t\t\t\t\t\tonPlay={onPlay}\n\t\t\t\t\t\tonStop={onStop}\n\t\t\t\t\t/>\n\t\t\t\t\t<div className=\"Metas\">\n\t\t\t\t\t\t<div className=\"Meta TrackTitle\">\n\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\thref={track.link}\n\t\t\t\t\t\t\t\ttarget=\"_blank\"\n\t\t\t\t\t\t\t\trel=\"noopener noreferrer\">\n\t\t\t\t\t\t\t\t{track.title}\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className=\"Meta TrackArtist\">\n\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\thref={track.artist.link}\n\t\t\t\t\t\t\t\ttarget=\"_blank\"\n\t\t\t\t\t\t\t\trel=\"noopener noreferrer\">\n\t\t\t\t\t\t\t\t{t(\"medias.by\", { artist: track.artist.name })}\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t);\n\t\t} else {\n\t\t\treturn null;\n\t\t}\n\t}\n);\n","import React from \"react\";\nimport { useTranslation } from \"react-i18next\";\n//\nimport { Media } from \"./Medias\";\nimport { IconButton } from \"../Common/IconButton\";\nimport { Media as MediaData, MediaType } from \"../../utils/medias\";\n\n// ------------------------------------------------------------------\n\nexport const QueueItem = React.memo(\n\t({\n\t\tlocked,\n\t\tmedia,\n\t\tmediaType,\n\t\tplaying,\n\t\tonPlay,\n\t\tonRemove,\n\t\tonStop\n\t}: {\n\t\tlocked: boolean;\n\t\tmedia: MediaData | null; // if null : stiil loading or cannot be loaded or to reload later because of rate limit\n\t\tmediaType: MediaType;\n\t\tplaying: boolean;\n\t\tonPlay: () => void;\n\t\tonRemove: () => void;\n\t\tonStop: () => void;\n\t}) => {\n\t\tconst { t } = useTranslation();\n\t\treturn (\n\t\t\t<div className=\"QueueItem\">\n\t\t\t\t<Media\n\t\t\t\t\tmedia={media}\n\t\t\t\t\tmediaType={mediaType}\n\t\t\t\t\tplayable={!!media && !locked}\n\t\t\t\t\tplaying={playing}\n\t\t\t\t\tonPlay={onPlay}\n\t\t\t\t\tonStop={onStop}\n\t\t\t\t\tactions={\n\t\t\t\t\t\t!locked ? (\n\t\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\t\ttitle={t(\"medias.remove\")}\n\t\t\t\t\t\t\t\ticon=\"trash\"\n\t\t\t\t\t\t\t\tonClick={onRemove}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t) : null\n\t\t\t\t\t}\n\t\t\t\t/>\n\t\t\t</div>\n\t\t);\n\t}\n);\n","const config = {\n\tappIDs: (process.env.REACT_APP_DATABASE_ID || \"\").split(\"|\")\n};\n\n// console.debug('[Firebase] Config', config);\n\nexport default config;\n","export const sleep = (delay: number) =>\n\tnew Promise(resolve => setTimeout(resolve, delay));\n\nexport const onlyUnique = <T>(value: T, index: number, self: T[]) =>\n\tself.indexOf(value) === index;\n\nexport const getFromDict = <T>(dict: { [id: string]: T }, id: string) => {\n\tconst value = dict[id];\n\treturn !value ? void 0 : value;\n};\n\nexport const getFromList = <T extends { id: string }>(\n\tlist: T[],\n\tid: string\n) => {\n\treturn list.find(item => item.id === id);\n};\n\nexport const getFromDictOrList = <T extends { id: string }>(\n\tdict: { [id: string]: T },\n\tlist: T[],\n\tid: string\n) => getFromDict(dict, id) || getFromList(list, id);\n","import * as firebase from \"firebase/app\";\nimport \"firebase/database\";\n//\nimport firebaseConfig from \"../config/firebase\";\nimport { RoomInfo } from \"./rooms\";\nimport { UserInfo } from \"./users\";\nimport { sleep } from \".\";\n\n// ------------------------------------------------------------------\n\ntype FirebaseCB = (eventType: firebase.database.DataSnapshot) => void;\n\n// ------------------------------------------------------------------\n\nconst APPS: {\n\t[id: string]: {\n\t\tapp: firebase.app.App;\n\t\tdatabase: firebase.database.Database;\n\t\tmembers: firebase.database.Reference;\n\t\trooms: firebase.database.Reference;\n\t\tusers: firebase.database.Reference;\n\t};\n} = {};\n\nconst DEFAULT_APP_ID = firebaseConfig.appIDs[0];\n\nconst createOrGetApp = (appId: string = DEFAULT_APP_ID) => {\n\tlet res = APPS[appId];\n\tif (!res) {\n\t\tconsole.debug(\"[Firebase] Creating app\", { appId });\n\t\tconst databaseURL = `https://${appId}.firebaseio.com`;\n\t\tconst app = firebase.initializeApp({ databaseURL });\n\t\tconst database = firebase.database(app);\n\t\tAPPS[appId] = res = {\n\t\t\tapp,\n\t\t\tdatabase,\n\t\t\tmembers: database.ref(\"members\"),\n\t\t\trooms: database.ref(\"rooms\"),\n\t\t\tusers: database.ref(\"users\")\n\t\t};\n\t}\n\treturn res;\n};\n\n// ------------------------------------------------------------------\n\nexport const FirebaseRoom = ({\n\tid,\n\tsecret\n}: {\n\tid: string;\n\tsecret?: string;\n}) => {\n\tconst app = createOrGetApp();\n\tconst _room = app.rooms.child(id);\n\tconst _info = _room.child(\"info\");\n\tconst _members = app.members.child(id);\n\tlet _secret = secret || \"\";\n\tlet _values: RoomInfo = {\n\t\tname: \"dummy\",\n\t\tplaying: false,\n\t\tqueue: {},\n\t\tqueue_position: 0,\n\t\ttimestamp: 0,\n\t\ttype: \"dj\"\n\t};\n\n\tconst getInfo = () => _values;\n\n\tconst isLocked = () => !_secret;\n\n\tconst setSecret = (newSecret: string) => {\n\t\tconsole.debug(\"[Firebase] Setting room secret\", {\n\t\t\toldSecret: _secret,\n\t\t\tnewSecret\n\t\t});\n\t\t_secret = newSecret;\n\t};\n\n\tconst wait = async (): Promise<RoomInfo> =>\n\t\tnew Promise((resolve, reject) => {\n\t\t\tconsole.debug(\"[Firebase] Waiting room...\");\n\t\t\t_info.once(\"value\", snapshot => {\n\t\t\t\tconst newValues = snapshot.val();\n\t\t\t\tif (newValues) {\n\t\t\t\t\t_values = newValues;\n\t\t\t\t\tresolve(_values);\n\t\t\t\t} else {\n\t\t\t\t\treject(new Error(\"rooms.errors.invalid\"));\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\tconst subscribeInfo = (cb: FirebaseCB) => {\n\t\tconsole.debug(\"[Firebase] Subscribing room...\");\n\t\t_info.on(\"value\", cb);\n\t};\n\n\tconst unsubscribeInfo = (cb: FirebaseCB) => {\n\t\tconsole.debug(\"[Firebase] Unsubscribing room...\");\n\t\t_info.off(\"value\", cb);\n\t};\n\n\tconst subscribeMembers = (cbAdded: FirebaseCB, cbRemoved: FirebaseCB) => {\n\t\tconsole.debug(\"[Firebase] Subscribing members...\");\n\t\t_members.on(\"child_added\", cbAdded);\n\t\t_members.on(\"child_removed\", cbRemoved);\n\t};\n\n\tconst unsubscribeMembers = (cbAdded: FirebaseCB, cbRemoved: FirebaseCB) => {\n\t\tconsole.debug(\"[Firebase] Unsubscribing members...\");\n\t\t_members.off(\"child_added\", cbAdded);\n\t\t_members.off(\"child_removed\", cbRemoved);\n\t};\n\n\tconst update = async ({\n\t\tname,\n\t\tplaying,\n\t\tqueue,\n\t\tqueue_position\n\t}: Partial<\n\t\tPick<RoomInfo, \"name\" | \"playing\" | \"queue\" | \"queue_position\">\n\t>) => {\n\t\tconsole.debug(\"[Firebase] Updating room...\", {\n\t\t\tname,\n\t\t\tplaying,\n\t\t\tqueue,\n\t\t\tqueue_position\n\t\t});\n\t\tif (name !== void 0) {\n\t\t\t_values.name = name;\n\t\t}\n\t\tif (playing !== void 0) {\n\t\t\t_values.playing = playing;\n\t\t}\n\t\tif (queue !== void 0) {\n\t\t\t_values.queue = queue;\n\t\t}\n\t\tif (queue_position !== void 0) {\n\t\t\t_values.queue_position = queue_position;\n\t\t}\n\t\tawait _room.set({\n\t\t\tinfo: {\n\t\t\t\t..._values,\n\t\t\t\ttimestamp: firebase.database.ServerValue.TIMESTAMP\n\t\t\t},\n\t\t\tsecret: _secret\n\t\t});\n\t};\n\n\treturn {\n\t\tgetInfo,\n\t\tid,\n\t\tisLocked,\n\t\tsetSecret,\n\t\twait,\n\t\tsubscribeInfo,\n\t\tsubscribeMembers,\n\t\tunsubscribeInfo,\n\t\tunsubscribeMembers,\n\t\tupdate\n\t};\n};\n\n// ------------------------------------------------------------------\n\nexport const FirebaseUser = ({\n\tid,\n\tsecret\n}: {\n\tid: string;\n\tsecret?: string;\n}) => {\n\tconst app = createOrGetApp();\n\tconst _user = app.users.child(id);\n\tconst _info = _user.child(\"info\");\n\tlet _membership: firebase.database.Reference | null = null;\n\tlet _secret = secret || \"\";\n\tlet _values: UserInfo = {\n\t\tname: \"dummy\",\n\t\tonline: false,\n\t\troom_id: \"\",\n\t\tstatus: \"\",\n\t\ttimestamp: 0\n\t};\n\n\tconst getInfo = () => _values;\n\n\tconst isLocked = () => !_secret;\n\n\tconst setSecret = (newSecret: string) => {\n\t\tconsole.debug(\"[Firebase] Setting user secret...\", {\n\t\t\toldSecret: _secret,\n\t\t\tnewSecret\n\t\t});\n\t\t_secret = newSecret;\n\t};\n\n\tconst wait = async (): Promise<UserInfo> =>\n\t\tnew Promise((resolve, reject) => {\n\t\t\tconsole.debug(\"[Firebase] Waiting user...\");\n\t\t\t_info.once(\"value\", snapshot => {\n\t\t\t\tconst newValues = snapshot.val();\n\t\t\t\tif (newValues) {\n\t\t\t\t\t_values = newValues;\n\t\t\t\t\tresolve(_values);\n\t\t\t\t} else {\n\t\t\t\t\treject(new Error(\"users.errors.invalid\"));\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\tconst subscribeInfo = (cb: FirebaseCB) => {\n\t\tconsole.debug(\"[Firebase] Subscribing user...\");\n\t\t_info.on(\"value\", cb);\n\t};\n\n\tconst unsubscribeInfo = (cb: FirebaseCB) => {\n\t\tconsole.debug(\"[Firebase] Unsubscribing user...\");\n\t\t_info.off(\"value\", cb);\n\t};\n\n\tconst update = async ({\n\t\tname,\n\t\troom_id\n\t}: Partial<Pick<UserInfo, \"name\" | \"room_id\">>) => {\n\t\tconsole.debug(\"[Firebase] Updating user...\", { name, room_id });\n\t\tif (name !== void 0) {\n\t\t\t_values.name = name;\n\t\t}\n\t\tif (room_id !== void 0) {\n\t\t\t_values.room_id = room_id;\n\t\t}\n\t\tawait _user.set({\n\t\t\tinfo: {\n\t\t\t\t..._values,\n\t\t\t\tonline: true,\n\t\t\t\tstatus: \"online\",\n\t\t\t\ttimestamp: firebase.database.ServerValue.TIMESTAMP\n\t\t\t},\n\t\t\tsecret: _secret\n\t\t});\n\t\tinstallDisconnect();\n\t};\n\n\tconst installDisconnect = () => {\n\t\tconsole.debug(\"[Firebase] Installing user disconnect...\");\n\t\t_user.onDisconnect().cancel();\n\t\t_user.onDisconnect().set({\n\t\t\tinfo: {\n\t\t\t\t..._values,\n\t\t\t\tonline: false,\n\t\t\t\troom_id: \"\",\n\t\t\t\tstatus: \"disconnected\",\n\t\t\t\ttimestamp: firebase.database.ServerValue.TIMESTAMP\n\t\t\t},\n\t\t\tsecret: _secret\n\t\t});\n\t};\n\n\tconst enter = async (room: ReturnType<typeof FirebaseRoom>) => {\n\t\tconst app = createOrGetApp();\n\t\tif (_membership) {\n\t\t\tawait _membership.remove();\n\t\t\t_membership = null;\n\t\t}\n\t\tawait update({\n\t\t\troom_id: room.id\n\t\t});\n\t\t_membership = app.members.child(room.id).child(id);\n\t\t_membership.onDisconnect().remove();\n\t\tawait _membership.set({\n\t\t\ttimestamp: firebase.database.ServerValue.TIMESTAMP\n\t\t});\n\t};\n\n\tconst exit = async () => {\n\t\tif (_membership) {\n\t\t\tawait _membership.remove();\n\t\t\t_membership = null;\n\t\t}\n\t\tawait update({\n\t\t\troom_id: \"\"\n\t\t});\n\t};\n\n\treturn {\n\t\tid,\n\t\tenter,\n\t\texit,\n\t\tisLocked,\n\t\tsetSecret,\n\t\twait,\n\t\tsubscribeInfo,\n\t\tunsubscribeInfo,\n\t\tupdate,\n\t\tgetInfo\n\t};\n};\n\n// ------------------------------------------------------------------\n\nexport const FirebaseParty = ({\n\tid,\n\troom\n}: {\n\tid: string;\n\troom: ReturnType<typeof FirebaseRoom>;\n}) => {\n\tconst _members: string[] = [];\n\tconst _users: { [id: string]: ReturnType<typeof FirebaseUser> } = {};\n\tlet _info: RoomInfo = {\n\t\tname: \"\",\n\t\tplaying: false,\n\t\tqueue: {},\n\t\tqueue_position: 0,\n\t\ttimestamp: 0,\n\t\ttype: \"dj\"\n\t};\n\n\tconst _onAdded = (added: firebase.database.DataSnapshot) => {\n\t\tconst userId = added.key;\n\t\tif (userId) {\n\t\t\tconst index = _members.indexOf(userId);\n\t\t\tif (index === -1) {\n\t\t\t\t_members.push(userId);\n\t\t\t\t_users[userId] = FirebaseUser({ id: userId });\n\t\t\t\t_log();\n\t\t\t}\n\t\t}\n\t};\n\n\tconst _onRemoved = (removed: firebase.database.DataSnapshot) => {\n\t\tconst userId = removed.key;\n\t\tif (userId) {\n\t\t\tconst index = _members.indexOf(userId);\n\t\t\tif (index !== -1) {\n\t\t\t\t_members.splice(index, 1);\n\t\t\t\tdelete _users[userId];\n\t\t\t\t_log();\n\t\t\t}\n\t\t}\n\t};\n\n\tconst _onRoomInfo = (snapshot: firebase.database.DataSnapshot) => {\n\t\tconst newValues = snapshot.val() as RoomInfo | null;\n\t\tif (newValues) {\n\t\t\t_info = newValues;\n\t\t\t_log();\n\t\t}\n\t};\n\n\tconst _log = () => {\n\t\tconsole.debug(\"PARTY\", {\n\t\t\t_info,\n\t\t\t_members\n\t\t});\n\t};\n\n\tconst init = () => {\n\t\troom.subscribeInfo(_onRoomInfo);\n\t\troom.subscribeMembers(_onAdded, _onRemoved);\n\t};\n\n\tconst terminate = () => {\n\t\troom.unsubscribeInfo(_onRoomInfo);\n\t\troom.unsubscribeMembers(_onAdded, _onRemoved);\n\t};\n\n\treturn {\n\t\tinit,\n\t\tterminate\n\t};\n};\n\n// ------------------------------------------------------------------\n// ------------------------------------------------------------------\n// ------------------------------------------------------------------\n\nexport const testRoom = async () => {\n\tconst room = FirebaseRoom({ id: \"r1\", secret: \"rs1\" });\n\tawait room.update({ name: \"R1\" });\n\troom.subscribeInfo(info => console.debug(\"ROOM\", info.val()));\n\troom.subscribeMembers(\n\t\tmembers => console.debug(\"ADDED\", members.key),\n\t\tmembers => console.debug(\"REMOVED\", members.key)\n\t);\n\tawait room.update({ name: \"R1\" });\n\tawait sleep(1000);\n\tawait room.update({\n\t\tname: \"R1b\",\n\t\tqueue: {},\n\t\tqueue_position: 0\n\t});\n};\n\nexport const testUser = async () => {\n\tconst user = FirebaseUser({ id: \"u1\", secret: \"us1\" });\n\tuser.subscribeInfo(info => console.debug(\"USER\", info.val()));\n\tawait user.update({ name: \"U1\" });\n\tawait sleep(1000);\n\tawait user.update({ name: \"U1b\" });\n};\n\nexport const testParty = async () => {\n\tconst room1 = FirebaseRoom({ id: \"r1\", secret: \"rs1\" });\n\tawait room1.update({ name: \"R1\" });\n\tconst room2 = FirebaseRoom({ id: \"r2\", secret: \"rs2\" });\n\tawait room2.update({ name: \"R2\" });\n\tconst user1 = FirebaseUser({ id: \"u1\", secret: \"us1\" });\n\tawait user1.update({ name: \"U1\" });\n\tconst user2 = FirebaseUser({ id: \"u2\", secret: \"us2\" });\n\tawait user2.update({ name: \"U2\" });\n\n\tawait sleep(2000);\n\n\tconst party1 = FirebaseParty({ id: \"P1\", room: room1 });\n\tawait party1.init();\n\tconst party2 = FirebaseParty({ id: \"P2\", room: room2 });\n\tawait party2.init();\n\n\tawait sleep(1000);\n\tuser1.enter(room1);\n\tawait sleep(1000);\n\tuser2.enter(room1);\n\tawait sleep(1000);\n\tuser1.enter(room2);\n\tawait sleep(1000);\n\tuser1.exit();\n\tawait sleep(1000);\n\tuser1.enter(room1);\n};\n\nexport const test = () => {\n\t// testRoom();\n\t// testUser();\n\t// testParty();\n};\n","export type MessageType = \"error\" | \"info\";\n\nexport type Message = {\n\tid: number;\n\tstamp: number;\n\ttext: string;\n\ttype: MessageType;\n};\n\nexport const extractErrorMessage = (err: any) =>\n\terr.response && err.response.data && err.response.data.message\n\t\t? err.response.data.message\n\t\t: err.message;\n","import { AsyncAction } from \".\";\nimport { RoomQueue } from \"../utils/rooms\";\nimport { displayError } from \"./messages\";\nimport { lockRoom } from \"./room\";\nimport { ProviderType } from \"../utils/medias\";\nimport { extractErrorMessage } from \"../utils/messages\";\n\n// ------------------------------------------------------------------\n\nexport const clearQueue = (): AsyncAction => async (dispatch, getState) => {\n\tconst {\n\t\troom: { room }\n\t} = getState();\n\tif (room && !room.isLocked()) {\n\t\ttry {\n\t\t\tconsole.debug(\"Clearing queue...\");\n\t\t\tawait room.update({ queue: {}, queue_position: 0 });\n\t\t} catch (err) {\n\t\t\tdispatch(displayError(extractErrorMessage(err)));\n\t\t\tdispatch(lockRoom());\n\t\t}\n\t} else {\n\t\tdispatch(displayError(\"rooms.error.locked\"));\n\t}\n};\n\nexport const appendInQueue = (\n\tprovider: ProviderType,\n\ttrackIds: string[]\n): AsyncAction => async (dispatch, getState) => {\n\tconst {\n\t\troom: { room }\n\t} = getState();\n\tif (room && !room.isLocked()) {\n\t\tif (trackIds.length > 0) {\n\t\t\tconst {\n\t\t\t\troom: { medias: queueMedias }\n\t\t\t} = getState();\n\t\t\ttry {\n\t\t\t\tconsole.debug(\"Appending queue...\", { trackIds });\n\t\t\t\tconst queue: RoomQueue = {};\n\t\t\t\t[...queueMedias.map(media => media.id), ...trackIds].forEach(\n\t\t\t\t\t(id, index) => {\n\t\t\t\t\t\tqueue[index] = {\n\t\t\t\t\t\t\tid,\n\t\t\t\t\t\t\tprovider,\n\t\t\t\t\t\t\ttype: \"track\"\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t\tawait room.update({ queue });\n\t\t\t} catch (err) {\n\t\t\t\tdispatch(displayError(extractErrorMessage(err)));\n\t\t\t\tdispatch(lockRoom());\n\t\t\t}\n\t\t}\n\t} else {\n\t\tdispatch(displayError(\"rooms.error.locked\"));\n\t}\n};\n\nexport const removeFromQueue = (index: number): AsyncAction => async (\n\tdispatch,\n\tgetState\n) => {\n\tconst {\n\t\troom: { medias: queueMedias, position, room }\n\t} = getState();\n\tif (room && !room.isLocked()) {\n\t\tif (index < queueMedias.length) {\n\t\t\ttry {\n\t\t\t\tconsole.debug(\"Removing from queue...\", { index });\n\t\t\t\tconst oldIndex = position % queueMedias.length;\n\t\t\t\tconst queue: RoomQueue = {};\n\t\t\t\tconst copy = [...queueMedias];\n\t\t\t\tcopy.splice(index, 1);\n\t\t\t\tcopy.forEach((mediaAccess, index) => {\n\t\t\t\t\tqueue[index] = mediaAccess;\n\t\t\t\t});\n\t\t\t\tawait room.update({\n\t\t\t\t\tqueue,\n\t\t\t\t\tqueue_position: index < oldIndex ? position - 1 : position\n\t\t\t\t});\n\t\t\t} catch (err) {\n\t\t\t\tdispatch(displayError(extractErrorMessage(err)));\n\t\t\t\tdispatch(lockRoom());\n\t\t\t}\n\t\t}\n\t} else {\n\t\tdispatch(displayError(\"rooms.error.locked\"));\n\t}\n};\n\nexport const setQueuePosition = (newPosition: number): AsyncAction => async (\n\tdispatch,\n\tgetState\n) => {\n\tconst {\n\t\troom: { position: oldPosition, room }\n\t} = getState();\n\tif (room && !room.isLocked()) {\n\t\tif (oldPosition !== newPosition) {\n\t\t\ttry {\n\t\t\t\tconsole.debug(\"Set queue position...\", {\n\t\t\t\t\toldPosition,\n\t\t\t\t\tnewPosition\n\t\t\t\t});\n\t\t\t\tawait room.update({ queue_position: newPosition });\n\t\t\t} catch (err) {\n\t\t\t\tdispatch(displayError(extractErrorMessage(err)));\n\t\t\t\tdispatch(lockRoom());\n\t\t\t}\n\t\t}\n\t} else {\n\t\tdispatch(displayError(\"rooms.error.locked\"));\n\t}\n};\n\n// ------------------------------------------------------------------\n\nexport const moveBackward = (): AsyncAction => async (dispatch, getState) => {\n\tconst {\n\t\troom: { medias: queueMedias, position }\n\t} = getState();\n\tif (queueMedias.length > 0) {\n\t\tconsole.debug(\"Moving backward...\");\n\t\tdispatch(\n\t\t\tsetQueuePosition(\n\t\t\t\tposition > 0 ? position - 1 : queueMedias.length - 1\n\t\t\t)\n\t\t);\n\t}\n};\n\nexport const moveForward = (): AsyncAction => async (dispatch, getState) => {\n\tconst {\n\t\troom: { medias: queueMedias, position }\n\t} = getState();\n\tif (queueMedias.length > 0) {\n\t\tconsole.debug(\"Moving forward...\");\n\t\tdispatch(setQueuePosition(position + 1));\n\t}\n};\n","import { AxiosError } from \"axios\";\n//\nimport { createAction, AsyncAction } from \".\";\nimport { displayError } from \"./messages\";\nimport { appendInQueue } from \"./queue\";\nimport { getFromDictOrList, onlyUnique } from \"../utils\";\nimport {\n\tMedia,\n\tMediaType,\n\tProviderType,\n\tTrack,\n\tContainer\n} from \"../utils/medias\";\nimport { extractErrorMessage } from \"../utils/messages\";\n\n// ------------------------------------------------------------------\n\nexport type MediasAction =\n\t| ReturnType<typeof fetching>\n\t| ReturnType<typeof success>\n\t| ReturnType<typeof error>\n\t| ReturnType<typeof reset>\n\t| ReturnType<typeof set>;\n\nconst fetching = () => createAction(\"medias/FETCHING\");\nconst success = () => createAction(\"medias/FETCHED\");\nconst error = (error: AxiosError) => createAction(\"medias/ERROR\", error);\nconst reset = () => createAction(\"medias/RESET\");\nconst set = (medias: Media[]) => createAction(\"medias/SET\", medias);\n\n// ------------------------------------------------------------------\n\nexport const loadMedias = (\n\tprovider: ProviderType,\n\tmediaType: MediaType,\n\tmediaIds: string[],\n\tenqueue: boolean,\n\tpreview: boolean\n): AsyncAction => async (dispatch, getState, { deezer, previewPlayer }) => {\n\tif (mediaIds.length > 0) {\n\t\tconst {\n\t\t\tmedias: { medias }\n\t\t} = getState();\n\t\ttry {\n\t\t\tif (mediaType === \"track\") {\n\t\t\t\t// TRACK\n\t\t\t\tconst { track: oldTracks } = medias;\n\t\t\t\tconst newTrackIds: string[] = mediaIds\n\t\t\t\t\t.filter(trackId => !oldTracks[trackId])\n\t\t\t\t\t.filter(onlyUnique);\n\t\t\t\tlet newTracks: Track[] = [];\n\t\t\t\tif (newTrackIds.length > 0) {\n\t\t\t\t\tconsole.debug(\"Loading tracks...\", {\n\t\t\t\t\t\tmediaIds: newTrackIds\n\t\t\t\t\t});\n\t\t\t\t\tnewTracks = await deezer.loadTracks(newTrackIds);\n\t\t\t\t\tdispatch(set(newTracks));\n\t\t\t\t}\n\t\t\t\tif (enqueue) {\n\t\t\t\t\tconsole.debug(\"Enqueuing tracks...\", { mediaIds });\n\t\t\t\t\tdispatch(appendInQueue(provider, mediaIds));\n\t\t\t\t}\n\t\t\t\tif (preview) {\n\t\t\t\t\tconst trackId = mediaIds[0];\n\t\t\t\t\tconst track = getFromDictOrList(\n\t\t\t\t\t\toldTracks,\n\t\t\t\t\t\tnewTracks,\n\t\t\t\t\t\ttrackId\n\t\t\t\t\t);\n\t\t\t\t\tif (track) {\n\t\t\t\t\t\tconsole.debug(\"Previewing track...\", {\n\t\t\t\t\t\t\ttrack,\n\t\t\t\t\t\t\ttrackId\n\t\t\t\t\t\t});\n\t\t\t\t\t\tawait previewPlayer.play(0, track.id, track.preview, 0);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconsole.debug(\"Cannot load track to preview...\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// CONTAINERS\n\t\t\t\tconst { [mediaType]: oldContainers } = medias;\n\t\t\t\tconst newContainerIds: string[] = mediaIds\n\t\t\t\t\t.filter(containerId => !oldContainers[containerId])\n\t\t\t\t\t.filter(onlyUnique);\n\t\t\t\tlet newContainers: Array<Container> = [];\n\t\t\t\tif (newContainerIds.length > 0) {\n\t\t\t\t\tconsole.debug(\"Loading containers...\", {\n\t\t\t\t\t\tmediaIds: newContainerIds\n\t\t\t\t\t});\n\t\t\t\t\tnewContainers = await deezer.loadContainers(\n\t\t\t\t\t\tmediaType,\n\t\t\t\t\t\tnewContainerIds\n\t\t\t\t\t);\n\n\t\t\t\t\tconst newContainersAndTracks: Media[] = [...newContainers];\n\t\t\t\t\tfor (const container of newContainers) {\n\t\t\t\t\t\tnewContainersAndTracks.push(...container.tracks!);\n\t\t\t\t\t}\n\n\t\t\t\t\tdispatch(set(newContainersAndTracks));\n\t\t\t\t}\n\n\t\t\t\tif (enqueue) {\n\t\t\t\t\tconsole.debug(\"Enqueuing containers tracks...\", {\n\t\t\t\t\t\tmediaIds\n\t\t\t\t\t});\n\t\t\t\t\tfor (const containerId of mediaIds) {\n\t\t\t\t\t\tconst container = getFromDictOrList<Container>(\n\t\t\t\t\t\t\toldContainers,\n\t\t\t\t\t\t\tnewContainers,\n\t\t\t\t\t\t\tcontainerId\n\t\t\t\t\t\t);\n\t\t\t\t\t\tif (container) {\n\t\t\t\t\t\t\tdispatch(\n\t\t\t\t\t\t\t\tappendInQueue(\n\t\t\t\t\t\t\t\t\tprovider,\n\t\t\t\t\t\t\t\t\tcontainer.tracks!.map(track => track.id)\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (preview) {\n\t\t\t\t\tlet track: Track | null = null;\n\t\t\t\t\tfor (const containerId of mediaIds) {\n\t\t\t\t\t\tconst container = getFromDictOrList<Container>(\n\t\t\t\t\t\t\toldContainers,\n\t\t\t\t\t\t\tnewContainers,\n\t\t\t\t\t\t\tcontainerId\n\t\t\t\t\t\t);\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\tcontainer &&\n\t\t\t\t\t\t\tcontainer.tracks &&\n\t\t\t\t\t\t\tcontainer.tracks.length > 0\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\ttrack = container.tracks[0];\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (track) {\n\t\t\t\t\t\tconsole.debug(\"Previewing container first track...\");\n\t\t\t\t\t\tawait previewPlayer.play(0, track.id, track.preview, 0);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconsole.debug(\"Cannot load track to preview...\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t} catch (err) {\n\t\t\tdispatch(displayError(extractErrorMessage(err)));\n\t\t}\n\t}\n};\n","import { createHashHistory } from \"history\";\n\nexport default createHashHistory();\n","import { AxiosError } from \"axios\";\nimport { v4 } from \"uuid\";\n//\nimport { createAction, AsyncAction } from \".\";\nimport { displayError } from \"./messages\";\nimport { RoomInfo } from \"../utils/rooms\";\nimport { FirebaseRoom } from \"../utils/firebase\";\nimport { loadMedias } from \"./medias\";\nimport { MediaAccess } from \"../utils/medias\";\nimport history from \"../utils/history\";\nimport { extractErrorMessage } from \"../utils/messages\";\nimport { RoomData } from \"../reducers/room\";\n\n// ------------------------------------------------------------------\n\nexport type RoomAction =\n\t| ReturnType<typeof fetching>\n\t| ReturnType<typeof success>\n\t| ReturnType<typeof error>\n\t| ReturnType<typeof resetRoom>\n\t| ReturnType<typeof setRoom>;\n\nconst fetching = () => createAction(\"room/FETCHING\");\nconst success = () => createAction(\"room/FETCHED\");\nconst error = (error: AxiosError) => createAction(\"room/ERROR\", error);\nconst resetRoom = () => createAction(\"room/RESET\");\nexport const setRoom = (values: Partial<RoomData>) =>\n\tcreateAction(\"room/SET\", values);\n\n// ------------------------------------------------------------------\n\nexport const createRoom = (\n\tname: string,\n\tsecret: string\n): AsyncAction => async dispatch => {\n\ttry {\n\t\tconst id = v4();\n\t\tconsole.debug(\"Creating room...\", { id, secret });\n\t\tawait FirebaseRoom({ id, secret }).update({ name });\n\t\tdispatch(enterRoom(id, secret));\n\t} catch (err) {\n\t\tdispatch(displayError(extractErrorMessage(err)));\n\t}\n};\n\n// ------------------------------------------------------------------\n\nlet FIREBASE_CB: any = null;\n\nexport const enterRoom = (id: string, secret: string): AsyncAction => async (\n\tdispatch,\n\tgetState\n) => {\n\tconst {\n\t\troom: { room }\n\t} = getState();\n\tif (!room || room.id !== id) {\n\t\tdispatch(exitRoom());\n\t\ttry {\n\t\t\tconsole.debug(\"Entering room...\", { id, secret });\n\t\t\tconst newRoom = FirebaseRoom({ id, secret });\n\t\t\tdispatch(\n\t\t\t\tsetRoom({\n\t\t\t\t\taccess: { id, secret },\n\t\t\t\t\troom: newRoom,\n\t\t\t\t\tinfo: await newRoom.wait()\n\t\t\t\t})\n\t\t\t);\n\t\t\tFIREBASE_CB = newRoom.subscribeInfo(\n\t\t\t\t(snapshot: firebase.database.DataSnapshot) => {\n\t\t\t\t\tconst newInfo = snapshot.val() as RoomInfo;\n\t\t\t\t\tconsole.debug(\n\t\t\t\t\t\t\"[Firebase] Received room update...\",\n\t\t\t\t\t\tnewInfo\n\t\t\t\t\t);\n\t\t\t\t\tlet medias: MediaAccess[] = [];\n\t\t\t\t\tif (newInfo.queue) {\n\t\t\t\t\t\tmedias = Object.entries(newInfo.queue)\n\t\t\t\t\t\t\t.sort(\n\t\t\t\t\t\t\t\t(media1, media2) =>\n\t\t\t\t\t\t\t\t\tNumber(media1[0]) - Number(media2[0])\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t.map(media => media[1]);\n\t\t\t\t\t\tdispatch(\n\t\t\t\t\t\t\tloadMedias(\n\t\t\t\t\t\t\t\t\"deezer\",\n\t\t\t\t\t\t\t\t\"track\",\n\t\t\t\t\t\t\t\tmedias.map(media => media.id),\n\t\t\t\t\t\t\t\tfalse,\n\t\t\t\t\t\t\t\tfalse\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\tdispatch(\n\t\t\t\t\t\tsetRoom({\n\t\t\t\t\t\t\tmedias,\n\t\t\t\t\t\t\tplaying: newInfo.playing,\n\t\t\t\t\t\t\tposition: newInfo.queue_position,\n\t\t\t\t\t\t\troom: newRoom,\n\t\t\t\t\t\t\tinfo: newInfo\n\t\t\t\t\t\t})\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t);\n\t\t\thistory.push(`/room/${id}?secret=${secret}`); // TODO: should push only if we're not already in it\n\t\t} catch (err) {\n\t\t\tdispatch(displayError(extractErrorMessage(err)));\n\t\t}\n\t}\n};\n\nexport const exitRoom = (): AsyncAction => async (dispatch, getState) => {\n\tconst {\n\t\troom: { room }\n\t} = getState();\n\tif (room) {\n\t\tconsole.debug(\"Exiting room...\");\n\t\troom.unsubscribeInfo(FIREBASE_CB);\n\t\tFIREBASE_CB = null;\n\t\tdispatch(resetRoom());\n\t}\n};\n\n// ------------------------------------------------------------------\n\nexport const lockRoom = (): AsyncAction => async (dispatch, getState) => {\n\tconst {\n\t\troom: {\n\t\t\troom,\n\t\t\taccess: { id }\n\t\t}\n\t} = getState();\n\tif (room && room.id === id) {\n\t\tconsole.debug(\"Locking room...\", { id });\n\t\troom.setSecret(\"\");\n\t\thistory.replace(`/room/${id}`);\n\t\tdispatch(setRoom({ access: { id, secret: \"\" } }));\n\t}\n};\n\nexport const unlockRoom = (secret: string): AsyncAction => async (\n\tdispatch,\n\tgetState\n) => {\n\tconst {\n\t\troom: {\n\t\t\troom,\n\t\t\taccess: { id }\n\t\t}\n\t} = getState();\n\tif (room && room.id === id) {\n\t\tconsole.debug(\"Unlocking room...\", { id, secret });\n\t\troom.setSecret(secret);\n\t\thistory.replace(`/room/${id}?secret=${secret}`);\n\t\tdispatch(setRoom({ access: { id, secret } }));\n\t}\n};\n","import * as jimp from \"jimp\";\n\n// ------------------------------------------------------------------\n\nexport type Color = {\n\tr: number;\n\tg: number;\n\tb: number;\n};\n\nexport type CombinedColor = {\n\tbg: Color;\n\tfg: string;\n};\n\nconst CACHE: { [url: string]: CombinedColor } = {};\n\nconst DEFAULT_COLOR = {\n\tbg: { r: 255, g: 255, b: 255 },\n\tfg: \"dark\"\n};\n\n// ------------------------------------------------------------------\n\n// https://stackoverflow.com/questions/3942878/how-to-decide-font-color-in-white-or-black-depending-on-background-color\nexport const pickColor = async (url: string) => {\n\tlet res = DEFAULT_COLOR;\n\tif (url) {\n\t\tres = CACHE[url];\n\t\tif (!res) {\n\t\t\ttry {\n\t\t\t\tconst image = await jimp.read(url);\n\t\t\t\tconst pixel = await image.resize(1, 1).getPixelColor(0, 0);\n\t\t\t\tconst bg = jimp.intToRGBA(pixel);\n\t\t\t\tCACHE[url] = res = {\n\t\t\t\t\tbg,\n\t\t\t\t\tfg:\n\t\t\t\t\t\tbg.r * 0.299 + bg.g * 0.587 + bg.b * 0.114 > 186\n\t\t\t\t\t\t\t? \"dark\"\n\t\t\t\t\t\t\t: \"light\"\n\t\t\t\t};\n\t\t\t} catch (err) {\n\t\t\t\tconsole.debug(\"An error prevented colorpicking\", err);\n\t\t\t}\n\t\t}\n\t}\n\treturn res;\n};\n","import { AsyncAction, createAction, Dispatch } from \".\";\nimport { setRoom } from \"./room\";\nimport { pickColor } from \"../utils/colorpicker\";\nimport { setQueuePosition } from \"./queue\";\nimport { Player } from \"../utils/player\";\nimport { RootState } from \"../reducers\";\nimport { MediaAccess } from \"../utils/medias\";\nimport { displayError } from \"./messages\";\nimport { extractErrorMessage } from \"../utils/messages\";\n\n// ------------------------------------------------------------------\n\nexport type PlayerAction =\n\t| ReturnType<typeof resetPlayer>\n\t| ReturnType<typeof setPlayer>;\n\nconst resetPlayer = () => createAction(\"player/RESET\");\nconst setPlayer = (\n\tvalues: Partial<{ playing: boolean; track_percent: number }>\n) => createAction(\"player/SET\", values);\n\n// ------------------------------------------------------------------\n\nexport const startPlayer = (): AsyncAction => async (\n\tdispatch,\n\tgetState,\n\t{ queuePlayer }\n) => {\n\tif (!PLAYER_TIMER1 && !PLAYER_TIMER2) {\n\t\t_installTimer1(dispatch, getState, queuePlayer);\n\t\t_installTimer2(dispatch, getState, queuePlayer);\n\t\tdispatch(setPlayer({ playing: true }));\n\t}\n};\n\n// ------------------------------------------------------------------\n\nexport const stopPlayer = (): AsyncAction => async (\n\tdispatch,\n\t_,\n\t{ queuePlayer }\n) => {\n\tif (PLAYER_TIMER1 && PLAYER_TIMER2) {\n\t\tclearTimeout(PLAYER_TIMER1);\n\t\tPLAYER_TIMER1 = null;\n\t\tclearTimeout(PLAYER_TIMER2);\n\t\tPLAYER_TIMER2 = null;\n\t\tawait queuePlayer.stop();\n\t\tdispatch(resetPlayer());\n\t}\n};\n\n// ------------------------------------------------------------------\n\nexport const stopPreview = (): AsyncAction => async (\n\t_1,\n\t_2,\n\t{ previewPlayer }\n) => {\n\tconsole.debug(\"Stop previewing...\");\n\tawait previewPlayer.stop();\n};\n\n// ------------------------------------------------------------------\n\nlet PLAYER_TIMER1: NodeJS.Timeout | null = null;\nlet PLAYER_TIMER2: NodeJS.Timeout | null = null;\n\nconst _computeNextPosition = (\n\tqueuePlayer: ReturnType<typeof Player>,\n\tqueueTrackPosition: number,\n\tmedias: MediaAccess[]\n) => {\n\tlet nextPosition = -1;\n\tconst playingTrackID = queuePlayer.getPlayingTrackID();\n\tconst playingTrackPosition = queuePlayer.getPlayingTrackPosition();\n\tif (playingTrackPosition !== queueTrackPosition) {\n\t\tif (queuePlayer.isPlaying()) {\n\t\t\t// User has clicked an other track or added/removed a track in queue\n\t\t\tnextPosition = queueTrackPosition;\n\t\t} else {\n\t\t\t// Not playing which means previous track has terminated\n\t\t\tnextPosition =\n\t\t\t\tplayingTrackPosition >= 0\n\t\t\t\t\t? playingTrackPosition\n\t\t\t\t\t: queueTrackPosition;\n\t\t}\n\t} else if (\n\t\tplayingTrackID !== medias[queueTrackPosition % medias.length].id\n\t) {\n\t\t// User has deleted playing track\n\t\tnextPosition = queueTrackPosition;\n\t}\n\treturn nextPosition;\n};\n\nconst _installTimer1 = (\n\tdispatch: Dispatch,\n\tgetState: () => RootState,\n\tqueuePlayer: ReturnType<typeof Player>\n) => {\n\t// Don't use setInterval because a step could be triggered before previous one terminated\n\tPLAYER_TIMER1 = setTimeout(async () => {\n\t\tconst {\n\t\t\troom: { medias: queueMedias, position },\n\t\t\tmedias: {\n\t\t\t\tmedias: { track: tracks }\n\t\t\t}\n\t\t} = getState();\n\t\tif (queueMedias.length > 0) {\n\t\t\t// Detect and apply change to queue and player\n\t\t\tconst nextTrackPosition = _computeNextPosition(\n\t\t\t\tqueuePlayer,\n\t\t\t\tposition,\n\t\t\t\tqueueMedias\n\t\t\t);\n\t\t\tif (nextTrackPosition >= 0) {\n\t\t\t\tconst nextIndex = nextTrackPosition % queueMedias.length;\n\t\t\t\tconst nextTrack = tracks[queueMedias[nextIndex].id];\n\t\t\t\tconsole.debug(\"Detected play change...\", {\n\t\t\t\t\tnextIndex,\n\t\t\t\t\tnextTrack,\n\t\t\t\t\tnextTrackPosition\n\t\t\t\t});\n\n\t\t\t\ttry {\n\t\t\t\t\tdispatch(setQueuePosition(nextTrackPosition));\n\t\t\t\t\tconst [color] = await Promise.all([\n\t\t\t\t\t\tpickColor(nextTrack.album.cover_small),\n\t\t\t\t\t\tqueuePlayer.play(\n\t\t\t\t\t\t\tnextTrackPosition,\n\t\t\t\t\t\t\tnextTrack.id,\n\t\t\t\t\t\t\tnextTrack.preview,\n\t\t\t\t\t\t\t0\n\t\t\t\t\t\t)\n\t\t\t\t\t]);\n\t\t\t\t\tdispatch(setRoom({ color }));\n\t\t\t\t} catch (err) {\n\t\t\t\t\tdispatch(displayError(extractErrorMessage(err)));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Reschedule time\n\t\t\t_installTimer1(dispatch, getState, queuePlayer);\n\t\t} else {\n\t\t\t// Last track has been removed from queue by user\n\t\t\tconsole.debug(\"No more tracks in queue...\");\n\t\t\tdispatch(stopPlayer());\n\t\t}\n\t}, 250);\n};\n\nconst _installTimer2 = (\n\tdispatch: Dispatch,\n\tgetState: () => RootState,\n\tqueuePlayer: ReturnType<typeof Player>\n) => {\n\t// Don't use setInterval because a step could be triggered before previous one terminated\n\tPLAYER_TIMER2 = setTimeout(() => {\n\t\tconst {\n\t\t\troom: { medias }\n\t\t} = getState();\n\t\tif (medias.length > 0) {\n\t\t\t// Refresh player track percent\n\t\t\tdispatch(\n\t\t\t\tsetPlayer({\n\t\t\t\t\ttrack_percent: queuePlayer.getPlayingTrackPercent()\n\t\t\t\t})\n\t\t\t);\n\n\t\t\t// Reschedule time\n\t\t\t_installTimer2(dispatch, getState, queuePlayer);\n\t\t}\n\t}, 250); // Must do very few operation because called very often (if we put less it creates blink on mobile when playing & scrolling)\n};\n","import React, { useCallback } from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { useTranslation } from \"react-i18next\";\n//\nimport { IconButton } from \"../Common/IconButton\";\nimport { LoadingIcon } from \"../Common/LoadingIcon\";\nimport { QueueItem } from \"./QueueItem\";\nimport { Dispatch } from \"../../actions\";\nimport { RootState } from \"../../reducers\";\nimport { isRoomLoaded, isRoomLocked } from \"../../selectors/room\";\nimport { extractMedias } from \"../../selectors/medias\";\nimport { Media } from \"../../utils/medias\";\nimport { startPlayer, stopPlayer } from \"../../actions/player\";\nimport { setQueuePosition, removeFromQueue } from \"../../actions/queue\";\nimport { openModal } from \"../../actions/modals\";\nimport \"./Queue.scss\";\n\n// ------------------------------------------------------------------\n\nexport const Queue = () => {\n\tconst dispatch = useDispatch<Dispatch>();\n\tconst loaded = useSelector<RootState, boolean>(isRoomLoaded);\n\tconst locked = useSelector<RootState, boolean>(isRoomLocked);\n\tconst playing = useSelector<RootState, boolean>(\n\t\tstate => state.player.playing\n\t);\n\tconst playingIndex = useSelector<RootState, number>(\n\t\tstate => state.room.position % state.room.medias.length\n\t);\n\tconst medias = useSelector<RootState, Array<Media | null>>(state =>\n\t\textractMedias(state, state.room.medias)\n\t);\n\n\tconst onPlay = useCallback(\n\t\t(index: number) => {\n\t\t\tdispatch(startPlayer());\n\t\t\tdispatch(setQueuePosition(index));\n\t\t},\n\t\t[dispatch]\n\t);\n\n\tconst onRemove = useCallback(\n\t\t(index: number) => dispatch(removeFromQueue(index)),\n\t\t[dispatch]\n\t);\n\n\tconst onSearch = useCallback(\n\t\t() => dispatch(openModal({ type: \"Search\", props: null })),\n\t\t[dispatch]\n\t);\n\n\tconst onStop = useCallback(() => dispatch(stopPlayer()), [dispatch]);\n\n\treturn (\n\t\t<div className=\"Queue\">\n\t\t\t{medias.length > 0 ? (\n\t\t\t\t<QueueList\n\t\t\t\t\tlocked={locked}\n\t\t\t\t\tmedias={medias}\n\t\t\t\t\tplaying={playing}\n\t\t\t\t\tplayingIndex={playingIndex}\n\t\t\t\t\tonPlay={onPlay}\n\t\t\t\t\tonRemove={onRemove}\n\t\t\t\t\tonStop={onStop}\n\t\t\t\t/>\n\t\t\t) : (\n\t\t\t\t<EmptyQueueList\n\t\t\t\t\tloaded={loaded}\n\t\t\t\t\tlocked={locked}\n\t\t\t\t\tonSearch={onSearch}\n\t\t\t\t/>\n\t\t\t)}\n\t\t</div>\n\t);\n};\n\n// ------------------------------------------------------------------\n\nconst EmptyQueueList = React.memo(\n\t({\n\t\tloaded,\n\t\tlocked,\n\t\tonSearch\n\t}: {\n\t\tloaded: boolean;\n\t\tlocked: boolean;\n\t\tonSearch: () => void;\n\t}) => {\n\t\tconst { t } = useTranslation();\n\t\treturn (\n\t\t\t<div className=\"QueueEmpty\">\n\t\t\t\t{loaded ? (\n\t\t\t\t\t<>\n\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\ttitle=\"...\"\n\t\t\t\t\t\t\ticon=\"shower\"\n\t\t\t\t\t\t\tonClick={onSearch}\n\t\t\t\t\t\t\tsize=\"L\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<span onClick={onSearch}>\n\t\t\t\t\t\t\t{t(locked ? \"rooms.empty_for_now\" : \"rooms.empty\")}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</>\n\t\t\t\t) : (\n\t\t\t\t\t<>\n\t\t\t\t\t\t<LoadingIcon size=\"L\" />\n\t\t\t\t\t\t<span>{t(\"rooms.loading\")}</span>\n\t\t\t\t\t</>\n\t\t\t\t)}\n\t\t\t</div>\n\t\t);\n\t}\n);\n\n// ------------------------------------------------------------------\n\nconst QueueList = React.memo(\n\t({\n\t\tlocked,\n\t\tmedias,\n\t\tplaying,\n\t\tplayingIndex,\n\t\tonPlay,\n\t\tonRemove,\n\t\tonStop\n\t}: {\n\t\tlocked: boolean;\n\t\tmedias: Array<Media | null>;\n\t\tplaying: boolean;\n\t\tplayingIndex: number;\n\t\tonPlay: (index: number) => void;\n\t\tonRemove: (index: number) => void;\n\t\tonStop: () => void;\n\t}) => (\n\t\t<>\n\t\t\t{medias.map((media, index) => (\n\t\t\t\t<QueueItem\n\t\t\t\t\tkey={index}\n\t\t\t\t\tlocked={locked}\n\t\t\t\t\tplaying={playing && playingIndex === index}\n\t\t\t\t\tmedia={media}\n\t\t\t\t\tmediaType=\"track\"\n\t\t\t\t\tonPlay={() => onPlay(index)}\n\t\t\t\t\tonRemove={() => onRemove(index)}\n\t\t\t\t\tonStop={onStop}\n\t\t\t\t/>\n\t\t\t))}\n\t\t</>\n\t)\n);\n","import { RootState } from \"../reducers\";\nimport { Media, MediaAccess } from \"../utils/medias\";\n\n// ------------------------------------------------------------------\n\nexport const extractMedias = (\n\tstate: RootState,\n\tmediaAccesses: MediaAccess[]\n) => {\n\tconst res: Array<Media | null> = [];\n\tconst {\n\t\tmedias: { medias }\n\t} = state;\n\tfor (const mediaAccess of mediaAccesses) {\n\t\tconst media = medias[mediaAccess.type][mediaAccess.id];\n\t\tif (!!media) {\n\t\t\tres.push(media);\n\t\t} else {\n\t\t\tres.push(null); // Stiil loading or cannot be loaded or to reload later because of rate limit\n\t\t}\n\t}\n\treturn res;\n};\n","import React from \"react\";\nimport { useSelector } from \"react-redux\";\n//\nimport { RootState } from \"../../reducers\";\nimport \"./Progress.scss\";\n\n// ------------------------------------------------------------------\n\nexport const Progress = () => {\n\tconst value = useSelector<RootState, number>(\n\t\tstate => state.player.track_percent\n\t);\n\treturn (\n\t\t<div className=\"Progress\">\n\t\t\t<progress max={100} value={value * 100} />\n\t\t</div>\n\t);\n};\n","import React, { useCallback } from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { useTranslation } from \"react-i18next\";\n//\nimport { IconButton } from \"../Common/IconButton\";\nimport { Progress } from \"./Progress\";\nimport { Dispatch } from \"../../actions\";\nimport { RootState } from \"../../reducers\";\nimport { isRoomLocked } from \"../../selectors/room\";\nimport { lockRoom } from \"../../actions/room\";\nimport { clearQueue, moveBackward, moveForward } from \"../../actions/queue\";\nimport { stopPlayer, startPlayer } from \"../../actions/player\";\nimport { confirmModal, openModal } from \"../../actions/modals\";\nimport \"./Controls.scss\";\n\n// ------------------------------------------------------------------\n\nexport const Controls = () => {\n\tconst dispatch = useDispatch<Dispatch>();\n\tconst { t } = useTranslation();\n\tconst tracksCount = useSelector<RootState, number>(\n\t\tstate => state.room.medias.length\n\t);\n\tconst locked = useSelector<RootState, boolean>(isRoomLocked);\n\tconst playing = useSelector<RootState, boolean>(\n\t\tstate => state.player.playing\n\t);\n\n\tconst onClear = useCallback(() => {\n\t\tdispatch(\n\t\t\tconfirmModal(t(\"rooms.confirm_clear\"), () => {\n\t\t\t\tdispatch(clearQueue());\n\t\t\t\tdispatch(stopPlayer());\n\t\t\t})\n\t\t);\n\t}, [dispatch, t]);\n\n\tconst onLock = useCallback(() => {\n\t\tdispatch(\n\t\t\tconfirmModal(t(\"rooms.confirm_lock\"), () => {\n\t\t\t\tdispatch(lockRoom());\n\t\t\t})\n\t\t);\n\t}, [dispatch, t]);\n\n\tconst onUnlock = useCallback(() => {\n\t\tdispatch(openModal({ type: \"UnlockRoom\", props: null }));\n\t}, [dispatch]);\n\n\tconst onMoveBackward = useCallback(() => dispatch(moveBackward()), [\n\t\tdispatch\n\t]);\n\n\tconst onMoveForward = useCallback(() => dispatch(moveForward()), [\n\t\tdispatch\n\t]);\n\n\tconst onPlay = useCallback(() => dispatch(startPlayer()), [dispatch]);\n\n\tconst onSearch = useCallback(\n\t\t() => dispatch(openModal({ type: \"Search\", props: null })),\n\t\t[dispatch]\n\t);\n\n\tconst onStop = useCallback(() => dispatch(stopPlayer()), [dispatch]);\n\n\treturn (\n\t\t<div className=\"Controls\">\n\t\t\t<div className=\"ControlsSet\">\n\t\t\t\t<div className=\"Control\">\n\t\t\t\t\t<IconButton\n\t\t\t\t\t\tdisabled={locked || tracksCount === 0}\n\t\t\t\t\t\ticon=\"step-backward\"\n\t\t\t\t\t\tonClick={onMoveBackward}\n\t\t\t\t\t\tsize=\"M\"\n\t\t\t\t\t\ttitle={t(\"player.backward\")}\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div className=\"Control\">\n\t\t\t\t\t{!playing ? (\n\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\tdisabled={locked || tracksCount === 0}\n\t\t\t\t\t\t\tonClick={onPlay}\n\t\t\t\t\t\t\ticon=\"play\"\n\t\t\t\t\t\t\tsize=\"L\"\n\t\t\t\t\t\t\ttitle={t(\"player.play\")}\n\t\t\t\t\t\t/>\n\t\t\t\t\t) : (\n\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\tdisabled={locked || tracksCount === 0}\n\t\t\t\t\t\t\tonClick={onStop}\n\t\t\t\t\t\t\ticon=\"pause\"\n\t\t\t\t\t\t\ttitle={t(\"player.stop\")}\n\t\t\t\t\t\t\tsize=\"L\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t)}\n\t\t\t\t</div>\n\t\t\t\t<div className=\"Control\">\n\t\t\t\t\t<IconButton\n\t\t\t\t\t\tdisabled={locked || tracksCount === 0}\n\t\t\t\t\t\ticon=\"step-forward\"\n\t\t\t\t\t\tonClick={onMoveForward}\n\t\t\t\t\t\tsize=\"M\"\n\t\t\t\t\t\ttitle={t(\"player.forward\")}\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<Progress />\n\t\t\t<div className=\"ControlsSet\">\n\t\t\t\t<div className=\"Control\">\n\t\t\t\t\t<IconButton\n\t\t\t\t\t\tdisabled={locked || tracksCount === 0}\n\t\t\t\t\t\tonClick={onClear}\n\t\t\t\t\t\ticon=\"trash\"\n\t\t\t\t\t\ttitle={t(\"rooms.clear\")}\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div className=\"Control\">\n\t\t\t\t\t<IconButton\n\t\t\t\t\t\tonClick={onSearch}\n\t\t\t\t\t\ticon=\"search\"\n\t\t\t\t\t\ttitle={t(\"medias.search\")}\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div className=\"Control\">\n\t\t\t\t\t{locked ? (\n\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\ticon=\"lock\"\n\t\t\t\t\t\t\tonClick={onUnlock}\n\t\t\t\t\t\t\tsize=\"M\"\n\t\t\t\t\t\t\ttitle={t(\"rooms.locked\")}\n\t\t\t\t\t\t/>\n\t\t\t\t\t) : (\n\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\ticon=\"unlock\"\n\t\t\t\t\t\t\tonClick={onLock}\n\t\t\t\t\t\t\tsize=\"M\"\n\t\t\t\t\t\t\ttitle={t(\"rooms.unlocked\")}\n\t\t\t\t\t\t/>\n\t\t\t\t\t)}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t);\n};\n","import React, { useEffect } from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { useLocation, useParams } from \"react-router-dom\";\nimport classNames from \"classnames\";\nimport qs from \"qs\";\n//\nimport { Head } from \"../components/Room/Head\";\nimport { Queue } from \"../components/Room/Queue\";\nimport { Controls } from \"../components/Room/Controls\";\nimport { RootState } from \"../reducers\";\nimport { CombinedColor } from \"../utils/colorpicker\";\nimport { exitRoom, enterRoom } from \"../actions/room\";\nimport { Dispatch } from \"../actions\";\nimport \"./Room.scss\";\n\n// ------------------------------------------------------------------\n\nexport const Room = () => {\n\tconst dispatch = useDispatch<Dispatch>();\n\tconst { fg, bg } = useSelector<RootState, CombinedColor>(\n\t\tstate => state.room.color\n\t);\n\n\tconst { search } = useLocation();\n\tconst { room_id } = useParams<{\n\t\troom_id: string;\n\t}>();\n\n\tconst { secret } = qs.parse(search.substr(1)) as {\n\t\tsecret?: string;\n\t};\n\n\tuseEffect(() => {\n\t\tdispatch(enterRoom(room_id, secret || \"\"));\n\n\t\treturn () => {\n\t\t\tdispatch(exitRoom());\n\t\t};\n\t}, [dispatch, room_id, secret]);\n\n\treturn (\n\t\t<div\n\t\t\tclassName={classNames(\"Room\", fg)}\n\t\t\tstyle={{\n\t\t\t\tbackgroundColor: `rgb(${bg.r}, ${bg.g}, ${bg.b})`\n\t\t\t}}>\n\t\t\t<Head />\n\t\t\t<Queue />\n\t\t\t<Controls />\n\t\t</div>\n\t);\n};\n","import { AxiosError } from \"axios\";\nimport { v4 } from \"uuid\";\n//\nimport { createAction, AsyncAction } from \".\";\nimport { UserInfo } from \"../utils/users\";\nimport { FirebaseUser } from \"../utils/firebase\";\nimport { displayError } from \"./messages\";\nimport { extractErrorMessage } from \"../utils/messages\";\nimport { UserData } from \"../reducers/user\";\n\n// ------------------------------------------------------------------\n\nexport type UserAction =\n\t| ReturnType<typeof fetching>\n\t| ReturnType<typeof success>\n\t| ReturnType<typeof error>\n\t| ReturnType<typeof resetUser>\n\t| ReturnType<typeof setUser>;\n\nconst fetching = () => createAction(\"user/FETCHING\");\nconst success = () => createAction(\"user/FETCHED\");\nconst error = (error: AxiosError) => createAction(\"user/ERROR\", error);\nconst resetUser = () => createAction(\"user/RESET\");\nconst setUser = (values: Partial<UserData>) => createAction(\"user/SET\", values);\n\n// ------------------------------------------------------------------\n\nexport const createUser = (\n\tname: string,\n\tsecret: string\n): AsyncAction => async dispatch => {\n\ttry {\n\t\tconsole.debug(\"Creating user...\");\n\t\tconst id = v4();\n\t\tawait FirebaseUser({ id, secret }).update({ name });\n\t\tdispatch(connectUser(id, secret));\n\t} catch (err) {\n\t\tdispatch(displayError(extractErrorMessage(err)));\n\t}\n};\n\n// ------------------------------------------------------------------\n\nlet FIREBASE_CB: any = null;\n\nexport const connectUser = (id: string, secret: string): AsyncAction => async (\n\tdispatch,\n\tgetState\n) => {\n\tconst {\n\t\tuser: { user }\n\t} = getState();\n\tif (!user || user.id !== id) {\n\t\tdispatch(disconnectUser());\n\t\ttry {\n\t\t\tconsole.debug(\"Connection user...\", { id, secret });\n\t\t\tconst newUser = FirebaseUser({ id, secret });\n\t\t\tdispatch(\n\t\t\t\tsetUser({\n\t\t\t\t\taccess: { id, secret },\n\t\t\t\t\tuser: newUser,\n\t\t\t\t\tinfo: await newUser.wait()\n\t\t\t\t})\n\t\t\t);\n\t\t\tFIREBASE_CB = newUser.subscribeInfo(\n\t\t\t\t(snapshot: firebase.database.DataSnapshot) => {\n\t\t\t\t\tconst newInfo = snapshot.val() as UserInfo;\n\t\t\t\t\tconsole.debug(\n\t\t\t\t\t\t\"[Firebase] Received user update...\",\n\t\t\t\t\t\tnewInfo\n\t\t\t\t\t);\n\t\t\t\t\tdispatch(setUser({ user: newUser, info: newInfo }));\n\t\t\t\t}\n\t\t\t);\n\t\t} catch (err) {\n\t\t\tdispatch(displayError(extractErrorMessage(err)));\n\t\t\tdispatch(setUser({ access: { id, secret: \"\" } }));\n\t\t}\n\t}\n};\n\nexport const disconnectUser = (): AsyncAction => async (dispatch, getState) => {\n\tconst {\n\t\tuser: {\n\t\t\taccess: { id, secret },\n\t\t\tuser\n\t\t}\n\t} = getState();\n\tif (id || secret || user) {\n\t\tconsole.debug(\"Disconnecting user...\");\n\t\tif (user) {\n\t\t\tuser.unsubscribeInfo(FIREBASE_CB);\n\t\t\tFIREBASE_CB = null;\n\t\t}\n\t\tdispatch(resetUser());\n\t}\n};\n\nexport const reconnectUser = (): AsyncAction => async (dispatch, getState) => {\n\tconst {\n\t\tuser: {\n\t\t\taccess: { id, secret }\n\t\t}\n\t} = getState();\n\tif (id && secret) {\n\t\tconsole.debug(\"Reconnecting user...\", { id, secret });\n\t\tdispatch(connectUser(id, secret));\n\t}\n};\n","import React, { useCallback } from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { Link } from \"react-router-dom\";\nimport { useTranslation } from \"react-i18next\";\n//\nimport { IconButton } from \"../components/Common/IconButton\";\nimport { RootState } from \"../reducers\";\nimport { openModal } from \"../actions/modals\";\nimport { disconnectUser } from \"../actions/user\";\nimport \"./Splash.scss\";\n\n// ------------------------------------------------------------------\n\nexport const Splash = () => {\n\tconst dispatch = useDispatch();\n\tconst loggedIn = useSelector<RootState, boolean>(\n\t\tstate => !!state.user.access.id\n\t);\n\tconst { t } = useTranslation();\n\n\tconst onCreateRoom = useCallback(\n\t\t() => dispatch(openModal({ type: \"CreateRoom\", props: null })),\n\t\t[dispatch]\n\t);\n\n\tconst onConnectUser = useCallback(\n\t\t() => dispatch(openModal({ type: \"CreateUser\", props: null })),\n\t\t[dispatch]\n\t);\n\n\tconst onDisconnect = useCallback(() => dispatch(disconnectUser()), [\n\t\tdispatch\n\t]);\n\n\treturn (\n\t\t<div className=\"Splash\">\n\t\t\t<div className=\"Top\">\n\t\t\t\t<div className=\"Logo\">\n\t\t\t\t\t<Link to=\"/\">Party</Link>\n\t\t\t\t</div>\n\t\t\t\t<div className=\"PoweredWith\">\n\t\t\t\t\t<span>{t(\"splash.powered_with\")}</span>\n\t\t\t\t\t<a\n\t\t\t\t\t\thref=\"https://www.deezer.com\"\n\t\t\t\t\t\ttarget=\"_blank\"\n\t\t\t\t\t\trel=\"noopener noreferrer\">\n\t\t\t\t\t\t<img\n\t\t\t\t\t\t\tsrc=\"/images/deezer.svg\"\n\t\t\t\t\t\t\theight=\"20px\"\n\t\t\t\t\t\t\ttitle=\"Deezer\"\n\t\t\t\t\t\t\talt=\"Deezer Logo\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</a>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div className=\"Middle\">\n\t\t\t\t<div className=\"Menu\">\n\t\t\t\t\t{loggedIn ? (\n\t\t\t\t\t\t<div className=\"MenuItem\">\n\t\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\t\tdisplayTitle={true}\n\t\t\t\t\t\t\t\ticon=\"plus\"\n\t\t\t\t\t\t\t\tonClick={onCreateRoom}\n\t\t\t\t\t\t\t\tsize=\"L\"\n\t\t\t\t\t\t\t\ttitle={t(\"rooms.create\")}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t) : (\n\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t<div className=\"MenuItem\">\n\t\t\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\t\t\tdisplayTitle={true}\n\t\t\t\t\t\t\t\t\tonClick={onConnectUser}\n\t\t\t\t\t\t\t\t\ticon=\"sign-in\"\n\t\t\t\t\t\t\t\t\tsize=\"L\"\n\t\t\t\t\t\t\t\t\ttitle={t(\"users.connect\")}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</>\n\t\t\t\t\t)}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div className=\"Bottom\">\n\t\t\t\t<div className=\"Menu\">\n\t\t\t\t\t{loggedIn ? (\n\t\t\t\t\t\t<div className=\"MenuItem\">\n\t\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\t\tdisplayTitle={true}\n\t\t\t\t\t\t\t\ticon=\"sign-out\"\n\t\t\t\t\t\t\t\tonClick={onDisconnect}\n\t\t\t\t\t\t\t\tsize=\"M\"\n\t\t\t\t\t\t\t\ttitle={t(\"users.disconnect\")}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t) : (\n\t\t\t\t\t\t<div className=\"MenuItem\">\n\t\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\t\tdisplayTitle={true}\n\t\t\t\t\t\t\t\ticon=\"info\"\n\t\t\t\t\t\t\t\tonClick={() => {}}\n\t\t\t\t\t\t\t\tsize=\"M\"\n\t\t\t\t\t\t\t\ttitle={t(\"splash.CGU\")}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t);\n};\n","import React, { FormEvent, ReactNode, useCallback } from \"react\";\nimport classNames from \"classnames\";\nimport { useTranslation } from \"react-i18next\";\n//\nimport { IconButton } from \"../Common/IconButton\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { RootState } from \"../../reducers\";\nimport { Dispatch } from \"../../actions\";\nimport { popModal, closeModal } from \"../../actions/modals\";\n\n// ------------------------------------------------------------------\n\nexport const Modal = ({\n\tchildren,\n\tclassName,\n\ttitle,\n\trenderFoot,\n\tonSubmit\n}: {\n\tchildren: ReactNode;\n\tclassName?: string;\n\ttitle: string;\n\trenderFoot?: () => React.ReactNode;\n\tonSubmit?: () => void;\n}) => {\n\tconst dispatch = useDispatch<Dispatch>();\n\tconst { t } = useTranslation();\n\tconst has_prev_modal = useSelector<RootState, boolean>(\n\t\tstate => state.modals.stack.length > 1\n\t);\n\n\tconst onClose = useCallback(() => dispatch(closeModal()), [dispatch]);\n\tconst onPop = useCallback(() => dispatch(popModal()), [dispatch]);\n\n\treturn (\n\t\t<form\n\t\t\tclassName={classNames(\"Modal\", className)}\n\t\t\tonSubmit={(event: FormEvent<HTMLFormElement>) => {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tif (onSubmit) {\n\t\t\t\t\tonSubmit();\n\t\t\t\t}\n\t\t\t}}>\n\t\t\t<div className=\"ModalHead\">\n\t\t\t\t<IconButton\n\t\t\t\t\tkind=\"special\"\n\t\t\t\t\tclassName={classNames(\"ModalHeadBack\", {\n\t\t\t\t\t\thidden: !has_prev_modal\n\t\t\t\t\t})}\n\t\t\t\t\ticon=\"angle-left\"\n\t\t\t\t\ttitle=\"Back\"\n\t\t\t\t\tonClick={onPop}\n\t\t\t\t/>\n\t\t\t\t<div className=\"ModalTitle\">{title}</div>\n\t\t\t\t<IconButton\n\t\t\t\t\tkind=\"special\"\n\t\t\t\t\tclassName=\"ModalHeadClose\"\n\t\t\t\t\tonClick={onClose}\n\t\t\t\t\ttitle={t(\"cancel\")}\n\t\t\t\t\ticon=\"times\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<div className=\"ModalBody\">{children}</div>\n\t\t\t<div className=\"ModalFoot\">{renderFoot && renderFoot()}</div>\n\t\t</form>\n\t);\n};\n","import React, { ReactNode } from \"react\";\nimport classNames from \"classnames\";\n//\nimport { Modal } from \"./Modal\";\nimport \"./FormModal.scss\";\n\n// ------------------------------------------------------------------\n\nexport const FormModal = ({\n\tchildren,\n\tclassName,\n\trenderButtons,\n\ttitle,\n\tonSubmit\n}: {\n\tchildren: ReactNode;\n\tclassName?: string;\n\tonSubmit: () => void;\n\trenderButtons: () => React.ReactNode;\n\ttitle: string;\n}) => (\n\t<Modal\n\t\tclassName={classNames(\"FormModal\", className)}\n\t\ttitle={title}\n\t\trenderFoot={renderButtons}\n\t\tonSubmit={onSubmit}>\n\t\t{children}\n\t</Modal>\n);\n","import React from \"react\";\nimport { useTranslation } from \"react-i18next\";\n//\nimport { IconButton } from \"./IconButton\";\n\n// ------------------------------------------------------------------\n\nexport const CancelButton = ({ onClick }: { onClick: () => void }) => {\n\tconst { t } = useTranslation();\n\treturn (\n\t\t<IconButton\n\t\t\tonClick={onClick}\n\t\t\ttitle={t(\"cancel\")}\n\t\t\tkind=\"default\"\n\t\t\ticon=\"ban\"\n\t\t/>\n\t);\n};\n","import React, { useCallback } from \"react\";\nimport { useTranslation } from \"react-i18next\";\n//\nimport { FormModal } from \"../Modals/FormModal\";\nimport { IconButton } from \"../Common/IconButton\";\nimport { CancelButton } from \"../Common/CancelButton\";\nimport { useDispatch } from \"react-redux\";\nimport { Dispatch } from \"../../actions\";\nimport { popModal } from \"../../actions/modals\";\n\n// ------------------------------------------------------------------\n\nexport const ConfirmModal = ({\n\tquestion,\n\tonCanceled,\n\tonConfirmed\n}: {\n\tquestion: string;\n\tonCanceled?: () => void;\n\tonConfirmed: () => void;\n}) => {\n\tconst dispatch = useDispatch<Dispatch>();\n\tconst { t } = useTranslation();\n\n\tconst onCancel = useCallback(() => {\n\t\tdispatch(popModal());\n\t\tif (onCanceled) {\n\t\t\tonCanceled();\n\t\t}\n\t}, [dispatch, onCanceled]);\n\n\treturn (\n\t\t<FormModal\n\t\t\ttitle={t(\"confirm\")}\n\t\t\tonSubmit={onConfirmed}\n\t\t\trenderButtons={() => (\n\t\t\t\t<>\n\t\t\t\t\t<IconButton\n\t\t\t\t\t\ttitle={t(\"cancel\")}\n\t\t\t\t\t\tkind=\"primary\"\n\t\t\t\t\t\ticon=\"plus\"\n\t\t\t\t\t\ttype=\"submit\"\n\t\t\t\t\t/>\n\t\t\t\t\t<CancelButton onClick={onCancel} />\n\t\t\t\t</>\n\t\t\t)}>\n\t\t\t{question}\n\t\t</FormModal>\n\t);\n};\n","import React, { useCallback } from \"react\";\nimport { useTranslation } from \"react-i18next\";\n//\nimport { copyToClipboard } from \"../../utils/clipboard\";\nimport { IconButton } from \"../Common/IconButton\";\nimport { displayInfo } from \"../../actions/messages\";\nimport { useDispatch } from \"react-redux\";\n\n// ------------------------------------------------------------------\n\nexport const SECRET_FIELD_SIZE = 36;\n\nexport const SecretField = ({\n\tid,\n\tlabel,\n\tonChange,\n\tplaceholder,\n\tvalue\n}: {\n\tid: string;\n\tlabel: string;\n\tonChange: (value: string) => void;\n\tplaceholder: string;\n\tvalue: string;\n}) => {\n\tconst dispatch = useDispatch();\n\tconst { t } = useTranslation();\n\n\tconst onCopyToClipboard = useCallback(async () => {\n\t\tawait copyToClipboard(value);\n\t\tdispatch(displayInfo(\"secret_copied_to_clipboard\"));\n\t}, [dispatch, value]);\n\n\treturn (\n\t\t<div className=\"ModalField\">\n\t\t\t<label htmlFor={id}>{label}</label>\n\t\t\t<div\n\t\t\t\tstyle={{\n\t\t\t\t\tdisplay: \"flex\",\n\t\t\t\t\tflexDirection: \"row\",\n\t\t\t\t\tjustifyContent: \"space-between\"\n\t\t\t\t}}>\n\t\t\t\t<input\n\t\t\t\t\tstyle={{\n\t\t\t\t\t\tflexGrow: 1,\n\t\t\t\t\t\tmarginRight: \"0.5rem\"\n\t\t\t\t\t}}\n\t\t\t\t\tid={id}\n\t\t\t\t\ttype=\"password\"\n\t\t\t\t\tautoComplete=\"password\"\n\t\t\t\t\tplaceholder={placeholder}\n\t\t\t\t\tmaxLength={SECRET_FIELD_SIZE}\n\t\t\t\t\tminLength={SECRET_FIELD_SIZE}\n\t\t\t\t\trequired={true}\n\t\t\t\t\tvalue={value}\n\t\t\t\t\tonChange={e => onChange(e.target.value)}\n\t\t\t\t/>\n\t\t\t\t<IconButton\n\t\t\t\t\ticon=\"clipboard\"\n\t\t\t\t\tonClick={onCopyToClipboard}\n\t\t\t\t\tsize=\"M\"\n\t\t\t\t\ttitle={t(\"copy_to_clipboard\")}\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t);\n};\n","import React, { useRef, useState, useEffect, useCallback } from \"react\";\nimport { useDispatch } from \"react-redux\";\nimport { useTranslation } from \"react-i18next\";\n//\nimport { FormModal } from \"../Modals/FormModal\";\nimport { IconButton } from \"../Common/IconButton\";\nimport { CancelButton } from \"../Common/CancelButton\";\nimport { popModal, openModal } from \"../../actions/modals\";\nimport { displayError } from \"../../actions/messages\";\nimport { connectUser } from \"../../actions/user\";\nimport { Dispatch } from \"../../actions\";\nimport { SECRET_FIELD_SIZE } from \"../Modals/SecretField\";\n\n// ------------------------------------------------------------------\n\nexport const ConnectUserModal = () => {\n\tconst dispatch = useDispatch<Dispatch>();\n\tconst [id, setId] = useState(\"\");\n\tconst [secret, setSecret] = useState(\"\");\n\tconst idRef = useRef<HTMLInputElement>(null);\n\tconst { t } = useTranslation();\n\n\tuseEffect(() => {\n\t\tif (idRef.current) {\n\t\t\tidRef.current.focus();\n\t\t}\n\t});\n\n\tconst onClose = useCallback(() => dispatch(popModal()), [dispatch]);\n\n\tconst onConnect = useCallback(() => {\n\t\tif (id.trim().length === 0) {\n\t\t\tdispatch(displayError(\"users.id_is_invalid\"));\n\t\t\treturn;\n\t\t}\n\t\tif (secret.trim().length === 0) {\n\t\t\tdispatch(displayError(\"users.secret_is_invalid\"));\n\t\t\treturn;\n\t\t}\n\t\tdispatch(connectUser(id, secret));\n\t\tdispatch(popModal());\n\t}, [dispatch, id, secret]);\n\n\tconst onToggle = useCallback(\n\t\t() => dispatch(openModal({ type: \"CreateUser\", props: null })),\n\t\t[dispatch]\n\t);\n\n\treturn (\n\t\t<FormModal\n\t\t\ttitle={t(\"users.connection\")}\n\t\t\tonSubmit={onConnect}\n\t\t\trenderButtons={() => (\n\t\t\t\t<>\n\t\t\t\t\t<IconButton\n\t\t\t\t\t\tdisabled={\n\t\t\t\t\t\t\tid.trim().length === 0 ||\n\t\t\t\t\t\t\tsecret.length !== SECRET_FIELD_SIZE\n\t\t\t\t\t\t}\n\t\t\t\t\t\ttitle={t(\"users.connect\")}\n\t\t\t\t\t\tkind=\"primary\"\n\t\t\t\t\t\ticon=\"sign-in\"\n\t\t\t\t\t\ttype=\"submit\"\n\t\t\t\t\t/>\n\t\t\t\t\t<CancelButton onClick={onClose} />\n\t\t\t\t\t<IconButton\n\t\t\t\t\t\ttitle={t(\"users.create\")}\n\t\t\t\t\t\tkind=\"default\"\n\t\t\t\t\t\ticon=\"plus\"\n\t\t\t\t\t\tonClick={onToggle}\n\t\t\t\t\t/>\n\t\t\t\t</>\n\t\t\t)}>\n\t\t\t<div className=\"ModalField\">\n\t\t\t\t<label htmlFor=\"modal-id\">{t(\"users.user_id\")}</label>\n\t\t\t\t<input\n\t\t\t\t\tid=\"modal-id\"\n\t\t\t\t\ttype=\"text\"\n\t\t\t\t\tplaceholder={t(\"users.id_placeholder\")}\n\t\t\t\t\tmaxLength={36}\n\t\t\t\t\tminLength={36}\n\t\t\t\t\trequired={true}\n\t\t\t\t\tvalue={id}\n\t\t\t\t\tref={idRef}\n\t\t\t\t\tonChange={e => setId(e.target.value)}\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<div className=\"ModalField\">\n\t\t\t\t<label htmlFor=\"modal-secret\">{t(\"users.secret\")}</label>\n\t\t\t\t<input\n\t\t\t\t\tid=\"modal-secret\"\n\t\t\t\t\ttype=\"password\"\n\t\t\t\t\tautoComplete=\"password\"\n\t\t\t\t\tplaceholder={t(\"users.secret_placeholder\")}\n\t\t\t\t\tmaxLength={36}\n\t\t\t\t\tminLength={36}\n\t\t\t\t\trequired={true}\n\t\t\t\t\tvalue={secret}\n\t\t\t\t\tonChange={e => setSecret(e.target.value)}\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</FormModal>\n\t);\n};\n","import React, { useState, useRef, useEffect, useCallback } from \"react\";\nimport { useDispatch } from \"react-redux\";\nimport { useTranslation } from \"react-i18next\";\nimport { v4 } from \"uuid\";\n//\nimport { FormModal } from \"../Modals/FormModal\";\nimport { IconButton } from \"../Common/IconButton\";\nimport { CancelButton } from \"../Common/CancelButton\";\nimport { SecretField, SECRET_FIELD_SIZE } from \"../Modals/SecretField\";\nimport { Dispatch } from \"../../actions\";\nimport { popModal } from \"../../actions/modals\";\nimport { createRoom } from \"../../actions/room\";\nimport { displayError } from \"../../actions/messages\";\n\n// ------------------------------------------------------------------\n\nlet ROOM_COUNTER = 1;\n\n// ------------------------------------------------------------------\n\nexport const CreateRoomModal = () => {\n\tconst dispatch = useDispatch<Dispatch>();\n\tconst [name, setName] = useState(\"\");\n\tconst [secret, setSecret] = useState(v4());\n\tconst nameRef = useRef<HTMLInputElement>(null);\n\tconst { t } = useTranslation();\n\n\tuseEffect(() => {\n\t\tsetName(`${t(\"rooms.room\")} ${ROOM_COUNTER}`);\n\t\tif (nameRef.current) {\n\t\t\tnameRef.current.focus();\n\t\t}\n\t}, [t]);\n\n\tconst onClose = useCallback(() => dispatch(popModal()), [dispatch]);\n\n\tconst onCreate = useCallback(() => {\n\t\tif (name.trim().length === 0) {\n\t\t\tdispatch(displayError(\"rooms.name_is_invalid\"));\n\t\t\treturn;\n\t\t}\n\t\tif (secret.trim().length === 0) {\n\t\t\tdispatch(displayError(\"rooms.secret_is_invalid\"));\n\t\t\treturn;\n\t\t}\n\t\tdispatch(createRoom(name, secret));\n\t\tdispatch(popModal());\n\t\tROOM_COUNTER++;\n\t}, [dispatch, name, secret]);\n\n\treturn (\n\t\t<FormModal\n\t\t\ttitle={t(\"rooms.room_creation\")}\n\t\t\tonSubmit={onCreate}\n\t\t\trenderButtons={() => (\n\t\t\t\t<>\n\t\t\t\t\t<IconButton\n\t\t\t\t\t\tdisabled={\n\t\t\t\t\t\t\tname.trim().length === 0 ||\n\t\t\t\t\t\t\tsecret.length !== SECRET_FIELD_SIZE\n\t\t\t\t\t\t}\n\t\t\t\t\t\ttitle={t(\"rooms.create\")}\n\t\t\t\t\t\tkind=\"primary\"\n\t\t\t\t\t\ticon=\"plus\"\n\t\t\t\t\t\ttype=\"submit\"\n\t\t\t\t\t/>\n\t\t\t\t\t<CancelButton onClick={onClose} />\n\t\t\t\t</>\n\t\t\t)}>\n\t\t\t<div className=\"ModalField\">\n\t\t\t\t<label htmlFor=\"modal-name\">{t(\"rooms.name\")}</label>\n\t\t\t\t<input\n\t\t\t\t\tid=\"modal-name\"\n\t\t\t\t\ttype=\"text\"\n\t\t\t\t\tplaceholder={t(\"rooms.name_placeholder\")}\n\t\t\t\t\tmaxLength={100}\n\t\t\t\t\tminLength={2}\n\t\t\t\t\trequired={true}\n\t\t\t\t\tvalue={name}\n\t\t\t\t\tref={nameRef}\n\t\t\t\t\tonChange={e => setName(e.target.value)}\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<SecretField\n\t\t\t\tid=\"modal-secret\"\n\t\t\t\tlabel={t(\"rooms.key\")}\n\t\t\t\tplaceholder={t(\"rooms.key_placeholder\")}\n\t\t\t\tvalue={secret}\n\t\t\t\tonChange={setSecret}\n\t\t\t/>\n\t\t</FormModal>\n\t);\n};\n","import React, { useState, useEffect, useRef, useCallback } from \"react\";\nimport { useDispatch } from \"react-redux\";\nimport { useTranslation } from \"react-i18next\";\nimport { v4 } from \"uuid\";\n//\nimport { FormModal } from \"../Modals/FormModal\";\nimport { IconButton } from \"../Common/IconButton\";\nimport { CancelButton } from \"../Common/CancelButton\";\nimport { SecretField, SECRET_FIELD_SIZE } from \"../Modals/SecretField\";\nimport { popModal, openModal } from \"../../actions/modals\";\nimport { displayError } from \"../../actions/messages\";\nimport { createUser } from \"../../actions/user\";\nimport { Dispatch } from \"../../actions\";\n\n// ------------------------------------------------------------------\n\nlet USER_COUNTER = 1;\n\n// ------------------------------------------------------------------\n\nexport const CreateUserModal = () => {\n\tconst dispatch = useDispatch<Dispatch>();\n\tconst [name, setName] = useState(\"\");\n\tconst [secret, setSecret] = useState(v4());\n\tconst nameRef = useRef<HTMLInputElement>(null);\n\tconst { t } = useTranslation();\n\n\tuseEffect(() => {\n\t\tsetName(`${t(\"users.user\")} ${USER_COUNTER}`);\n\t\tif (nameRef.current) {\n\t\t\tnameRef.current.focus();\n\t\t}\n\t}, [t]);\n\n\tconst onClose = useCallback(() => dispatch(popModal()), [dispatch]);\n\n\tconst onCreate = useCallback(() => {\n\t\tif (name.trim().length === 0) {\n\t\t\tdispatch(displayError(\"users.name_is_invalid\"));\n\t\t\treturn;\n\t\t}\n\t\tif (secret.trim().length === 0) {\n\t\t\tdispatch(displayError(\"users.secret_is_invalid\"));\n\t\t\treturn;\n\t\t}\n\t\tdispatch(createUser(name, secret));\n\t\tdispatch(popModal());\n\t\tUSER_COUNTER++;\n\t}, [dispatch, name, secret]);\n\n\tconst onToggle = useCallback(() => {\n\t\tdispatch(openModal({ type: \"ConnectUser\", props: null }));\n\t}, [dispatch]);\n\n\treturn (\n\t\t<FormModal\n\t\t\ttitle={t(\"users.user_creation\")}\n\t\t\tonSubmit={onCreate}\n\t\t\trenderButtons={() => (\n\t\t\t\t<>\n\t\t\t\t\t<IconButton\n\t\t\t\t\t\tdisabled={\n\t\t\t\t\t\t\tname.trim().length === 0 ||\n\t\t\t\t\t\t\tsecret.length !== SECRET_FIELD_SIZE\n\t\t\t\t\t\t}\n\t\t\t\t\t\ttitle={t(\"users.create\")}\n\t\t\t\t\t\tkind=\"primary\"\n\t\t\t\t\t\ticon=\"plus\"\n\t\t\t\t\t\ttype=\"submit\"\n\t\t\t\t\t/>\n\t\t\t\t\t<CancelButton onClick={onClose} />\n\t\t\t\t\t<IconButton\n\t\t\t\t\t\ttitle={t(\"users.connect\")}\n\t\t\t\t\t\tkind=\"default\"\n\t\t\t\t\t\ticon=\"sign-in\"\n\t\t\t\t\t\tonClick={onToggle}\n\t\t\t\t\t/>\n\t\t\t\t</>\n\t\t\t)}>\n\t\t\t<div className=\"ModalField\">\n\t\t\t\t<label htmlFor=\"modal-name\">{t(\"users.name\")}</label>\n\t\t\t\t<input\n\t\t\t\t\tid=\"modal-name\"\n\t\t\t\t\ttype=\"text\"\n\t\t\t\t\tplaceholder={t(\"users.name_placeholder\")}\n\t\t\t\t\tmaxLength={100}\n\t\t\t\t\tminLength={2}\n\t\t\t\t\trequired={true}\n\t\t\t\t\tvalue={name}\n\t\t\t\t\tref={nameRef}\n\t\t\t\t\tonChange={e => setName(e.target.value)}\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<SecretField\n\t\t\t\tid=\"modal-secret\"\n\t\t\t\tlabel={t(\"users.secret\")}\n\t\t\t\tplaceholder={t(\"users.secret_placeholder\")}\n\t\t\t\tvalue={secret}\n\t\t\t\tonChange={newSecret => setSecret(newSecret)}\n\t\t\t/>\n\t\t</FormModal>\n\t);\n};\n","// import Axios from \"axios\";\nimport jsonp from \"jsonp\";\n//\nimport { sleep } from \".\";\nimport {\n\tSearchResults,\n\tContainer,\n\tContainerType,\n\tAlbum,\n\tPlaylist,\n\tTrack,\n\tMediaType\n} from \"./medias\";\n\n// ------------------------------------------------------------------\n\nconst RATE_LIMIT_DELAY = 5000; // ms\n\n// ------------------------------------------------------------------\n\nexport type ApiError = {\n\tcode: number;\n\tmessage: string;\n\ttype: string;\n};\n\nexport type ApiAlbum = {\n\terror?: ApiError;\n\tartist: {\n\t\tid: number;\n\t\tname: string;\n\t\tpicture_big: string;\n\t\tpicture_small: string;\n\t};\n\tcover_big: string;\n\tcover_small: string;\n\tid: number;\n\ttitle: string;\n\ttracks?: { data: ApiTrack[] };\n};\n\nexport type ApiPlaylist = {\n\terror?: ApiError;\n\tcreator?: {\n\t\tid: number;\n\t\tname: string;\n\t};\n\tid: number;\n\tpicture_big: string;\n\tpicture_small: string;\n\tpublic: true;\n\ttitle: string;\n\ttracks?: { data: ApiTrack[] };\n\tuser?: {\n\t\tid: number;\n\t\tname: string;\n\t};\n};\n\nexport type ApiTrack = {\n\terror?: ApiError;\n\talbum: {\n\t\tcover_big: string;\n\t\tcover_small: string;\n\t\tid: number;\n\t\ttitle: string;\n\t};\n\tartist: {\n\t\tid: number;\n\t\tname: string;\n\t\tpicture_big: string;\n\t\tpicture_small: string;\n\t};\n\tduration: number;\n\tid: number;\n\tpreview: string;\n\treadable: boolean;\n\ttitle: string;\n};\n\nexport type ApiSearchResult<T> = {\n\tdata: T[];\n\ttotal: number;\n};\n\n// ------------------------------------------------------------------\n\nconst ConvertAlbum = (album: ApiAlbum): Album => ({\n\tartist: {\n\t\tid: album.artist.id.toString(),\n\t\tname: album.artist.name,\n\t\tlink: `https://www.deezer.com/artist/${album.artist.id}`,\n\t\tpicture_big: album.artist.picture_big,\n\t\tpicture_small: album.artist.picture_small\n\t},\n\tcover_big: album.cover_big,\n\tcover_small: album.cover_small,\n\tid: album.id.toString(),\n\tlink: `https://www.deezer.com/album/${album.id}`,\n\ttitle: album.title,\n\ttracks:\n\t\talbum.tracks !== void 0\n\t\t\t? album.tracks.data\n\t\t\t\t\t.filter(track => track.readable && track.preview)\n\t\t\t\t\t.map(track => ConvertTrack(track, album))\n\t\t\t: void 0,\n\ttype: \"album\"\n});\n\nconst ConvertPlaylist = (\n\tplaylist: ApiPlaylist,\n\tuser: { id: number; name: string }\n): Playlist => ({\n\tid: playlist.id.toString(),\n\tlink: `https://www.deezer.com/playlist/${playlist.id}`,\n\tpicture_big: playlist.picture_big,\n\tpicture_small: playlist.picture_small,\n\ttitle: playlist.title,\n\ttracks:\n\t\tplaylist.tracks !== void 0\n\t\t\t? playlist.tracks.data\n\t\t\t\t\t.filter(track => track.readable && track.preview)\n\t\t\t\t\t.map(track => ConvertTrack(track, track.album))\n\t\t\t: void 0,\n\ttype: \"playlist\",\n\tuser: {\n\t\tid: user.id.toString(),\n\t\tname: user.name,\n\t\tlink: `https://www.deezer.com/profile/${user.id}`\n\t}\n});\n\nconst ConvertTrack = (\n\ttrack: ApiTrack,\n\talbum: { id: number; title: string; cover_big: string; cover_small: string }\n): Track => ({\n\talbum: {\n\t\tid: album.id.toString(),\n\t\tlink: `https://www.deezer.com/album/${album.id}`,\n\t\ttitle: album.title,\n\t\tcover_big: album.cover_big,\n\t\tcover_small: album.cover_small\n\t},\n\tartist: {\n\t\tid: track.artist.id.toString(),\n\t\tname: track.artist.name,\n\t\tlink: `https://www.deezer.com/artist/${track.artist.id}`,\n\t\tpicture_big: track.artist.picture_big,\n\t\tpicture_small: track.artist.picture_small\n\t},\n\tduration: track.duration,\n\tid: track.id.toString(),\n\tlink: `https://www.deezer.com/track/${track.id}`,\n\tpreview: track.preview,\n\ttitle: track.title,\n\ttype: \"track\"\n});\n\n// ------------------------------------------------------------------\n\nexport const DeezerApi = () => {\n\tconst API_BASE = \"https://api.deezer.com\";\n\n\tconst _asyncJsonp = <T>(url: string): Promise<T> =>\n\t\tnew Promise((resolve, reject) => {\n\t\t\tjsonp(url, void 0, (err, data) => {\n\t\t\t\tif (err) {\n\t\t\t\t\treject(new Error(err.message));\n\t\t\t\t} else {\n\t\t\t\t\tresolve(data);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\tconst _call = async <T>(path: string, qs?: string) => {\n\t\t// We have to rely on jsonp because the Deezer api is CORS restricted\n\t\tconst fullpath = qs\n\t\t\t? `${API_BASE}/${path}?${qs}&output=jsonp&callback=`\n\t\t\t: `${API_BASE}/${path}?output=jsonp&callback=`;\n\t\treturn await _asyncJsonp<T>(fullpath);\n\t};\n\n\tconst _search = <T>(type: MediaType, query: string) =>\n\t\t_call<ApiSearchResult<T>>(\n\t\t\t`search/${type}`,\n\t\t\t`q=${encodeURIComponent(query)}`\n\t\t);\n\n\tconst _load = <T extends { error?: ApiError }>(\n\t\ttype: MediaType,\n\t\tids: string[]\n\t) =>\n\t\tPromise.all(\n\t\t\tids.map(async id => {\n\t\t\t\tconst media = await _call<T>(`${type}/${id}`);\n\t\t\t\treturn media.error ? null : media;\n\t\t\t})\n\t\t);\n\n\tconst _loadWithRetry = async <T extends { error?: ApiError }>(\n\t\ttype: MediaType,\n\t\tids: string[]\n\t) => {\n\t\tlet first = true;\n\t\tconst medias: Array<T | null> = ids.map(() => null);\n\t\twhile (medias.includes(null)) {\n\t\t\tconst subIds: string[] = [];\n\t\t\tconst subIndexes: number[] = [];\n\t\t\tmedias.forEach((media, index) => {\n\t\t\t\tif (!media) {\n\t\t\t\t\tsubIds.push(ids[index]);\n\t\t\t\t\tsubIndexes.push(index);\n\t\t\t\t}\n\t\t\t});\n\t\t\tif (!first) {\n\t\t\t\tconsole.debug(`[Deezer] Handling rate limit delayed batch...`, {\n\t\t\t\t\tsubIds\n\t\t\t\t});\n\t\t\t\tawait sleep(RATE_LIMIT_DELAY);\n\t\t\t}\n\t\t\tconst subMedias = await _load<T>(type, subIds);\n\t\t\tsubIndexes.forEach((index, subIndex) => {\n\t\t\t\tmedias[index] = subMedias[subIndex];\n\t\t\t});\n\t\t\tfirst = false;\n\t\t}\n\t\treturn medias as T[];\n\t};\n\n\tconst searchAlbums = async (query: string) => {\n\t\treturn (await _search<ApiAlbum>(\"album\", query)).data.map(ConvertAlbum);\n\t};\n\n\tconst searchPlaylists = async (query: string) => {\n\t\treturn (await _search<ApiPlaylist>(\"playlist\", query)).data\n\t\t\t.filter(playlist => playlist.public)\n\t\t\t.map(playlist => ConvertPlaylist(playlist, playlist.user!));\n\t};\n\n\tconst searchTracks = async (query: string) => {\n\t\treturn (await _search<ApiTrack>(\"track\", query)).data\n\t\t\t.filter(track => track.readable && track.preview)\n\t\t\t.map(track => ConvertTrack(track, track.album));\n\t};\n\n\tconst search = async (query: string): Promise<SearchResults> => {\n\t\tconst [album, playlist, track] = await Promise.all([\n\t\t\tsearchAlbums(query),\n\t\t\tsearchPlaylists(query),\n\t\t\tsearchTracks(query)\n\t\t]);\n\t\treturn {\n\t\t\t// keys are MediaType\n\t\t\talbum: album,\n\t\t\tplaylist: playlist,\n\t\t\ttrack: track\n\t\t};\n\t};\n\n\tconst loadAlbums = async (ids: string[]): Promise<Album[]> => {\n\t\tconst albums = await _loadWithRetry<ApiAlbum>(\"album\", ids);\n\t\treturn albums.map(album => ConvertAlbum(album));\n\t};\n\n\tconst loadPlaylists = async (ids: string[]): Promise<Playlist[]> => {\n\t\tconst playlists = await _loadWithRetry<ApiPlaylist>(\"playlist\", ids);\n\t\treturn playlists.map(playlist =>\n\t\t\tConvertPlaylist(playlist, playlist.creator!)\n\t\t);\n\t};\n\n\tconst loadContainers = async (\n\t\ttype: ContainerType,\n\t\tids: string[]\n\t): Promise<Container[]> => {\n\t\tswitch (type) {\n\t\t\tcase \"album\":\n\t\t\t\treturn loadAlbums(ids);\n\t\t\tcase \"playlist\":\n\t\t\t\treturn loadPlaylists(ids);\n\t\t}\n\t};\n\n\tconst loadTracks = async (ids: string[]): Promise<Track[]> => {\n\t\tconst tracks = await _loadWithRetry<ApiTrack>(\"track\", ids);\n\t\treturn tracks.map(track => ConvertTrack(track, track.album));\n\t};\n\n\treturn {\n\t\tsearch,\n\t\tsearchAlbums,\n\t\tsearchPlaylists,\n\t\tsearchTracks,\n\t\tloadContainers,\n\t\tloadTracks\n\t};\n};\n\n// ------------------------------------------------------------------\n\nexport const DEFAULT_API = DeezerApi();\n","export type MediaAccess = {\n\tid: string;\n\tprovider: ProviderType;\n\ttype: MediaType;\n};\n\nexport type ContainerType = \"album\" | \"playlist\";\n\nexport type MediaType = ContainerType | \"track\";\n\nexport type MediaTypeDefinition = {\n\tlabel: string;\n\tprovider: ProviderType;\n\ttype: MediaType;\n};\n\nexport type ProviderType = \"deezer\";\n\nexport type TrackType = \"track\";\n\n// ------------------------------------------------------------------\n\nexport type Album = {\n\tartist: {\n\t\tid: string;\n\t\tlink: string;\n\t\tname: string;\n\t\tpicture_big: string;\n\t\tpicture_small: string;\n\t};\n\tcover_big: string;\n\tcover_small: string;\n\tid: string;\n\tlink: string;\n\ttitle: string;\n\ttracks?: Track[];\n\ttype: \"album\";\n};\n\nexport type Playlist = {\n\tid: string;\n\tlink: string;\n\tpicture_big: string;\n\tpicture_small: string;\n\ttitle: string;\n\ttracks?: Track[];\n\ttype: \"playlist\";\n\tuser: {\n\t\tid: string;\n\t\tlink: string;\n\t\tname: string;\n\t};\n};\n\nexport type Track = {\n\talbum: {\n\t\tcover_big: string;\n\t\tcover_small: string;\n\t\tid: string;\n\t\tlink: string;\n\t\ttitle: string;\n\t};\n\tartist: {\n\t\tid: string;\n\t\tname: string;\n\t\tlink: string;\n\t\tpicture_big: string;\n\t\tpicture_small: string;\n\t};\n\tduration: number;\n\tid: string;\n\tlink: string;\n\tpreview: string;\n\ttitle: string;\n\ttype: \"track\";\n};\n\nexport type Container = Album | Playlist;\n\nexport type Media = Container | Track;\n\n// ------------------------------------------------------------------\n\nexport type SearchResults = {\n\t// keys are MediaType\n\talbum: Album[];\n\tplaylist: Playlist[];\n\ttrack: Track[];\n};\n\n// ------------------------------------------------------------------\n\nexport const MEDIA_TYPE_DEFINITIONS: MediaTypeDefinition[] = [\n\t{\n\t\tlabel: \"medias.albums\",\n\t\tprovider: \"deezer\",\n\t\ttype: \"album\"\n\t},\n\t{\n\t\tlabel: \"medias.playlists\",\n\t\tprovider: \"deezer\",\n\t\ttype: \"playlist\"\n\t},\n\t{\n\t\tlabel: \"medias.tracks\",\n\t\tprovider: \"deezer\",\n\t\ttype: \"track\"\n\t}\n];\n","import React, { ReactNode } from \"react\";\n//\nimport { Media } from \"../../utils/medias\";\n\n// ------------------------------------------------------------------\n\nconst MAX_RESULTS_COUNT = 5;\n\n// ------------------------------------------------------------------\n\nexport const SearchResultCategory = ({\n\titems,\n\tlabel,\n\tcb\n}: {\n\titems: Media[];\n\tlabel: string;\n\tcb: (item: Media) => ReactNode;\n}) =>\n\titems.length > 0 ? (\n\t\t<>\n\t\t\t<div className=\"ModalField\">\n\t\t\t\t<label>{label}</label>\n\t\t\t</div>\n\t\t\t{items.slice(0, MAX_RESULTS_COUNT).map(item => (\n\t\t\t\t<div key={item.id} className=\"ModalField\">\n\t\t\t\t\t<div className=\"SearchResultItem\">{cb(item)}</div>\n\t\t\t\t</div>\n\t\t\t))}\n\t\t</>\n\t) : null;\n","import React, { useRef, useState, useEffect, useCallback } from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { useTranslation } from \"react-i18next\";\n//\nimport { FormModal } from \"../Modals/FormModal\";\nimport { IconButton } from \"../Common/IconButton\";\nimport { CancelButton } from \"../Common/CancelButton\";\nimport { DEFAULT_API } from \"../../utils/deezer\";\nimport { Media } from \"./Medias\";\nimport {\n\tMEDIA_TYPE_DEFINITIONS,\n\tMediaType,\n\tProviderType,\n\tSearchResults\n} from \"../../utils/medias\";\nimport { SearchResultCategory } from \"./SearchResultCategory\";\nimport { Dispatch } from \"../../actions\";\nimport { popModal } from \"../../actions/modals\";\nimport { loadMedias } from \"../../actions/medias\";\nimport { stopPreview } from \"../../actions/player\";\nimport { isRoomLocked } from \"../../selectors/room\";\nimport { RootState } from \"../../reducers\";\nimport \"./SearchModal.scss\";\n\n// ------------------------------------------------------------------\n\nexport const SearchModal = () => {\n\tconst dispatch = useDispatch<Dispatch>();\n\tconst { t } = useTranslation();\n\tconst queryRef = useRef<HTMLInputElement>(null);\n\tconst locked = useSelector<RootState, boolean>(isRoomLocked);\n\tconst [playingMediaId, setPlayingMediaId] = useState(\"\");\n\tconst [playingMediaType, setPlayingMediaType] = useState<MediaType>(\n\t\t\"track\"\n\t);\n\tconst [provider] = useState<ProviderType>(\"deezer\");\n\tconst [query, setQuery] = useState(\"\");\n\tconst [results, setResults] = useState<SearchResults>({\n\t\t// keys are MediaType\n\t\talbum: [],\n\t\tplaylist: [],\n\t\ttrack: []\n\t});\n\n\tconst onClose = useCallback(() => dispatch(popModal()), [dispatch]);\n\n\tconst onSearch = useCallback(async () => {\n\t\tif (query.trim().length > 0) {\n\t\t\tsetResults(await DEFAULT_API.search(query));\n\t\t}\n\t}, [query]);\n\n\tconst onSelect = useCallback(\n\t\t(provider: ProviderType, mediaType: MediaType, mediaId: string) =>\n\t\t\tdispatch(loadMedias(provider, mediaType, [mediaId], true, false)),\n\t\t[dispatch]\n\t);\n\n\tconst onStartPreview = useCallback(\n\t\t(mediaType: MediaType, mediaId: string) => {\n\t\t\tdispatch(loadMedias(provider, mediaType, [mediaId], false, true));\n\t\t\tsetPlayingMediaId(mediaId);\n\t\t\tsetPlayingMediaType(mediaType);\n\t\t},\n\t\t[dispatch, provider]\n\t);\n\n\tconst onStopPreview = useCallback(() => {\n\t\tdispatch(stopPreview());\n\t\tsetPlayingMediaId(\"\");\n\t\tsetPlayingMediaType(\"track\");\n\t}, [dispatch]);\n\n\tuseEffect(() => {\n\t\tif (queryRef.current) {\n\t\t\tqueryRef.current.focus();\n\t\t}\n\t\treturn () => {\n\t\t\tdispatch(stopPreview());\n\t\t};\n\t}, [dispatch]);\n\n\treturn (\n\t\t<FormModal\n\t\t\tclassName=\"SearchModal\"\n\t\t\ttitle={t(\"medias.medias_search\")}\n\t\t\tonSubmit={onSearch}\n\t\t\trenderButtons={() => (\n\t\t\t\t<>\n\t\t\t\t\t<IconButton\n\t\t\t\t\t\tdisabled={query.trim().length === 0}\n\t\t\t\t\t\ttitle={t(\"medias.search\")}\n\t\t\t\t\t\tkind=\"primary\"\n\t\t\t\t\t\ticon=\"search\"\n\t\t\t\t\t\ttype=\"submit\"\n\t\t\t\t\t/>\n\t\t\t\t\t<CancelButton onClick={onClose} />\n\t\t\t\t</>\n\t\t\t)}>\n\t\t\t<div className=\"ModalField\">\n\t\t\t\t<input\n\t\t\t\t\tid=\"modal-query\"\n\t\t\t\t\ttype=\"text\"\n\t\t\t\t\tplaceholder={t(\"medias.search_placeholder\")}\n\t\t\t\t\tmaxLength={100}\n\t\t\t\t\tminLength={2}\n\t\t\t\t\trequired={true}\n\t\t\t\t\tvalue={query}\n\t\t\t\t\tref={queryRef}\n\t\t\t\t\tonChange={e => setQuery(e.target.value)}\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t{MEDIA_TYPE_DEFINITIONS.map(({ label, type }) => (\n\t\t\t\t<SearchResultCategory\n\t\t\t\t\tkey={type}\n\t\t\t\t\tlabel={t(label)}\n\t\t\t\t\titems={results[type]}\n\t\t\t\t\tcb={media => (\n\t\t\t\t\t\t<Media\n\t\t\t\t\t\t\tactions={\n\t\t\t\t\t\t\t\t!locked ? (\n\t\t\t\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\t\t\t\ttitle={t(\"medias.add\")}\n\t\t\t\t\t\t\t\t\t\ticon=\"plus\"\n\t\t\t\t\t\t\t\t\t\tonClick={() =>\n\t\t\t\t\t\t\t\t\t\t\tonSelect(provider, type, media.id)\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t) : null\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tmedia={media}\n\t\t\t\t\t\t\tmediaType={type}\n\t\t\t\t\t\t\tplayable={true}\n\t\t\t\t\t\t\tplaying={\n\t\t\t\t\t\t\t\tplayingMediaType === type &&\n\t\t\t\t\t\t\t\tplayingMediaId === media.id\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tonPlay={() => onStartPreview(type, media.id)}\n\t\t\t\t\t\t\tonStop={onStopPreview}\n\t\t\t\t\t\t/>\n\t\t\t\t\t)}\n\t\t\t\t/>\n\t\t\t))}\n\t\t</FormModal>\n\t);\n};\n","import React, { useRef, useState, useEffect, useCallback } from \"react\";\nimport { useDispatch } from \"react-redux\";\nimport { useTranslation } from \"react-i18next\";\n//\nimport { FormModal } from \"../Modals/FormModal\";\nimport { IconButton } from \"../Common/IconButton\";\nimport { CancelButton } from \"../Common/CancelButton\";\nimport { Dispatch } from \"../../actions\";\nimport { popModal } from \"../../actions/modals\";\nimport { unlockRoom } from \"../../actions/room\";\nimport { SECRET_FIELD_SIZE } from \"../Modals/SecretField\";\n\n// ------------------------------------------------------------------\n\nexport const UnlockRoomModal = () => {\n\tconst dispatch = useDispatch<Dispatch>();\n\tconst [secret, setSecret] = useState(\"\");\n\tconst secretRef = useRef<HTMLInputElement>(null);\n\tconst { t } = useTranslation();\n\n\tuseEffect(() => {\n\t\tif (secretRef.current) {\n\t\t\tsecretRef.current.focus();\n\t\t}\n\t}, []);\n\n\tconst onClose = useCallback(() => dispatch(popModal()), [dispatch]);\n\n\tconst onUnlock = useCallback(() => {\n\t\tdispatch(unlockRoom(secret));\n\t\tdispatch(popModal());\n\t}, [dispatch, secret]);\n\n\treturn (\n\t\t<FormModal\n\t\t\ttitle={t(\"rooms.room_unlocking\")}\n\t\t\tonSubmit={onUnlock}\n\t\t\trenderButtons={() => (\n\t\t\t\t<>\n\t\t\t\t\t<IconButton\n\t\t\t\t\t\tdisabled={secret.length !== SECRET_FIELD_SIZE}\n\t\t\t\t\t\ttitle={t(\"rooms.unlock\")}\n\t\t\t\t\t\tkind=\"primary\"\n\t\t\t\t\t\ticon=\"unlock\"\n\t\t\t\t\t\ttype=\"submit\"\n\t\t\t\t\t/>\n\t\t\t\t\t<CancelButton onClick={onClose} />\n\t\t\t\t</>\n\t\t\t)}>\n\t\t\t<div className=\"ModalField\">\n\t\t\t\t<label htmlFor=\"modal-secret\">{t(\"rooms.key\")}</label>\n\t\t\t\t<input\n\t\t\t\t\tid=\"modal-secret\"\n\t\t\t\t\ttype=\"password\"\n\t\t\t\t\tautoComplete=\"password\"\n\t\t\t\t\tplaceholder={t(\"rooms.key_placeholder\")}\n\t\t\t\t\tmaxLength={36}\n\t\t\t\t\tminLength={36}\n\t\t\t\t\trequired={true}\n\t\t\t\t\tvalue={secret}\n\t\t\t\t\tref={secretRef}\n\t\t\t\t\tonChange={e => setSecret(e.target.value)}\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</FormModal>\n\t);\n};\n","import React, { MouseEvent, useState, useEffect, useCallback } from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { CSSTransition } from \"react-transition-group\";\n//\nimport { Dispatch } from \"../../actions\";\nimport { RootState } from \"../../reducers\";\nimport { ModalPrereq, popModal } from \"../../actions/modals\";\nimport { ConfirmModal } from \"./ConfirmModal\";\nimport { ConnectUserModal } from \"../Users/ConnectUserModal\";\nimport { CreateRoomModal } from \"../Room/CreateRoomModal\";\nimport { CreateUserModal } from \"..//Users/CreateUserModal\";\nimport { SearchModal } from \"..//Room/SearchModal\";\nimport { UnlockRoomModal } from \"../Room/UnlockRoomModal\";\nimport \"./index.scss\";\n\n// ------------------------------------------------------------------\n\nconst TRANSITION_TIMEOUT = 300;\n\n// ------------------------------------------------------------------\n\nexport const getModal = (prereq?: ModalPrereq) => {\n\tif (prereq) {\n\t\tswitch (prereq.type) {\n\t\t\tcase \"Confirm\":\n\t\t\t\treturn <ConfirmModal {...prereq.props} />;\n\t\t\tcase \"ConnectUser\":\n\t\t\t\treturn <ConnectUserModal />;\n\t\t\tcase \"CreateRoom\":\n\t\t\t\treturn <CreateRoomModal />;\n\t\t\tcase \"CreateUser\":\n\t\t\t\treturn <CreateUserModal />;\n\t\t\tcase \"Search\":\n\t\t\t\treturn <SearchModal />;\n\t\t\tcase \"UnlockRoom\":\n\t\t\t\treturn <UnlockRoomModal />;\n\t\t}\n\t}\n\treturn null;\n};\n\n// ------------------------------------------------------------------\n\nexport const Modals = () => {\n\tconst dispatch = useDispatch<Dispatch>();\n\tconst prereq = useSelector<RootState, ModalPrereq | undefined>(state =>\n\t\tstate.modals.stack.length > 0\n\t\t\t? state.modals.stack[state.modals.stack.length - 1]\n\t\t\t: void 0\n\t);\n\n\tconst [currPrereq, setCurrPrereq] = useState<ModalPrereq | undefined>(\n\t\tvoid 0\n\t);\n\tconst [prevPrereq, setPrevPrereq] = useState<ModalPrereq | undefined>(\n\t\tvoid 0\n\t);\n\n\tconst onPopModal = useCallback(() => dispatch(popModal()), [dispatch]);\n\n\tuseEffect(() => {\n\t\tconst keyDown = (e: KeyboardEvent) => {\n\t\t\tif (e.keyCode === 27) {\n\t\t\t\tonPopModal();\n\t\t\t}\n\t\t};\n\n\t\tdocument.addEventListener(\"keydown\", keyDown);\n\n\t\treturn () => {\n\t\t\tdocument.removeEventListener(\"keydown\", keyDown);\n\t\t};\n\t});\n\n\tuseEffect(() => {\n\t\t// Hide current modal before showing new one (if there is a new one)\n\t\tsetCurrPrereq(void 0);\n\t\tsetPrevPrereq(prereq);\n\t}, [prereq]);\n\n\tuseEffect(() => {\n\t\tif (prereq) {\n\t\t\tsetTimeout(() => {\n\t\t\t\tsetCurrPrereq(prereq);\n\t\t\t}, TRANSITION_TIMEOUT);\n\t\t}\n\t}, [prereq, prevPrereq]);\n\n\tconst modal = getModal(currPrereq || prevPrereq);\n\treturn (\n\t\t<CSSTransition\n\t\t\tin={!!currPrereq}\n\t\t\ttimeout={TRANSITION_TIMEOUT}\n\t\t\tunmountOnExit={true}>\n\t\t\t<div\n\t\t\t\tclassName=\"ModalOverlay\"\n\t\t\t\tonClick={e => {\n\t\t\t\t\t// Clicking overlay will close current modal\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t\tonPopModal();\n\t\t\t\t}}>\n\t\t\t\t{modal && (\n\t\t\t\t\t<div\n\t\t\t\t\t\tclassName=\"ModalWrapper\"\n\t\t\t\t\t\trole=\"dialog\"\n\t\t\t\t\t\tonClick={(e: MouseEvent) => {\n\t\t\t\t\t\t\t// Clicking wrapper modal will not progagate to overlay which would close current modal\n\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t}}>\n\t\t\t\t\t\t{modal}\n\t\t\t\t\t</div>\n\t\t\t\t)}\n\t\t\t</div>\n\t\t</CSSTransition>\n\t);\n};\n","import { RootState } from \"../reducers\";\n\n// ------------------------------------------------------------------\n\nexport const extractMessages = (state: RootState) =>\n\tstate.messages.sort((m1, m2) => m1.stamp - m2.stamp);\n","import React from \"react\";\nimport { useSelector } from \"react-redux\";\nimport { useTranslation } from \"react-i18next\";\nimport classNames from \"classnames\";\nimport { TransitionGroup, CSSTransition } from \"react-transition-group\";\n//\nimport { Message } from \"../../utils/messages\";\nimport { extractMessages } from \"../../selectors/messages\";\nimport { RootState } from \"../../reducers\";\nimport \"./Messages.scss\";\n\n// ------------------------------------------------------------------\n\nexport const Messages = () => {\n\tconst { t } = useTranslation();\n\tconst messages = useSelector<RootState, Message[]>(extractMessages);\n\treturn (\n\t\t<div className=\"Messages\">\n\t\t\t<TransitionGroup>\n\t\t\t\t{messages.map(message => (\n\t\t\t\t\t<CSSTransition\n\t\t\t\t\t\tkey={message.id}\n\t\t\t\t\t\tclassNames=\"Message\"\n\t\t\t\t\t\ttimeout={{ enter: 200, exit: 200 }}>\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclassName={classNames(\n\t\t\t\t\t\t\t\t\"Message\",\n\t\t\t\t\t\t\t\t\"Message-\" + message.type\n\t\t\t\t\t\t\t)}>\n\t\t\t\t\t\t\t{t(message.text)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</CSSTransition>\n\t\t\t\t))}\n\t\t\t</TransitionGroup>\n\t\t</div>\n\t);\n};\n","import React, { useEffect } from \"react\";\nimport { useDispatch } from \"react-redux\";\nimport { Redirect, Route, Switch } from \"react-router-dom\";\n//\nimport { Room } from \"./Room\";\nimport { Splash } from \"./Splash\";\nimport { Modals } from \"../components/Modals\";\nimport { Messages } from \"../components/App/Messages\";\nimport { reconnectUser } from \"../actions/user\";\nimport { Dispatch } from \"../actions\";\nimport \"./App.scss\";\n\n// ------------------------------------------------------------------\n\nexport const App = () => {\n\tconst dispatch = useDispatch<Dispatch>();\n\n\tuseEffect(() => {\n\t\tdispatch(reconnectUser());\n\t}, [dispatch]);\n\n\treturn (\n\t\t<div className=\"App\">\n\t\t\t<Modals />\n\t\t\t<Switch>\n\t\t\t\t<Route exact={true} path=\"/room/:room_id\" component={Room} />\n\t\t\t\t<Route exact={true} path=\"/\" component={Splash} />\n\t\t\t\t<Redirect to=\"/\" />\n\t\t\t</Switch>\n\t\t\t<Messages />\n\t\t</div>\n\t);\n};\n","// ------------------------------------------------------------------\n\nlet AUDIO_CONTEXT: AudioContext | null = null;\n\nconst getContext = () => {\n\tif (!AUDIO_CONTEXT) {\n\t\tAUDIO_CONTEXT = new (window.AudioContext ||\n\t\t\t(window as any).webkitAudioContext)();\n\t}\n\treturn AUDIO_CONTEXT;\n};\n\nconst decodeAudioData = (encodedBuffer: ArrayBuffer): Promise<AudioBuffer> =>\n\tnew Promise((resolve, reject) =>\n\t\tgetContext().decodeAudioData(encodedBuffer, resolve, reject)\n\t);\n\nconst loadAudioBuffer = (trackId: string, url: string): Promise<AudioBuffer> =>\n\tnew Promise((resolve, reject) => {\n\t\tconst req = new XMLHttpRequest();\n\t\treq.open(\"GET\", url, true);\n\t\treq.responseType = \"arraybuffer\";\n\t\treq.addEventListener(\n\t\t\t\"error\",\n\t\t\t() => reject(new Error(\"player.errors.cannot_load_audio_buffer\")),\n\t\t\tfalse\n\t\t);\n\t\treq.addEventListener(\n\t\t\t\"load\",\n\t\t\tasync () => {\n\t\t\t\ttry {\n\t\t\t\t\tresolve(await decodeAudioData(req.response as ArrayBuffer));\n\t\t\t\t} catch (error) {\n\t\t\t\t\tconsole.debug(\n\t\t\t\t\t\t\"An error occurred while decoding audio data\",\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttrackId,\n\t\t\t\t\t\t\turl\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t\treject(new Error(\"player.errors.cannot_decode_audio_data\"));\n\t\t\t\t}\n\t\t\t},\n\t\t\tfalse\n\t\t);\n\t\treq.send();\n\t});\n\nconst AUDIO_BUFFER_CACHES: Array<{ buffer: AudioBuffer; url: string }> = [];\nconst AUDIO_BUFFER_CACHES_MAX_SIZE = 10;\n\nconst loadAudioBufferWithCache = async (\n\ttrackId: string,\n\turl: string\n): Promise<AudioBuffer> => {\n\tif (!url) {\n\t\tconsole.error(\"Track has invalid URL\", { trackId });\n\t\tthrow new Error(\"Invalid URL\");\n\t}\n\tlet buffer: AudioBuffer | null = null;\n\tconst index = AUDIO_BUFFER_CACHES.findIndex(item => item.url === url);\n\tif (index >= 0) {\n\t\t// Found: extract old buffer, it will be repush at the end of cache\n\t\tconsole.debug(\"Reusing cached audio buffer...\", { trackId, url });\n\t\tbuffer = AUDIO_BUFFER_CACHES.splice(index, 1)[0].buffer;\n\t} else {\n\t\t// Not Found\n\t\tconsole.debug(\"Loading audio buffer...\", { trackId, url });\n\t\tbuffer = await loadAudioBuffer(trackId, url);\n\t}\n\tAUDIO_BUFFER_CACHES.push({ buffer, url });\n\tAUDIO_BUFFER_CACHES.splice(AUDIO_BUFFER_CACHES_MAX_SIZE);\n\treturn buffer;\n};\n\n// ------------------------------------------------------------------\n\n// Fix Safari and iOS Audio Context\n(() => {\n\tconst fixAudioContext = () => {\n\t\tdocument.removeEventListener(\"click\", fixAudioContext);\n\t\tdocument.removeEventListener(\"touchstart\", fixAudioContext);\n\t\tconsole.debug(\"Fixing audio context...\");\n\t\tconst context = getContext();\n\t\t// Create empty buffer, connect to output, play sound\n\t\tvar buffer = context.createBuffer(1, 1, 22050);\n\t\tvar source = context.createBufferSource();\n\t\tsource.buffer = buffer;\n\t\tsource.connect(context.destination);\n\t\tsource.start(0);\n\t};\n\tdocument.addEventListener(\"click\", fixAudioContext);\n\tdocument.addEventListener(\"touchstart\", fixAudioContext);\n})();\n\n// ------------------------------------------------------------------\n\nexport type PlayerCallbacks = {\n\tonStart: () => void;\n\tonStop: () => void;\n};\n\nexport const Player = (chainPlay: boolean) => {\n\tlet analyserNode: AnalyserNode | null = null;\n\tlet gainNode: GainNode | null = null;\n\tlet _node: AudioNode | null = null;\n\tlet _buffer: AudioBuffer | null = null;\n\tlet _sourceNode: AudioBufferSourceNode | null = null;\n\tlet _sourceNodeStartTime = 0;\n\tlet _trackId = \"\";\n\tlet _trackPosition = -1;\n\n\tconst getOrCreateNode = () => {\n\t\tif (!_node) {\n\t\t\tconst context = getContext();\n\t\t\t_node = context.destination;\n\n\t\t\tgainNode = context.createGain();\n\t\t\tgainNode.gain.value = 1.0;\n\t\t\tgainNode.connect(_node);\n\t\t\t_node = gainNode;\n\n\t\t\tanalyserNode = context.createAnalyser();\n\t\t\tanalyserNode.fftSize = 128;\n\t\t\t// analyserNode.minDecibels = -90;\n\t\t\t// analyserNode.maxDecibels = -10;\n\t\t\tanalyserNode.connect(_node);\n\t\t\t_node = analyserNode;\n\t\t}\n\t\treturn _node;\n\t};\n\n\tconst isPlaying = () => !!_sourceNode;\n\n\tconst getPlayingTrackID = () => _trackId;\n\n\tconst getPlayingTrackPosition = () => _trackPosition;\n\n\t// Percentage [0, 1]\n\tconst getPlayingTrackPercent = () => {\n\t\tif (_buffer && _sourceNode) {\n\t\t\treturn (\n\t\t\t\t(getContext().currentTime - _sourceNodeStartTime) /\n\t\t\t\t_buffer.duration\n\t\t\t);\n\t\t}\n\t\treturn 0;\n\t};\n\n\tconst play = async (\n\t\ttrackPosition: number,\n\t\ttrackId: string,\n\t\ttrackUrl: string,\n\t\toffset: number\n\t) => {\n\t\tawait stop();\n\t\t_buffer = await loadAudioBufferWithCache(trackId, trackUrl); // TODO: warning if loadBuffer takes long for some reason and user clicks stop before end, next part of this function will continue after stop have been requested\n\t\tconsole.debug(\"Starting audio...\", {\n\t\t\ttrackPosition,\n\t\t\ttrackId,\n\t\t\ttrackUrl\n\t\t});\n\t\t_trackId = trackId;\n\t\t_trackPosition = trackPosition;\n\t\t_sourceNode = getContext().createBufferSource();\n\t\t_sourceNode.buffer = _buffer;\n\t\t_sourceNode.loop = false;\n\t\t_sourceNode.loopStart = 0;\n\t\t_sourceNode.loopEnd = 0;\n\t\t_sourceNode.onended = () => {\n\t\t\tconsole.debug(\"Audio terminated...\");\n\t\t\t_buffer = null;\n\t\t\t_sourceNode = null;\n\t\t\tif (chainPlay) {\n\t\t\t\t_trackPosition++;\n\t\t\t}\n\t\t};\n\t\t_sourceNode.playbackRate.value = 1.0;\n\t\t_sourceNode.connect(getOrCreateNode());\n\t\t_sourceNode.start(0, offset); // A new BufferSource must be created for each start\n\t\t_sourceNodeStartTime = getContext().currentTime;\n\t};\n\n\tconst stop = async (): Promise<void> =>\n\t\tnew Promise(resolve => {\n\t\t\tif (null !== _sourceNode) {\n\t\t\t\tconsole.debug(\"Stopping audio...\");\n\t\t\t\t_sourceNode.onended = () => {\n\t\t\t\t\tconsole.debug(\"Forced audio termination...\");\n\t\t\t\t\tresolve();\n\t\t\t\t};\n\t\t\t\t_sourceNode.stop();\n\t\t\t\t_sourceNode = null;\n\t\t\t\t_sourceNodeStartTime = 0;\n\t\t\t\t_trackPosition = -1;\n\t\t\t} else {\n\t\t\t\tresolve();\n\t\t\t}\n\t\t});\n\n\treturn {\n\t\tanalyserNode,\n\t\tgainNode,\n\t\tgetPlayingTrackID,\n\t\tgetPlayingTrackPercent,\n\t\tgetPlayingTrackPosition,\n\t\tisPlaying,\n\t\tplay,\n\t\tstop\n\t};\n};\n","export default {\n\tsplash: {\n\t\tCGU: \"CGU\",\n\t\tpowered_with: \"Powered with\"\n\t},\n\tusers: {\n\t\terrors: {\n\t\t\tinvalid: \"User is invalid\"\n\t\t},\n\t\tuser: \"User\",\n\t\tconfirm_disconnect: \"Are you sure you want to disconnect?\",\n\t\tconnect: \"Connect\",\n\t\tconnection: \"Connection\",\n\t\tcreate: \"Create a user\",\n\t\tdisconnect: \"Disconnect\",\n\t\tuser_creation: \"User Registration\",\n\t\tid_is_invalid: \"ID is invalid\",\n\t\tid_placeholder: \"User ID...\",\n\t\tuser_id: \"User ID\",\n\t\tname_is_invalid: \"Name is invalid\",\n\t\tname_placeholder: \"User Name...\",\n\t\tname: \"User Name\",\n\t\tsecret_is_invalid: \"Secret is invalid\",\n\t\tsecret_placeholder: \"User Secret...\",\n\t\tsecret: \"User Secret\"\n\t},\n\trooms: {\n\t\terrors: {\n\t\t\tinvalid: \"Room is invalid\",\n\t\t\tlocked: \"Room is locked\"\n\t\t},\n\t\tclear: \"Clear all tracks\",\n\t\tconfirm_clear: \"Are you sure you want to remove all tracks?\",\n\t\tconfirm_exit: \"Are you sure you want to leave the room?\",\n\t\tconfirm_lock: \"Are you sure you want to lock the room?\",\n\t\tcopy_link: \"Copy Room Link to Clipboard\",\n\t\tcreate: \"Create a room\",\n\t\tempty: \"It's empty here, you should add some tracks...\",\n\t\tempty_for_now: \"It's empty here, the owner has to fill it..\",\n\t\texit: \"Exit Room\",\n\t\tkey_placeholder: \"Room Key...\",\n\t\tkey: \"Room Key\",\n\t\tlink_copied_to_clipboard: \"Room link has been copied to clipboard\",\n\t\tloading: \"Loading...\",\n\t\tlocked: \"Locked (click to unlock)\",\n\t\tname_is_invalid: \"Name is invalid\",\n\t\tname_placeholder: \"Room Name...\",\n\t\tname: \"Room Name\",\n\t\troom_creation: \"Room Creation\",\n\t\troom_unlocking: \"Room Unlocking\",\n\t\troom: \"Room\",\n\t\tsecret_is_invalid: \"Secret is invalid\",\n\t\tunlock: \"Unlock\",\n\t\tunlocked: \"Unlocked (click to lock)\",\n\t\ttrack_count: \"{{count}} track\",\n\t\ttrack_count_plural: \"{{count}} tracks\"\n\t},\n\tmedias: {\n\t\tby: \"by {{artist}}\",\n\t\tadd: \"Add\",\n\t\tremove: \"Remove\",\n\t\tsearch: \"Search Media\",\n\t\tsearch_placeholder: \"Search...\",\n\t\tmedias_search: \"Media Search\",\n\t\talbums: \"Albums\",\n\t\tplaylists: \"Playlists\",\n\t\ttracks: \"Tracks\"\n\t},\n\tplayer: {\n\t\terrors: {\n\t\t\tcannot_decode_audio_data: \"Audio buffer cannot be decoded\",\n\t\t\tcannot_load_audio_buffer: \"Audio buffer loading failed\"\n\t\t},\n\t\tbackward: \"Backward\",\n\t\tforward: \"Forward\",\n\t\tplay: \"Play\",\n\t\tplaying: \"Playing\",\n\t\tstop: \"Stop\"\n\t},\n\tcancel: \"Cancel\",\n\tcopy_to_clipboard: \"Copy to Clipboard\",\n\tsecret_copied_to_clipboard: \"Secret has been copied to clipboard\"\n};\n","export default {\n\tsplash: {\n\t\tCGU: \"CGU\",\n\t\tpowered_with: \"boosté avec\"\n\t},\n\tusers: {\n\t\terrors: {\n\t\t\tinvalid: \"L'utilisateur est invalide\"\n\t\t},\n\t\tuser: \"Utilisateur\",\n\t\tconfirm_disconnect: \"Êtes-vous sûr(e) de vouloir vous déconnecter ?\",\n\t\tconnect: \"Se connecter\",\n\t\tconnection: \"Connexion\",\n\t\tcreate: \"Créer un utilisateur\",\n\t\tdisconnect: \"Se déconnecter\",\n\t\tuser_creation: \"Création d'un utilisateur\",\n\t\tid_is_invalid: \"L'identifiant est invalide\",\n\t\tid_placeholder: \"Identifiant...\",\n\t\tuser_id: \"Identifiant\",\n\t\tname_is_invalid: \"Le nom est invalide\",\n\t\tname_placeholder: \"Nom...\",\n\t\tname: \"Nom\",\n\t\tsecret_is_invalid: \"Le secret est invalide\",\n\t\tsecret_placeholder: \"Secret...\",\n\t\tsecret: \"Secret\"\n\t},\n\trooms: {\n\t\terrors: {\n\t\t\tinvalid: \"La salle est invalide\",\n\t\t\tlocked: \"La salle est verrouillée\"\n\t\t},\n\t\tclear: \"Supprimer toutes les pistes\",\n\t\tconfirm_clear:\n\t\t\t\"Êtes-vous sûr(e) de vouloir supprimer toutes les pistes ?\",\n\t\tconfirm_exit: \"Êtes-vous sûr(e) de vouloir quitter la salle ?\",\n\t\tconfirm_lock: \"Êtes-vous sûr(e) de vouloir verrouiller la salle ?\",\n\t\tcopy_link: \"Copier le lien de la salle dans le presse-papier\",\n\t\tcreate: \"Créer une salle\",\n\t\tempty: \"Cette salle est vide, vous devriez ajouter quelques pistes...\",\n\t\tempty_for_now: \"Cette salle est pour le moment vide...\",\n\t\texit: \"Quitter la salle\",\n\t\tkey_placeholder: \"Clef...\",\n\t\tkey: \"Clef\",\n\t\tloading: \"Chargement...\",\n\t\tlink_copied_to_clipboard:\n\t\t\t\"Le lien de la salle a été copié dans le presse-papier\",\n\t\tlocked: \"Verrouillée (cliquer pour déverrouiller)\",\n\t\tname_is_invalid: \"Le nom est invalide\",\n\t\tname_placeholder: \"Nom...\",\n\t\tname: \"Nom\",\n\t\troom: \"Salle\",\n\t\troom_creation: \"Création d'une salle\",\n\t\troom_unlocking: \"Déverrouillage de la salle\",\n\t\tsecret_is_invalid: \"Le secret is invalide\",\n\t\tunlock: \"Déverrouiller\",\n\t\tunlocked: \"Déverrouillée (cliquer pour verrouiller)\",\n\t\ttrack_count: \"{{count}} piste\",\n\t\ttrack_count_plural: \"{{count}} pistes\"\n\t},\n\tmedias: {\n\t\tby: \"par {{artist}}\",\n\t\tadd: \"Ajouter\",\n\t\tremove: \"Supprimer\",\n\t\tsearch: \"Chercher des médias\",\n\t\tsearch_placeholder: \"Recherche...\",\n\t\tmedias_search: \"Recherche de médias\",\n\t\talbums: \"Albums\",\n\t\tplaylists: \"Playlists\",\n\t\ttracks: \"Pistes\"\n\t},\n\tplayer: {\n\t\terrors: {\n\t\t\tcannot_decode_audio_data: \"Le buffer audio ne peut pas être décodé\",\n\t\t\tcannot_load_audio_buffer: \"Le buffer audio ne peut pas être chargé\"\n\t\t},\n\t\tbackward: \"Piste précédente\",\n\t\tforward: \"Piste suivante\",\n\t\tplay: \"Lire\",\n\t\tplaying: \"En cours de lecture\",\n\t\tstop: \"Arrêter\"\n\t},\n\tcancel: \"Annuler\",\n\tcopy_to_clipboard: \"Copier dans le presse-papier\",\n\tsecret_copied_to_clipboard: \"Le secret a été copié dans le presse-papier\"\n};\n","import i18next from \"i18next\";\nimport { initReactI18next } from \"react-i18next\";\n//\nimport en from \"../locales/en\";\nimport fr from \"../locales/fr\";\n\n// --------------------------------------------------------------\n\nexport const changeLanguage = (language: string) =>\n\ti18next.changeLanguage(language);\n\n// --------------------------------------------------------------\n\nexport const initLocales = async (): Promise<void> =>\n\tnew Promise((resolve, reject) => {\n\t\tconsole.debug(\"Initializing language...\", {\n\t\t\tcurrent: navigator.language || (navigator as any).userLanguage\n\t\t});\n\t\ti18next.use(initReactI18next).init(\n\t\t\t{\n\t\t\t\tfallbackLng: \"en\",\n\t\t\t\tlng: navigator.language || (navigator as any).userLanguage,\n\t\t\t\tresources: {\n\t\t\t\t\ten: { translation: en },\n\t\t\t\t\t\"en-US\": { translation: en },\n\t\t\t\t\tfr: { translation: fr },\n\t\t\t\t\t\"fr-FR\": { translation: fr }\n\t\t\t\t},\n\t\t\t\tinterpolation: {\n\t\t\t\t\tescapeValue: false, // react is already safe from xss\n\t\t\t\t\tformat: (value, format, lng) => {\n\t\t\t\t\t\t// if (format === \"uppercase\") return value.toUpperCase();\n\t\t\t\t\t\t// if (value instanceof Date) return moment(value).format(format);\n\t\t\t\t\t\treturn value;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\terror => {\n\t\t\t\tif (error) reject(error);\n\t\t\t\tresolve();\n\t\t\t}\n\t\t);\n\t});\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n\twindow.location.hostname === \"localhost\" ||\n\t\t// [::1] is the IPv6 localhost address.\n\t\twindow.location.hostname === \"[::1]\" ||\n\t\t// 127.0.0.0/8 are considered localhost for IPv4.\n\t\twindow.location.hostname.match(\n\t\t\t/^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n\t\t)\n);\n\nexport function register(config?: RegistrationOptions) {\n\tif (process.env.NODE_ENV === \"production\" && \"serviceWorker\" in navigator) {\n\t\t// The URL constructor is available in all browsers that support SW.\n\t\tconst publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n\t\tif (publicUrl.origin !== window.location.origin) {\n\t\t\t// Our service worker won't work if PUBLIC_URL is on a different origin\n\t\t\t// from what our page is served on. This might happen if a CDN is used to\n\t\t\t// serve assets; see https://github.com/facebook/create-react-app/issues/2374\n\t\t\treturn;\n\t\t}\n\n\t\twindow.addEventListener(\"load\", () => {\n\t\t\tconst swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n\t\t\tif (isLocalhost) {\n\t\t\t\t// This is running on localhost. Let's check if a service worker still exists or not.\n\t\t\t\tcheckValidServiceWorker(swUrl, config);\n\n\t\t\t\t// Add some additional logging to localhost, pointing developers to the\n\t\t\t\t// service worker/PWA documentation.\n\t\t\t\tnavigator.serviceWorker.ready.then(() => {\n\t\t\t\t\tconsole.log(\n\t\t\t\t\t\t\"This web app is being served cache-first by a service \" +\n\t\t\t\t\t\t\t\"worker. To learn more, visit https://bit.ly/CRA-PWA\"\n\t\t\t\t\t);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\t// Is not localhost. Just register service worker\n\t\t\t\tregisterValidSW(swUrl, config);\n\t\t\t}\n\t\t});\n\t}\n}\n\nfunction registerValidSW(swUrl: string, config?: RegistrationOptions) {\n\tnavigator.serviceWorker\n\t\t.register(swUrl)\n\t\t.then(registration => {\n\t\t\tregistration.onupdatefound = () => {\n\t\t\t\tconst installingWorker = registration.installing;\n\t\t\t\tif (installingWorker == null) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tinstallingWorker.onstatechange = () => {\n\t\t\t\t\tif (installingWorker.state === \"installed\") {\n\t\t\t\t\t\tif (navigator.serviceWorker.controller) {\n\t\t\t\t\t\t\t// At this point, the updated precached content has been fetched,\n\t\t\t\t\t\t\t// but the previous service worker will still serve the older\n\t\t\t\t\t\t\t// content until all client tabs are closed.\n\t\t\t\t\t\t\tconsole.log(\n\t\t\t\t\t\t\t\t\"New content is available and will be used when all \" +\n\t\t\t\t\t\t\t\t\t\"tabs for this page are closed. See https://bit.ly/CRA-PWA.\"\n\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\t// Execute callback\n\t\t\t\t\t\t\tif (config && (config as any).onUpdate) {\n\t\t\t\t\t\t\t\t(config as any).onUpdate(registration);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// At this point, everything has been precached.\n\t\t\t\t\t\t\t// It's the perfect time to display a\n\t\t\t\t\t\t\t// \"Content is cached for offline use.\" message.\n\t\t\t\t\t\t\tconsole.log(\"Content is cached for offline use.\");\n\n\t\t\t\t\t\t\t// Execute callback\n\t\t\t\t\t\t\tif (config && (config as any).onSuccess) {\n\t\t\t\t\t\t\t\t(config as any).onSuccess(registration);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t};\n\t\t})\n\t\t.catch(error => {\n\t\t\tconsole.error(\"Error during service worker registration:\", error);\n\t\t});\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: RegistrationOptions) {\n\t// Check if the service worker can be found. If it can't reload the page.\n\tfetch(swUrl, {\n\t\theaders: { \"Service-Worker\": \"script\" }\n\t})\n\t\t.then(response => {\n\t\t\t// Ensure service worker exists, and that we really are getting a JS file.\n\t\t\tconst contentType = response.headers.get(\"content-type\");\n\t\t\tif (\n\t\t\t\tresponse.status === 404 ||\n\t\t\t\t(contentType != null &&\n\t\t\t\t\tcontentType.indexOf(\"javascript\") === -1)\n\t\t\t) {\n\t\t\t\t// No service worker found. Probably a different app. Reload the page.\n\t\t\t\tnavigator.serviceWorker.ready.then(registration => {\n\t\t\t\t\tregistration.unregister().then(() => {\n\t\t\t\t\t\twindow.location.reload();\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\t// Service worker found. Proceed as normal.\n\t\t\t\tregisterValidSW(swUrl, config);\n\t\t\t}\n\t\t})\n\t\t.catch(() => {\n\t\t\tconsole.log(\n\t\t\t\t\"No internet connection found. App is running in offline mode.\"\n\t\t\t);\n\t\t});\n}\n\nexport function unregister() {\n\tif (\"serviceWorker\" in navigator) {\n\t\tnavigator.serviceWorker.ready\n\t\t\t.then(registration => {\n\t\t\t\tregistration.unregister();\n\t\t\t})\n\t\t\t.catch(error => {\n\t\t\t\tconsole.error(error.message);\n\t\t\t});\n\t}\n}\n","import * as React from \"react\";\nimport * as ReactDOM from \"react-dom\";\nimport { Provider } from \"react-redux\";\nimport { Route, HashRouter } from \"react-router-dom\";\nimport { composeWithDevTools } from \"redux-devtools-extension\";\nimport { applyMiddleware, createStore, compose } from \"redux\";\nimport thunk from \"redux-thunk\";\n//\nimport { rootReducer } from \"./reducers\";\nimport { App } from \"./pages/App\";\nimport { DEFAULT_API } from \"./utils/deezer\";\nimport { Player } from \"./utils/player\";\nimport { initLocales } from \"./utils/i18n\";\nimport { unregister as unregisterServiceWorker } from \"./serviceWorker\";\nimport \"./index.scss\";\n\n// ------------------------------------------------------------------\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nunregisterServiceWorker();\n\n// ------------------------------------------------------------------\n\nconst init = async () => {\n\tconst composeEnhancers =\n\t\tprocess.env.NODE_ENV === \"development\"\n\t\t\t? composeWithDevTools({})\n\t\t\t: compose;\n\n\tconst deezer = DEFAULT_API;\n\tconst queuePlayer = Player(true);\n\tconst previewPlayer = Player(false);\n\tinitLocales();\n\n\tconst store = createStore(\n\t\trootReducer,\n\t\tcomposeEnhancers(\n\t\t\tapplyMiddleware(\n\t\t\t\tthunk.withExtraArgument({ deezer, queuePlayer, previewPlayer })\n\t\t\t)\n\t\t)\n\t);\n\n\t// const dispatch: Dispatch = store.dispatch.bind(store);\n\n\treturn store;\n};\n\n// ------------------------------------------------------------------\n\ninit().then(store => {\n\tReactDOM.render(\n\t\t<Provider store={store}>\n\t\t\t<HashRouter>\n\t\t\t\t<Route path=\"/\" component={App} />\n\t\t\t</HashRouter>\n\t\t</Provider>,\n\t\tdocument.getElementById(\"root\")\n\t);\n});\n"],"sourceRoot":""}