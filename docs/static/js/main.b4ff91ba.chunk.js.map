{"version":3,"sources":["components/Common/Icon.tsx","components/Common/IconButton.tsx","utils/clipboard.ts","selectors/room.ts","actions/index.ts","reducers/messages.ts","actions/messages.ts","actions/modals.ts","selectors/medias.ts","components/Room/Head.tsx","components/Common/LoadingIcon.tsx","components/Room/Cover.tsx","components/Room/Medias.tsx","components/Room/QueueItem.tsx","utils/index.ts","utils/games/seabattle/index.ts","utils/games/seabattle/mappings.ts","utils/games/seabattle/generator.ts","utils/rooms.ts","config/firebase.ts","utils/firebase.ts","utils/messages.ts","utils/images.ts","utils/colorpicker.ts","utils/audio.ts","utils/player.ts","utils/jsonp.ts","utils/providers/deezer.ts","utils/providers/index.ts","reducers/medias.ts","reducers/room.ts","utils/medias.ts","actions/medias.ts","utils/history.ts","reducers/modals.ts","actions/room.ts","actions/player.ts","actions/queue.ts","components/Room/Queue.tsx","components/Room/AudioPlayerControls.tsx","components/Room/Progress.tsx","components/Room/RoomControls.tsx","components/SeaBattle/PlayerControls.tsx","components/SeaBattle/Assets.tsx","components/SeaBattle/Weapons.tsx","components/SeaBattle/Hits.tsx","components/SeaBattle/Boats.tsx","components/SeaBattle/Fleet.tsx","components/SeaBattle/BattleAssets.tsx","utils/svg.ts","components/SeaBattle/Map.tsx","utils/games/seabattle/collision.ts","actions/games/seabattle.ts","components/SeaBattle/OpponentSelection.tsx","components/SeaBattle/WeaponSelection.tsx","components/SeaBattle/OpponentControls.tsx","pages/games/SeaBattle.tsx","utils/keyboards.ts","selectors/messages.ts","components/Common/Messages.tsx","pages/Room.tsx","utils/users.ts","reducers/user.ts","actions/user.ts","pages/Splash.tsx","components/Modals/Modal.tsx","components/Modals/FormModal.tsx","components/Common/CancelButton.tsx","components/Modals/ConfirmModal.tsx","components/Modals/ModalFields.tsx","components/Users/ConnectUserModal.tsx","components/Room/CreateRoomModal.tsx","components/Users/CreateUserModal.tsx","components/Modals/HelpModal.tsx","components/Room/SearchResultCategory.tsx","components/Room/SearchModal.tsx","components/Room/JoinRoomModal.tsx","components/Room/UnlockRoomModal.tsx","components/Modals/index.tsx","pages/App.tsx","locales/en.ts","locales/fr.ts","utils/i18n.ts","serviceWorker.ts","reducers/games/seabattle.ts","reducers/games/index.ts","reducers/index.ts","utils/redux.ts","index.tsx","utils/encoder.ts"],"names":["Icon","React","memo","className","color","icon","size","title","classNames","name","style","IconButton","disabled","displayTitle","kind","onClick","type","aria-label","clickable","copyToClipboard","value","a","Promise","resolve","elem","document","createElement","setAttribute","position","left","body","appendChild","selection","getSelection","selected","rangeCount","getRangeAt","select","execCommand","removeAllRanges","addRange","removeChild","selectRoom","state","room","info","isRoomLoaded","isRoomLocked","access","secret","isRoomPlaying","playing","createAction","payload","removeMessage","id","clearMessages","tag","INITIAL_STATE","MESSAGE_ID_GENERATOR","displayMessage","autoclear","closable","duration","extra","text","weight","dispatch","getState","messages","oldEntry","Object","entries","find","_","message","oldID","oldMessage","Number","timer","clearTimeout","addMessage","stamp","Date","getTime","setTimeout","displayError","data","displayInfo","displaySuccess","confirmModal","question","onConfirmed","onCanceled","window","confirm","selectTracks","res","medias","tracks","track","provider","push","selectTracksCount","length","Head","useDispatch","t","useTranslation","history","useHistory","useSelector","mediasCount","tracksCount","onCopy","useCallback","location","href","split","onExit","count","LoadingIcon","Cover","playable","image","onPlay","onStop","backgroundImage","renderMediaInToaster","media","Media","actions","picture_small","link","target","rel","artist","user","preview","album","QueueItem","locked","onRemove","sleep","delay","SeaBattleDirections","AngleToDirection","angle","augmentedArrayIndexAccess","arr","idx","DirectionToAngle","E","S","W","N","BoatsOffsetMappings","boat1","x","y","boat2","boat3","HitsOffsetInBoatappings","hitted","missed","HitsOffsetInCellMappings","SeaBattleWeaponTypes","SeaBattleWeaponsOffsetMappings","bullet1","bullet2","bullet3","mine","extractOpponentMaps","maps","userId","values","filter","other","checkUserHasBatton","battle","currentMapIndex","passBatonToNextPlayer","decodeBattle","decode","encodeBattle","encode","SeaBattleBoatRotationTransformationMappings","SeaBattleKeyboardMoveMappings","SeaBattleBoatTranslationMappings","SeaBattleBoatLengthMappings","SeaBattleMovementIconMappings","forward","backward","FleetDefaultSet","getCell","grid","setCell","checkAvailable","pos","dir","boatLength","i","generatePlace","Math","floor","random","generateFleet","console","debug","Array","fill","map","fleet","reverse","boatSetting","rawType","boat","hits","status","newMap","opponentsWeapons","weapons","RoomTypes","createQueueMerging","accesses1","accesses2","queue","forEach","index","createQueueRemoving","accesses","Error","copy","splice","generateRoomExtra","generateBattle","config","dbIDs","process","dbPrefix","selectRoomDatabaseId","selectUserDatabaseId","APPS","createOrGetApp","dbId","databaseURL","firebaseConfig","app","firebase","database","rooms","ref","users","FirebaseRoom","roomId","_room","child","_info","_secret","isLocked","setSecret","newSecret","oldSecret","wait","reject","once","snapshot","newValues","val","subscribe","cb","on","unsubscribe","off","update","playmode","queue_position","set","timestamp","ServerValue","TIMESTAMP","FirebaseUser","_user","_values","online","installDisconnect","onDisconnect","cancel","extractErrorMessage","err","response","getImageMainColor","url","jimp","resize","getPixelColor","pixel","r","g","b","CACHE","DEFAULT_COLOR","bg","fg","pickColor","error","AUDIO_BUFFER_CACHES","AUDIO_CONTEXT","getContext","AudioContext","webkitAudioContext","getCurrentTime","currentTime","decodeAudioData","encodedBuffer","loadAudioBuffer","req","XMLHttpRequest","open","responseType","addEventListener","send","getOrLoadAudioBuffer","buffer","findIndex","item","fixAudioContext","removeEventListener","context","createBuffer","source","createBufferSource","connect","destination","start","generateRandomPosition","PlayerImpl","_analyserNode","_gainNode","_node","_duration","_sourceNode","_startTime","_trackId","_trackPosition","getOrCreateNode","createGain","gain","createAnalyser","fftSize","play","trackPosition","trackId","trackUrl","offset","options","stop","loop","loopStart","loopEnd","onended","playbackRate","getPlayingTrackID","getPlayingTrackPercent","getPlayingTrackPosition","isPlaying","computePlayerNextPosition","playStarted","playingTrackID","playingTrackIndex","trackIndex","nextIndex","QUEUE_PLAYER","PREVIEW_PLAYER","WWW_BASE","ConvertAlbum","toString","picture_big","cover_big","cover_small","readable","ConvertTrack","ConvertPlaylist","playlist","DEFAULT_API","_call","path","qs","jsonp","asyncJsonp","_search","query","encodeURIComponent","limit","_load","ids","delayedIds","failedIds","loadedMedias","all","code","_loadWithRetry","first","remainingIds","searchAlbums","trim","searchPlaylists","public","searchTracks","loadAlbums","albums","loadPlaylists","playlists","creator","loadTracks","DeezerApiImpl","loadMedias","deezer","flatten","loadNewMedias","oldMedias","newAccesses","self","newMedias","newMediasAndTracks","searchMedias","results","setMedias","fetching","setRoom","MEDIA_TYPE_DEFINITIONS","label","findMediaInDict","findMedia","dist","list","findMediaInList","findPreview","extractTracks","contextId","contextType","container","findContextFromTrackIndex","allMedias","mediaIndex","mediaFirstTrackIndex","mediaSize","displayMediaInfo","previewMedia","createHashHistory","openModal","prereq","popModal","initialState","stack","DEFAULT_QUEUE_INFO_BY_TYPE","dj","seabattle","0","1","2","3","createRoom","props","onSuccess","v4","enterRoom","exitRoom","newRoom","_watchRoom","_watchPlayer","_unwatchPlayer","_unwatchRoom","lockRoom","unlockRoom","ROOM_WATCHER","player","newInfo","sort","media1","media2","PLAYER_TIMER","_scheduleTimer","ms","nextTrackIndex","nextAccess","nextTrack","startPlayer","stopPlayer","clearQueue","appendToQueue","removeFromQueue","removedTrackIndex","removedMediaFirstTrackIndex","removedMediaIndex","removedTrackCount","keys","setQueuePosition","newTrackIndex","oldTrackIndex","moveToPreviousTrack","moveToNextTrack","Queue","loaded","playingIndex","onSearch","QueueList","EmptyQueueList","key","AudioPlayerControls","propagate","roomInfo","onMoveBackward_Propagate","onMoveForward_Propagate","onPlay_Propagate","onStop_Propagate","onMoveForward_NoPropagate","onMoveBackward_NoPropagate","onPlay_NoPropagate","onStop_NoPropagate","Progress","useState","setValue","useEffect","setInterval","clearInterval","max","RoomControls","extended","onClear","onLock","onUnlock","SeaBattlePlayerControls","onMoveBackward","onMoveForward","onRotateLeft","onRotateRight","Asset","stopPropagation","transform","visibility","e","Cell","asset","Weapon","Weapons","weapon","Hit","Hits","hit","Boat","hideFleet","Fleet","selectedBoatIndex","onSelectBoatIndex","BattleAssets","cx","cy","points","fillRule","d","width","height","patternUnits","getSVGNormalizedPosition","svg","pt","createSVGPoint","tx","matrixTransform","getScreenCTM","inverse","ty","getSVGPosition","Map","onCellClick","useRef","selectedPos","setSelectedPos","selectedVis","setSelectedVis","selectionPos","setSelectionPos","selectionVis","setSelectionVis","normalizedPos","current","onLeave","onOver","viewBox","clientX","clientY","onMouseLeave","onMouseMove","getGridCell","setGridCell","cell","checkPositionInZone","generateGrid","movingBoat","boatIndex","boatCount","boatLocalIndex","movementIsPossible","newPos","newDir","checkZone","checkCollisions","joinBattle","moveBoat","movement","playerMap","oldAngle","oldPosition","oldDirection","newPosition","newAngle","newDirection","attackOpponent","opponentIndex","weaponType","opponentMaps","opponentMap","opponentBoat","OpponentSelection","opponentsCount","onSelectPreviousOpponent","onSelectNextOpponent","WeaponSelection","onSelect","indexOf","opponentId","SeaBattleOpponentControls","onSelectWeaponType","SeaBattle","previousMapIndex","setPreviousMapIndex","setSelectedBoatIndex","setSelectedOpponent","setSelectedWeaponType","playerMapIndex","extractBattleInfo","onJoinBattle","onMove","onKeyDown","repeat","keyCode","preventDefault","onConnectUser","onOpponentCellClick","selectMessages","m1","m2","Messages","bottomPosition","bottom","timeout","enter","exit","Room","search","useLocation","useParams","db_id","room_id","parse","substr","backgroundColor","loadUserAccess","s","localStorage","getItem","setUser","createUser","connectUser","FIREBASE_CB","disconnectUser","newUser","reconnectUser","Splash","loggedIn","onCreateRoom","onCreateUser","onShowHelp","to","src","alt","Modal","children","renderFoot","onSubmit","has_prev_modal","modals","onClose","onPop","event","hidden","FormModal","renderButtons","CancelButton","ConfirmModal","onCancel","ModalField","InputField","forwardRef","htmlFor","SecretField","onChange","placeholder","onCopyToClipboard","display","flexDirection","justifyContent","flexGrow","marginRight","autoComplete","maxLength","minLength","required","SelectField","localeCompare","option","ConnectUserModal","setUserId","userIdRef","focus","onConnect","ROOM_COUNTER","CreateRoomModal","setName","setType","nameRef","onCreate","USER_COUNTER","CreateUserModal","HelpModal","onJoinRoom","SearchResultCategory","items","onViewMore","SearchModal","queryRef","playingMediaId","setPlayingMediaId","playingMediaProvider","setPlayingMediaProvider","playingMediaType","setPlayingMediaType","setQuery","setResults","onStartPreview","onStopPreview","JoinRoomModal","serverId","setServerId","setRoomId","roomIdRef","onJoin","s1","s2","UnlockRoomModal","secretRef","Modals","currPrereq","setCurrPrereq","prevPrereq","setPrevPrereq","onPopModal","keyDown","modal","getModal","in","unmountOnExit","role","App","exact","component","audio","errors","cannot_decode_audio_data","cannot_load_audio_buffer","splash","CGU","powered_with","description","help","rules","rule1","rule1b","rule2","rule2b","notes","note1","note2","invalid","confirm_disconnect","connection","create","disconnect","id_is_invalid","id_placeholder","name_is_invalid","name_placeholder","secret_is_invalid","secret_placeholder","user_creation","not_connected","games","movement_not_possible","movement_not_possible_because_hitted","opponent_index","join_battle","opponent_already_killed","ship_already_hitted","ship_already_killed","hitted_opponent","killed_opponent","killed_opponent_boat","missed_opponent","no_weapon_selected","weapon_not_available","not_your_turn","opponent_turn","player_turn","you_have_been_killed","max_players_count","no_opponents","no_opponents_to_attack","connect_to_join","watch_or_join","types","blind","clear","confirm_clear","confirm_exit","confirm_lock","copy_link","empty","empty_for_now","server_id","server_id_placeholder","key_placeholder","type_placeholder","join","link_copied_to_clipboard","loading","room_creation","room_join","room_unlocking","unlock","unlocked","media_count","media_count_plural","track_count","track_count_plural","by","add","remove","search_placeholder","medias_search","copy_to_clipboard","secret_copied_to_clipboard","initLocales","navigator","language","userLanguage","i18next","use","initReactI18next","init","fallbackLng","lng","resources","en","translation","fr","interpolation","escapeValue","format","isLocalhost","Boolean","hostname","match","registerValidSW","swUrl","serviceWorker","register","then","registration","onupdatefound","installingWorker","installing","onstatechange","controller","onUpdate","catch","gamesReducer","combineReducers","action","rootReducer","pop","setItem","removeItem","initStore","composeEnhancers","compose","store","createStore","applyMiddleware","thunk","withExtraArgument","bind","URL","origin","fetch","headers","contentType","get","ready","unregister","reload","checkValidServiceWorker","registerServiceWorker","ReactDOM","getElementById","Buffer","from","JSON","stringify"],"mappings":"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","file":"static/js/main.b4ff91ba.chunk.js","sourcesContent":["import React, { FC } from \"react\";\nimport FontAwesome from \"react-fontawesome\";\nimport classNames from \"classnames\";\n//\nimport \"./Icon.scss\";\n\n// ------------------------------------------------------------------\n\nexport type IconSize = \"S\" | \"M\" | \"L\" | \"XL\";\n\n// ------------------------------------------------------------------\n\nexport const Icon: FC<{\n\tclassName?: string;\n\tcolor?: string;\n\ticon: string;\n\tsize?: IconSize;\n\ttitle?: string;\n}> = React.memo(({ className, color, icon, size = \"M\", title }) => (\n\t<FontAwesome\n\t\tclassName={classNames(\"Icon\", className, size)}\n\t\tname={icon}\n\t\tstyle={{ color }}\n\t\ttitle={title}\n\t/>\n));\n","import React, { FC } from \"react\";\nimport classNames from \"classnames\";\n//\nimport { Icon, IconSize } from \"./Icon\";\nimport \"./IconButton.scss\";\n\n// ------------------------------------------------------------------\n\ntype ButtonType = \"button\" | \"submit\";\n\nexport const IconButton: FC<{\n\tclassName?: string;\n\tcolor?: string;\n\tdisabled?: boolean;\n\tdisplayTitle?: boolean;\n\ticon: string;\n\tkind?: \"default\" | \"primary\" | \"danger\" | \"special\";\n\tonClick?: () => void;\n\tsize?: IconSize;\n\ttitle: string;\n\ttype?: ButtonType;\n}> = React.memo(\n\t({\n\t\tclassName,\n\t\tcolor,\n\t\tdisabled = false,\n\t\tdisplayTitle = false,\n\t\ticon,\n\t\tkind = \"default\",\n\t\tonClick,\n\t\tsize,\n\t\ttitle,\n\t\ttype = \"button\"\n\t}) => (\n\t\t<button\n\t\t\ttype={type}\n\t\t\taria-label={title}\n\t\t\tclassName={classNames(\"IconButton\", className, kind, {\n\t\t\t\tclickable: !disabled && (!!onClick || type === \"submit\")\n\t\t\t})}\n\t\t\tonClick={disabled ? void 0 : onClick}\n\t\t\ttitle={title}>\n\t\t\t<Icon color={color} icon={icon} size={size} />\n\t\t\t{displayTitle && (\n\t\t\t\t<div className={classNames(\"IconButtonTitle\", size)}>\n\t\t\t\t\t{title}\n\t\t\t\t</div>\n\t\t\t)}\n\t\t</button>\n\t)\n);\n","// https://hackernoon.com/copying-text-to-clipboard-with-javascript-df4d4988697f\nexport const copyToClipboard = async (value: string): Promise<void> =>\n\tawait new Promise(resolve => {\n\t\tconst elem = document.createElement(\"textarea\");\n\t\telem.value = value;\n\t\telem.setAttribute(\"readonly\", \"\");\n\t\telem.style.position = \"absolute\";\n\t\telem.style.left = \"-9999px\";\n\n\t\tdocument.body.appendChild(elem);\n\t\tconst selection = document.getSelection();\n\t\tif (selection !== null) {\n\t\t\tconst selected =\n\t\t\t\tselection.rangeCount > 0 ? selection.getRangeAt(0) : false;\n\t\t\telem.select();\n\t\t\tdocument.execCommand(\"copy\");\n\t\t\tif (selected !== false) {\n\t\t\t\tselection.removeAllRanges();\n\t\t\t\tselection.addRange(selected);\n\t\t\t}\n\t\t}\n\t\tdocument.body.removeChild(elem);\n\t\tresolve();\n\t});\n","import { RootState } from \"../reducers\";\n\nexport const selectRoom = (state: RootState) => state.room.info;\n\nexport const isRoomLoaded = (state: RootState) => !!state.room.room;\n\nexport const isRoomLocked = (state: RootState) => !state.room.access.secret;\n\nexport const isRoomPlaying = (state: RootState) =>\n\tnull !== state.room.info && state.room.info.playing;\n","import { AnyAction } from \"redux\";\nimport { ThunkAction, ThunkDispatch } from \"redux-thunk\";\n//\nimport { Player } from \"../utils/player\";\nimport { RootState } from \"../reducers\";\n\n// ------------------------------------------------------------------\n\nexport type Action<T extends string> = {\n\ttype: T;\n};\n\nexport type ActionWithPayload<T extends string, P> = {\n\ttype: T;\n\tpayload: P;\n};\n\nexport type Extended = {\n\tplayer: Player;\n};\n\nexport type Dispatch = ThunkDispatch<RootState, Extended, AnyAction>;\n\nexport type AsyncAction = ThunkAction<void, RootState, Extended, AnyAction>;\n\nexport function createAction<T extends string>(type: T): Action<T>;\n\nexport function createAction<T extends string, P>(\n\ttype: T,\n\tpayload: P\n): ActionWithPayload<T, P>;\n\nexport function createAction<T extends string, P>(type: T, payload?: P) {\n\treturn payload === void 0 ? { type } : { type, payload };\n}\n\nexport type ActionOptions = { onSuccess?: () => void };\n","import { Reducer } from \"redux\";\nimport { Message } from \"../utils/messages\";\nimport { createAction } from \"../actions\";\n\n// ------------------------------------------------------------------\n\ntype MessagesAction =\n\t| ReturnType<typeof addMessage>\n\t| ReturnType<typeof clearMessages>\n\t| ReturnType<typeof removeMessage>;\n\nexport const addMessage = (\n\tid: number,\n\tmessage: Message,\n\ttimer?: NodeJS.Timeout\n) => createAction(\"message/ADD\", { timer, id, message });\nexport const removeMessage = (id: number) =>\n\tcreateAction(\"message/REMOVE\", { id });\nexport const clearMessages = (tag?: string) =>\n\tcreateAction(\"message/RESET\", { tag });\n\n// ------------------------------------------------------------------\n\nexport type State = { [id: string]: Message };\n\nexport const INITIAL_STATE: State = {};\n\n// ------------------------------------------------------------------\n\nexport const messagesReducer: Reducer<State, MessagesAction> = (\n\tstate = INITIAL_STATE,\n\taction\n): State => {\n\tswitch (action.type) {\n\t\tcase \"message/ADD\":\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\t[action.payload.id]: {\n\t\t\t\t\ttimer: action.payload.timer,\n\t\t\t\t\t...action.payload.message\n\t\t\t\t}\n\t\t\t};\n\t\tcase \"message/REMOVE\": {\n\t\t\tconst copy = { ...state };\n\t\t\tdelete copy[action.payload.id];\n\t\t\treturn copy;\n\t\t}\n\t\tcase \"message/RESET\": {\n\t\t\tif (!action.payload.tag) {\n\t\t\t\treturn INITIAL_STATE;\n\t\t\t}\n\t\t\tconst copy = { ...state };\n\t\t\tObject.entries(state).forEach(([id, message]) => {\n\t\t\t\tif (message.tag === action.payload.tag) {\n\t\t\t\t\tdelete copy[id];\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn copy;\n\t\t}\n\t\tdefault:\n\t\t\treturn state;\n\t}\n};\n","import { AsyncAction } from \".\";\nimport { MessageType } from \"../utils/messages\";\nimport { addMessage, removeMessage } from \"../reducers/messages\";\n\n// ------------------------------------------------------------------\n\nlet MESSAGE_ID_GENERATOR: number = 0;\n\ntype MessageCreationData = {\n\tautoclear?: boolean;\n\tclosable?: boolean;\n\tduration?: number;\n\textra?: () => React.ReactNode;\n\ttag?: string;\n\ttext?: string;\n\tweight?: number;\n};\n\nexport const displayMessage = (\n\ttype: MessageType,\n\t{\n\t\tautoclear = true,\n\t\tclosable = true,\n\t\tduration = 3000,\n\t\textra,\n\t\ttag,\n\t\ttext,\n\t\tweight = 0\n\t}: MessageCreationData\n): AsyncAction => (dispatch, getState) => {\n\tconst { messages } = getState();\n\n\tconst oldEntry = Object.entries(messages).find(\n\t\t([_, message]) => message.tag === tag && message.text === text\n\t);\n\tlet id = 0;\n\tif (oldEntry) {\n\t\tconst [oldID, oldMessage] = oldEntry;\n\t\tid = Number(oldID); // Reuse message id and renqueue\n\t\tif (oldMessage.timer) {\n\t\t\tclearTimeout(oldMessage.timer);\n\t\t}\n\t} else {\n\t\tid = MESSAGE_ID_GENERATOR++;\n\t}\n\n\tdispatch(\n\t\taddMessage(\n\t\t\tid,\n\t\t\t{\n\t\t\t\tclosable,\n\t\t\t\textra,\n\t\t\t\tid,\n\t\t\t\tstamp: new Date().getTime(),\n\t\t\t\ttag,\n\t\t\t\ttext,\n\t\t\t\ttype,\n\t\t\t\tweight\n\t\t\t},\n\t\t\tautoclear\n\t\t\t\t? setTimeout(() => dispatch(removeMessage(id)), duration)\n\t\t\t\t: void 0\n\t\t)\n\t);\n};\n\n// ------------------------------------------------------------------\n\nexport const displayError = (text: string, data?: MessageCreationData) =>\n\tdisplayMessage(\"error\", {\n\t\ttext,\n\t\t...data\n\t});\n\nexport const displayInfo = (text: string, data?: MessageCreationData) =>\n\tdisplayMessage(\"info\", {\n\t\ttext,\n\t\t...data\n\t});\n\nexport const displaySuccess = (text: string, data?: MessageCreationData) =>\n\tdisplayMessage(\"success\", {\n\t\ttext,\n\t\t...data\n\t});\n","import { AsyncAction } from \".\";\n\n// ------------------------------------------------------------------\n\nexport const confirmModal = (\n\tquestion: string,\n\tonConfirmed: () => void,\n\tonCanceled?: () => void\n): AsyncAction => () => {\n\t// TODO: open custom ConfirmModal instead of system popup\n\tif (window.confirm(question)) {\n\t\tonConfirmed();\n\t\treturn;\n\t}\n\tif (onCanceled) {\n\t\tonCanceled();\n\t}\n};\n","import { RootState } from \"../reducers\";\nimport { Track } from \"../utils/medias\";\n\n// ------------------------------------------------------------------\n\nexport const selectTracks = (state: RootState): Array<Track | null> => {\n\tconst res: Array<Track | null> = [];\n\tconst {\n\t\tmedias: { medias },\n\t\troom: { tracks }\n\t} = state;\n\tfor (const access of tracks) {\n\t\tconst track = medias[access.provider][access.type][access.id];\n\t\tif (!!track) {\n\t\t\tres.push(track);\n\t\t} else {\n\t\t\tres.push(null); // Stiil loading or cannot be loaded or to reload later because of rate limit\n\t\t}\n\t}\n\treturn res;\n};\n\nexport const selectTracksCount = (state: RootState) => state.room.tracks.length;\n","import React, { FC, useCallback } from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { useTranslation } from \"react-i18next\";\nimport { useHistory } from \"react-router-dom\";\n//\nimport { IconButton } from \"../Common/IconButton\";\nimport { copyToClipboard } from \"../../utils/clipboard\";\nimport { Dispatch } from \"../../actions\";\nimport { RootState } from \"../../reducers\";\nimport { selectRoom } from \"../../selectors/room\";\nimport { displaySuccess } from \"../../actions/messages\";\nimport { confirmModal } from \"../../actions/modals\";\nimport { RoomInfo } from \"../../utils/rooms\";\nimport { selectTracksCount } from \"../../selectors/medias\";\nimport \"./Head.scss\";\n\n// ------------------------------------------------------------------\n\nexport const Head: FC = () => {\n\tconst dispatch = useDispatch<Dispatch>();\n\tconst { t } = useTranslation();\n\tconst history = useHistory();\n\tconst room = useSelector<RootState, RoomInfo | null>(selectRoom);\n\tconst mediasCount = useSelector<RootState, number>(\n\t\tstate => state.room.medias.length\n\t);\n\tconst tracksCount = useSelector<RootState, number>(selectTracksCount);\n\n\tconst onCopy = useCallback(async () => {\n\t\tawait copyToClipboard(document.location.href.split(\"?\")[0]);\n\t\tdispatch(displaySuccess(\"rooms.link_copied_to_clipboard\"));\n\t}, [dispatch]);\n\n\tconst onExit = useCallback(() => {\n\t\tdispatch(\n\t\t\tconfirmModal(t(\"rooms.confirm_exit\"), () => {\n\t\t\t\thistory.push(\"/\");\n\t\t\t})\n\t\t);\n\t}, [t, dispatch, history]);\n\n\treturn (\n\t\t<div className=\"Head\">\n\t\t\t<div className=\"HeadInner\">\n\t\t\t\t<div className=\"RoomLink\">\n\t\t\t\t\t<IconButton\n\t\t\t\t\t\ticon=\"link\"\n\t\t\t\t\t\tonClick={onCopy}\n\t\t\t\t\t\tsize=\"M\"\n\t\t\t\t\t\ttitle={t(\"rooms.copy_link\")}\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div className=\"RoomMeta\">\n\t\t\t\t\t{room ? (\n\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclassName=\"RoomName\"\n\t\t\t\t\t\t\t\ttitle={`${t(\"rooms.media_count\", {\n\t\t\t\t\t\t\t\t\tcount: mediasCount\n\t\t\t\t\t\t\t\t})} / ${t(\"rooms.track_count\", {\n\t\t\t\t\t\t\t\t\tcount: tracksCount\n\t\t\t\t\t\t\t\t})}`}>\n\t\t\t\t\t\t\t\t{room.name}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</>\n\t\t\t\t\t) : null}\n\t\t\t\t</div>\n\t\t\t\t<div className=\"RoomExit\">\n\t\t\t\t\t<IconButton\n\t\t\t\t\t\tonClick={onExit}\n\t\t\t\t\t\ticon=\"sign-out\"\n\t\t\t\t\t\tsize=\"M\"\n\t\t\t\t\t\ttitle={t(\"rooms.exit\")}\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t);\n};\n","import React, { FC } from \"react\";\nimport { Icon, IconSize } from \"./Icon\";\n\n// ------------------------------------------------------------------\n\nexport const LoadingIcon: FC<{ size?: IconSize }> = React.memo(({ size }) => (\n\t<Icon\n\t\tclassName=\"rotating\"\n\t\ticon=\"circle-o-notch\"\n\t\tsize={size}\n\t\ttitle=\"Loading\"\n\t/>\n));\n","import React, { FC } from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport classNames from \"classnames\";\n//\nimport { Icon } from \"../Common/Icon\";\nimport \"./Cover.scss\";\n\n// ------------------------------------------------------------------\n\nexport const Cover: FC<{\n\timage: string;\n\tonPlay?: () => void;\n\tonStop?: () => void;\n\tplayable: boolean;\n\tplaying: boolean;\n}> = React.memo(({ playable, playing, image, onPlay, onStop }) => {\n\tconst { t } = useTranslation();\n\tif (playable) {\n\t\treturn (\n\t\t\t<div\n\t\t\t\tclassName={classNames(\"Cover\", { playable, playing })}\n\t\t\t\tstyle={image ? { backgroundImage: `url('${image}')` } : {}}\n\t\t\t\tonClick={!playing ? onPlay : onStop}>\n\t\t\t\t{!playing ? (\n\t\t\t\t\t<Icon icon=\"play\" size=\"S\" title={t(\"player.play\")} />\n\t\t\t\t) : (\n\t\t\t\t\t<Icon icon=\"pause\" size=\"S\" title={t(\"player.stop\")} />\n\t\t\t\t)}\n\t\t\t</div>\n\t\t);\n\t} else {\n\t\treturn (\n\t\t\t<div\n\t\t\t\tclassName={classNames(\"Cover\", { playing })}\n\t\t\t\tstyle={image ? { backgroundImage: `url('${image}')` } : {}}>\n\t\t\t\t{playing ? (\n\t\t\t\t\t<Icon icon=\"music\" size=\"S\" title={t(\"player.playing\")} />\n\t\t\t\t) : null}\n\t\t\t</div>\n\t\t);\n\t}\n});\n","import React, { FC, ReactNode } from \"react\";\nimport { useTranslation } from \"react-i18next\";\n//\nimport { Cover } from \"./Cover\";\nimport { LoadingIcon } from \"../Common/LoadingIcon\";\nimport { Media as MediaData } from \"../../utils/medias\";\nimport \"./Medias.scss\";\n\n// ------------------------------------------------------------------\n\nexport const renderMediaInToaster = (media: MediaData): React.ReactNode => {\n\treturn <Media media={media} playable={false} playing={true} />;\n};\n\n// ------------------------------------------------------------------\n\nexport const Media: FC<{\n\tactions?: ReactNode;\n\tmedia: MediaData | null;\n\tplayable: boolean;\n\tplaying: boolean;\n\tonPlay?: () => void;\n\tonStop?: () => void;\n}> = React.memo(({ actions, media, playable, playing, onPlay, onStop }) => {\n\tconst { t } = useTranslation();\n\tif (!media) {\n\t\treturn (\n\t\t\t<div className=\"Media\">\n\t\t\t\t<Cover\n\t\t\t\t\tplayable={playable}\n\t\t\t\t\tplaying={playing}\n\t\t\t\t\timage={\"\"}\n\t\t\t\t\tonPlay={onPlay}\n\t\t\t\t\tonStop={onStop}\n\t\t\t\t/>\n\t\t\t\t<div className=\"Metas\">\n\t\t\t\t\t<LoadingIcon size=\"M\" />\n\t\t\t\t</div>\n\t\t\t\t{actions ? <div className=\"Actions\">{actions}</div> : null}\n\t\t\t</div>\n\t\t);\n\t}\n\tif (media.type === \"album\") {\n\t\treturn (\n\t\t\t<div className=\"Media Album\">\n\t\t\t\t<Cover\n\t\t\t\t\tplayable={playable}\n\t\t\t\t\tplaying={playing}\n\t\t\t\t\timage={media.picture_small}\n\t\t\t\t\tonPlay={onPlay}\n\t\t\t\t\tonStop={onStop}\n\t\t\t\t/>\n\t\t\t\t<div className=\"Metas\">\n\t\t\t\t\t<div className=\"Meta AlbumTitle\">\n\t\t\t\t\t\t<a\n\t\t\t\t\t\t\thref={media.link}\n\t\t\t\t\t\t\ttarget=\"_blank\"\n\t\t\t\t\t\t\trel=\"noopener noreferrer\">\n\t\t\t\t\t\t\t{media.title}\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className=\"Meta AlbumArtist\">\n\t\t\t\t\t\t<a\n\t\t\t\t\t\t\thref={media.artist.link}\n\t\t\t\t\t\t\ttarget=\"_blank\"\n\t\t\t\t\t\t\trel=\"noopener noreferrer\">\n\t\t\t\t\t\t\t{t(\"medias.by\", { artist: media.artist.name })}\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t{actions ? <div className=\"Actions\">{actions}</div> : null}\n\t\t\t</div>\n\t\t);\n\t}\n\tif (media.type === \"playlist\") {\n\t\treturn (\n\t\t\t<div className=\"Media Playlist\">\n\t\t\t\t<Cover\n\t\t\t\t\tplayable={playable}\n\t\t\t\t\tplaying={playing}\n\t\t\t\t\timage={media.picture_small}\n\t\t\t\t\tonPlay={onPlay}\n\t\t\t\t\tonStop={onStop}\n\t\t\t\t/>\n\t\t\t\t<div className=\"Metas\">\n\t\t\t\t\t<div className=\"Meta PlaylistTitle\">\n\t\t\t\t\t\t<a\n\t\t\t\t\t\t\thref={media.link}\n\t\t\t\t\t\t\ttarget=\"_blank\"\n\t\t\t\t\t\t\trel=\"noopener noreferrer\">\n\t\t\t\t\t\t\t{media.title}\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className=\"Meta PlaylistCreator\">\n\t\t\t\t\t\t<a\n\t\t\t\t\t\t\thref={media.user.link}\n\t\t\t\t\t\t\ttarget=\"_blank\"\n\t\t\t\t\t\t\trel=\"noopener noreferrer\">\n\t\t\t\t\t\t\t{t(\"medias.by\", { artist: media.user.name })}\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t{actions ? <div className=\"Actions\">{actions}</div> : null}\n\t\t\t</div>\n\t\t);\n\t}\n\tif (media.type === \"track\") {\n\t\treturn (\n\t\t\t<div className=\"Media Track\">\n\t\t\t\t<Cover\n\t\t\t\t\tplayable={playable && !!media.preview}\n\t\t\t\t\tplaying={playing}\n\t\t\t\t\timage={media.album.picture_small}\n\t\t\t\t\tonPlay={onPlay}\n\t\t\t\t\tonStop={onStop}\n\t\t\t\t/>\n\t\t\t\t<div className=\"Metas\">\n\t\t\t\t\t<div className=\"Meta TrackTitle\">\n\t\t\t\t\t\t<a\n\t\t\t\t\t\t\thref={media.link}\n\t\t\t\t\t\t\ttarget=\"_blank\"\n\t\t\t\t\t\t\trel=\"noopener noreferrer\">\n\t\t\t\t\t\t\t{media.title}\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className=\"Meta TrackArtist\">\n\t\t\t\t\t\t<a\n\t\t\t\t\t\t\thref={media.artist.link}\n\t\t\t\t\t\t\ttarget=\"_blank\"\n\t\t\t\t\t\t\trel=\"noopener noreferrer\">\n\t\t\t\t\t\t\t{t(\"medias.by\", { artist: media.artist.name })}\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t{actions ? <div className=\"Actions\">{actions}</div> : null}\n\t\t\t</div>\n\t\t);\n\t}\n\treturn null;\n});\n","import React, { FC } from \"react\";\nimport { useTranslation } from \"react-i18next\";\n//\nimport { Media } from \"./Medias\";\nimport { IconButton } from \"../Common/IconButton\";\nimport { Track } from \"../../utils/medias\";\n\n// ------------------------------------------------------------------\n\nexport const QueueItem: FC<{\n\tlocked: boolean;\n\ttrack: Track | null; // if null : stiil loading or cannot be loaded or to reload later because of rate limit\n\tplaying: boolean;\n\tonPlay: () => void;\n\tonRemove: () => void;\n\tonStop: () => void;\n}> = React.memo(({ locked, track, playing, onPlay, onRemove, onStop }) => {\n\tconst { t } = useTranslation();\n\treturn (\n\t\t<div className=\"QueueItem\">\n\t\t\t<Media\n\t\t\t\tmedia={track}\n\t\t\t\tplayable={!!track && !locked}\n\t\t\t\tplaying={playing}\n\t\t\t\tonPlay={onPlay}\n\t\t\t\tonStop={onStop}\n\t\t\t\tactions={\n\t\t\t\t\t<IconButton\n\t\t\t\t\t\tdisabled={locked}\n\t\t\t\t\t\ttitle={t(\"medias.remove\")}\n\t\t\t\t\t\ticon=\"trash\"\n\t\t\t\t\t\tonClick={onRemove}\n\t\t\t\t\t/>\n\t\t\t\t}\n\t\t\t/>\n\t\t</div>\n\t);\n});\n","export const sleep = (delay: number) =>\n\tnew Promise(resolve => setTimeout(resolve, delay));\n\nexport const augmentedArrayIndexAccess = <T>(arr: T[], idx: number): T =>\n\tarr[(idx < 0 ? (idx % arr.length) + arr.length : idx) % arr.length];\n","import { decode, encode } from \"../../encoder\";\nimport { augmentedArrayIndexAccess } from \"../../\";\n\n// ------------------------------------------------------------------\n\nexport const GRID_CELL_COUNT = 10;\nexport const GRID_CELL_UNIT_SIZE = 40;\nexport const MAX_PLAYER_COUNT = 3;\nexport const INVALID_MOVE_MESSAGE_TAG = \"seabattle/invalid_move\";\nexport const PLAYER_TURN_MESSAGE_TAG = \"seabattle/player_turn\";\n\n// ------------------------------------------------------------------\n\nexport type SeaBattleGridCell =\n\t| {\n\t\t\tboatIndex: number;\n\t\t\tboatLocalIndex: number;\n\t\t\ttype: \"boat\";\n\t  }\n\t| {\n\t\t\tweaponType: SeaBattleWeaponType;\n\t\t\ttype: \"weapon\";\n\t  }\n\t| null;\n\nexport type SeaBattleGrid = SeaBattleGridCell[][];\n\n// ------------------------------------------------------------------\n\nexport type SeaBattlePosition = { x: number; y: number };\n\nexport type SeaBattleAssetVisibility = \"hidden\" | \"visible\";\n\nexport type SeaBattleCellType =\n\t| \"cell-crossed\"\n\t| \"cell-selected\"\n\t| \"cell-selection\";\n\nexport type SeaBattleAssetType =\n\t| SeaBattleBoatType\n\t| SeaBattleCellType\n\t| SeaBattleHitType\n\t| SeaBattleWeaponType;\n\n// ------------------------------------------------------------------\n\nexport type SeaBattleDirection = \"E\" | \"S\" | \"W\" | \"N\";\n\nexport const SeaBattleDirections: SeaBattleDirection[] = [\"E\", \"S\", \"W\", \"N\"]; // order is important for AngleToDirection\n\nexport const AngleToDirection = (angle: number): SeaBattleDirection =>\n\taugmentedArrayIndexAccess(SeaBattleDirections, angle);\n\nexport const DirectionToAngle = {\n\t// Keys are direction\n\tE: 0,\n\tS: 1,\n\tW: 2,\n\tN: 3\n};\n\nexport type SeaBattleMovementType =\n\t| \"move-forward\"\n\t| \"move-backward\"\n\t| \"rotate-left\"\n\t| \"rotate-right\";\n\nexport type SeaBattleBoatStatus = \"ok\" | \"ko\";\n\nexport type SeaBattleBoatType = \"boat1\" | \"boat2\" | \"boat3\";\n\nexport type SeaBattleBoatData = {\n\tangle: number;\n\thits: SeaBattleHitData[];\n\tposition: SeaBattlePosition;\n\tstatus: SeaBattleBoatStatus;\n\ttype: SeaBattleBoatType;\n};\n\nexport const BoatsOffsetMappings = {\n\t// Keys are boat types\n\tboat1: { x: 6, y: 6 },\n\tboat2: { x: 6, y: 6 },\n\tboat3: { x: 6, y: 6 }\n};\n\n// ------------------------------------------------------------------\n\nexport type SeaBattleCellData = {\n\tposition: SeaBattlePosition;\n\ttype: SeaBattleCellType;\n\tvisibility?: SeaBattleAssetVisibility;\n};\n\n// ------------------------------------------------------------------\n\nexport type SeaBattleHitType = \"hitted\" | \"missed\";\n\nexport type SeaBattleHitData = {\n\tposition: SeaBattlePosition;\n\ttype: SeaBattleHitType;\n};\n\nexport const HitsOffsetInBoatappings = {\n\t// Keys are hits types\n\thitted: { x: 4, y: 4 },\n\tmissed: { x: 4, y: 4 }\n};\n\nexport const HitsOffsetInCellMappings = {\n\t// Keys are hits types\n\thitted: { x: 10, y: 10 },\n\tmissed: { x: 10, y: 10 }\n};\n\n// ------------------------------------------------------------------\n\nexport type SeaBattleWeaponType = \"bullet1\" | \"bullet2\" | \"bullet3\" | \"mine\";\n\nexport const SeaBattleWeaponTypes: SeaBattleWeaponType[] = [\n\t\"bullet1\",\n\t\"bullet2\",\n\t\"bullet3\",\n\t\"mine\"\n];\n\nexport type SeaBattleWeaponData = {\n\topponentId: string;\n\tposition: SeaBattlePosition;\n\ttype: SeaBattleWeaponType;\n};\n\nexport const SeaBattleWeaponsOffsetMappings = {\n\t// Keys are weapon types\n\tbullet1: { x: 12, y: 16 },\n\tbullet2: { x: 12, y: 16 },\n\tbullet3: { x: 12, y: 16 },\n\tmine: { x: 12, y: 12 }\n};\n\nexport type SeaBattleWeaponsSet = {\n\t// Keys are weapon types\n\t[type: string]: number;\n};\n\n// ------------------------------------------------------------------\n\nexport type SeaBattleMapStatus = \"ok\" | \"ko\";\n\nexport type SeaBattleMapData = {\n\tfleet: SeaBattleBoatData[];\n\thits: SeaBattleHitData[];\n\topponentsWeapons: SeaBattleWeaponData[]; // Weapons placed by opponents\n\tstatus: SeaBattleMapStatus;\n\tuserId: string;\n\tweapons: SeaBattleWeaponsSet;\n};\n\n// ------------------------------------------------------------------\n\nexport type SeaBattleData = {\n\tcurrentMapIndex: number;\n\tmaps: SeaBattleMapData[];\n};\n\n// ------------------------------------------------------------------\n\nexport const extractOpponentMaps = (maps: SeaBattleMapData[], userId: string) =>\n\tObject.values(maps).filter(other => other.userId !== userId);\n\n// ------------------------------------------------------------------\n\nexport const extractBattleInfo = ({\n\textra,\n\tuserId,\n\tboatIndex\n}: {\n\textra: string;\n\tuserId: string;\n\tboatIndex: number;\n}): {\n\tboat?: SeaBattleBoatData;\n\tcurrentMapIndex: number;\n\topponentMaps?: SeaBattleMapData[];\n\tplayerMap?: SeaBattleMapData;\n\tplayerMapIndex: number;\n} => {\n\tlet boat: SeaBattleBoatData | undefined = void 0;\n\tlet currentMapIndex = -1;\n\tlet opponentMaps: SeaBattleMapData[] | undefined = void 0;\n\tlet playerMap: SeaBattleMapData | undefined = void 0;\n\tlet playerMapIndex = -1;\n\tif (extra) {\n\t\tconst battle = decodeBattle(extra);\n\t\tif (userId) {\n\t\t\tcurrentMapIndex = battle.currentMapIndex;\n\t\t\tplayerMapIndex = battle.maps.findIndex(\n\t\t\t\tother => other.userId === userId\n\t\t\t);\n\t\t\tif (playerMapIndex >= 0) {\n\t\t\t\tplayerMap = battle.maps[playerMapIndex];\n\t\t\t\tif (boatIndex >= 0 && boatIndex < playerMap.fleet.length) {\n\t\t\t\t\tboat = playerMap.fleet[boatIndex];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\topponentMaps = extractOpponentMaps(battle.maps, userId);\n\t}\n\treturn {\n\t\tboat,\n\t\tcurrentMapIndex,\n\t\topponentMaps,\n\t\tplayerMap,\n\t\tplayerMapIndex\n\t};\n};\n\n// ------------------------------------------------------------------\n\nexport const checkUserHasBatton = (battle: SeaBattleData, userId: string) =>\n\tbattle.maps[battle.currentMapIndex]?.userId === userId;\n\nexport const passBatonToNextPlayer = (battle: SeaBattleData) => {\n\tbattle.currentMapIndex = (battle.currentMapIndex + 1) % battle.maps.length;\n};\n\n// ------------------------------------------------------------------\n\nexport const decodeBattle = (data: string): SeaBattleData =>\n\tdecode<SeaBattleData>(data);\n\nexport const encodeBattle = (data: SeaBattleData): string =>\n\tencode<SeaBattleData>(data);\n","import { SeaBattlePosition, SeaBattleMovementType } from \".\";\nimport { KEY_RIGHT, KEY_LEFT, KEY_DOWN, KEY_UP } from \"../../keyboards\";\n\n// ------------------------------------------------------------------\n\nexport const SeaBattleBoatRotationTransformationMappings: {\n\t[type: string]: {\n\t\t[direction: string]: SeaBattlePosition;\n\t};\n} = {\n\t// Keys are boat types\n\tboat1: {\n\t\tN: { x: 0, y: 0 },\n\t\tE: { x: 0, y: 0 },\n\t\tS: { x: 0, y: 0 },\n\t\tW: { x: 0, y: 0 }\n\t},\n\tboat2: {\n\t\tN: { x: 0, y: -1 },\n\t\tE: { x: 1, y: 0 },\n\t\tS: { x: 0, y: 1 },\n\t\tW: { x: -1, y: 0 }\n\t},\n\tboat3: {\n\t\tN: { x: 0, y: -2 },\n\t\tE: { x: 2, y: 0 },\n\t\tS: { x: 0, y: 2 },\n\t\tW: { x: -2, y: 0 }\n\t}\n};\n\n// ------------------------------------------------------------------\n\nexport const SeaBattleKeyboardMoveMappings: {\n\t[direction: string]: { [key: string]: SeaBattleMovementType };\n} = {\n\tN: {\n\t\t[KEY_UP]: \"move-forward\",\n\t\t[KEY_DOWN]: \"move-backward\",\n\t\t[KEY_LEFT]: \"rotate-left\",\n\t\t[KEY_RIGHT]: \"rotate-right\"\n\t},\n\tE: {\n\t\t[KEY_UP]: \"rotate-left\",\n\t\t[KEY_DOWN]: \"rotate-right\",\n\t\t[KEY_LEFT]: \"move-backward\",\n\t\t[KEY_RIGHT]: \"move-forward\"\n\t},\n\tS: {\n\t\t[KEY_UP]: \"move-backward\",\n\t\t[KEY_DOWN]: \"move-forward\",\n\t\t[KEY_LEFT]: \"rotate-right\",\n\t\t[KEY_RIGHT]: \"rotate-left\"\n\t},\n\tW: {\n\t\t[KEY_UP]: \"rotate-right\",\n\t\t[KEY_DOWN]: \"rotate-left\",\n\t\t[KEY_LEFT]: \"move-forward\",\n\t\t[KEY_RIGHT]: \"move-backward\"\n\t}\n};\n\n// ------------------------------------------------------------------\n\nexport const SeaBattleBoatTranslationMappings: {\n\t[direction: string]: { [rotation: string]: SeaBattlePosition };\n} = {\n\tN: {\n\t\t\"move-forward\": { x: 0, y: -1 },\n\t\t\"move-backward\": { x: 0, y: 1 }\n\t},\n\tE: {\n\t\t\"move-forward\": { x: 1, y: 0 },\n\t\t\"move-backward\": { x: -1, y: 0 }\n\t},\n\tS: {\n\t\t\"move-forward\": { x: 0, y: 1 },\n\t\t\"move-backward\": { x: 0, y: -1 }\n\t},\n\tW: {\n\t\t\"move-forward\": { x: -1, y: 0 },\n\t\t\"move-backward\": { x: 1, y: 0 }\n\t}\n};\n\n// ------------------------------------------------------------------\n\nexport const SeaBattleBoatLengthMappings = {\n\tboat1: 1,\n\tboat2: 2,\n\tboat3: 3\n};\n\n// ------------------------------------------------------------------\n\nexport const SeaBattleMovementIconMappings = {\n\tN: {\n\t\tforward: \"arrow-up\",\n\t\tbackward: \"arrow-down\"\n\t},\n\tE: {\n\t\tforward: \"arrow-right\",\n\t\tbackward: \"arrow-left\"\n\t},\n\tS: {\n\t\tforward: \"arrow-down\",\n\t\tbackward: \"arrow-up\"\n\t},\n\tW: {\n\t\tforward: \"arrow-left\",\n\t\tbackward: \"arrow-right\"\n\t}\n};\n","import {\n\tSeaBattleBoatData,\n\tSeaBattleBoatType,\n\tSeaBattleData,\n\tSeaBattleDirections,\n\tSeaBattleMapData,\n\tSeaBattleWeaponsSet,\n\tGRID_CELL_COUNT,\n\tDirectionToAngle,\n\tSeaBattlePosition,\n\tSeaBattleDirection\n} from \".\";\nimport { SeaBattleBoatLengthMappings } from \"./mappings\";\n\n// ------------------------------------------------------------------\n\nconst FleetDefaultSet = {\n\t// Keys are boat types\n\tboat1: 4,\n\tboat2: 3,\n\tboat3: 2\n};\n\n// ------------------------------------------------------------------\n\nexport const generateWeaponsSet = (): SeaBattleWeaponsSet => ({\n\t// Keys are weapon types: Following counts are abitrary choices (to validate or adjust ^_^) - TODO\n\tbullet1: 100,\n\tbullet2: 6,\n\tbullet3: 3,\n\tmine: 3\n});\n\n// ------------------------------------------------------------------\n\nexport const generateBattle = (userId: string): SeaBattleData => {\n\tconsole.debug(\"[SeaBattle] Genering battle...\");\n\tconst battle: SeaBattleData = {\n\t\tcurrentMapIndex: 0,\n\t\tmaps: []\n\t};\n\tgenerateFleet(battle, userId);\n\treturn battle;\n};\n\n// ------------------------------------------------------------------\n\nconst getCell = (grid: number[][], x: number, y: number): number => {\n\tif (x < 0 || x >= GRID_CELL_COUNT || y < 0 || y >= GRID_CELL_COUNT) {\n\t\treturn -1;\n\t}\n\treturn grid[y][x];\n};\n\nconst setCell = (grid: number[][], x: number, y: number) => {\n\tgrid[y][x] = 1;\n};\n\nexport const checkAvailable = (\n\tgrid: number[][],\n\tpos: SeaBattlePosition,\n\tdir: SeaBattleDirection,\n\tboatLength: number\n) => {\n\tswitch (dir) {\n\t\tcase \"N\":\n\t\t\tfor (let i = 0; i < boatLength; ++i) {\n\t\t\t\tconst cell = getCell(grid, pos.x, pos.y - i);\n\t\t\t\tif (0 !== cell) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t\tbreak;\n\t\tcase \"E\":\n\t\t\tfor (let i = 0; i < boatLength; ++i) {\n\t\t\t\tconst cell = getCell(grid, pos.x + i, pos.y);\n\t\t\t\tif (0 !== cell) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t\tbreak;\n\t\tcase \"S\":\n\t\t\tfor (let i = 0; i < boatLength; ++i) {\n\t\t\t\tconst cell = getCell(grid, pos.x, pos.y + i);\n\t\t\t\tif (0 !== cell) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t\tbreak;\n\t\tcase \"W\":\n\t\t\tfor (let i = 0; i < boatLength; ++i) {\n\t\t\t\tconst cell = getCell(grid, pos.x - i, pos.y);\n\t\t\t\tif (0 !== cell) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t\tbreak;\n\t}\n\treturn true;\n};\n\nexport const generatePlace = (grid: number[][], boatLength: number) => {\n\twhile (true) {\n\t\tconst pos = {\n\t\t\tx: Math.floor(Math.random() * GRID_CELL_COUNT),\n\t\t\ty: Math.floor(Math.random() * GRID_CELL_COUNT)\n\t\t};\n\t\tconst dir =\n\t\t\tSeaBattleDirections[\n\t\t\t\tMath.floor(Math.random() * SeaBattleDirections.length)\n\t\t\t];\n\t\tif (checkAvailable(grid, pos, dir, boatLength)) {\n\t\t\tswitch (dir) {\n\t\t\t\tcase \"N\":\n\t\t\t\t\tfor (let i = 0; i < boatLength; ++i) {\n\t\t\t\t\t\tsetCell(grid, pos.x, pos.y - i);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"E\":\n\t\t\t\t\tfor (let i = 0; i < boatLength; ++i) {\n\t\t\t\t\t\tsetCell(grid, pos.x + i, pos.y);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"S\":\n\t\t\t\t\tfor (let i = 0; i < boatLength; ++i) {\n\t\t\t\t\t\tsetCell(grid, pos.x, pos.y + i);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"W\":\n\t\t\t\t\tfor (let i = 0; i < boatLength; ++i) {\n\t\t\t\t\t\tsetCell(grid, pos.x - i, pos.y);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\treturn {\n\t\t\t\tangle: DirectionToAngle[dir],\n\t\t\t\tposition: pos\n\t\t\t};\n\t\t}\n\t}\n};\n\nexport const generateFleet = (battle: SeaBattleData, userId: string) => {\n\tconst oldMap = battle.maps.find(other => other.userId === userId);\n\tif (oldMap) {\n\t\treturn; // User already has a map in the battle\n\t}\n\tconsole.debug(\"[SeaBattle] Genering fleet...\", {\n\t\tuserId\n\t});\n\n\tconst grid: number[][] = Array<number>(GRID_CELL_COUNT)\n\t\t.fill(0)\n\t\t.map(_ => Array<number>(GRID_CELL_COUNT).fill(0));\n\n\tconst fleet: SeaBattleBoatData[] = [];\n\tfor (const boatSetting of Object.entries(FleetDefaultSet).reverse()) {\n\t\tconst [rawType, count] = boatSetting;\n\t\tconst type = rawType as SeaBattleBoatType;\n\t\tconst boatLength = SeaBattleBoatLengthMappings[type];\n\t\tfor (let i = 0; i < count; ++i) {\n\t\t\tconst { angle, position } = generatePlace(grid, boatLength);\n\t\t\tconst boat: SeaBattleBoatData = {\n\t\t\t\thits: [],\n\t\t\t\ttype,\n\t\t\t\tangle,\n\t\t\t\tposition,\n\t\t\t\tstatus: \"ok\"\n\t\t\t};\n\t\t\tfleet.push(boat);\n\t\t}\n\t}\n\n\tconst newMap: SeaBattleMapData = {\n\t\tfleet,\n\t\thits: [\n\t\t\t/*\n\t\t\t\t{ position: { x: 0, y: 1 }, type: \"hitted\" },\n\t\t\t\t{ position: { x: 0, y: 2 }, type: \"hitted\" },\n\t\t\t\t{ position: { x: 0, y: 3 }, type: \"missed\" }\n\t\t\t\t*/\n\t\t],\n\t\topponentsWeapons: [\n\t\t\t/*\n\t\t\t\t{position: { x: 0, y: 5 }, opponentId: '', type:'mine'}\n\t\t\t\t*/\n\t\t],\n\t\tstatus: \"ok\",\n\t\tuserId,\n\t\tweapons: generateWeaponsSet()\n\t};\n\tbattle.maps.push(newMap);\n};\n","import { MediaAccess } from \"./medias\";\nimport { generateBattle } from \"./games/seabattle/generator\";\nimport { encodeBattle } from \"./games/seabattle\";\n\n// ------------------------------------------------------------------\n\nexport type PlayMode = \"default\" | \"shuffle\"; // TODO: Implement Shuffle mode\n\nexport type RoomType = \"blind\" | \"dj\" | \"seabattle\";\n\nexport const DEFAULT_PLAY_MODE: PlayMode = \"default\";\n\nexport const DEFAULT_ROOM_TYPE: RoomType = \"seabattle\";\n\nexport const RoomTypes = [\n\t// \"blind\",\n\t\"dj\",\n\t\"seabattle\"\n];\n\nexport type RoomInfo = {\n\textra: string;\n\tname: string;\n\tqueue?: RoomQueue;\n\tqueue_position: number;\n\tplaying: boolean;\n\tplaymode: PlayMode;\n\ttimestamp: number;\n\ttype: RoomType;\n};\n\nexport type RoomAccess = {\n\tdbId: string;\n\troomId: string;\n\tsecret: string;\n};\n\nexport type RoomQueue = {\n\t[index: string]: MediaAccess;\n};\n\n// ------------------------------------------------------------------\n\nexport const createQueueMerging = (\n\taccesses1: MediaAccess[],\n\taccesses2: MediaAccess[]\n): RoomQueue => {\n\tconst queue: RoomQueue = {};\n\t[...accesses1, ...accesses2].forEach(({ id, provider, type }, index) => {\n\t\tqueue[index] = { id, provider, type };\n\t});\n\treturn queue;\n};\n\n// ------------------------------------------------------------------\n\nexport const createQueueRemoving = (\n\taccesses: MediaAccess[],\n\tindex: number,\n\tcount: number\n): RoomQueue => {\n\tif (index < 0 || index >= accesses.length) {\n\t\tthrow new Error(\"Media index is out of range\");\n\t}\n\tconst queue: RoomQueue = {};\n\tconst copy = [...accesses];\n\tcopy.splice(index, count);\n\tcopy.forEach(({ id, provider, type }, index) => {\n\t\tqueue[index] = { id, provider, type };\n\t});\n\treturn queue;\n};\n\n// ------------------------------------------------------------------\n\nexport const generateRoomExtra = (userId: string, type: RoomType): string => {\n\tswitch (type) {\n\t\tcase \"blind\":\n\t\t\treturn \"\";\n\t\tcase \"dj\":\n\t\t\treturn \"\";\n\t\tcase \"seabattle\":\n\t\t\treturn encodeBattle(generateBattle(userId));\n\t}\n};\n","const config = {\n\tdbIDs: (process.env.REACT_APP_DATABASE_IDS || \"\").split(\"|\"),\n\tdbPrefix: process.env.REACT_APP_DATABASE_PREFIX || \"\"\n};\n\nexport const selectRoomDatabaseId = () =>\n\tconfig.dbIDs[Math.floor(Math.random() * config.dbIDs.length)];\n\nexport const selectUserDatabaseId = () => config.dbIDs[0];\n\n// console.debug('[Firebase] Config', config);\n\nexport default config;\n","import * as firebase from \"firebase/app\";\nimport \"firebase/database\";\n//\nimport firebaseConfig from \"../config/firebase\";\nimport { RoomInfo } from \"./rooms\";\nimport { UserInfo } from \"./users\";\n\n// ------------------------------------------------------------------\n\ntype FirebaseCB = (eventType: firebase.database.DataSnapshot) => void;\n\n// ------------------------------------------------------------------\n\nconst APPS: {\n\t[id: string]: {\n\t\tapp: firebase.app.App;\n\t\tdatabase: firebase.database.Database;\n\t\trooms: firebase.database.Reference;\n\t\tusers: firebase.database.Reference;\n\t};\n} = {};\n\nconst createOrGetApp = (dbId: string) => {\n\tlet res = APPS[dbId];\n\tif (!res) {\n\t\tconsole.debug(\"[Firebase] Creating app\", { dbId });\n\t\tconst databaseURL = `https://${firebaseConfig.dbPrefix}${dbId}.firebaseio.com`;\n\t\tconst app = firebase.initializeApp({ databaseURL }, dbId);\n\t\tconst database = firebase.database(app);\n\t\tAPPS[dbId] = res = {\n\t\t\tapp,\n\t\t\tdatabase,\n\t\t\trooms: database.ref(\"rooms\"),\n\t\t\tusers: database.ref(\"users\")\n\t\t};\n\t}\n\treturn res;\n};\n\n// ------------------------------------------------------------------\n\nexport const FirebaseRoom = ({\n\tdbId,\n\troomId,\n\tsecret\n}: {\n\tdbId: string;\n\troomId: string;\n\tsecret?: string;\n}) => {\n\tconst app = createOrGetApp(dbId);\n\tconst _room = app.rooms.child(roomId);\n\tconst _info = _room.child(\"info\");\n\tlet _secret = secret || \"\";\n\n\tconst isLocked = () => !_secret;\n\n\tconst setSecret = (newSecret: string) => {\n\t\tconsole.debug(\"[Firebase] Setting room secret\", {\n\t\t\toldSecret: _secret,\n\t\t\tnewSecret\n\t\t});\n\t\t_secret = newSecret;\n\t};\n\n\tconst wait = async (): Promise<RoomInfo> =>\n\t\tnew Promise((resolve, reject) => {\n\t\t\tconsole.debug(\"[Firebase] Waiting room...\");\n\t\t\t_info.once(\"value\", snapshot => {\n\t\t\t\tconst newValues = snapshot.val();\n\t\t\t\tif (newValues) {\n\t\t\t\t\tresolve(newValues);\n\t\t\t\t} else {\n\t\t\t\t\treject(new Error(\"rooms.errors.invalid\"));\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\tconst subscribe = (cb: FirebaseCB) => {\n\t\tconsole.debug(\"[Firebase] Subscribing room...\");\n\t\treturn _info.on(\"value\", cb);\n\t};\n\n\tconst unsubscribe = (cb: FirebaseCB) => {\n\t\tconsole.debug(\"[Firebase] Unsubscribing room...\");\n\t\t_info.off(\"value\", cb);\n\t};\n\n\t// const subscribeMembers = (cbAdded: FirebaseCB, cbRemoved: FirebaseCB) => {\n\t// \tconsole.debug(\"[Firebase] Subscribing members...\");\n\t// \t_members.on(\"child_added\", cbAdded);\n\t// \t_members.on(\"child_removed\", cbRemoved);\n\t// };\n\n\t// const unsubscribeMembers = (cbAdded: FirebaseCB, cbRemoved: FirebaseCB) => {\n\t// \tconsole.debug(\"[Firebase] Unsubscribing members...\");\n\t// \t_members.off(\"child_added\", cbAdded);\n\t// \t_members.off(\"child_removed\", cbRemoved);\n\t// };\n\n\tconst update = async ({\n\t\textra,\n\t\tname,\n\t\tplaying,\n\t\tplaymode,\n\t\tqueue,\n\t\tqueue_position,\n\t\ttype\n\t}: Pick<\n\t\tRoomInfo,\n\t\t| \"extra\"\n\t\t| \"name\"\n\t\t| \"playing\"\n\t\t| \"playmode\"\n\t\t| \"queue\"\n\t\t| \"queue_position\"\n\t\t| \"type\"\n\t>) => {\n\t\tconsole.debug(\"[Firebase] Updating room...\", {\n\t\t\textra: !!extra,\n\t\t\tname,\n\t\t\tplaying,\n\t\t\tplaymode,\n\t\t\tqueue,\n\t\t\tqueue_position\n\t\t});\n\t\tawait _room.set({\n\t\t\tinfo: {\n\t\t\t\textra,\n\t\t\t\tname,\n\t\t\t\tplaying,\n\t\t\t\tplaymode,\n\t\t\t\tqueue,\n\t\t\t\tqueue_position,\n\t\t\t\ttimestamp: firebase.database.ServerValue.TIMESTAMP,\n\t\t\t\ttype\n\t\t\t},\n\t\t\tsecret: _secret\n\t\t});\n\t};\n\n\treturn {\n\t\tdbId,\n\t\troomId,\n\t\tisLocked,\n\t\tsetSecret,\n\t\twait,\n\t\tsubscribe,\n\t\tunsubscribe,\n\t\tupdate\n\t};\n};\n\n// ------------------------------------------------------------------\n\nexport const FirebaseUser = ({\n\tdbId,\n\tuserId,\n\tsecret\n}: {\n\tdbId: string;\n\tuserId: string;\n\tsecret?: string;\n}) => {\n\tconst app = createOrGetApp(dbId);\n\tconst _user = app.users.child(userId);\n\tconst _info = _user.child(\"info\");\n\t// let _membership: firebase.database.Reference | null = null;\n\tlet _secret = secret || \"\";\n\tlet _values: UserInfo = {\n\t\tname: \"dummy\",\n\t\tonline: false,\n\t\tstatus: \"\",\n\t\ttimestamp: 0\n\t};\n\n\tconst isLocked = () => !_secret;\n\n\tconst setSecret = (newSecret: string) => {\n\t\tconsole.debug(\"[Firebase] Setting user secret...\", {\n\t\t\toldSecret: _secret,\n\t\t\tnewSecret\n\t\t});\n\t\t_secret = newSecret;\n\t};\n\n\tconst wait = async (): Promise<UserInfo> =>\n\t\tnew Promise((resolve, reject) => {\n\t\t\tconsole.debug(\"[Firebase] Waiting user...\");\n\t\t\t_info.once(\"value\", snapshot => {\n\t\t\t\tconst newValues = snapshot.val();\n\t\t\t\tif (newValues) {\n\t\t\t\t\t_values = newValues;\n\t\t\t\t\tresolve(newValues);\n\t\t\t\t} else {\n\t\t\t\t\treject(new Error(\"users.errors.invalid\"));\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\tconst subscribe = (cb: FirebaseCB) => {\n\t\tconsole.debug(\"[Firebase] Subscribing user...\");\n\t\treturn _info.on(\"value\", cb);\n\t};\n\n\tconst unsubscribe = (cb: FirebaseCB) => {\n\t\tconsole.debug(\"[Firebase] Unsubscribing user...\");\n\t\t_info.off(\"value\", cb);\n\t};\n\n\tconst update = async ({ name }: Partial<Pick<UserInfo, \"name\">>) => {\n\t\tconsole.debug(\"[Firebase] Updating user...\", { name });\n\t\tif (name !== void 0) {\n\t\t\t_values.name = name;\n\t\t}\n\t\tawait _user.set({\n\t\t\tinfo: {\n\t\t\t\t..._values,\n\t\t\t\tonline: true,\n\t\t\t\tstatus: \"online\",\n\t\t\t\ttimestamp: firebase.database.ServerValue.TIMESTAMP\n\t\t\t},\n\t\t\tsecret: _secret\n\t\t});\n\t\tinstallDisconnect();\n\t};\n\n\tconst installDisconnect = () => {\n\t\tconsole.debug(\"[Firebase] Installing user disconnect...\");\n\t\t_user.onDisconnect().cancel();\n\t\t_user.onDisconnect().set({\n\t\t\tinfo: {\n\t\t\t\t..._values,\n\t\t\t\tonline: false,\n\t\t\t\tstatus: \"disconnected\",\n\t\t\t\ttimestamp: firebase.database.ServerValue.TIMESTAMP\n\t\t\t},\n\t\t\tsecret: _secret\n\t\t});\n\t};\n\n\t//const enter = async (room: ReturnType<typeof FirebaseRoom>) => {\n\t//\tconst app = createOrGetApp();\n\t//\tif (_membership) {\n\t//\t\tawait _membership.remove();\n\t//\t\t_membership = null;\n\t//\t}\n\t//\tawait update({\n\t//\t});\n\t// \t_membership = app.members.child(room.id).child(id);\n\t// \t_membership.onDisconnect().remove();\n\t// \tawait _membership.set({\n\t// \t\ttimestamp: firebase.database.ServerValue.TIMESTAMP\n\t// \t});\n\t//};\n\n\t//const exit = async () => {\n\t// if (_membership) {\n\t// \tawait _membership.remove();\n\t// \t_membership = null;\n\t// }\n\t//\tawait update({\n\t//\t\t...\n\t//\t});\n\t//};\n\n\treturn {\n\t\tdbId,\n\t\tuserId,\n\t\tisLocked,\n\t\tsetSecret,\n\t\twait,\n\t\tsubscribe,\n\t\tunsubscribe,\n\t\tupdate\n\t};\n};\n","export type MessageType = \"error\" | \"info\" | \"success\";\n\nexport type Message = {\n\tclosable: boolean;\n\textra?: () => React.ReactNode;\n\tid: number;\n\tstamp: number;\n\ttag?: string;\n\ttext?: string;\n\ttimer?: NodeJS.Timeout;\n\ttype: MessageType;\n\tweight: number;\n};\n\nexport const extractErrorMessage = (err: any) =>\n\terr.response && err.response.data && err.response.data.message\n\t\t? err.response.data.message\n\t\t: err.message;\n","import * as jimp from \"jimp\";\n\n// ------------------------------------------------------------------\n\nexport const getImageMainColor = async (url: string) => {\n\tconst image = await jimp.read(url);\n\tconst pixel = await image.resize(1, 1).getPixelColor(0, 0);\n\tconst { r, g, b } = jimp.intToRGBA(pixel);\n\treturn { r, g, b };\n};\n","import { getImageMainColor } from \"./images\";\n\n// ------------------------------------------------------------------\n\nexport type Color = {\n\tr: number;\n\tg: number;\n\tb: number;\n};\n\nexport type CombinedColor = {\n\tbg: Color;\n\tfg: string;\n};\n\nconst CACHE: { [url: string]: CombinedColor } = {};\n\nconst DEFAULT_COLOR = {\n\tbg: { r: 255, g: 255, b: 255 },\n\tfg: \"dark\"\n};\n\n// ------------------------------------------------------------------\n\n// https://stackoverflow.com/questions/3942878/how-to-decide-font-color-in-white-or-black-depending-on-background-color\nexport const pickColor = async (url: string) => {\n\tlet res = DEFAULT_COLOR;\n\tif (url) {\n\t\tres = CACHE[url];\n\t\tif (!res) {\n\t\t\ttry {\n\t\t\t\tconst { r, g, b } = await getImageMainColor(url);\n\t\t\t\tCACHE[url] = res = {\n\t\t\t\t\tbg: { r, g, b },\n\t\t\t\t\tfg:\n\t\t\t\t\t\tr * 0.299 + g * 0.587 + b * 0.114 > 186\n\t\t\t\t\t\t\t? \"dark\"\n\t\t\t\t\t\t\t: \"light\"\n\t\t\t\t};\n\t\t\t} catch (err) {\n\t\t\t\tconsole.error(\"An error prevented colorpicking\", err);\n\t\t\t\tCACHE[url] = res = DEFAULT_COLOR;\n\t\t\t}\n\t\t}\n\t}\n\treturn res;\n};\n","const AUDIO_BUFFER_CACHES: Array<{ buffer: AudioBuffer; url: string }> = [];\nconst AUDIO_BUFFER_CACHES_MAX_SIZE = 10;\nlet AUDIO_CONTEXT: AudioContext | null = null;\n\n// ------------------------------------------------------------------\n\nconst getContext = (): AudioContext => {\n\tif (!AUDIO_CONTEXT) {\n\t\tconsole.debug(\"[Audio] Creating context\");\n\t\tAUDIO_CONTEXT = new (window.AudioContext ||\n\t\t\t(window as any).webkitAudioContext)();\n\t}\n\treturn AUDIO_CONTEXT;\n};\n\n// ------------------------------------------------------------------\n\nexport const createAnalyzerNode = () => getContext().createAnalyser();\n\n// ------------------------------------------------------------------\n\nexport const createGainNode = () => getContext().createGain();\n\n// ------------------------------------------------------------------\n\nexport const createSourceNode = () => getContext().createBufferSource();\n\n// ------------------------------------------------------------------\n\nexport const getCurrentTime = () => getContext().currentTime;\n\n// ------------------------------------------------------------------\n\nexport const getDestinationNode = () => getContext().destination;\n\n// ------------------------------------------------------------------\n\nexport const decodeAudioData = (\n\tencodedBuffer: ArrayBuffer\n): Promise<AudioBuffer> =>\n\tnew Promise((resolve, reject) =>\n\t\tgetContext().decodeAudioData(encodedBuffer, resolve, reject)\n\t);\n\n// ------------------------------------------------------------------\n\nexport const loadAudioBuffer = (url: string): Promise<AudioBuffer> =>\n\tnew Promise((resolve, reject) => {\n\t\tconst req = new XMLHttpRequest();\n\t\treq.open(\"GET\", url, true);\n\t\treq.responseType = \"arraybuffer\";\n\t\treq.addEventListener(\n\t\t\t\"error\",\n\t\t\t() => reject(new Error(\"audio.errors.cannot_load_audio_buffer\")),\n\t\t\tfalse\n\t\t);\n\t\treq.addEventListener(\n\t\t\t\"load\",\n\t\t\tasync () => {\n\t\t\t\ttry {\n\t\t\t\t\tresolve(await decodeAudioData(req.response as ArrayBuffer));\n\t\t\t\t} catch (error) {\n\t\t\t\t\tconsole.debug(\n\t\t\t\t\t\t\"[Audio] An error occurred while decoding data\",\n\t\t\t\t\t\t{ error, url }\n\t\t\t\t\t);\n\t\t\t\t\treject(new Error(\"audio.errors.cannot_decode_audio_data\"));\n\t\t\t\t}\n\t\t\t},\n\t\t\tfalse\n\t\t);\n\t\treq.send();\n\t});\n\n// ------------------------------------------------------------------\n\nexport const getOrLoadAudioBuffer = async (\n\turl: string\n): Promise<AudioBuffer> => {\n\tif (!url) {\n\t\tthrow new Error(\"URL is invalid\");\n\t}\n\tlet buffer: AudioBuffer | null = null;\n\tconst index = AUDIO_BUFFER_CACHES.findIndex(item => item.url === url);\n\tif (index >= 0) {\n\t\t// Found: extract old buffer, it will be repush at the end of cache\n\t\tconsole.debug(\"[Audio] Reusing cached buffer...\", {\n\t\t\turl\n\t\t});\n\t\tbuffer = AUDIO_BUFFER_CACHES.splice(index, 1)[0].buffer;\n\t} else {\n\t\t// Not Found\n\t\tconsole.debug(\"[Audio] Loading buffer...\", { url });\n\t\tbuffer = await loadAudioBuffer(url);\n\t}\n\tAUDIO_BUFFER_CACHES.push({ buffer, url });\n\tAUDIO_BUFFER_CACHES.splice(AUDIO_BUFFER_CACHES_MAX_SIZE);\n\treturn buffer;\n};\n\n// ------------------------------------------------------------------\n\n// Fix Safari and iOS Audio Context\n(() => {\n\tconst fixAudioContext = () => {\n\t\tdocument.removeEventListener(\"click\", fixAudioContext);\n\t\tdocument.removeEventListener(\"touchstart\", fixAudioContext);\n\t\tconsole.debug(\"[Audio] Fixing context...\");\n\t\tconst context = getContext();\n\t\t// Create empty buffer, connect to output, play sound\n\t\tvar buffer = context.createBuffer(1, 1, 22050);\n\t\tvar source = context.createBufferSource();\n\t\tsource.buffer = buffer;\n\t\tsource.connect(context.destination);\n\t\tsource.start(0);\n\t};\n\tdocument.addEventListener(\"click\", fixAudioContext);\n\tdocument.addEventListener(\"touchstart\", fixAudioContext);\n})();\n","import {\n\tcreateAnalyzerNode,\n\tcreateGainNode,\n\tcreateSourceNode,\n\tgetCurrentTime,\n\tgetDestinationNode,\n\tgetOrLoadAudioBuffer\n} from \"./audio\";\nimport { PlayMode } from \"./rooms\";\nimport { TrackAccess } from \"./medias\";\n\n// ------------------------------------------------------------------\n\nexport const generateRandomPosition = () => Math.floor(Math.random() * 1000000);\n\n// ------------------------------------------------------------------\n\nexport type Player = {\n\tisPlaying: () => boolean;\n\tgetPlayingTrackID: () => string;\n\tgetPlayingTrackPosition: () => number;\n\tgetPlayingTrackPercent: () => number;\n\tplay: (\n\t\ttrackPosition: number,\n\t\ttrackId: string,\n\t\ttrackUrl: string,\n\t\toffset: number,\n\t\toptions?: {\n\t\t\tplaymode: PlayMode;\n\t\t}\n\t) => Promise<void>;\n\tstop: () => Promise<void>;\n};\n\n// ------------------------------------------------------------------\n\nconst PlayerImpl = (): Player => {\n\tlet _analyserNode: AnalyserNode | null = null;\n\tlet _gainNode: GainNode | null = null;\n\tlet _node: AudioNode | null = null;\n\tlet _duration = 0;\n\tlet _sourceNode: AudioBufferSourceNode | null = null;\n\tlet _startTime = 0;\n\tlet _trackId = \"\";\n\tlet _trackPosition = -1;\n\n\tconst getOrCreateNode = () => {\n\t\tif (!_node) {\n\t\t\t_node = getDestinationNode();\n\n\t\t\t_gainNode = createGainNode();\n\t\t\t_gainNode.gain.value = 1.0;\n\t\t\t_gainNode.connect(_node);\n\t\t\t_node = _gainNode;\n\n\t\t\t_analyserNode = createAnalyzerNode();\n\t\t\t_analyserNode.fftSize = 128;\n\t\t\t// _analyserNode.minDecibels = -90;\n\t\t\t// _analyserNode.maxDecibels = -10;\n\t\t\t_analyserNode.connect(_node);\n\t\t\t_node = _analyserNode;\n\t\t}\n\t\treturn _node;\n\t};\n\n\tconst isPlaying = () => !!_sourceNode;\n\n\tconst getPlayingTrackID = () => _trackId;\n\n\tconst getPlayingTrackPosition = () => _trackPosition;\n\n\t// Percentage [0, 1]\n\tconst getPlayingTrackPercent = () => {\n\t\tif (_sourceNode) {\n\t\t\treturn (getCurrentTime() - _startTime) / _duration;\n\t\t}\n\t\treturn 0;\n\t};\n\n\tconst play = async (\n\t\ttrackPosition: number,\n\t\ttrackId: string,\n\t\ttrackUrl: string,\n\t\toffset: number,\n\t\toptions?: {\n\t\t\tplaymode: PlayMode;\n\t\t}\n\t) => {\n\t\tawait stop();\n\t\tconst buffer = await getOrLoadAudioBuffer(trackUrl); // TODO: warning if loadBuffer takes long for some reason and user clicks stop before end, next part of this function will continue after stop have been requested\n\t\tconsole.debug(\"[Player] Starting audio...\", {\n\t\t\ttrackPosition,\n\t\t\ttrackId,\n\t\t\ttrackUrl\n\t\t});\n\t\t_duration = buffer.duration;\n\t\t_trackId = trackId;\n\t\t_trackPosition = trackPosition;\n\t\t_sourceNode = createSourceNode();\n\t\t_sourceNode.buffer = buffer;\n\t\t_sourceNode.loop = false;\n\t\t_sourceNode.loopStart = 0;\n\t\t_sourceNode.loopEnd = 0;\n\t\t_sourceNode.onended = () => {\n\t\t\tconsole.debug(\"[Player] Audio terminated...\");\n\t\t\t_duration = 0;\n\t\t\t_sourceNode = null;\n\t\t\t_startTime = 0;\n\t\t\t_trackId = \"\";\n\t\t\tif (options?.playmode === \"shuffle\") {\n\t\t\t\t_trackPosition += generateRandomPosition();\n\t\t\t} else {\n\t\t\t\t_trackPosition++;\n\t\t\t}\n\t\t};\n\t\t_sourceNode.playbackRate.value = 1.0;\n\t\t_sourceNode.connect(getOrCreateNode());\n\t\t_sourceNode.start(0, offset); // A new BufferSource must be created for each start\n\t\t_startTime = getCurrentTime();\n\t};\n\n\tconst stop = (): Promise<void> =>\n\t\tnew Promise(resolve => {\n\t\t\tif (null !== _sourceNode) {\n\t\t\t\tconsole.debug(\"[Player] Stopping play...\");\n\t\t\t\t_sourceNode.onended = () => {\n\t\t\t\t\tconsole.debug(\"[Player] Forced audio termination...\");\n\t\t\t\t\tresolve();\n\t\t\t\t};\n\t\t\t\t_sourceNode.stop();\n\t\t\t\t_duration = 0;\n\t\t\t\t_sourceNode = null;\n\t\t\t\t_startTime = 0;\n\t\t\t\t_trackId = \"\";\n\t\t\t\t_trackPosition = -1;\n\t\t\t} else {\n\t\t\t\tresolve();\n\t\t\t}\n\t\t});\n\n\treturn {\n\t\tgetPlayingTrackID,\n\t\tgetPlayingTrackPercent,\n\t\tgetPlayingTrackPosition,\n\t\tisPlaying,\n\t\tplay,\n\t\tstop\n\t};\n};\n\n// ------------------------------------------------------------------\n\nexport const computePlayerNextPosition = (\n\tplayStarted: boolean,\n\tplaying: boolean,\n\tplayingTrackID: string,\n\tplayingTrackIndex: number,\n\ttracks: TrackAccess[],\n\ttrackIndex: number\n) => {\n\tif (!playStarted || tracks.length === 0) {\n\t\treturn -1;\n\t}\n\tlet nextIndex = -1;\n\tif (playingTrackIndex !== trackIndex) {\n\t\tif (playing) {\n\t\t\t// User has clicked an other track or added/removed a track in queue\n\t\t\tif (playingTrackID !== tracks[trackIndex].id) {\n\t\t\t\tnextIndex = trackIndex;\n\t\t\t}\n\t\t} else {\n\t\t\t// Not playing which means previous track has terminated\n\t\t\tnextIndex = playingTrackIndex >= 0 ? playingTrackIndex : trackIndex;\n\t\t}\n\t} else if (playingTrackID !== tracks[trackIndex].id) {\n\t\t// User has deleted playing track\n\t\tnextIndex = trackIndex;\n\t}\n\treturn nextIndex;\n};\n\n// ------------------------------------------------------------------\n\nexport const QUEUE_PLAYER = PlayerImpl();\n\nexport const PREVIEW_PLAYER = PlayerImpl();\n","import jsonp from \"jsonp\";\n\n// ------------------------------------------------------------------\n\nexport const asyncJsonp = (url: string, qs?: string): Promise<any> =>\n\tnew Promise((resolve, reject) => {\n\t\tjsonp(\n\t\t\tqs\n\t\t\t\t? `${url}?${qs}&output=jsonp&callback=`\n\t\t\t\t: `${url}?output=jsonp&callback=`,\n\t\t\tvoid 0,\n\t\t\t(err, data) => {\n\t\t\t\tif (err) {\n\t\t\t\t\treject(new Error(err.message));\n\t\t\t\t} else {\n\t\t\t\t\tresolve(data);\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t});\n","import { sleep } from \"../\";\nimport { Album, MediaType, Playlist, Track } from \"../medias\";\nimport { SearchOptions } from \"../providers\";\nimport { asyncJsonp } from \"../jsonp\";\n\n// ------------------------------------------------------------------\n\nconst API_BASE = \"https://api.deezer.com\";\nconst WWW_BASE = \"https://www.deezer.com\";\nconst RATE_LIMIT_DELAY = 5000; // ms\n\n// ------------------------------------------------------------------\n\nexport type DeezerApiError = {\n\tcode: number;\n\tmessage: string;\n\ttype: string;\n};\n\nexport type DeezerApiDataCollection<T> = {\n\tdata: T[];\n};\n\nexport type DeezerApiSearchResult<T> = {\n\tdata: T[];\n\ttotal: number;\n};\n\n// ------------------------------------------------------------------\n\nexport type DeezerApiAlbum = {\n\terror?: DeezerApiError;\n\tartist: DeezerApiArtist;\n\tcover_big: string;\n\tcover_small: string;\n\tid: number;\n\ttitle: string;\n\ttracks?: DeezerApiDataCollection<DeezerApiTrack>;\n};\n\nexport type DeezerApiAlbumLight = {\n\tcover_big: string;\n\tcover_small: string;\n\tid: number;\n\ttitle: string;\n};\n\nexport type DeezerApiUser = {\n\tid: number;\n\tname: string;\n};\n\nexport type DeezerApiArtist = {\n\tid: number;\n\tname: string;\n\tpicture_big: string;\n\tpicture_small: string;\n};\n\nexport type DeezerApiPlaylist = {\n\terror?: DeezerApiError;\n\tcreator?: DeezerApiUser;\n\tid: number;\n\tpicture_big: string;\n\tpicture_small: string;\n\tpublic: boolean;\n\ttitle: string;\n\ttracks?: DeezerApiDataCollection<DeezerApiTrack>;\n\tuser?: DeezerApiUser;\n};\n\nexport type DeezerApiTrack = {\n\terror?: DeezerApiError;\n\talbum: DeezerApiAlbumLight;\n\tartist: DeezerApiArtist;\n\tduration: number;\n\tid: number;\n\tpreview: string;\n\treadable: boolean;\n\ttitle: string;\n};\n\n// ------------------------------------------------------------------\n\nconst ConvertAlbum = (album: DeezerApiAlbum): Album => ({\n\tartist: {\n\t\tid: album.artist.id.toString(),\n\t\tname: album.artist.name,\n\t\tlink: `${WWW_BASE}/artist/${album.artist.id}`,\n\t\tpicture_big: album.artist.picture_big,\n\t\tpicture_small: album.artist.picture_small\n\t},\n\tid: album.id.toString(),\n\tlink: `${WWW_BASE}/album/${album.id}`,\n\tpicture_big: album.cover_big,\n\tpicture_small: album.cover_small,\n\tprovider: \"deezer\",\n\ttitle: album.title,\n\ttracks:\n\t\talbum.tracks !== void 0\n\t\t\t? album.tracks.data\n\t\t\t\t\t.filter(track => track.readable && track.preview)\n\t\t\t\t\t.map(track => ConvertTrack(track, album))\n\t\t\t: [],\n\ttype: \"album\"\n});\n\nconst ConvertPlaylist = (\n\tplaylist: DeezerApiPlaylist,\n\tuser: DeezerApiUser\n): Playlist => ({\n\tid: playlist.id.toString(),\n\tlink: `${WWW_BASE}/playlist/${playlist.id}`,\n\tpicture_big: playlist.picture_big,\n\tpicture_small: playlist.picture_small,\n\tprovider: \"deezer\",\n\ttitle: playlist.title,\n\ttracks:\n\t\tplaylist.tracks !== void 0\n\t\t\t? playlist.tracks.data\n\t\t\t\t\t.filter(track => track.readable && track.preview)\n\t\t\t\t\t.map(track => ConvertTrack(track, track.album))\n\t\t\t: [],\n\ttype: \"playlist\",\n\tuser: {\n\t\tid: user.id.toString(),\n\t\tlink: `${WWW_BASE}/profile/${user.id}`,\n\t\tname: user.name\n\t}\n});\n\nconst ConvertTrack = (\n\ttrack: DeezerApiTrack,\n\talbum: DeezerApiAlbumLight\n): Track => ({\n\talbum: {\n\t\tid: album.id.toString(),\n\t\tlink: `${WWW_BASE}/album/${album.id}`,\n\t\ttitle: album.title,\n\t\tpicture_big: album.cover_big,\n\t\tpicture_small: album.cover_small\n\t},\n\tartist: {\n\t\tid: track.artist.id.toString(),\n\t\tname: track.artist.name,\n\t\tlink: `${WWW_BASE}/artist/${track.artist.id}`,\n\t\tpicture_big: track.artist.picture_big,\n\t\tpicture_small: track.artist.picture_small\n\t},\n\tduration: track.duration,\n\tid: track.id.toString(),\n\tlink: `${WWW_BASE}/track/${track.id}`,\n\tpreview: track.preview,\n\tprovider: \"deezer\",\n\ttitle: track.title,\n\ttype: \"track\"\n});\n\n// ------------------------------------------------------------------\n\nexport type DeezerApi = {\n\tsearchAlbums: (query: string, options?: SearchOptions) => Promise<Album[]>;\n\n\tsearchPlaylists: (\n\t\tquery: string,\n\t\toptions?: SearchOptions\n\t) => Promise<Playlist[]>;\n\n\tsearchTracks: (query: string, options?: SearchOptions) => Promise<Track[]>;\n\n\tloadAlbums: (ids: string[]) => Promise<Album[]>;\n\n\tloadPlaylists: (ids: string[]) => Promise<Playlist[]>;\n\n\tloadTracks: (ids: string[]) => Promise<Track[]>;\n};\n\n// ------------------------------------------------------------------\n\nconst DeezerApiImpl = (): DeezerApi => {\n\tconst _call = <T>(path: string, qs?: string): Promise<T> => {\n\t\t// We have to rely on jsonp because the Deezer api is CORS restricted\n\t\tconsole.debug(\"[Deezer] Requesting... \", { path, qs });\n\t\treturn asyncJsonp(`${API_BASE}/${path}`, qs);\n\t};\n\n\tconst _search = <T>(\n\t\ttype: MediaType,\n\t\tquery: string,\n\t\toptions?: SearchOptions\n\t) =>\n\t\t_call<DeezerApiSearchResult<T>>(\n\t\t\t`search/${type}`,\n\t\t\t`q=${encodeURIComponent(query)}${\n\t\t\t\toptions && options.limit ? `&limit=${options.limit}` : \"\"\n\t\t\t}`\n\t\t);\n\n\tconst _load = async <T extends { error?: DeezerApiError }>(\n\t\ttype: MediaType,\n\t\tids: string[]\n\t): Promise<{\n\t\tdelayedIds: string[];\n\t\tfailedIds: string[];\n\t\tloadedMedias: T[];\n\t}> => {\n\t\tconst delayedIds: string[] = [];\n\t\tconst failedIds: string[] = [];\n\t\tconst loadedMedias: T[] = [];\n\t\tawait Promise.all(\n\t\t\tids.map(async id => {\n\t\t\t\tconst media = await _call<T>(`${type}/${id}`);\n\t\t\t\tif (!media.error) {\n\t\t\t\t\tloadedMedias.push(media);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (media.error.code === 4) {\n\t\t\t\t\tdelayedIds.push(id);\n\t\t\t\t\treturn; // Quota limit exceeded, do not throw so that it will be retried later\n\t\t\t\t}\n\t\t\t\tconsole.error(\n\t\t\t\t\t`[Deezer] An error occured while loading ${type}:`,\n\t\t\t\t\tmedia.error\n\t\t\t\t);\n\t\t\t\tfailedIds.push(id);\n\t\t\t})\n\t\t);\n\t\treturn { delayedIds, failedIds, loadedMedias };\n\t};\n\n\tconst _loadWithRetry = async <T extends { error?: DeezerApiError }>(\n\t\ttype: MediaType,\n\t\tids: string[]\n\t): Promise<T[]> => {\n\t\tlet first = true;\n\t\tconst res: T[] = [];\n\t\tlet remainingIds = [...ids];\n\t\twhile (remainingIds.length > 0) {\n\t\t\tif (!first) {\n\t\t\t\tconsole.debug(`[Deezer] Handling rate limit delayed batch...`, {\n\t\t\t\t\tremainingIds\n\t\t\t\t});\n\t\t\t\tawait sleep(RATE_LIMIT_DELAY);\n\t\t\t}\n\t\t\tconst { delayedIds, loadedMedias } = await _load<T>(\n\t\t\t\ttype,\n\t\t\t\tremainingIds\n\t\t\t);\n\t\t\tres.push(...loadedMedias);\n\t\t\tremainingIds = delayedIds;\n\t\t\tfirst = false;\n\t\t}\n\t\treturn res;\n\t};\n\n\tconst searchAlbums = async (\n\t\tquery: string,\n\t\toptions?: SearchOptions\n\t): Promise<Album[]> => {\n\t\tif (query.trim().length === 0) {\n\t\t\treturn [];\n\t\t}\n\t\treturn (\n\t\t\tawait _search<DeezerApiAlbum>(\"album\", query, options)\n\t\t).data.map(ConvertAlbum);\n\t};\n\n\tconst searchPlaylists = async (\n\t\tquery: string,\n\t\toptions?: SearchOptions\n\t): Promise<Playlist[]> => {\n\t\tif (query.trim().length === 0) {\n\t\t\treturn [];\n\t\t}\n\t\treturn (\n\t\t\tawait _search<DeezerApiPlaylist>(\"playlist\", query, options)\n\t\t).data\n\t\t\t.filter(playlist => playlist.public)\n\t\t\t.map(playlist => ConvertPlaylist(playlist, playlist.user!));\n\t};\n\n\tconst searchTracks = async (\n\t\tquery: string,\n\t\toptions?: SearchOptions\n\t): Promise<Track[]> => {\n\t\tif (query.trim().length === 0) {\n\t\t\treturn [];\n\t\t}\n\t\treturn (await _search<DeezerApiTrack>(\"track\", query, options)).data\n\t\t\t.filter(track => track.readable && track.preview)\n\t\t\t.map(track => ConvertTrack(track, track.album));\n\t};\n\n\tconst loadAlbums = async (ids: string[]): Promise<Album[]> => {\n\t\tif (ids.length === 0) {\n\t\t\treturn [];\n\t\t}\n\t\tconsole.debug(\"[Deezer] Loading albums...\", { ids });\n\t\tconst albums = await _loadWithRetry<DeezerApiAlbum>(\"album\", ids);\n\t\treturn albums.map(ConvertAlbum);\n\t};\n\n\tconst loadPlaylists = async (ids: string[]): Promise<Playlist[]> => {\n\t\tif (ids.length === 0) {\n\t\t\treturn [];\n\t\t}\n\t\tconsole.debug(\"[Deezer] Loading playlists...\", { ids });\n\t\tconst playlists = await _loadWithRetry<DeezerApiPlaylist>(\n\t\t\t\"playlist\",\n\t\t\tids\n\t\t);\n\t\treturn playlists.map(playlist =>\n\t\t\tConvertPlaylist(playlist, playlist.creator!)\n\t\t);\n\t};\n\n\tconst loadTracks = async (ids: string[]): Promise<Track[]> => {\n\t\tif (ids.length === 0) {\n\t\t\treturn [];\n\t\t}\n\t\tconsole.debug(\"[Deezer] Loading tracks...\", { ids });\n\t\tconst tracks = await _loadWithRetry<DeezerApiTrack>(\"track\", ids);\n\t\treturn tracks.map(track => ConvertTrack(track, track.album));\n\t};\n\n\treturn {\n\t\tsearchAlbums,\n\t\tsearchPlaylists,\n\t\tsearchTracks,\n\t\tloadAlbums,\n\t\tloadPlaylists,\n\t\tloadTracks\n\t};\n};\n\n// ------------------------------------------------------------------\n\nexport const DEFAULT_API = DeezerApiImpl();\n","import {\n\tMedia,\n\tMediaAccess,\n\tStructuredMedias,\n\tAlbum,\n\tPlaylist,\n\tTrack,\n\tMediaType\n} from \"../medias\";\nimport { DEFAULT_API } from \"./deezer\";\n\n// ------------------------------------------------------------------\n\nexport type SearchOptions = {\n\tlimit?: number;\n};\n\nexport type SearchResults = {\n\t// keys are ProviderType\n\tdeezer: {\n\t\t// keys are MediaType\n\t\talbum: Album[];\n\t\tplaylist: Playlist[];\n\t\ttrack: Track[];\n\t};\n};\n\n// ------------------------------------------------------------------\n\nexport const loadMedias = async (accesses: MediaAccess[]): Promise<Media[]> => {\n\tconst ids: {\n\t\tdeezer: { album: string[]; playlist: string[]; track: string[] };\n\t} = {\n\t\t// keys are ProviderType\n\t\tdeezer: {\n\t\t\t// keys are MediaType\n\t\t\talbum: [],\n\t\t\tplaylist: [],\n\t\t\ttrack: []\n\t\t}\n\t};\n\tfor (const access of accesses) {\n\t\tids[access.provider][access.type].push(access.id);\n\t}\n\tconst medias = {\n\t\t// keys are ProviderType\n\t\tdeezer: {\n\t\t\t// keys are MediaType\n\t\t\talbum: await DEFAULT_API.loadAlbums(ids.deezer.album),\n\t\t\tplaylist: await DEFAULT_API.loadPlaylists(ids.deezer.playlist),\n\t\t\ttrack: await DEFAULT_API.loadTracks(ids.deezer.track)\n\t\t}\n\t};\n\tconst flatten: Media[] = [];\n\tfor (const access of accesses) {\n\t\tconst media = (medias[access.provider][access.type] as Media[]).find(\n\t\t\tother => other.id === access.id\n\t\t);\n\t\tif (media) {\n\t\t\tflatten.push(media);\n\t\t}\n\t}\n\treturn flatten;\n};\n\n// ------------------------------------------------------------------\n\nexport const loadNewMedias = async (\n\taccesses: MediaAccess[],\n\toldMedias: StructuredMedias\n): Promise<{\n\tnewMedias: Media[];\n\tnewMediasAndTracks: Media[];\n}> => {\n\tconst newAccesses: MediaAccess[] = accesses\n\t\t// Only not already loaded\n\t\t.filter(access => !oldMedias[access.provider][access.type][access.id])\n\t\t// Only unique\n\t\t.filter(\n\t\t\t(value, index, self) =>\n\t\t\t\tindex ===\n\t\t\t\tself.findIndex(\n\t\t\t\t\tother =>\n\t\t\t\t\t\tother.id === value.id &&\n\t\t\t\t\t\tother.provider === value.provider &&\n\t\t\t\t\t\tother.type === value.type\n\t\t\t\t)\n\t\t);\n\tconst newMedias = await loadMedias(newAccesses);\n\tconst newMediasAndTracks: Media[] = [];\n\tfor (const media of newMedias) {\n\t\tnewMediasAndTracks.push(media);\n\t\tif (media.type !== \"track\") {\n\t\t\tnewMediasAndTracks.push(...media.tracks);\n\t\t}\n\t}\n\treturn { newMedias, newMediasAndTracks };\n};\n// ------------------------------------------------------------------\n\nexport const searchMedias = async (\n\tquery: string,\n\toptions?: SearchOptions,\n\ttype?: MediaType\n): Promise<SearchResults> => {\n\tif (!type) {\n\t\tconst [album, playlist, track] = await Promise.all([\n\t\t\tDEFAULT_API.searchAlbums(query, options),\n\t\t\tDEFAULT_API.searchPlaylists(query, options),\n\t\t\tDEFAULT_API.searchTracks(query, options)\n\t\t]);\n\t\treturn {\n\t\t\t// keys are ProviderType\n\t\t\tdeezer: {\n\t\t\t\t// keys are MediaType\n\t\t\t\talbum: album,\n\t\t\t\tplaylist: playlist,\n\t\t\t\ttrack: track\n\t\t\t}\n\t\t};\n\t}\n\tconst results: SearchResults = {\n\t\tdeezer: {\n\t\t\talbum: [],\n\t\t\tplaylist: [],\n\t\t\ttrack: []\n\t\t}\n\t};\n\tswitch (type) {\n\t\tcase \"album\":\n\t\t\tresults.deezer.album = await DEFAULT_API.searchAlbums(\n\t\t\t\tquery,\n\t\t\t\toptions\n\t\t\t);\n\t\t\tbreak;\n\t\tcase \"playlist\":\n\t\t\tresults.deezer.playlist = await DEFAULT_API.searchPlaylists(\n\t\t\t\tquery,\n\t\t\t\toptions\n\t\t\t);\n\t\t\tbreak;\n\t\tcase \"track\":\n\t\t\tresults.deezer.track = await DEFAULT_API.searchTracks(\n\t\t\t\tquery,\n\t\t\t\toptions\n\t\t\t);\n\t\t\tbreak;\n\t}\n\treturn results;\n};\n","import { Reducer } from \"redux\";\nimport { AxiosError } from \"axios\";\nimport { StructuredMedias, Media } from \"../utils/medias\";\nimport { createAction } from \"../actions\";\n\n// ------------------------------------------------------------------\n\ntype MediasAction =\n\t| ReturnType<typeof fetching>\n\t| ReturnType<typeof error>\n\t| ReturnType<typeof resetMedias>\n\t| ReturnType<typeof setMedias>;\n\nexport const fetching = () => createAction(\"medias/FETCHING\");\nexport const error = (error: AxiosError) => createAction(\"medias/ERROR\", error);\nexport const resetMedias = () => createAction(\"medias/RESET\");\nexport const setMedias = (medias: Media[]) =>\n\tcreateAction(\"medias/SET\", medias);\n\n// ------------------------------------------------------------------\n\nexport type State = {\n\terror: null | AxiosError;\n\tfetching: boolean;\n\tmedias: StructuredMedias;\n};\n\nconst INITIAL_STATE: State = {\n\terror: null,\n\tfetching: false,\n\tmedias: {\n\t\t// keys are ProvideType\n\t\tdeezer: {\n\t\t\t// keys are MediaType\n\t\t\talbum: {},\n\t\t\tplaylist: {},\n\t\t\ttrack: {}\n\t\t}\n\t}\n};\n\n// ------------------------------------------------------------------\n\nexport const mediasReducer: Reducer<State, MediasAction> = (\n\tstate = INITIAL_STATE,\n\taction: MediasAction\n): State => {\n\tswitch (action.type) {\n\t\tcase \"medias/FETCHING\":\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tfetching: true,\n\t\t\t\terror: null\n\t\t\t};\n\t\tcase \"medias/ERROR\":\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tfetching: false,\n\t\t\t\terror: action.payload\n\t\t\t};\n\t\tcase \"medias/SET\": {\n\t\t\tconst copy = {\n\t\t\t\t...state,\n\t\t\t\tfetching: false,\n\t\t\t\terror: null,\n\t\t\t\tmedias: {\n\t\t\t\t\t// keys are ProvideType\n\t\t\t\t\tdeezer: {\n\t\t\t\t\t\t// keys are MediaType\n\t\t\t\t\t\talbum: { ...state.medias.deezer.album },\n\t\t\t\t\t\tplaylist: { ...state.medias.deezer.playlist },\n\t\t\t\t\t\ttrack: { ...state.medias.deezer.track }\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t\tfor (const media of action.payload) {\n\t\t\t\tcopy.medias[media.provider][media.type][media.id] = media;\n\t\t\t}\n\t\t\treturn copy;\n\t\t}\n\t\tcase \"medias/RESET\":\n\t\t\treturn INITIAL_STATE;\n\t\tdefault:\n\t\t\treturn state;\n\t}\n};\n","import { Reducer } from \"redux\";\nimport { AxiosError } from \"axios\";\nimport { RoomAccess, RoomInfo } from \"../utils/rooms\";\nimport { CombinedColor } from \"../utils/colorpicker\";\nimport { FirebaseRoom } from \"../utils/firebase\";\nimport { ContextualizedTrackAccess, MediaAccess } from \"../utils/medias\";\nimport { createAction } from \"../actions\";\n\n// ------------------------------------------------------------------\n\ntype RoomAction =\n\t| ReturnType<typeof fetching>\n\t| ReturnType<typeof error>\n\t| ReturnType<typeof resetRoom>\n\t| ReturnType<typeof setRoom>;\n\nexport const fetching = () => createAction(\"room/FETCHING\");\nexport const error = (error: AxiosError) => createAction(\"room/ERROR\", error);\nexport const resetRoom = () => createAction(\"room/RESET\");\nexport const setRoom = (values: Partial<RoomData>) =>\n\tcreateAction(\"room/SET\", values);\n\n// ------------------------------------------------------------------\n\nexport type RoomData = {\n\taccess: RoomAccess;\n\tcolor: CombinedColor;\n\tinfo: RoomInfo | null;\n\tmedias: MediaAccess[];\n\troom: ReturnType<typeof FirebaseRoom> | null;\n\ttracks: Array<ContextualizedTrackAccess>; // TODO expanded medias (containers are replaced by their tracks)\n};\n\nexport type State = RoomData & {\n\tfetching: boolean;\n\terror: null | AxiosError;\n};\n\nconst INITIAL_STATE: State = {\n\taccess: { dbId: \"\", roomId: \"\", secret: \"\" },\n\tcolor: { fg: \"dark\", bg: { r: 255, g: 255, b: 255 } },\n\terror: null,\n\tfetching: false,\n\tinfo: null,\n\tmedias: [],\n\troom: null,\n\ttracks: []\n};\n\n// ------------------------------------------------------------------\n\nexport const roomReducer: Reducer<State, RoomAction> = (\n\tstate = INITIAL_STATE,\n\taction: RoomAction\n): State => {\n\tswitch (action.type) {\n\t\tcase \"room/FETCHING\":\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tfetching: true,\n\t\t\t\terror: null\n\t\t\t};\n\t\tcase \"room/ERROR\":\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tfetching: false,\n\t\t\t\terror: action.payload\n\t\t\t};\n\t\tcase \"room/SET\":\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\t...action.payload,\n\t\t\t\tfetching: false,\n\t\t\t\terror: null\n\t\t\t};\n\t\tcase \"room/RESET\":\n\t\t\treturn INITIAL_STATE;\n\t\tdefault:\n\t\t\treturn state;\n\t}\n};\n","export type ContainerType = \"album\" | \"playlist\";\n\nexport type MediaType = ContainerType | \"track\";\n\nexport const MediaTypes: MediaType[] = [\"album\", \"playlist\", \"track\"];\n\nexport type MediaTypeDefinition = {\n\tlabel: string;\n\tprovider: ProviderType;\n\ttype: MediaType;\n};\n\nexport type ProviderType = \"deezer\";\n\nexport const ProviderTypes: ProviderType[] = [\"deezer\"];\n\nexport type TrackType = \"track\";\n\n// ------------------------------------------------------------------\n\nexport type AlbumAccess = {\n\tid: string;\n\tprovider: ProviderType;\n\ttype: \"album\";\n};\n\nexport type PlaylistAccess = {\n\tid: string;\n\tprovider: ProviderType;\n\ttype: \"playlist\";\n};\n\nexport type TrackAccess = {\n\tid: string;\n\tprovider: ProviderType;\n\ttype: \"track\";\n};\n\nexport type ContainerAccess = AlbumAccess | PlaylistAccess;\n\nexport type MediaAccess = ContainerAccess | TrackAccess;\n\nexport type ContextualizedTrackAccess = {\n\tcontextId: string;\n\tcontextType: MediaType;\n} & TrackAccess;\n\n// ------------------------------------------------------------------\n\nexport type Album = {\n\tartist: Artist;\n\tid: string;\n\tlink: string;\n\tpicture_big: string;\n\tpicture_small: string;\n\tprovider: ProviderType;\n\ttitle: string;\n\ttracks: Track[];\n\ttype: \"album\";\n};\n\nexport type AlbumLight = {\n\tid: string;\n\tlink: string;\n\tpicture_big: string;\n\tpicture_small: string;\n\ttitle: string;\n};\n\nexport type Artist = {\n\tid: string;\n\tlink: string;\n\tname: string;\n\tpicture_big: string;\n\tpicture_small: string;\n};\n\nexport type Playlist = {\n\tid: string;\n\tlink: string;\n\tpicture_big: string;\n\tpicture_small: string;\n\tprovider: ProviderType;\n\ttitle: string;\n\ttracks: Track[];\n\ttype: \"playlist\";\n\tuser: {\n\t\tid: string;\n\t\tlink: string;\n\t\tname: string;\n\t};\n};\n\nexport type Track = {\n\talbum: AlbumLight;\n\tartist: Artist;\n\tduration: number;\n\tid: string;\n\tlink: string;\n\tpreview: string;\n\tprovider: ProviderType;\n\ttitle: string;\n\ttype: \"track\";\n};\n\nexport type Container = Album | Playlist;\n\nexport type Media = Container | Track;\n\nexport type StructuredMedias = {\n\t// keys are ProvideType\n\tdeezer: {\n\t\t// keys are MediaType\n\t\talbum: { [id: string]: Album };\n\t\tplaylist: { [id: string]: Playlist };\n\t\ttrack: { [id: string]: Track };\n\t};\n};\n\n// ------------------------------------------------------------------\n\nexport const MEDIA_TYPE_DEFINITIONS: MediaTypeDefinition[] = [\n\t{\n\t\tlabel: \"medias.albums\",\n\t\tprovider: \"deezer\",\n\t\ttype: \"album\"\n\t},\n\t{\n\t\tlabel: \"medias.playlists\",\n\t\tprovider: \"deezer\",\n\t\ttype: \"playlist\"\n\t},\n\t{\n\t\tlabel: \"medias.tracks\",\n\t\tprovider: \"deezer\",\n\t\ttype: \"track\"\n\t}\n];\n\n// ------------------------------------------------------------------\n\nconst findMediaInDict = (\n\taccess: MediaAccess,\n\tmedias: StructuredMedias\n): Media | undefined => medias[access.provider][access.type][access.id];\n\n// ------------------------------------------------------------------\n\nconst findMediaInList = (\n\taccess: MediaAccess,\n\tmedias: Media[]\n): Media | undefined =>\n\tmedias.find(\n\t\titem =>\n\t\t\titem.id === access.id &&\n\t\t\titem.provider === access.provider &&\n\t\t\titem.type === access.type\n\t);\n\n// ------------------------------------------------------------------\n\nexport const findMedia = (\n\taccess: MediaAccess,\n\tdist: StructuredMedias,\n\tlist: Media[]\n): Media | undefined =>\n\tfindMediaInDict(access, dist) || findMediaInList(access, list);\n\n// ------------------------------------------------------------------\n\nexport const findPreview = (\n\taccess: MediaAccess,\n\toldMedias: StructuredMedias,\n\tnewMedias: Media[]\n): Track | null => {\n\tconst media = findMedia(access, oldMedias, newMedias);\n\tif (!media) {\n\t\treturn null;\n\t}\n\tif (media.type === \"track\") {\n\t\treturn media;\n\t}\n\tif (media.tracks && media.tracks.length > 0) {\n\t\treturn media.tracks[0];\n\t}\n\treturn null;\n};\n\n// ------------------------------------------------------------------\n\nexport const extractTracks = (\n\taccesses: MediaAccess[],\n\toldMedias: StructuredMedias,\n\tnewMedias: Media[]\n): ContextualizedTrackAccess[] => {\n\tconst tracks: ContextualizedTrackAccess[] = [];\n\tfor (const access of accesses) {\n\t\tif (access.type === \"track\") {\n\t\t\ttracks.push({\n\t\t\t\tcontextId: access.id,\n\t\t\t\tcontextType: access.type,\n\t\t\t\tid: access.id,\n\t\t\t\tprovider: access.provider,\n\t\t\t\ttype: access.type\n\t\t\t});\n\t\t\tcontinue;\n\t\t}\n\n\t\tconst container = findMedia(access, oldMedias, newMedias);\n\t\tif (!container) {\n\t\t\tthrow new Error(\"Media is unknown\");\n\t\t}\n\n\t\tif (\n\t\t\tcontainer.type !== \"track\" &&\n\t\t\tcontainer.tracks &&\n\t\t\tcontainer.tracks.length > 0\n\t\t) {\n\t\t\tfor (const track of container.tracks) {\n\t\t\t\ttracks.push({\n\t\t\t\t\tcontextId: container.id,\n\t\t\t\t\tcontextType: container.type,\n\t\t\t\t\tid: track.id,\n\t\t\t\t\tprovider: track.provider,\n\t\t\t\t\ttype: track.type\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\treturn tracks;\n};\n\n// ------------------------------------------------------------------\n\nexport const findContextFromTrackIndex = (\n\tmedias: MediaAccess[],\n\ttrackIndex: number,\n\tallMedias: StructuredMedias\n): {\n\tmediaFirstTrackIndex: number;\n\tmediaIndex: number;\n\tmediaSize: number;\n} => {\n\tif (trackIndex < 0) {\n\t\tthrow new Error(\"Track index is out of range\");\n\t}\n\tlet index = 0;\n\tfor (let mediaIndex = 0; mediaIndex < medias.length; ++mediaIndex) {\n\t\tconst media = medias[mediaIndex];\n\t\tif (media.type === \"track\") {\n\t\t\tif (trackIndex === index) {\n\t\t\t\treturn {\n\t\t\t\t\tmediaFirstTrackIndex: trackIndex,\n\t\t\t\t\tmediaIndex,\n\t\t\t\t\tmediaSize: 1\n\t\t\t\t};\n\t\t\t}\n\t\t\tindex++;\n\t\t} else {\n\t\t\tconst container = findMediaInDict(media, allMedias);\n\t\t\tif (!container) {\n\t\t\t\tthrow new Error(\"Media is unknown\");\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\tcontainer.type !== \"track\" &&\n\t\t\t\tcontainer.tracks &&\n\t\t\t\tcontainer.tracks.length > 0\n\t\t\t) {\n\t\t\t\tconst mediaFirstTrackIndex = index;\n\t\t\t\tfor (let i = 0; i < container.tracks.length; ++i) {\n\t\t\t\t\tif (trackIndex === index) {\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tmediaFirstTrackIndex,\n\t\t\t\t\t\t\tmediaIndex,\n\t\t\t\t\t\t\tmediaSize: container.tracks.length\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t\tindex++;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tthrow new Error(\"Track index is out of range\");\n};\n","import { AsyncAction } from \".\";\nimport { MediaAccess, findPreview, Media } from \"../utils/medias\";\nimport { PREVIEW_PLAYER } from \"../utils/player\";\nimport { loadNewMedias } from \"../utils/providers\";\nimport { displayError, displayMessage } from \"./messages\";\nimport { extractErrorMessage } from \"../utils/messages\";\nimport { renderMediaInToaster } from \"../components/Room/Medias\";\n\n// ------------------------------------------------------------------\n\nexport const displayMediaInfo = (media: Media): AsyncAction => async dispatch =>\n\tdispatch(\n\t\tdisplayMessage(\"info\", {\n\t\t\tduration: 5000,\n\t\t\textra: () => renderMediaInToaster(media)\n\t\t})\n\t);\n\n// ------------------------------------------------------------------\n\nexport const previewMedia = (access: MediaAccess): AsyncAction => async (\n\tdispatch,\n\tgetState\n) => {\n\ttry {\n\t\tconst {\n\t\t\tmedias: { medias: oldMedias }\n\t\t} = getState();\n\t\tconst { newMedias } = await loadNewMedias([access], oldMedias);\n\t\tconst track = findPreview(access, oldMedias, newMedias);\n\t\tif (!track) {\n\t\t\tthrow new Error(\"[Medias] Cannot find track to preview...\");\n\t\t}\n\t\tconsole.debug(\"[Medias] Previewing track...\", { track });\n\t\tawait PREVIEW_PLAYER.play(0, track.id, track.preview, 0);\n\t} catch (err) {\n\t\tdispatch(displayError(extractErrorMessage(err)));\n\t}\n};\n","import { createHashHistory } from \"history\";\n\nexport default createHashHistory();\n","import { Reducer } from \"redux\";\nimport { createAction } from \"../actions\";\nimport { ConnectUserModalProps } from \"../components/Users/ConnectUserModal\";\nimport { CreateUserModalProps } from \"../components/Users/CreateUserModal\";\nimport { ConfirmModalProps } from \"../components/Modals/ConfirmModal\";\nimport { UnlockRoomModalProps } from \"../components/Room/UnlockRoomModal\";\n\n// ------------------------------------------------------------------\n\nexport type ModalPrereqT<T extends string, P> = {\n\ttype: T;\n\tprops: P;\n};\n\nexport type ModalPrereq =\n\t| ModalPrereqT<\"Confirm\", ConfirmModalProps>\n\t| ModalPrereqT<\"ConnectUser\", ConnectUserModalProps>\n\t| ModalPrereqT<\"CreateRoom\", null>\n\t| ModalPrereqT<\"CreateUser\", CreateUserModalProps>\n\t| ModalPrereqT<\"Help\", null>\n\t| ModalPrereqT<\"JoinRoom\", null>\n\t| ModalPrereqT<\"Search\", null>\n\t| ModalPrereqT<\"UnlockRoom\", UnlockRoomModalProps>;\n\n// ------------------------------------------------------------------\n\ntype ModalsAction =\n\t| ReturnType<typeof closeModal>\n\t| ReturnType<typeof openModal>\n\t| ReturnType<typeof popModal>\n\t| ReturnType<typeof pushModal>;\n\n// ------------------------------------------------------------------\n\nexport const openModal = (prereq: ModalPrereq) =>\n\tcreateAction(\"modals/OPEN\", prereq);\n\nexport const closeModal = () => createAction(\"modals/CLOSE\");\n\n// ------------------------------------------------------------------\n\nexport const pushModal = (prereq: ModalPrereq) =>\n\tcreateAction(\"modals/PUSH\", prereq);\n\nexport const popModal = () => createAction(\"modals/POP\");\n\n// ------------------------------------------------------------------\n\nexport type ModalsState = {\n\tstack: ModalPrereq[];\n};\n\n// ------------------------------------------------------------------\n\nexport const initialState: ModalsState = {\n\tstack: []\n};\n\n// ------------------------------------------------------------------\n\nexport const modalsReducer: Reducer<ModalsState, ModalsAction> = (\n\tstate = initialState,\n\taction\n): ModalsState => {\n\tswitch (action.type) {\n\t\tcase \"modals/OPEN\":\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tstack: [action.payload]\n\t\t\t};\n\t\tcase \"modals/CLOSE\":\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tstack: []\n\t\t\t};\n\t\tcase \"modals/PUSH\":\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tstack: [...state.stack, action.payload]\n\t\t\t};\n\t\tcase \"modals/POP\":\n\t\t\tconst copy = [...state.stack];\n\t\t\tcopy.pop();\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tstack: copy\n\t\t\t};\n\t\tdefault:\n\t\t\treturn state;\n\t}\n};\n","import { v4 } from \"uuid\";\n//\nimport { AsyncAction, Dispatch, ActionOptions } from \".\";\nimport { displayError } from \"./messages\";\nimport { RoomInfo, RoomType, generateRoomExtra } from \"../utils/rooms\";\nimport { FirebaseRoom } from \"../utils/firebase\";\nimport { extractErrorMessage } from \"../utils/messages\";\nimport { pickColor } from \"../utils/colorpicker\";\nimport { Player } from \"../utils/player\";\nimport { computePlayerNextPosition } from \"../utils/player\";\nimport { loadNewMedias } from \"../utils/providers\";\nimport { RootState } from \"../reducers\";\nimport { setMedias } from \"../reducers/medias\";\nimport { setRoom, resetRoom } from \"../reducers/room\";\nimport { displayMediaInfo } from \"./medias\";\nimport history from \"../utils/history\";\nimport {\n\tMediaAccess,\n\textractTracks,\n\tContextualizedTrackAccess\n} from \"../utils/medias\";\nimport { openModal } from \"../reducers/modals\";\n\n// ------------------------------------------------------------------\n\nconst DEFAULT_QUEUE_INFO_BY_TYPE: {\n\t// Keys are room types\n\t[type: string]: Pick<RoomInfo, \"playing\" | \"playmode\" | \"queue\">;\n} = {\n\tdj: {\n\t\tplaying: false,\n\t\tplaymode: \"default\",\n\t\tqueue: {}\n\t},\n\tseabattle: {\n\t\tplaying: true,\n\t\tplaymode: \"shuffle\",\n\t\tqueue: {\n\t\t\t0: {\n\t\t\t\tid: \"301013\", // Pirates Of The Caribbean OST\n\t\t\t\tprovider: \"deezer\",\n\t\t\t\ttype: \"album\"\n\t\t\t},\n\t\t\t1: {\n\t\t\t\tid: \"7358507\", // Stalingrad OST\n\t\t\t\tprovider: \"deezer\",\n\t\t\t\ttype: \"album\"\n\t\t\t},\n\t\t\t2: {\n\t\t\t\tid: \"558976\", // Master & Commander OST\n\t\t\t\tprovider: \"deezer\",\n\t\t\t\ttype: \"album\"\n\t\t\t},\n\t\t\t3: {\n\t\t\t\tid: \"87375582\", // Le chant du loup OST\n\t\t\t\tprovider: \"deezer\",\n\t\t\t\ttype: \"album\"\n\t\t\t}\n\t\t}\n\t}\n};\n\n// ------------------------------------------------------------------\n\nexport const createRoom = (\n\tdbId: string,\n\tname: string,\n\tsecret: string,\n\ttype: RoomType,\n\toptions?: ActionOptions\n): AsyncAction => async (dispatch, getState) => {\n\tconst {\n\t\tuser: {\n\t\t\taccess: { userId }\n\t\t}\n\t} = getState();\n\tif (!userId) {\n\t\tconsole.debug(\"[Room] Not connected\");\n\t\tdispatch(displayError(\"users.not_connected\"));\n\t\tdispatch(\n\t\t\topenModal({\n\t\t\t\ttype: \"CreateUser\",\n\t\t\t\tprops: {\n\t\t\t\t\toptions: {\n\t\t\t\t\t\tonSuccess: () => {\n\t\t\t\t\t\t\tdispatch(\n\t\t\t\t\t\t\t\tcreateRoom(dbId, name, secret, type, options)\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t);\n\t\treturn;\n\t}\n\ttry {\n\t\tconst roomId = v4();\n\t\tconsole.debug(\"[Room] Creating...\", { dbId, roomId, secret });\n\n\t\tawait FirebaseRoom({ dbId, roomId, secret }).update({\n\t\t\textra: generateRoomExtra(userId, type),\n\t\t\tname,\n\t\t\tqueue_position: 0,\n\t\t\ttype,\n\t\t\t...DEFAULT_QUEUE_INFO_BY_TYPE[type]\n\t\t});\n\t\tdispatch(enterRoom(dbId, roomId, secret));\n\t\tif (options && options.onSuccess) {\n\t\t\toptions.onSuccess();\n\t\t}\n\t} catch (err) {\n\t\tdispatch(displayError(extractErrorMessage(err)));\n\t}\n};\n\n// ------------------------------------------------------------------\n\nexport const enterRoom = (\n\tdbId: string,\n\troomId: string,\n\tsecret: string,\n\toptions?: ActionOptions\n): AsyncAction => async (dispatch, getState) => {\n\tconst {\n\t\troom: { room },\n\t\tuser: {\n\t\t\taccess: { userId }\n\t\t}\n\t} = getState();\n\tif (room && room.dbId === dbId && room.roomId === roomId) {\n\t\t// Nothing to do\n\t\treturn;\n\t}\n\tif (!userId) {\n\t\tconsole.debug(\"[Room] Not connected\");\n\t\tdispatch(displayError(\"users.not_connected\"));\n\t\tdispatch(\n\t\t\topenModal({\n\t\t\t\ttype: \"CreateUser\",\n\t\t\t\tprops: {\n\t\t\t\t\toptions: {\n\t\t\t\t\t\tonSuccess: () => {\n\t\t\t\t\t\t\tdispatch(enterRoom(dbId, roomId, secret, options));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t);\n\t\treturn;\n\t}\n\tdispatch(exitRoom());\n\ttry {\n\t\tconsole.debug(\"[Room] Entering...\", { dbId, roomId, secret });\n\t\tconst newRoom = FirebaseRoom({ dbId, roomId, secret });\n\t\tdispatch(\n\t\t\tsetRoom({\n\t\t\t\taccess: { dbId, roomId, secret },\n\t\t\t\troom: newRoom,\n\t\t\t\tinfo: await newRoom.wait()\n\t\t\t})\n\t\t);\n\t\tdispatch(_watchRoom(newRoom));\n\t\tdispatch(_watchPlayer());\n\t\thistory.push(`/room/${dbId}/${roomId}?secret=${secret}`); // TODO: should push only if we're not already in it\n\t\tif (options && options.onSuccess) {\n\t\t\toptions.onSuccess();\n\t\t}\n\t} catch (err) {\n\t\tdispatch(displayError(extractErrorMessage(err)));\n\t}\n};\n\nexport const exitRoom = (): AsyncAction => async (dispatch, getState) => {\n\tconst {\n\t\troom: { room }\n\t} = getState();\n\tif (!room) {\n\t\t// Nothing to do\n\t\treturn;\n\t}\n\tconsole.debug(\"[Room] Exiting...\");\n\tdispatch(_unwatchPlayer());\n\tdispatch(_unwatchRoom(room));\n\tdispatch(resetRoom());\n};\n\n// ------------------------------------------------------------------\n\nexport const lockRoom = (): AsyncAction => async (dispatch, getState) => {\n\tconst {\n\t\troom: {\n\t\t\troom,\n\t\t\taccess: { dbId, roomId, secret: oldSecret }\n\t\t}\n\t} = getState();\n\tif (!room || room.dbId !== dbId || room.roomId !== roomId || !oldSecret) {\n\t\t// Nothing to do\n\t\treturn;\n\t}\n\tconsole.debug(\"[Room] Locking...\", { dbId, roomId });\n\troom.setSecret(\"\");\n\t// TODO : not history.replace(`/room/${dbId}/${roomId}`); as it would trigger a page refresh\n\tdispatch(setRoom({ access: { dbId, roomId, secret: \"\" } }));\n};\n\nexport const unlockRoom = (\n\tsecret: string,\n\toptions?: ActionOptions\n): AsyncAction => async (dispatch, getState) => {\n\tconst {\n\t\troom: {\n\t\t\troom,\n\t\t\taccess: { dbId, roomId, secret: oldSecret }\n\t\t}\n\t} = getState();\n\tif (\n\t\t!room ||\n\t\troom.dbId !== dbId ||\n\t\troom.roomId !== roomId ||\n\t\toldSecret === secret\n\t) {\n\t\t// Nothing to do\n\t\treturn;\n\t}\n\tconsole.debug(\"[Room] Unlocking...\", { dbId, roomId, secret });\n\troom.setSecret(secret);\n\t// TODO : not history.replace(`/room/${id}?secret=${secret}`); as it would trigger a page refresh\n\tdispatch(setRoom({ access: { dbId, roomId, secret } }));\n\tif (options && options.onSuccess) {\n\t\toptions.onSuccess();\n\t}\n};\n\n// ------------------------------------------------------------------\n// ------------------------------------------------------------------\n// ------------------------------------------------------------------\n\nlet ROOM_WATCHER: any = null;\n\nconst _watchRoom = (\n\troom: ReturnType<typeof FirebaseRoom>\n): AsyncAction => async (dispatch, getState, { player }) => {\n\tconsole.debug(\"[Room] Watching...\");\n\tif (!!ROOM_WATCHER) {\n\t\t// Nothing to do\n\t\treturn;\n\t}\n\tROOM_WATCHER = room.subscribe(\n\t\tasync (snapshot: firebase.database.DataSnapshot) => {\n\t\t\t// TODO: we could add a queue in case too much updates are received\n\t\t\tconst {\n\t\t\t\tmedias: { medias: oldMedias }\n\t\t\t} = getState();\n\t\t\tconst newInfo = snapshot.val() as RoomInfo | null;\n\t\t\tconsole.debug(\"[Room] Received room update...\", { newInfo });\n\t\t\tif (!newInfo) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlet medias: MediaAccess[] = [];\n\t\t\tif (newInfo.queue) {\n\t\t\t\tmedias = Object.entries(newInfo.queue)\n\t\t\t\t\t.sort(\n\t\t\t\t\t\t(media1, media2) =>\n\t\t\t\t\t\t\tNumber(media1[0]) - Number(media2[0])\n\t\t\t\t\t)\n\t\t\t\t\t.map(media => media[1]);\n\t\t\t}\n\t\t\tlet tracks: ContextualizedTrackAccess[] = [];\n\t\t\tif (medias.length > 0) {\n\t\t\t\tconst { newMedias, newMediasAndTracks } = await loadNewMedias(\n\t\t\t\t\tmedias,\n\t\t\t\t\toldMedias\n\t\t\t\t);\n\t\t\t\tif (newMediasAndTracks.length > 0) {\n\t\t\t\t\tdispatch(setMedias(newMediasAndTracks));\n\t\t\t\t}\n\t\t\t\ttracks = extractTracks(medias, oldMedias, newMedias);\n\t\t\t}\n\t\t\tdispatch(\n\t\t\t\tsetRoom({\n\t\t\t\t\tinfo: newInfo,\n\t\t\t\t\tmedias,\n\t\t\t\t\troom,\n\t\t\t\t\ttracks\n\t\t\t\t})\n\t\t\t);\n\t\t}\n\t);\n};\n\nconst _unwatchRoom = (\n\troom: ReturnType<typeof FirebaseRoom>\n): AsyncAction => async () => {\n\tif (!ROOM_WATCHER) {\n\t\t// Nothing to do\n\t\treturn;\n\t}\n\tconsole.debug(\"Unwatching room...\");\n\troom.unsubscribe(ROOM_WATCHER);\n\tROOM_WATCHER = null;\n};\n\n// ------------------------------------------------------------------\n// ------------------------------------------------------------------\n// ------------------------------------------------------------------\n\nlet PLAYER_TIMER: NodeJS.Timeout | null = null;\n\nconst _watchPlayer = (): AsyncAction => async (\n\tdispatch,\n\tgetState,\n\t{ player }\n) => {\n\tif (!PLAYER_TIMER) {\n\t\tconsole.debug(\"[Room] Watching player... ********************\");\n\t\t_scheduleTimer(dispatch, getState, player, 250);\n\t}\n};\n\nconst _unwatchPlayer = (): AsyncAction => async (\n\tdispatch,\n\tgetState,\n\t{ player }\n) => {\n\tif (PLAYER_TIMER) {\n\t\tconsole.debug(\"[Room] Unwatching player... ********************\");\n\t\tclearTimeout(PLAYER_TIMER);\n\t\tPLAYER_TIMER = null;\n\t}\n\tawait player.stop();\n};\n\n// Don't use setInterval because a step could be triggered before previous one terminated\nconst _scheduleTimer = (\n\tdispatch: Dispatch,\n\tgetState: () => RootState,\n\tplayer: Player,\n\tms: number\n) => {\n\tPLAYER_TIMER = setTimeout(async () => {\n\t\tconst {\n\t\t\troom: { info, tracks },\n\t\t\tmedias: { medias }\n\t\t} = getState();\n\n\t\tif (info) {\n\t\t\t// Detect and apply change to queue and player\n\t\t\tconst nextTrackIndex = computePlayerNextPosition(\n\t\t\t\tinfo.playing,\n\t\t\t\tplayer.isPlaying(),\n\t\t\t\tplayer.getPlayingTrackID(),\n\t\t\t\tplayer.getPlayingTrackPosition() % tracks.length,\n\t\t\t\ttracks,\n\t\t\t\tinfo.queue_position\n\t\t\t);\n\n\t\t\tif (nextTrackIndex >= 0) {\n\t\t\t\tconst nextAccess = tracks[nextTrackIndex];\n\t\t\t\tconst nextTrack =\n\t\t\t\t\tmedias[nextAccess.provider][nextAccess.type][nextAccess.id];\n\t\t\t\tconsole.debug(\"Detected play change...\", {\n\t\t\t\t\tnextTrack,\n\t\t\t\t\tnextTrackIndex\n\t\t\t\t});\n\n\t\t\t\ttry {\n\t\t\t\t\tconst [color] = await Promise.all([\n\t\t\t\t\t\tpickColor(nextTrack.album.picture_small),\n\t\t\t\t\t\tplayer.play(\n\t\t\t\t\t\t\tnextTrackIndex,\n\t\t\t\t\t\t\tnextTrack.id,\n\t\t\t\t\t\t\tnextTrack.preview,\n\t\t\t\t\t\t\t0,\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tplaymode: info.playmode\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t)\n\t\t\t\t\t]);\n\t\t\t\t\tdispatch(displayMediaInfo(nextTrack));\n\t\t\t\t\tdispatch(\n\t\t\t\t\t\tsetRoom({\n\t\t\t\t\t\t\tcolor,\n\t\t\t\t\t\t\tinfo: { ...info, queue_position: nextTrackIndex } // for info update because of player change without firebase\n\t\t\t\t\t\t})\n\t\t\t\t\t);\n\t\t\t\t} catch (err) {\n\t\t\t\t\tdispatch(displayError(extractErrorMessage(err)));\n\t\t\t\t}\n\t\t\t} else if (!info.playing) {\n\t\t\t\tplayer.stop();\n\t\t\t}\n\t\t}\n\n\t\t// Reschedule time\n\t\t// console.debug(\"[Room] Rescheduling\");\n\t\t_scheduleTimer(dispatch, getState, player, ms);\n\t}, ms);\n};\n","import { AsyncAction } from \".\";\nimport { lockRoom } from \"./room\";\nimport { displayError } from \"./messages\";\nimport { extractErrorMessage } from \"../utils/messages\";\nimport { openModal } from \"../reducers/modals\";\n\n// ------------------------------------------------------------------\n\nexport const startPlayer = (): AsyncAction => async (dispatch, getState) => {\n\tconst {\n\t\troom: { info, room }\n\t} = getState();\n\tif (!room || room.isLocked() || !info) {\n\t\tdispatch(displayError(\"rooms.errors.locked\"));\n\t\tdispatch(\n\t\t\topenModal({\n\t\t\t\ttype: \"UnlockRoom\",\n\t\t\t\tprops: {\n\t\t\t\t\toptions: {\n\t\t\t\t\t\tonSuccess: () => {\n\t\t\t\t\t\t\tdispatch(startPlayer());\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t);\n\t\treturn;\n\t}\n\tif (info.playing) {\n\t\t// Nothing to do\n\t\treturn;\n\t}\n\ttry {\n\t\tconsole.debug(\"[Player] Starting...\");\n\t\tawait room.update({\n\t\t\t...info,\n\t\t\tplaying: true\n\t\t});\n\t} catch (err) {\n\t\tdispatch(displayError(extractErrorMessage(err)));\n\t\tdispatch(lockRoom());\n\t}\n};\n\n// ------------------------------------------------------------------\n\nexport const stopPlayer = (): AsyncAction => async (dispatch, getState) => {\n\tconst {\n\t\troom: { info, room }\n\t} = getState();\n\tif (!room || room.isLocked() || !info) {\n\t\tdispatch(displayError(\"rooms.errors.locked\"));\n\t\tdispatch(\n\t\t\topenModal({\n\t\t\t\ttype: \"UnlockRoom\",\n\t\t\t\tprops: {\n\t\t\t\t\toptions: {\n\t\t\t\t\t\tonSuccess: () => {\n\t\t\t\t\t\t\tdispatch(stopPlayer());\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t);\n\t\treturn;\n\t}\n\tif (!info.playing) {\n\t\t// Nothing to do\n\t\treturn;\n\t}\n\ttry {\n\t\tconsole.debug(\"[Player] Stopping...\");\n\t\tawait room.update({\n\t\t\t...info,\n\t\t\tplaying: false\n\t\t});\n\t} catch (err) {\n\t\tdispatch(displayError(extractErrorMessage(err)));\n\t\tdispatch(lockRoom());\n\t}\n};\n","import { AsyncAction } from \".\";\nimport { displayError } from \"./messages\";\nimport { lockRoom } from \"./room\";\nimport { MediaAccess, findContextFromTrackIndex } from \"../utils/medias\";\nimport { extractErrorMessage } from \"../utils/messages\";\nimport { createQueueMerging, createQueueRemoving } from \"../utils/rooms\";\nimport { generateRandomPosition } from \"../utils/player\";\nimport { openModal } from \"../reducers/modals\";\n\n// ------------------------------------------------------------------\n\nexport const clearQueue = (): AsyncAction => async (dispatch, getState) => {\n\tconst {\n\t\troom: { info, room }\n\t} = getState();\n\tif (!room || room.isLocked() || !info) {\n\t\tdispatch(displayError(\"rooms.errors.locked\"));\n\t\tdispatch(\n\t\t\topenModal({\n\t\t\t\ttype: \"UnlockRoom\",\n\t\t\t\tprops: {\n\t\t\t\t\toptions: {\n\t\t\t\t\t\tonSuccess: () => {\n\t\t\t\t\t\t\tdispatch(clearQueue());\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t);\n\t\treturn;\n\t}\n\ttry {\n\t\tconsole.debug(\"[Queue] Clearing medias...\");\n\t\tawait room.update({\n\t\t\t...info,\n\t\t\tplaying: false,\n\t\t\tqueue: {},\n\t\t\tqueue_position: 0\n\t\t});\n\t} catch (err) {\n\t\tdispatch(displayError(extractErrorMessage(err)));\n\t\tdispatch(lockRoom());\n\t}\n};\n\n// ------------------------------------------------------------------\n\nexport const appendToQueue = (newMedias: MediaAccess[]): AsyncAction => async (\n\tdispatch,\n\tgetState\n) => {\n\tconst {\n\t\troom: { info, medias: oldMedias, room }\n\t} = getState();\n\tif (!room || room.isLocked() || !info) {\n\t\tdispatch(displayError(\"rooms.errors.locked\"));\n\t\tdispatch(\n\t\t\topenModal({\n\t\t\t\ttype: \"UnlockRoom\",\n\t\t\t\tprops: {\n\t\t\t\t\toptions: {\n\t\t\t\t\t\tonSuccess: () => {\n\t\t\t\t\t\t\tdispatch(appendToQueue(newMedias));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t);\n\t\treturn;\n\t}\n\tif (newMedias.length === 0) {\n\t\t// Nothing to do\n\t\treturn;\n\t}\n\ttry {\n\t\tconsole.debug(\"[Queue] Appending medias...\", {\n\t\t\tnewMedias\n\t\t});\n\t\tawait room.update({\n\t\t\t...info,\n\t\t\tqueue: createQueueMerging(oldMedias, newMedias)\n\t\t});\n\t} catch (err) {\n\t\tdispatch(displayError(extractErrorMessage(err)));\n\t\tdispatch(lockRoom());\n\t}\n};\n\n// ------------------------------------------------------------------\n\n// TODO: DECOMPLEXIFY removeFromQueue\nexport const removeFromQueue = (\n\tremovedTrackIndex: number\n): AsyncAction => async (dispatch, getState) => {\n\tconst {\n\t\tmedias: { medias: allMedias },\n\t\troom: { info, medias, room, tracks }\n\t} = getState();\n\tif (!room || room.isLocked() || !info) {\n\t\tdispatch(displayError(\"rooms.errors.locked\"));\n\t\tdispatch(\n\t\t\topenModal({\n\t\t\t\ttype: \"UnlockRoom\",\n\t\t\t\tprops: {\n\t\t\t\t\toptions: {\n\t\t\t\t\t\tonSuccess: () => {\n\t\t\t\t\t\t\tdispatch(removeFromQueue(removedTrackIndex));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t);\n\t\treturn;\n\t}\n\tconst {\n\t\tmediaFirstTrackIndex: removedMediaFirstTrackIndex,\n\t\tmediaIndex: removedMediaIndex,\n\t\tmediaSize: removedTrackCount\n\t} = findContextFromTrackIndex(medias, removedTrackIndex, allMedias);\n\tif (removedMediaIndex < 0) {\n\t\t// Nothing to do\n\t\treturn;\n\t}\n\tconst playingTrackIndex = info.queue_position;\n\ttry {\n\t\tconsole.debug(\"[Queue] Removing track...\", {\n\t\t\tplayingTrackIndex,\n\t\t\tremovedMediaIndex,\n\t\t\tremovedTrackCount,\n\t\t\tremovedTrackIndex,\n\t\t\tremovedMediaFirstTrackIndex\n\t\t});\n\t\tconst queue = createQueueRemoving(medias, removedMediaIndex, 1);\n\t\tif (Object.keys(queue).length === 0) {\n\t\t\tconsole.debug(\"[Queue] Removing last media...\");\n\t\t\tawait room.update({\n\t\t\t\t...info,\n\t\t\t\tplaying: false,\n\t\t\t\tqueue: {},\n\t\t\t\tqueue_position: 0\n\t\t\t});\n\t\t} else if (playingTrackIndex < removedTrackIndex) {\n\t\t\tawait room.update({\n\t\t\t\t...info,\n\t\t\t\tqueue\n\t\t\t});\n\t\t} else if (\n\t\t\tplayingTrackIndex >= removedMediaFirstTrackIndex &&\n\t\t\tplayingTrackIndex < removedMediaFirstTrackIndex + removedTrackCount\n\t\t) {\n\t\t\tawait room.update({\n\t\t\t\t...info,\n\t\t\t\tqueue,\n\t\t\t\tqueue_position:\n\t\t\t\t\tremovedMediaFirstTrackIndex + removedTrackCount ===\n\t\t\t\t\ttracks.length\n\t\t\t\t\t\t? removedMediaFirstTrackIndex - 1\n\t\t\t\t\t\t: removedMediaFirstTrackIndex\n\t\t\t});\n\t\t} else {\n\t\t\tawait room.update({\n\t\t\t\t...info,\n\t\t\t\tqueue,\n\t\t\t\tqueue_position: playingTrackIndex - removedTrackCount\n\t\t\t});\n\t\t}\n\t} catch (err) {\n\t\tdispatch(displayError(extractErrorMessage(err)));\n\t\tdispatch(lockRoom());\n\t}\n};\n\n// ------------------------------------------------------------------\n\nexport const setQueuePosition = (newTrackIndex: number): AsyncAction => async (\n\tdispatch,\n\tgetState\n) => {\n\tconst {\n\t\troom: { info, room }\n\t} = getState();\n\tif (!room || room.isLocked() || !info) {\n\t\tdispatch(displayError(\"rooms.errors.locked\"));\n\t\tdispatch(\n\t\t\topenModal({\n\t\t\t\ttype: \"UnlockRoom\",\n\t\t\t\tprops: {\n\t\t\t\t\toptions: {\n\t\t\t\t\t\tonSuccess: () => {\n\t\t\t\t\t\t\tdispatch(setQueuePosition(newTrackIndex));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t);\n\t\treturn;\n\t}\n\tconst oldTrackIndex = info.queue_position;\n\tif (oldTrackIndex === newTrackIndex) {\n\t\t// Nothing to do\n\t\treturn;\n\t}\n\ttry {\n\t\tconsole.debug(\"[Queue] Set position...\", {\n\t\t\toldTrackIndex,\n\t\t\tnewTrackIndex\n\t\t});\n\t\tawait room.update({\n\t\t\t...info,\n\t\t\tplaying: true, // important\n\t\t\tqueue_position: newTrackIndex\n\t\t});\n\t} catch (err) {\n\t\tdispatch(displayError(extractErrorMessage(err)));\n\t\tdispatch(lockRoom());\n\t}\n};\n\n// ------------------------------------------------------------------\n\nexport const moveToPreviousTrack = (): AsyncAction => async (\n\tdispatch,\n\tgetState\n) => {\n\tconst {\n\t\troom: { info, tracks }\n\t} = getState();\n\tif (!info || tracks.length === 0) {\n\t\t// Nothing to do\n\t\treturn;\n\t}\n\tconsole.debug(\"[Queue] Moving backward...\");\n\tdispatch(\n\t\tsetQueuePosition(\n\t\t\tinfo.queue_position > 0\n\t\t\t\t? info.queue_position - 1\n\t\t\t\t: tracks.length - 1\n\t\t)\n\t);\n};\n\n// ------------------------------------------------------------------\n\nexport const moveToNextTrack = (): AsyncAction => async (\n\tdispatch,\n\tgetState\n) => {\n\tconst {\n\t\troom: { info, tracks }\n\t} = getState();\n\tif (!info || tracks.length === 0) {\n\t\t// Nothing to do\n\t\treturn;\n\t}\n\tif (info.playmode === \"shuffle\") {\n\t\tconsole.debug(\"[Queue] Randomizing next track...\");\n\t\tdispatch(setQueuePosition(generateRandomPosition() % tracks.length));\n\t} else {\n\t\tconsole.debug(\"[Queue] Moving forward...\");\n\t\tdispatch(setQueuePosition((info.queue_position + 1) % tracks.length));\n\t}\n};\n","import React, { FC, useCallback } from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { useTranslation } from \"react-i18next\";\n//\nimport { IconButton } from \"../Common/IconButton\";\nimport { LoadingIcon } from \"../Common/LoadingIcon\";\nimport { QueueItem } from \"./QueueItem\";\nimport { Dispatch } from \"../../actions\";\nimport { RootState } from \"../../reducers\";\nimport {\n\tisRoomLoaded,\n\tisRoomLocked,\n\tisRoomPlaying\n} from \"../../selectors/room\";\nimport { selectTracks } from \"../../selectors/medias\";\nimport { Track } from \"../../utils/medias\";\nimport { startPlayer, stopPlayer } from \"../../actions/player\";\nimport { setQueuePosition, removeFromQueue } from \"../../actions/queue\";\nimport { openModal } from \"../../reducers/modals\";\nimport \"./Queue.scss\";\n\n// ------------------------------------------------------------------\n\nexport const Queue: FC = () => {\n\tconst dispatch = useDispatch<Dispatch>();\n\tconst loaded = useSelector<RootState, boolean>(isRoomLoaded);\n\tconst locked = useSelector<RootState, boolean>(isRoomLocked);\n\tconst playing = useSelector<RootState, boolean>(isRoomPlaying);\n\tconst playingIndex = useSelector<RootState, number>(state =>\n\t\tnull !== state.room.info ? state.room.info.queue_position : 0\n\t);\n\tconst tracks = useSelector<RootState, Array<Track | null>>(selectTracks);\n\n\tconst onPlay = useCallback(\n\t\t(index: number) => {\n\t\t\tdispatch(startPlayer());\n\t\t\tdispatch(setQueuePosition(index));\n\t\t},\n\t\t[dispatch]\n\t);\n\n\tconst onRemove = useCallback(\n\t\t(index: number) => dispatch(removeFromQueue(index)),\n\t\t[dispatch]\n\t);\n\n\tconst onSearch = useCallback(\n\t\t() => dispatch(openModal({ type: \"Search\", props: null })),\n\t\t[dispatch]\n\t);\n\n\tconst onStop = useCallback(() => dispatch(stopPlayer()), [dispatch]);\n\n\treturn (\n\t\t<div className=\"Queue\">\n\t\t\t{tracks.length > 0 ? (\n\t\t\t\t<QueueList\n\t\t\t\t\tlocked={locked}\n\t\t\t\t\ttracks={tracks}\n\t\t\t\t\tplaying={playing}\n\t\t\t\t\tplayingIndex={playingIndex}\n\t\t\t\t\tonPlay={onPlay}\n\t\t\t\t\tonRemove={onRemove}\n\t\t\t\t\tonStop={onStop}\n\t\t\t\t/>\n\t\t\t) : (\n\t\t\t\t<EmptyQueueList\n\t\t\t\t\tloaded={loaded}\n\t\t\t\t\tlocked={locked}\n\t\t\t\t\tonSearch={onSearch}\n\t\t\t\t/>\n\t\t\t)}\n\t\t</div>\n\t);\n};\n\n// ------------------------------------------------------------------\n\nconst EmptyQueueList = React.memo(\n\t({\n\t\tloaded,\n\t\tlocked,\n\t\tonSearch\n\t}: {\n\t\tloaded: boolean;\n\t\tlocked: boolean;\n\t\tonSearch: () => void;\n\t}) => {\n\t\tconst { t } = useTranslation();\n\t\treturn (\n\t\t\t<div className=\"QueueEmpty\">\n\t\t\t\t{loaded ? (\n\t\t\t\t\t<>\n\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\ttitle=\"...\"\n\t\t\t\t\t\t\ticon=\"shower\"\n\t\t\t\t\t\t\tonClick={onSearch}\n\t\t\t\t\t\t\tsize=\"L\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<span onClick={onSearch}>\n\t\t\t\t\t\t\t{t(locked ? \"rooms.empty_for_now\" : \"rooms.empty\")}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</>\n\t\t\t\t) : (\n\t\t\t\t\t<>\n\t\t\t\t\t\t<LoadingIcon size=\"L\" />\n\t\t\t\t\t\t<span>{t(\"rooms.loading\")}</span>\n\t\t\t\t\t</>\n\t\t\t\t)}\n\t\t\t</div>\n\t\t);\n\t}\n);\n\n// ------------------------------------------------------------------\n\nconst QueueList = React.memo(\n\t({\n\t\tlocked,\n\t\ttracks,\n\t\tplaying,\n\t\tplayingIndex,\n\t\tonPlay,\n\t\tonRemove,\n\t\tonStop\n\t}: {\n\t\tlocked: boolean;\n\t\ttracks: Array<Track | null>;\n\t\tplaying: boolean;\n\t\tplayingIndex: number;\n\t\tonPlay: (index: number) => void;\n\t\tonRemove: (index: number) => void;\n\t\tonStop: () => void;\n\t}) => (\n\t\t<>\n\t\t\t{tracks.map((track, index) => (\n\t\t\t\t<QueueItem\n\t\t\t\t\tkey={index}\n\t\t\t\t\tlocked={locked}\n\t\t\t\t\tplaying={playing && playingIndex === index}\n\t\t\t\t\ttrack={track}\n\t\t\t\t\tonPlay={() => onPlay(index)}\n\t\t\t\t\tonRemove={() => onRemove(index)}\n\t\t\t\t\tonStop={onStop}\n\t\t\t\t/>\n\t\t\t))}\n\t\t</>\n\t)\n);\n","import React, { FC, useCallback } from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { useTranslation } from \"react-i18next\";\nimport classNames from \"classnames\";\n//\nimport { IconButton } from \"../Common/IconButton\";\nimport { Dispatch } from \"../../actions\";\nimport { RootState } from \"../../reducers\";\nimport { isRoomLocked, isRoomPlaying } from \"../../selectors/room\";\nimport { stopPlayer, startPlayer } from \"../../actions/player\";\nimport { moveToPreviousTrack, moveToNextTrack } from \"../../actions/queue\";\nimport { RoomInfo } from \"../../utils/rooms\";\nimport { setRoom } from \"../../reducers/room\";\nimport { generateRandomPosition } from \"../../utils/player\";\nimport { IconSize } from \"../Common/Icon\";\nimport \"./AudioPlayerControls.scss\";\n\n// ------------------------------------------------------------------\n\nexport const AudioPlayerControls: FC<{\n\tclassName?: string;\n\tpropagate: boolean;\n\tsize?: IconSize;\n}> = ({ className, propagate, size }) => {\n\tconst dispatch = useDispatch<Dispatch>();\n\n\tconst { t } = useTranslation();\n\n\tconst locked = useSelector<RootState, boolean>(isRoomLocked);\n\n\tconst playing = useSelector<RootState, boolean>(isRoomPlaying);\n\n\tconst tracksCount = useSelector<RootState, number>(\n\t\tstate => state.room.tracks.length\n\t);\n\n\tconst roomInfo = useSelector<RootState, RoomInfo | null>(\n\t\tstate => state.room.info\n\t);\n\n\t// Propagation\n\n\tconst onMoveBackward_Propagate = useCallback(\n\t\t() => dispatch(moveToPreviousTrack()),\n\t\t[dispatch]\n\t);\n\n\tconst onMoveForward_Propagate = useCallback(\n\t\t() => dispatch(moveToNextTrack()),\n\t\t[dispatch]\n\t);\n\n\tconst onPlay_Propagate = useCallback(() => dispatch(startPlayer()), [\n\t\tdispatch\n\t]);\n\n\tconst onStop_Propagate = useCallback(() => dispatch(stopPlayer()), [\n\t\tdispatch\n\t]);\n\n\t// No propagation\n\n\tconst onMoveForward_NoPropagate = useCallback(() => {\n\t\tif (!roomInfo || tracksCount === 0) {\n\t\t\treturn;\n\t\t}\n\t\t// TODO: onMoveForward_NoPropagate (handle non shuffle mode)\n\t\tdispatch(\n\t\t\tsetRoom({\n\t\t\t\tinfo: {\n\t\t\t\t\t...roomInfo,\n\t\t\t\t\tplaying: true,\n\t\t\t\t\tqueue_position: generateRandomPosition() % tracksCount\n\t\t\t\t}\n\t\t\t})\n\t\t);\n\t}, [dispatch, roomInfo, tracksCount]);\n\n\tconst onMoveBackward_NoPropagate = useCallback(() => {\n\t\t// TODO: onMoveBackward_NoPropagate\n\t}, []);\n\n\tconst onPlay_NoPropagate = useCallback(() => {\n\t\tif (!roomInfo || tracksCount === 0) {\n\t\t\treturn;\n\t\t}\n\t\t// TODO: onPlay_NoPropagate (handle non shuffle mode)\n\t\tdispatch(\n\t\t\tsetRoom({\n\t\t\t\tinfo: {\n\t\t\t\t\t...roomInfo,\n\t\t\t\t\tplaying: true,\n\t\t\t\t\tqueue_position: generateRandomPosition() % tracksCount\n\t\t\t\t}\n\t\t\t})\n\t\t);\n\t}, [dispatch, roomInfo, tracksCount]);\n\n\tconst onStop_NoPropagate = useCallback(() => {\n\t\tif (!roomInfo) {\n\t\t\treturn;\n\t\t}\n\t\tdispatch(\n\t\t\tsetRoom({\n\t\t\t\tinfo: {\n\t\t\t\t\t...roomInfo,\n\t\t\t\t\tplaying: false\n\t\t\t\t}\n\t\t\t})\n\t\t);\n\t}, [dispatch, roomInfo]);\n\n\t// ...\n\n\treturn (\n\t\t<div className={classNames(\"AudioPlayerControls\", className)}>\n\t\t\t<div className=\"Control\">\n\t\t\t\t<IconButton\n\t\t\t\t\tdisabled={\n\t\t\t\t\t\tlocked ||\n\t\t\t\t\t\ttracksCount === 0 ||\n\t\t\t\t\t\troomInfo?.playmode === \"shuffle\"\n\t\t\t\t\t}\n\t\t\t\t\ticon=\"step-backward\"\n\t\t\t\t\tonClick={\n\t\t\t\t\t\tpropagate\n\t\t\t\t\t\t\t? onMoveBackward_Propagate\n\t\t\t\t\t\t\t: onMoveBackward_NoPropagate\n\t\t\t\t\t}\n\t\t\t\t\tsize={size || \"M\"}\n\t\t\t\t\ttitle={t(\"player.backward\")}\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<div className=\"Control\">\n\t\t\t\t{!playing ? (\n\t\t\t\t\t<IconButton\n\t\t\t\t\t\tdisabled={locked || tracksCount === 0}\n\t\t\t\t\t\tonClick={\n\t\t\t\t\t\t\tpropagate ? onPlay_Propagate : onPlay_NoPropagate\n\t\t\t\t\t\t}\n\t\t\t\t\t\ticon=\"play\"\n\t\t\t\t\t\tsize={size || \"L\"}\n\t\t\t\t\t\ttitle={t(\"player.play\")}\n\t\t\t\t\t/>\n\t\t\t\t) : (\n\t\t\t\t\t<IconButton\n\t\t\t\t\t\tdisabled={locked || tracksCount === 0}\n\t\t\t\t\t\tonClick={\n\t\t\t\t\t\t\tpropagate ? onStop_Propagate : onStop_NoPropagate\n\t\t\t\t\t\t}\n\t\t\t\t\t\ticon=\"pause\"\n\t\t\t\t\t\ttitle={t(\"player.stop\")}\n\t\t\t\t\t\tsize={size || \"L\"}\n\t\t\t\t\t/>\n\t\t\t\t)}\n\t\t\t</div>\n\t\t\t<div className=\"Control\">\n\t\t\t\t<IconButton\n\t\t\t\t\tdisabled={locked || tracksCount === 0}\n\t\t\t\t\ticon=\"step-forward\"\n\t\t\t\t\tonClick={\n\t\t\t\t\t\tpropagate\n\t\t\t\t\t\t\t? onMoveForward_Propagate\n\t\t\t\t\t\t\t: onMoveForward_NoPropagate\n\t\t\t\t\t}\n\t\t\t\t\tsize={size || \"M\"}\n\t\t\t\t\ttitle={t(\"player.forward\")}\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t);\n};\n","import React, { FC, useEffect, useState } from \"react\";\n//\nimport { QUEUE_PLAYER } from \"../../utils/player\";\nimport \"./Progress.scss\";\n\n// ------------------------------------------------------------------\n\nexport const Progress: FC = () => {\n\tconst [value, setValue] = useState<number>(0);\n\n\tuseEffect(() => {\n\t\tconst timer = setInterval(() => {\n\t\t\tsetValue(QUEUE_PLAYER.getPlayingTrackPercent());\n\t\t}, 250);\n\t\treturn () => {\n\t\t\tclearInterval(timer);\n\t\t};\n\t}, []);\n\n\treturn (\n\t\t<div className=\"Progress\">\n\t\t\t<progress max={100} value={value * 100} />\n\t\t</div>\n\t);\n};\n","import React, { FC, useCallback } from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { useTranslation } from \"react-i18next\";\n//\nimport { AudioPlayerControls } from \"./AudioPlayerControls\";\nimport { IconButton } from \"../Common/IconButton\";\nimport { Progress } from \"./Progress\";\nimport { Dispatch } from \"../../actions\";\nimport { RootState } from \"../../reducers\";\nimport { isRoomLocked } from \"../../selectors/room\";\nimport { lockRoom } from \"../../actions/room\";\nimport { stopPlayer } from \"../../actions/player\";\nimport { confirmModal } from \"../../actions/modals\";\nimport { openModal } from \"../../reducers/modals\";\nimport { clearQueue } from \"../../actions/queue\";\nimport \"./RoomControls.scss\";\n\n// ------------------------------------------------------------------\n\nexport const RoomControls: FC<{\n\textended: boolean;\n\tpropagate: boolean;\n}> = ({ extended, propagate }) => {\n\tconst dispatch = useDispatch<Dispatch>();\n\tconst { t } = useTranslation();\n\tconst tracksCount = useSelector<RootState, number>(\n\t\tstate => state.room.medias.length\n\t);\n\tconst locked = useSelector<RootState, boolean>(isRoomLocked);\n\tconst onClear = useCallback(() => {\n\t\tdispatch(\n\t\t\tconfirmModal(t(\"rooms.confirm_clear\"), () => {\n\t\t\t\tdispatch(clearQueue());\n\t\t\t\tdispatch(stopPlayer());\n\t\t\t})\n\t\t);\n\t}, [dispatch, t]);\n\n\tconst onLock = useCallback(() => {\n\t\tdispatch(\n\t\t\tconfirmModal(t(\"rooms.confirm_lock\"), () => {\n\t\t\t\tdispatch(lockRoom());\n\t\t\t})\n\t\t);\n\t}, [dispatch, t]);\n\n\tconst onUnlock = useCallback(() => {\n\t\tdispatch(openModal({ type: \"UnlockRoom\", props: {} }));\n\t}, [dispatch]);\n\n\tconst onSearch = useCallback(\n\t\t() => dispatch(openModal({ type: \"Search\", props: null })),\n\t\t[dispatch]\n\t);\n\n\treturn (\n\t\t<div className=\"RoomControls\">\n\t\t\t<div className=\"ControlsInner\">\n\t\t\t\t{extended ? (\n\t\t\t\t\t<>\n\t\t\t\t\t\t<AudioPlayerControls\n\t\t\t\t\t\t\tclassName=\"ControlsSet\"\n\t\t\t\t\t\t\tpropagate={propagate}\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<Progress />\n\t\t\t\t\t\t<div className=\"ControlsSet RoomControlsSet\">\n\t\t\t\t\t\t\t<div className=\"Control\">\n\t\t\t\t\t\t\t\t{locked ? (\n\t\t\t\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\t\t\t\ticon=\"lock\"\n\t\t\t\t\t\t\t\t\t\tonClick={onUnlock}\n\t\t\t\t\t\t\t\t\t\tsize=\"M\"\n\t\t\t\t\t\t\t\t\t\ttitle={t(\"rooms.locked\")}\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\t\t\t\ticon=\"unlock\"\n\t\t\t\t\t\t\t\t\t\tonClick={onLock}\n\t\t\t\t\t\t\t\t\t\tsize=\"M\"\n\t\t\t\t\t\t\t\t\t\ttitle={t(\"rooms.unlocked\")}\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div className=\"Control\">\n\t\t\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\t\t\tonClick={onSearch}\n\t\t\t\t\t\t\t\t\ticon=\"search\"\n\t\t\t\t\t\t\t\t\ttitle={t(\"medias.search\")}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div className=\"Control\">\n\t\t\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\t\t\tdisabled={locked || tracksCount === 0}\n\t\t\t\t\t\t\t\t\tonClick={onClear}\n\t\t\t\t\t\t\t\t\ticon=\"trash\"\n\t\t\t\t\t\t\t\t\ttitle={t(\"rooms.clear\")}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</>\n\t\t\t\t) : (\n\t\t\t\t\t<AudioPlayerControls\n\t\t\t\t\t\tclassName=\"ControlsSet\"\n\t\t\t\t\t\tpropagate={propagate}\n\t\t\t\t\t\tsize=\"S\"\n\t\t\t\t\t/>\n\t\t\t\t)}\n\t\t\t</div>\n\t\t</div>\n\t);\n};\n","import React, { FC } from \"react\";\nimport { useTranslation } from \"react-i18next\";\n//\nimport { IconButton } from \"../Common/IconButton\";\nimport {\n\tSeaBattleBoatData,\n\tAngleToDirection\n} from \"../../utils/games/seabattle\";\nimport { SeaBattleMovementIconMappings } from \"../../utils/games/seabattle/mappings\";\n\n// ------------------------------------------------------------------\n\nexport const SeaBattlePlayerControls: FC<{\n\tboat?: SeaBattleBoatData;\n\tdisabled?: boolean;\n\tonMoveBackward: () => void;\n\tonMoveForward: () => void;\n\tonRotateLeft: () => void;\n\tonRotateRight: () => void;\n}> = ({\n\tboat,\n\tdisabled = false,\n\tonMoveBackward,\n\tonMoveForward,\n\tonRotateLeft,\n\tonRotateRight\n}) => {\n\tconst { t } = useTranslation();\n\n\treturn (\n\t\t<div className=\"SeaBattlePlayerControls SeaBattleControls\">\n\t\t\t<IconButton\n\t\t\t\tdisabled={disabled}\n\t\t\t\ticon=\"rotate-left\"\n\t\t\t\ttitle={t(\"Rotate Left\")}\n\t\t\t\tonClick={onRotateLeft}\n\t\t\t/>\n\t\t\t<IconButton\n\t\t\t\tdisabled={disabled}\n\t\t\t\ticon={\n\t\t\t\t\tboat\n\t\t\t\t\t\t? SeaBattleMovementIconMappings[\n\t\t\t\t\t\t\t\tAngleToDirection(boat.angle)\n\t\t\t\t\t\t  ].backward\n\t\t\t\t\t\t: \"arrow-down\"\n\t\t\t\t}\n\t\t\t\ttitle={t(\"Move Backward\")}\n\t\t\t\tonClick={onMoveBackward}\n\t\t\t/>\n\t\t\t<IconButton\n\t\t\t\tdisabled={disabled}\n\t\t\t\ticon={\n\t\t\t\t\tboat\n\t\t\t\t\t\t? SeaBattleMovementIconMappings[\n\t\t\t\t\t\t\t\tAngleToDirection(boat.angle)\n\t\t\t\t\t\t  ].forward\n\t\t\t\t\t\t: \"arrow-up\"\n\t\t\t\t}\n\t\t\t\ttitle={t(\"Move Forward\")}\n\t\t\t\tonClick={onMoveForward}\n\t\t\t/>\n\t\t\t<IconButton\n\t\t\t\tdisabled={disabled}\n\t\t\t\ticon=\"rotate-right\"\n\t\t\t\ttitle={t(\"Rotate Right\")}\n\t\t\t\tonClick={onRotateRight}\n\t\t\t/>\n\t\t</div>\n\t);\n};\n","import React, { FC } from \"react\";\nimport {\n\tSeaBattleAssetType,\n\tSeaBattleCellData,\n\tGRID_CELL_UNIT_SIZE,\n\tSeaBattlePosition\n} from \"../../utils/games/seabattle\";\n\n// ------------------------------------------------------------------\n\nexport const Asset: FC<{\n\tclassName?: string;\n\tonClick?: () => void;\n\tposition: SeaBattlePosition;\n\tstopPropagation?: boolean;\n\ttransform?: string;\n\ttype: SeaBattleAssetType;\n\tvisibility?: string;\n}> = ({\n\tclassName,\n\tonClick,\n\tposition,\n\tstopPropagation = false,\n\ttransform,\n\ttype,\n\tvisibility\n}) => (\n\t<use\n\t\tonClick={e => {\n\t\t\tif (stopPropagation) {\n\t\t\t\te.stopPropagation();\n\t\t\t}\n\t\t\tif (onClick) {\n\t\t\t\tonClick();\n\t\t\t}\n\t\t}}\n\t\tclassName={className}\n\t\thref={`#${type}`}\n\t\ttransform={transform}\n\t\tvisibility={visibility}\n\t\t{...position}\n\t/>\n);\n\n// ------------------------------------------------------------------\n\nexport const Cell: FC<SeaBattleCellData> = ({ type, visibility, ...asset }) => (\n\t<Asset\n\t\tclassName=\"SeaBattleCell\"\n\t\ttype={type}\n\t\tvisibility={visibility}\n\t\tposition={{\n\t\t\tx: asset.position.x * GRID_CELL_UNIT_SIZE,\n\t\t\ty: asset.position.y * GRID_CELL_UNIT_SIZE\n\t\t}}\n\t/>\n);\n","import React, { FC } from \"react\";\n//\nimport { Asset } from \"./Assets\";\nimport {\n\tSeaBattleWeaponData,\n\tSeaBattleWeaponsOffsetMappings,\n\tGRID_CELL_UNIT_SIZE\n} from \"../../utils/games/seabattle\";\n\n// ------------------------------------------------------------------\n\nexport const Weapon: FC<SeaBattleWeaponData> = ({ type, ...asset }) => (\n\t<Asset\n\t\tclassName=\"SeaBattleWeapon\"\n\t\ttype={type}\n\t\tposition={{\n\t\t\tx:\n\t\t\t\tSeaBattleWeaponsOffsetMappings[type].x +\n\t\t\t\tasset.position.x * GRID_CELL_UNIT_SIZE,\n\t\t\ty:\n\t\t\t\tSeaBattleWeaponsOffsetMappings[type].y +\n\t\t\t\tasset.position.y * GRID_CELL_UNIT_SIZE\n\t\t}}\n\t/>\n);\n// ------------------------------------------------------------------\n\nexport const Weapons = ({ weapons }: { weapons: SeaBattleWeaponData[] }) => {\n\treturn (\n\t\t<>\n\t\t\t{weapons.map((weapon, index) => (\n\t\t\t\t<Weapon key={index} {...weapon} />\n\t\t\t))}\n\t\t</>\n\t);\n};\n","import React, { FC } from \"react\";\n//\nimport { Asset } from \"./Assets\";\nimport {\n\tSeaBattleHitData,\n\tGRID_CELL_UNIT_SIZE,\n\tHitsOffsetInCellMappings\n} from \"../../utils/games/seabattle\";\n\n// ------------------------------------------------------------------\n\nexport const Hit: FC<SeaBattleHitData> = ({ type, ...asset }) => (\n\t<Asset\n\t\tclassName=\"SeaBattleHit\"\n\t\ttype={type}\n\t\tposition={{\n\t\t\tx:\n\t\t\t\tHitsOffsetInCellMappings[type].x +\n\t\t\t\tasset.position.x * GRID_CELL_UNIT_SIZE,\n\t\t\ty:\n\t\t\t\tHitsOffsetInCellMappings[type].y +\n\t\t\t\tasset.position.y * GRID_CELL_UNIT_SIZE\n\t\t}}\n\t/>\n);\n\n// ------------------------------------------------------------------\n\nexport const Hits: FC<{ hits: SeaBattleHitData[] }> = ({ hits }) => {\n\treturn (\n\t\t<>\n\t\t\t{hits.map((hit, index) => (\n\t\t\t\t<Hit key={index} {...hit} />\n\t\t\t))}\n\t\t</>\n\t);\n};\n","import React, { FC } from \"react\";\nimport classNames from \"classnames\";\n//\nimport { Asset } from \"./Assets\";\nimport {\n\tSeaBattleBoatData,\n\tGRID_CELL_UNIT_SIZE,\n\tBoatsOffsetMappings,\n\tHitsOffsetInBoatappings\n} from \"../../utils/games/seabattle\";\n\n// ------------------------------------------------------------------\n\nexport const Boat: FC<{\n\tboat: SeaBattleBoatData;\n\thideFleet: boolean;\n\tonClick?: () => void;\n\tselected: boolean;\n}> = ({\n\tboat: { angle, hits, type, status = \"ok\", ...asset },\n\thideFleet,\n\tonClick,\n\tselected\n}) => (\n\t<g\n\t\tclassName=\"SeaBattleBoatAnim\"\n\t\ttransform={`translate(${\n\t\t\tBoatsOffsetMappings[type].x + asset.position.x * GRID_CELL_UNIT_SIZE\n\t\t}, ${\n\t\t\tBoatsOffsetMappings[type].y + asset.position.y * GRID_CELL_UNIT_SIZE\n\t\t}) rotate(${angle * 90}, 14, 14)`}>\n\t\t{!hideFleet || status === \"ko\" ? (\n\t\t\t<Asset\n\t\t\t\tclassName={classNames(\"SeaBattleBoat\", status, {\n\t\t\t\t\tclickable: !!onClick,\n\t\t\t\t\tselected\n\t\t\t\t})}\n\t\t\t\tonClick={onClick}\n\t\t\t\tstopPropagation={true}\n\t\t\t\tposition={{\n\t\t\t\t\tx: 0,\n\t\t\t\t\ty: 0\n\t\t\t\t}}\n\t\t\t\ttype={type}\n\t\t\t/>\n\t\t) : null}\n\t\t{hits.map((hit, index) => (\n\t\t\t<Asset\n\t\t\t\tkey={index}\n\t\t\t\tclassName=\"SeaBattleHit\"\n\t\t\t\ttype={hit.type}\n\t\t\t\tposition={{\n\t\t\t\t\tx:\n\t\t\t\t\t\tHitsOffsetInBoatappings[hit.type].x +\n\t\t\t\t\t\thit.position.x * GRID_CELL_UNIT_SIZE,\n\t\t\t\t\ty:\n\t\t\t\t\t\tHitsOffsetInBoatappings[hit.type].y +\n\t\t\t\t\t\thit.position.y * GRID_CELL_UNIT_SIZE\n\t\t\t\t}}\n\t\t\t/>\n\t\t))}\n\t</g>\n);\n","import React, { FC } from \"react\";\n//\nimport { Boat } from \"./Boats\";\nimport { SeaBattleBoatData } from \"../../utils/games/seabattle\";\n\n// ------------------------------------------------------------------\n\nexport const Fleet: FC<{\n\tfleet: SeaBattleBoatData[];\n\thideFleet: boolean;\n\tselectedBoatIndex?: number;\n\tonSelectBoatIndex?: (index: number) => void;\n}> = ({ fleet, hideFleet, selectedBoatIndex, onSelectBoatIndex }) => (\n\t<>\n\t\t{fleet.map((boat, index) => (\n\t\t\t<Boat\n\t\t\t\tkey={index}\n\t\t\t\tboat={boat}\n\t\t\t\thideFleet={hideFleet}\n\t\t\t\tonClick={\n\t\t\t\t\tonSelectBoatIndex && boat.status === \"ok\"\n\t\t\t\t\t\t? () => {\n\t\t\t\t\t\t\t\tconsole.debug(\"[SeaBattle] Selected boat\", {\n\t\t\t\t\t\t\t\t\tboat\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tonSelectBoatIndex(\n\t\t\t\t\t\t\t\t\tindex === selectedBoatIndex ? -1 : index\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t  }\n\t\t\t\t\t\t: void 0\n\t\t\t\t}\n\t\t\t\tselected={index === selectedBoatIndex}\n\t\t\t/>\n\t\t))}\n\t</>\n);\n","import React, { FC } from \"react\";\nimport { GRID_CELL_UNIT_SIZE } from \"../../utils/games/seabattle\";\n\n// ------------------------------------------------------------------\n\nconst SEA_COLOR1 = \"#a6dbf8\";\nconst SEA_COLOR2 = \"#50a3db\";\n\n// ------------------------------------------------------------------\n\nexport const BattleAssets: FC = () => (\n\t<defs>\n\t\t<circle id=\"hitted\" cx=\"10\" cy=\"10\" r=\"8\" fill=\"#e52524\" />\n\t\t<circle id=\"missed\" cx=\"10\" cy=\"10\" r=\"8\" fill=\"#fff\" />\n\t\t<polygon\n\t\t\tid=\"crossed\"\n\t\t\tpoints=\"11.98 8.08 20.07 0 24 3.9 15.92 11.98 24 20.07 20.07 24 11.98 15.92 3.9 24 0 20.07 8.08 11.98 0 3.9 3.9 0 11.98 8.08\"\n\t\t\tfillRule=\"evenodd\"\n\t\t/>\n\t\t<path id=\"cell\" d=\"M0,0V40H40V0ZM36,36H4V4H36Z\" />\n\t\t<use id=\"cell-selected\" href=\"#cell\" fill=\"#FF0\" />\n\t\t<use id=\"cell-selection\" href=\"#cell\" fill=\"#555\" />\n\t\t<g id=\"cell-crossed\">\n\t\t\t<use href=\"#cell\" fill=\"#e52524\" />\n\t\t\t<use href=\"#crossed\" fill=\"#e52524\" x=\"8\" y=\"8\" />\n\t\t</g>\n\t\t<path\n\t\t\tid=\"bullet1\"\n\t\t\td=\"M16,4C16,8.46,0,8,0,8V0S16-.46,16,4Z\"\n\t\t\tfill=\"#afafaf\"\n\t\t/>\n\t\t<path\n\t\t\tid=\"bullet2\"\n\t\t\td=\"M16,4C16,8.46,0,8,0,8V0S16-.46,16,4Z\"\n\t\t\tfill=\"#676766\"\n\t\t/>\n\t\t<path\n\t\t\tid=\"bullet3\"\n\t\t\td=\"M16,4C16,8.46,0,8,0,8V0S16-.46,16,4Z\"\n\t\t\tfill=\"#000000\"\n\t\t/>\n\t\t<path\n\t\t\tid=\"mine\"\n\t\t\td=\"M16,9V7H13.77a5.92,5.92,0,0,0-1-2.41L14.35,3,13,1.65,11.39,3.23A5.92,5.92,0,0,0,9,2.23V0H7V2.23a5.92,5.92,0,0,0-2.41,1L3,1.65,1.65,3,3.23,4.61A5.92,5.92,0,0,0,2.23,7H0V9H2.23a5.92,5.92,0,0,0,1,2.41L1.65,13,3,14.35l1.58-1.58a5.92,5.92,0,0,0,2.41,1V16H9V13.77a5.92,5.92,0,0,0,2.41-1L13,14.35,14.35,13l-1.58-1.58a5.92,5.92,0,0,0,1-2.41Z\"\n\t\t\tfill=\"#000000\"\n\t\t/>\n\t\t<path id=\"boat1\" d=\"M28,14C28,19,14,28,14,28H0V0H14S28,9.05,28,14Z\" />\n\t\t<path\n\t\t\tid=\"boat2\"\n\t\t\td=\"M68,14C68,19,51.89,28,51.89,28H0V0H51.89S68,9.05,68,14Z\"\n\t\t/>\n\t\t<path\n\t\t\tid=\"boat3\"\n\t\t\td=\"M108,14C108,19,91.24,28,91.24,28H0V0H91.24S108,9.05,108,14Z\"\n\t\t/>\n\t\t<pattern\n\t\t\tid=\"sea-grid\"\n\t\t\twidth=\"80\"\n\t\t\theight=\"80\"\n\t\t\tpatternUnits=\"userSpaceOnUse\">\n\t\t\t<g>\n\t\t\t\t<rect\n\t\t\t\t\twidth={GRID_CELL_UNIT_SIZE}\n\t\t\t\t\theight={GRID_CELL_UNIT_SIZE}\n\t\t\t\t\tfill={SEA_COLOR1}\n\t\t\t\t\tx=\"0\"\n\t\t\t\t\ty=\"0\"\n\t\t\t\t/>\n\t\t\t\t<rect\n\t\t\t\t\twidth={GRID_CELL_UNIT_SIZE}\n\t\t\t\t\theight={GRID_CELL_UNIT_SIZE}\n\t\t\t\t\tfill={SEA_COLOR2}\n\t\t\t\t\tx={GRID_CELL_UNIT_SIZE}\n\t\t\t\t\ty=\"0\"\n\t\t\t\t/>\n\t\t\t\t<rect\n\t\t\t\t\twidth={GRID_CELL_UNIT_SIZE}\n\t\t\t\t\theight={GRID_CELL_UNIT_SIZE}\n\t\t\t\t\tfill={SEA_COLOR2}\n\t\t\t\t\tx=\"0\"\n\t\t\t\t\ty={GRID_CELL_UNIT_SIZE}\n\t\t\t\t/>\n\t\t\t\t<rect\n\t\t\t\t\twidth={GRID_CELL_UNIT_SIZE}\n\t\t\t\t\theight={GRID_CELL_UNIT_SIZE}\n\t\t\t\t\tfill={SEA_COLOR1}\n\t\t\t\t\tx={GRID_CELL_UNIT_SIZE}\n\t\t\t\t\ty={GRID_CELL_UNIT_SIZE}\n\t\t\t\t/>\n\t\t\t</g>\n\t\t</pattern>\n\t</defs>\n);\n","import { SeaBattlePosition, GRID_CELL_UNIT_SIZE } from \"./games/seabattle\";\n\nexport const getSVGPosition = (\n\tsvg: SVGSVGElement,\n\t{ x, y }: { x: number; y: number }\n) => {\n\tvar pt = svg.createSVGPoint();\n\tpt.x = x;\n\tpt.y = y;\n\tpt = pt.matrixTransform(svg.getScreenCTM()!.inverse());\n\treturn { tx: pt.x, ty: pt.y };\n};\n\nexport const getSVGNormalizedPosition = (\n\tsvg: SVGSVGElement,\n\tposition: SeaBattlePosition\n): SeaBattlePosition => {\n\tconst { tx, ty } = getSVGPosition(svg, position);\n\treturn {\n\t\tx: Math.floor(tx / GRID_CELL_UNIT_SIZE),\n\t\ty: Math.floor(ty / GRID_CELL_UNIT_SIZE)\n\t};\n};\n","import React, { FC, useCallback, useRef, useState } from \"react\";\nimport { Cell } from \"./Assets\";\nimport { Weapons } from \"./Weapons\";\nimport { Hits } from \"./Hits\";\nimport { Fleet } from \"./Fleet\";\nimport { BattleAssets } from \"./BattleAssets\";\nimport { getSVGNormalizedPosition } from \"../../utils/svg\";\nimport {\n\tSeaBattlePosition,\n\tSeaBattleMapData,\n\tSeaBattleAssetVisibility\n} from \"../../utils/games/seabattle\";\n\n// ------------------------------------------------------------------\n\n// Order is important : Weapons under Boats under Hits\nexport const Map: FC<{\n\thideFleet: boolean;\n\tonCellClick?: (position: SeaBattlePosition) => void;\n\tmap?: SeaBattleMapData;\n\tselectedBoatIndex?: number;\n\tonSelectBoatIndex?: (index: number) => void;\n}> = ({\n\thideFleet,\n\tonCellClick,\n\tmap: { fleet, hits, opponentsWeapons } = {\n\t\tfleet: [],\n\t\thits: [],\n\t\topponentsWeapons: [],\n\t\tstatus: \"ok\",\n\t\tuserId: \"\",\n\t\tweapons: {}\n\t},\n\tselectedBoatIndex,\n\tonSelectBoatIndex\n}) => {\n\tconst svg = useRef<SVGSVGElement>(null);\n\n\tconst [selectedPos, setSelectedPos] = useState<SeaBattlePosition>({\n\t\tx: 0,\n\t\ty: 0\n\t});\n\tconst [selectedVis, setSelectedVis] = useState<SeaBattleAssetVisibility>(\n\t\t\"hidden\"\n\t);\n\n\tconst [selectionPos, setSelectionPos] = useState<SeaBattlePosition>({\n\t\tx: 0,\n\t\ty: 0\n\t});\n\tconst [selectionVis, setSelectionVis] = useState<SeaBattleAssetVisibility>(\n\t\t\"hidden\"\n\t);\n\n\tconst onClick = useCallback(\n\t\t(position: SeaBattlePosition) => {\n\t\t\tconst normalizedPos = getSVGNormalizedPosition(\n\t\t\t\tsvg.current!,\n\t\t\t\tposition\n\t\t\t);\n\t\t\tif (\n\t\t\t\tselectedPos.x === normalizedPos.x &&\n\t\t\t\tselectedPos.y === normalizedPos.y\n\t\t\t) {\n\t\t\t\t// Reset\n\t\t\t\tsetSelectedPos({ x: 0, y: 0 });\n\t\t\t\tsetSelectedVis(\"hidden\");\n\t\t\t} else {\n\t\t\t\t// Set\n\t\t\t\tsetSelectedPos(normalizedPos);\n\t\t\t\tsetSelectedVis(\"visible\");\n\t\t\t}\n\t\t\tif (onCellClick) {\n\t\t\t\tonCellClick(normalizedPos);\n\t\t\t}\n\t\t},\n\t\t[onCellClick, selectedPos]\n\t);\n\n\tconst onLeave = useCallback(() => {\n\t\tsetSelectionVis(\"hidden\");\n\t}, []);\n\n\tconst onOver = useCallback((position: SeaBattlePosition) => {\n\t\tsetSelectionPos(getSVGNormalizedPosition(svg.current!, position));\n\t\tsetSelectionVis(\"visible\");\n\t}, []);\n\n\treturn (\n\t\t<svg\n\t\t\tclassName=\"SeaBattleMap\"\n\t\t\tviewBox=\"0 0 400 400\"\n\t\t\tref={svg}\n\t\t\tonClick={e => onClick({ x: e.clientX, y: e.clientY })}\n\t\t\tonMouseLeave={onLeave}\n\t\t\tonMouseMove={e => onOver({ x: e.clientX, y: e.clientY })}>\n\t\t\t<BattleAssets />\n\t\t\t<rect width=\"400\" height=\"400\" fill=\"url(#sea-grid)\" />\n\t\t\t<Cell\n\t\t\t\ttype=\"cell-selection\"\n\t\t\t\tposition={selectionPos}\n\t\t\t\tvisibility={selectionVis}\n\t\t\t/>\n\t\t\t<Cell\n\t\t\t\ttype=\"cell-selected\"\n\t\t\t\tposition={selectedPos}\n\t\t\t\tvisibility={selectedVis}\n\t\t\t/>\n\t\t\t<Weapons weapons={opponentsWeapons} />\n\t\t\t<Fleet\n\t\t\t\thideFleet={hideFleet}\n\t\t\t\tfleet={fleet}\n\t\t\t\tselectedBoatIndex={selectedBoatIndex}\n\t\t\t\tonSelectBoatIndex={onSelectBoatIndex}\n\t\t\t/>\n\t\t\t<Hits hits={hits} />\n\t\t</svg>\n\t);\n};\n","import { SeaBattleBoatLengthMappings } from \"./mappings\";\nimport {\n\tSeaBattleBoatData,\n\tSeaBattleGrid,\n\tSeaBattleGridCell,\n\tSeaBattlePosition,\n\tSeaBattleDirection,\n\tGRID_CELL_COUNT,\n\tAngleToDirection\n} from \".\";\n\n// ------------------------------------------------------------------\n\nexport const getGridCell = (\n\tgrid: SeaBattleGrid,\n\tpos: SeaBattlePosition\n): SeaBattleGridCell => grid[pos.y][pos.x];\n\nexport const setGridCell = (\n\tgrid: SeaBattleGrid,\n\tpos: SeaBattlePosition,\n\tcell: SeaBattleGridCell\n): void => {\n\tgrid[pos.y][pos.x] = cell;\n};\n\n// ------------------------------------------------------------------\n\nexport const checkPositionInZone = (pos: SeaBattlePosition) =>\n\tpos.x >= 0 &&\n\tpos.x < GRID_CELL_COUNT &&\n\tpos.y >= 0 &&\n\tpos.y < GRID_CELL_COUNT;\n\n// ------------------------------------------------------------------\n\nexport const checkZone = (\n\tboat: SeaBattleBoatData,\n\tnewPos: SeaBattlePosition,\n\tnewDir: SeaBattleDirection\n) => {\n\tif (!checkPositionInZone(newPos)) {\n\t\treturn false;\n\t}\n\tconst offset = SeaBattleBoatLengthMappings[boat.type] - 1;\n\tswitch (newDir) {\n\t\tcase \"N\":\n\t\t\treturn checkPositionInZone({\n\t\t\t\tx: newPos.x,\n\t\t\t\ty: newPos.y - offset\n\t\t\t});\n\t\tcase \"E\":\n\t\t\treturn checkPositionInZone({\n\t\t\t\tx: newPos.x + offset,\n\t\t\t\ty: newPos.y\n\t\t\t});\n\t\tcase \"S\":\n\t\t\treturn checkPositionInZone({\n\t\t\t\tx: newPos.x,\n\t\t\t\ty: newPos.y + offset\n\t\t\t});\n\t\tcase \"W\":\n\t\t\treturn checkPositionInZone({\n\t\t\t\tx: newPos.x - offset,\n\t\t\t\ty: newPos.y\n\t\t\t});\n\t}\n};\n\n// ------------------------------------------------------------------\n\nexport const generateGrid = (\n\tfleet: SeaBattleBoatData[],\n\tmovingBoat?: SeaBattleBoatData\n): SeaBattleGrid => {\n\tconst grid: SeaBattleGrid = Array<SeaBattleGridCell>(GRID_CELL_COUNT)\n\t\t.fill(null)\n\t\t.map(_ => Array<SeaBattleGridCell>(GRID_CELL_COUNT).fill(null));\n\tfor (\n\t\tlet boatIndex = 0, boatCount = fleet.length;\n\t\tboatIndex < boatCount;\n\t\t++boatIndex\n\t) {\n\t\tconst boat = fleet[boatIndex];\n\t\tif (movingBoat === boat) {\n\t\t\tcontinue; // Ignore moving boat\n\t\t}\n\t\tswitch (AngleToDirection(boat.angle)) {\n\t\t\tcase \"N\":\n\t\t\t\tfor (\n\t\t\t\t\tlet boatLocalIndex = 0;\n\t\t\t\t\tboatLocalIndex < SeaBattleBoatLengthMappings[boat.type];\n\t\t\t\t\t++boatLocalIndex\n\t\t\t\t) {\n\t\t\t\t\tsetGridCell(\n\t\t\t\t\t\tgrid,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tx: boat.position.x,\n\t\t\t\t\t\t\ty: boat.position.y - boatLocalIndex\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tboatIndex,\n\t\t\t\t\t\t\tboatLocalIndex,\n\t\t\t\t\t\t\ttype: \"boat\"\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase \"E\":\n\t\t\t\tfor (\n\t\t\t\t\tlet boatLocalIndex = 0;\n\t\t\t\t\tboatLocalIndex < SeaBattleBoatLengthMappings[boat.type];\n\t\t\t\t\t++boatLocalIndex\n\t\t\t\t) {\n\t\t\t\t\tsetGridCell(\n\t\t\t\t\t\tgrid,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tx: boat.position.x + boatLocalIndex,\n\t\t\t\t\t\t\ty: boat.position.y\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tboatIndex,\n\t\t\t\t\t\t\tboatLocalIndex,\n\t\t\t\t\t\t\ttype: \"boat\"\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase \"S\":\n\t\t\t\tfor (\n\t\t\t\t\tlet boatLocalIndex = 0;\n\t\t\t\t\tboatLocalIndex < SeaBattleBoatLengthMappings[boat.type];\n\t\t\t\t\t++boatLocalIndex\n\t\t\t\t) {\n\t\t\t\t\tsetGridCell(\n\t\t\t\t\t\tgrid,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tx: boat.position.x,\n\t\t\t\t\t\t\ty: boat.position.y + boatLocalIndex\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tboatIndex,\n\t\t\t\t\t\t\tboatLocalIndex,\n\t\t\t\t\t\t\ttype: \"boat\"\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase \"W\":\n\t\t\t\tfor (\n\t\t\t\t\tlet boatLocalIndex = 0;\n\t\t\t\t\tboatLocalIndex < SeaBattleBoatLengthMappings[boat.type];\n\t\t\t\t\t++boatLocalIndex\n\t\t\t\t) {\n\t\t\t\t\tsetGridCell(\n\t\t\t\t\t\tgrid,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tx: boat.position.x - boatLocalIndex,\n\t\t\t\t\t\t\ty: boat.position.y\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tboatIndex,\n\t\t\t\t\t\t\tboatLocalIndex,\n\t\t\t\t\t\t\ttype: \"boat\"\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t}\n\t}\n\treturn grid;\n};\n\n// ------------------------------------------------------------------\n\nexport const checkCollisions = (\n\tfleet: SeaBattleBoatData[],\n\tboat: SeaBattleBoatData,\n\tpos: SeaBattlePosition,\n\tdir: SeaBattleDirection\n) => {\n\tconst grid = generateGrid(fleet, boat);\n\t// console.debug(\"[SeaBattle] Collision grid\", grid);\n\tconst length = SeaBattleBoatLengthMappings[boat.type];\n\tswitch (dir) {\n\t\tcase \"N\":\n\t\t\tfor (let i = 0; i < length; ++i) {\n\t\t\t\tif (null !== getGridCell(grid, { x: pos.x, y: pos.y - i })) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t\tbreak;\n\t\tcase \"E\":\n\t\t\tfor (let i = 0; i < length; ++i) {\n\t\t\t\tif (null !== getGridCell(grid, { x: pos.x + i, y: pos.y })) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t\tbreak;\n\t\tcase \"S\":\n\t\t\tfor (let i = 0; i < length; ++i) {\n\t\t\t\tif (null !== getGridCell(grid, { x: pos.x, y: pos.y + i })) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t\tbreak;\n\t\tcase \"W\":\n\t\t\tfor (let i = 0; i < length; ++i) {\n\t\t\t\tif (null !== getGridCell(grid, { x: pos.x - i, y: pos.y })) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t\tbreak;\n\t}\n\treturn true;\n};\n\n// ------------------------------------------------------------------\n\nexport const movementIsPossible = (\n\tfleet: SeaBattleBoatData[],\n\tboat: SeaBattleBoatData,\n\tnewPos: SeaBattlePosition,\n\tnewDir: SeaBattleDirection\n) => {\n\tif (!checkZone(boat, newPos, newDir)) {\n\t\tconsole.debug(\"[SeaBattle] Boat blocked by zone\");\n\t\treturn false;\n\t}\n\tif (!checkCollisions(fleet, boat, newPos, newDir)) {\n\t\tconsole.debug(\"[SeaBattle] Boat blocked by collision\");\n\t\treturn false;\n\t}\n\treturn true;\n};\n","import { AsyncAction } from \"..\";\nimport { displayError, displaySuccess, displayInfo } from \"../messages\";\nimport { extractErrorMessage } from \"../../utils/messages\";\nimport {\n\tSeaBattleMovementType,\n\tAngleToDirection,\n\tMAX_PLAYER_COUNT,\n\tINVALID_MOVE_MESSAGE_TAG,\n\tSeaBattlePosition,\n\tSeaBattleWeaponType,\n\textractOpponentMaps,\n\tpassBatonToNextPlayer,\n\tcheckUserHasBatton,\n\tdecodeBattle,\n\tencodeBattle\n} from \"../../utils/games/seabattle\";\nimport {\n\tSeaBattleBoatTranslationMappings,\n\tSeaBattleBoatRotationTransformationMappings,\n\tSeaBattleBoatLengthMappings\n} from \"../../utils/games/seabattle/mappings\";\nimport {\n\tmovementIsPossible,\n\tgenerateGrid,\n\tgetGridCell\n} from \"../../utils/games/seabattle/collision\";\nimport { openModal } from \"../../reducers/modals\";\nimport { generateFleet } from \"../../utils/games/seabattle/generator\";\n\n// ------------------------------------------------------------------\n\nexport const joinBattle = (): AsyncAction => async (dispatch, getState) => {\n\tconst {\n\t\troom: { info, room },\n\t\tuser: {\n\t\t\taccess: { userId }\n\t\t}\n\t} = getState();\n\tif (!room || room.isLocked() || !info) {\n\t\tdispatch(displayError(\"rooms.errors.locked\"));\n\t\tdispatch(\n\t\t\topenModal({\n\t\t\t\ttype: \"UnlockRoom\",\n\t\t\t\tprops: {\n\t\t\t\t\toptions: {\n\t\t\t\t\t\tonSuccess: () => {\n\t\t\t\t\t\t\tdispatch(joinBattle());\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t);\n\t\treturn;\n\t}\n\tif (!userId) {\n\t\tconsole.debug(\"[SeaBattle] Not connected\");\n\t\tdispatch(displayError(\"users.not_connected\"));\n\t\tdispatch(\n\t\t\topenModal({\n\t\t\t\ttype: \"CreateUser\",\n\t\t\t\tprops: {\n\t\t\t\t\toptions: {\n\t\t\t\t\t\tonSuccess: () => {\n\t\t\t\t\t\t\tdispatch(joinBattle());\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t);\n\t\treturn;\n\t}\n\ttry {\n\t\tconsole.debug(\"[SeaBattle] Joining battle...\", { userId });\n\t\tconst battle = decodeBattle(info.extra);\n\t\tconst map = battle.maps.find(other => other.userId === userId);\n\t\tif (map) {\n\t\t\treturn; // User is already in the battle\n\t\t}\n\t\tif (Object.keys(battle.maps).length >= MAX_PLAYER_COUNT) {\n\t\t\tdispatch(displayError(\"games.max_players_count\"));\n\t\t\treturn;\n\t\t}\n\t\tgenerateFleet(battle, userId);\n\t\tawait room.update({\n\t\t\t...info,\n\t\t\textra: encodeBattle(battle)\n\t\t});\n\t} catch (err) {\n\t\tdispatch(displayError(extractErrorMessage(err)));\n\t}\n};\n\n// ------------------------------------------------------------------\n\nexport const moveBoat = ({\n\tboatIndex,\n\tmovement\n}: {\n\tboatIndex: number;\n\tmovement: SeaBattleMovementType;\n}): AsyncAction => async (dispatch, getState) => {\n\tconst {\n\t\troom: { info, room },\n\t\tuser: {\n\t\t\taccess: { userId }\n\t\t}\n\t} = getState();\n\tif (!room || room.isLocked() || !info) {\n\t\tdispatch(displayError(\"rooms.errors.locked\"));\n\t\tdispatch(\n\t\t\topenModal({\n\t\t\t\ttype: \"UnlockRoom\",\n\t\t\t\tprops: {\n\t\t\t\t\toptions: {\n\t\t\t\t\t\tonSuccess: () => {\n\t\t\t\t\t\t\tdispatch(moveBoat({ boatIndex, movement }));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t);\n\t\treturn;\n\t}\n\tif (!userId) {\n\t\tconsole.debug(\"[SeaBattle] Not connected\");\n\t\tdispatch(displayError(\"users.not_connected\"));\n\t\tdispatch(\n\t\t\topenModal({\n\t\t\t\ttype: \"CreateUser\",\n\t\t\t\tprops: {\n\t\t\t\t\toptions: {\n\t\t\t\t\t\tonSuccess: () => {\n\t\t\t\t\t\t\tdispatch(moveBoat({ boatIndex, movement }));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t);\n\t\treturn;\n\t}\n\ttry {\n\t\tconst battle = decodeBattle(info.extra);\n\n\t\tconst playerMap = battle.maps.find(other => other.userId === userId);\n\t\tif (!playerMap) {\n\t\t\tconsole.debug(\"[SeaBattle] Cannot find map for current user\");\n\t\t\treturn;\n\t\t}\n\n\t\tif (!checkUserHasBatton(battle, userId)) {\n\t\t\tdispatch(displayError(\"games.seabattle.not_your_turn\"));\n\t\t\treturn;\n\t\t}\n\n\t\tconst { fleet } = playerMap;\n\t\tif (boatIndex < 0 || boatIndex >= fleet.length) {\n\t\t\tconsole.debug(\"[SeaBattle] No boat selected\");\n\t\t\treturn;\n\t\t}\n\n\t\tconst { angle: oldAngle, position: oldPosition, type } = fleet[\n\t\t\tboatIndex\n\t\t];\n\n\t\tconst oldDirection = AngleToDirection(oldAngle);\n\n\t\tlet newPosition = { ...oldPosition };\n\t\tif (movement === \"move-forward\" || movement === \"move-backward\") {\n\t\t\tnewPosition.x +=\n\t\t\t\tSeaBattleBoatTranslationMappings[oldDirection][movement].x;\n\t\t\tnewPosition.y +=\n\t\t\t\tSeaBattleBoatTranslationMappings[oldDirection][movement].y;\n\t\t}\n\n\t\tlet newAngle = oldAngle;\n\t\tlet newDirection = oldDirection;\n\t\tif (movement === \"rotate-left\" || movement === \"rotate-right\") {\n\t\t\tif (movement === \"rotate-left\") {\n\t\t\t\tnewAngle--;\n\t\t\t}\n\t\t\tif (movement === \"rotate-right\") {\n\t\t\t\tnewAngle++;\n\t\t\t}\n\t\t\tnewDirection = AngleToDirection(newAngle);\n\t\t\tnewPosition.x +=\n\t\t\t\tSeaBattleBoatRotationTransformationMappings[type][\n\t\t\t\t\toldDirection\n\t\t\t\t].x;\n\t\t\tnewPosition.y +=\n\t\t\t\tSeaBattleBoatRotationTransformationMappings[type][\n\t\t\t\t\toldDirection\n\t\t\t\t].y;\n\t\t}\n\n\t\tconst boat = fleet[boatIndex];\n\t\tif (boat.hits.find(hit => hit.type === \"hitted\")) {\n\t\t\tdispatch(\n\t\t\t\tdisplayError(\n\t\t\t\t\t\"games.seabattle.movement_not_possible_because_hitted\",\n\t\t\t\t\t{\n\t\t\t\t\t\ttag: INVALID_MOVE_MESSAGE_TAG\n\t\t\t\t\t}\n\t\t\t\t)\n\t\t\t);\n\t\t\treturn;\n\t\t}\n\n\t\tif (!movementIsPossible(fleet, boat, newPosition, newDirection)) {\n\t\t\tconsole.debug(\"[SeaBattle] Movement is not possible...\", {\n\t\t\t\tboatIndex,\n\t\t\t\tmovement,\n\t\t\t\toldDirection,\n\t\t\t\tnewDirection,\n\t\t\t\toldPosition,\n\t\t\t\tnewPosition\n\t\t\t});\n\t\t\tdispatch(\n\t\t\t\tdisplayError(\"games.seabattle.movement_not_possible\", {\n\t\t\t\t\ttag: INVALID_MOVE_MESSAGE_TAG\n\t\t\t\t})\n\t\t\t);\n\t\t\treturn;\n\t\t}\n\n\t\tconsole.debug(\"[SeaBattle] Moving boat...\", {\n\t\t\tboatIndex,\n\t\t\tmovement,\n\t\t\toldDirection,\n\t\t\toldPosition,\n\t\t\tnewDirection,\n\t\t\tnewPosition\n\t\t});\n\n\t\t// Alter battle\n\t\tboat.angle = newAngle;\n\t\tboat.position = newPosition;\n\t\tpassBatonToNextPlayer(battle);\n\t\tawait room.update({\n\t\t\t...info,\n\t\t\textra: encodeBattle(battle)\n\t\t});\n\t} catch (err) {\n\t\tdispatch(displayError(extractErrorMessage(err)));\n\t}\n};\n\n// ------------------------------------------------------------------\n\nexport const attackOpponent = ({\n\topponentIndex,\n\tposition,\n\tweaponType\n}: {\n\topponentIndex: number;\n\tposition: SeaBattlePosition;\n\tweaponType: SeaBattleWeaponType;\n}): AsyncAction => async (dispatch, getState) => {\n\tconst {\n\t\troom: { info, room },\n\t\tuser: {\n\t\t\taccess: { userId }\n\t\t}\n\t} = getState();\n\tif (!room || room.isLocked() || !info) {\n\t\tdispatch(displayError(\"rooms.errors.locked\"));\n\t\tdispatch(\n\t\t\topenModal({\n\t\t\t\ttype: \"UnlockRoom\",\n\t\t\t\tprops: {\n\t\t\t\t\toptions: {\n\t\t\t\t\t\tonSuccess: () => {\n\t\t\t\t\t\t\tdispatch(\n\t\t\t\t\t\t\t\tattackOpponent({\n\t\t\t\t\t\t\t\t\topponentIndex,\n\t\t\t\t\t\t\t\t\tposition,\n\t\t\t\t\t\t\t\t\tweaponType\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t);\n\t\treturn;\n\t}\n\tif (!userId) {\n\t\tconsole.debug(\"[SeaBattle] Not connected\");\n\t\tdispatch(displayError(\"users.not_connected\"));\n\t\tdispatch(\n\t\t\topenModal({\n\t\t\t\ttype: \"CreateUser\",\n\t\t\t\tprops: {\n\t\t\t\t\toptions: {\n\t\t\t\t\t\tonSuccess: () => {\n\t\t\t\t\t\t\tdispatch(\n\t\t\t\t\t\t\t\tattackOpponent({\n\t\t\t\t\t\t\t\t\topponentIndex,\n\t\t\t\t\t\t\t\t\tposition,\n\t\t\t\t\t\t\t\t\tweaponType\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t);\n\t\treturn;\n\t}\n\ttry {\n\t\tconst battle = decodeBattle(info.extra);\n\n\t\tconst playerMap = battle.maps.find(other => other.userId === userId);\n\t\tif (!playerMap) {\n\t\t\tconsole.debug(\"[SeaBattle] Cannot find map for current user\");\n\t\t\treturn;\n\t\t}\n\t\tif (!checkUserHasBatton(battle, userId)) {\n\t\t\tdispatch(displayError(\"games.seabattle.not_your_turn\"));\n\t\t\treturn;\n\t\t}\n\n\t\tconst weaponCount = playerMap.weapons[weaponType];\n\t\tif (weaponCount <= 0) {\n\t\t\tdispatch(displayInfo(\"games.seabattle.weapon_not_available\"));\n\t\t\treturn;\n\t\t}\n\n\t\tconst opponentMaps = extractOpponentMaps(battle.maps, userId);\n\t\tif (opponentIndex < 0 || opponentIndex >= opponentMaps.length) {\n\t\t\tconsole.debug(\"[SeaBattle] Cannot find opponent map\");\n\t\t\treturn;\n\t\t}\n\t\tconst opponentMap = opponentMaps[opponentIndex];\n\t\tif (opponentMap.userId === userId) {\n\t\t\tconsole.debug(\"[SeaBattle] Invalid opponent map\");\n\t\t\treturn;\n\t\t}\n\t\tif (opponentMap.status === \"ko\") {\n\t\t\tdispatch(displayError(\"games.seabattle.opponent_already_killed\"));\n\t\t\treturn;\n\t\t}\n\n\t\tconsole.debug(\"[SeaBattle] Attacking opponent...\", {\n\t\t\topponentIndex,\n\t\t\tposition,\n\t\t\tweaponType\n\t\t});\n\n\t\tconst grid = generateGrid(opponentMap.fleet);\n\t\tconst cell = getGridCell(grid, position);\n\n\t\t// Alter battle\n\t\tif (null === cell) {\n\t\t\tdispatch(displayError(\"games.seabattle.missed_opponent\"));\n\t\t\topponentMap.hits.push({\n\t\t\t\tposition,\n\t\t\t\ttype: \"missed\"\n\t\t\t});\n\t\t} else {\n\t\t\tif (cell.type === \"boat\") {\n\t\t\t\tconst opponentBoat = opponentMap.fleet[cell.boatIndex];\n\t\t\t\tif (opponentBoat.status === \"ko\") {\n\t\t\t\t\tdispatch(\n\t\t\t\t\t\tdisplayError(\"games.seabattle.ship_already_killed\")\n\t\t\t\t\t);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst hit = opponentBoat.hits.find(\n\t\t\t\t\thit => hit.position.x === cell.boatLocalIndex\n\t\t\t\t);\n\t\t\t\tif (hit) {\n\t\t\t\t\tdispatch(\n\t\t\t\t\t\tdisplayError(\"games.seabattle.ship_already_hitted\")\n\t\t\t\t\t);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\topponentBoat.hits.push({\n\t\t\t\t\tposition: {\n\t\t\t\t\t\tx: cell.boatLocalIndex,\n\t\t\t\t\t\ty: 0\n\t\t\t\t\t},\n\t\t\t\t\ttype: \"hitted\"\n\t\t\t\t});\n\t\t\t\tif (\n\t\t\t\t\topponentBoat.hits.length ===\n\t\t\t\t\tSeaBattleBoatLengthMappings[opponentBoat.type]\n\t\t\t\t) {\n\t\t\t\t\tdispatch(\n\t\t\t\t\t\tdisplaySuccess(\"games.seabattle.killed_opponent_boat\")\n\t\t\t\t\t);\n\t\t\t\t\topponentBoat.status = \"ko\";\n\n\t\t\t\t\tif (!opponentMap.fleet.find(boat => boat.status === \"ok\")) {\n\t\t\t\t\t\tdispatch(\n\t\t\t\t\t\t\tdisplaySuccess(\"games.seabattle.killed_opponent\")\n\t\t\t\t\t\t);\n\t\t\t\t\t\topponentMap.status = \"ko\";\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tdispatch(displaySuccess(\"games.seabattle.hitted_opponent\"));\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tdispatch(displaySuccess(\"games.seabattle.hitted_weapon\")); // TODO: for example a mine\n\t\t\t}\n\t\t}\n\t\tplayerMap.weapons[weaponType]--;\n\t\tpassBatonToNextPlayer(battle);\n\t\tawait room.update({\n\t\t\t...info,\n\t\t\textra: encodeBattle(battle)\n\t\t});\n\t} catch (err) {\n\t\tdispatch(displayError(extractErrorMessage(err)));\n\t}\n};\n","import React, { FC } from \"react\";\n//\nimport { IconButton } from \"../Common/IconButton\";\nimport { useTranslation } from \"react-i18next\";\n\n// ------------------------------------------------------------------\n\nexport const OpponentSelection: FC<{\n\topponentsCount: number;\n\topponentIndex: number;\n\tonSelectPreviousOpponent?: () => void;\n\tonSelectNextOpponent?: () => void;\n}> = ({\n\topponentsCount,\n\topponentIndex,\n\tonSelectPreviousOpponent,\n\tonSelectNextOpponent\n}) => {\n\tconst { t } = useTranslation();\n\n\treturn opponentsCount > 0 ? (\n\t\t<div className=\"SeaBattleOpponentSelection\">\n\t\t\t<IconButton\n\t\t\t\tdisabled={opponentsCount <= 1}\n\t\t\t\ticon=\"caret-left\"\n\t\t\t\ttitle=\"Previous enemy\"\n\t\t\t\tonClick={onSelectPreviousOpponent}\n\t\t\t/>\n\t\t\t<span className=\"SeaBattleOpponentSelectionLabel\">\n\t\t\t\t{t(\"games.seabattle.opponent_index\", {\n\t\t\t\t\tindex: `${opponentIndex + 1} / ${opponentsCount}`\n\t\t\t\t})}\n\t\t\t</span>\n\t\t\t<IconButton\n\t\t\t\tdisabled={opponentsCount <= 1}\n\t\t\t\ticon=\"caret-right\"\n\t\t\t\ttitle=\"Next enemy\"\n\t\t\t\tonClick={onSelectNextOpponent}\n\t\t\t/>\n\t\t</div>\n\t) : (\n\t\t<div className=\"SeaBattleOpponentSelection\">\n\t\t\t<span className=\"SeaBattleOpponentSelectionLabel\">\n\t\t\t\t{t(\"games.no_opponents\")}\n\t\t\t</span>\n\t\t</div>\n\t);\n};\n","import React, { FC, useRef, useCallback, useState } from \"react\";\n//\nimport { getSVGNormalizedPosition } from \"../../utils/svg\";\nimport { BattleAssets } from \"./BattleAssets\";\nimport { Cell } from \"./Assets\";\nimport { Weapons } from \"./Weapons\";\nimport {\n\tSeaBattleAssetVisibility,\n\tSeaBattlePosition,\n\tSeaBattleWeaponTypes,\n\tSeaBattleWeaponType\n} from \"../../utils/games/seabattle\";\n\n// ------------------------------------------------------------------\n\nexport const WeaponSelection: FC<{\n\tonSelect: (type: SeaBattleWeaponType) => void;\n\tweapons: { [type: string]: number };\n\tweaponType: SeaBattleWeaponType;\n}> = ({ onSelect, weapons, weaponType }) => {\n\tconst svg = useRef<SVGSVGElement>(null);\n\n\tconst [selectedPos, setSelectedPos] = useState<number>(\n\t\tSeaBattleWeaponTypes.indexOf(weaponType)\n\t);\n\tconst [selectedVis, setSelectedVis] = useState<SeaBattleAssetVisibility>(\n\t\tselectedPos >= 0 ? \"visible\" : \"hidden\"\n\t);\n\n\tconst [selectionPos, setSelectionPos] = useState<number>(-1);\n\tconst [selectionVis, setSelectionVis] = useState<SeaBattleAssetVisibility>(\n\t\t\"hidden\"\n\t);\n\n\tconst onClick = useCallback(\n\t\t(position: SeaBattlePosition) => {\n\t\t\tconst { x } = getSVGNormalizedPosition(svg.current!, position);\n\t\t\tif (selectedPos !== x) {\n\t\t\t\t// Set\n\t\t\t\tsetSelectedPos(x);\n\t\t\t\tsetSelectedVis(\"visible\");\n\t\t\t\tonSelect(SeaBattleWeaponTypes[x]);\n\t\t\t}\n\t\t},\n\t\t[onSelect, selectedPos]\n\t);\n\n\tconst onLeave = useCallback(() => {\n\t\tsetSelectionVis(\"hidden\");\n\t}, []);\n\n\tconst onOver = useCallback((position: SeaBattlePosition) => {\n\t\tsetSelectionPos(getSVGNormalizedPosition(svg.current!, position).x);\n\t\tsetSelectionVis(\"visible\");\n\t}, []);\n\n\treturn (\n\t\t<svg\n\t\t\tclassName=\"SeaBattleWeaponSelection\"\n\t\t\tviewBox=\"0 0 160 40\"\n\t\t\tref={svg}\n\t\t\tonClick={e => onClick({ x: e.clientX, y: e.clientY })}\n\t\t\tonMouseLeave={onLeave}\n\t\t\tonMouseMove={e => onOver({ x: e.clientX, y: e.clientY })}>\n\t\t\t<BattleAssets />\n\t\t\t<rect width=\"400\" height=\"400\" fill=\"url(#sea-grid)\" />\n\t\t\t<Cell\n\t\t\t\ttype=\"cell-selection\"\n\t\t\t\tposition={{ x: selectionPos, y: 0 }}\n\t\t\t\tvisibility={selectionVis}\n\t\t\t/>\n\t\t\t<Cell\n\t\t\t\ttype=\"cell-selected\"\n\t\t\t\tposition={{ x: selectedPos, y: 0 }}\n\t\t\t\tvisibility={selectedVis}\n\t\t\t/>\n\t\t\t<Weapons\n\t\t\t\tweapons={SeaBattleWeaponTypes.map((type, index) => ({\n\t\t\t\t\topponentId: \"\",\n\t\t\t\t\tposition: { x: index, y: 0 },\n\t\t\t\t\ttype\n\t\t\t\t}))}\n\t\t\t/>\n\t\t\t{SeaBattleWeaponTypes.map((type, index) => (\n\t\t\t\t<Cell\n\t\t\t\t\tkey={index}\n\t\t\t\t\ttype=\"cell-crossed\"\n\t\t\t\t\tposition={{ x: index, y: 0 }}\n\t\t\t\t\tvisibility={!weapons[type] ? \"visible\" : \"hidden\"}\n\t\t\t\t/>\n\t\t\t))}\n\t\t</svg>\n\t);\n};\n","import React, { FC } from \"react\";\n//\nimport { OpponentSelection } from \"./OpponentSelection\";\nimport { WeaponSelection } from \"./WeaponSelection\";\nimport { SeaBattleWeaponType } from \"../../utils/games/seabattle\";\n\n// ------------------------------------------------------------------\n\nexport const SeaBattleOpponentControls: FC<{\n\topponentsCount: number;\n\topponentIndex: number;\n\tonSelectPreviousOpponent?: () => void;\n\tonSelectNextOpponent?: () => void;\n\tonSelectWeaponType: (type: SeaBattleWeaponType) => void;\n\tweapons: { [type: string]: number };\n\tweaponType: SeaBattleWeaponType;\n}> = ({\n\topponentsCount,\n\topponentIndex,\n\tonSelectPreviousOpponent,\n\tonSelectNextOpponent,\n\tonSelectWeaponType,\n\tweapons,\n\tweaponType\n}) => (\n\t<div className=\"SeaBattleOpponentControls SeaBattleControls\">\n\t\t<OpponentSelection\n\t\t\topponentsCount={opponentsCount}\n\t\t\topponentIndex={opponentIndex}\n\t\t\tonSelectPreviousOpponent={onSelectPreviousOpponent}\n\t\t\tonSelectNextOpponent={onSelectNextOpponent}\n\t\t/>\n\t\t<WeaponSelection\n\t\t\tonSelect={onSelectWeaponType}\n\t\t\tweapons={weapons}\n\t\t\tweaponType={weaponType}\n\t\t/>\n\t</div>\n);\n","import React, { FC, useState, useEffect, useCallback } from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { useTranslation } from \"react-i18next\";\n//\nimport { SeaBattlePlayerControls } from \"../../components/SeaBattle/PlayerControls\";\nimport { Map } from \"../../components/SeaBattle/Map\";\nimport { RootState } from \"../../reducers\";\nimport { SeaBattleKeyboardMoveMappings } from \"../../utils/games/seabattle/mappings\";\nimport { Dispatch } from \"../../actions\";\nimport {\n\tmoveBoat,\n\tjoinBattle,\n\tattackOpponent\n} from \"../../actions/games/seabattle\";\nimport { KEY_UP, KEY_DOWN, KEY_LEFT, KEY_RIGHT } from \"../../utils/keyboards\";\nimport { SeaBattleOpponentControls } from \"../../components/SeaBattle/OpponentControls\";\nimport { IconButton } from \"../../components/Common/IconButton\";\nimport {\n\textractBattleInfo,\n\tMAX_PLAYER_COUNT,\n\tSeaBattleMovementType,\n\tSeaBattlePosition,\n\tSeaBattleWeaponType,\n\tAngleToDirection,\n\tPLAYER_TURN_MESSAGE_TAG\n} from \"../../utils/games/seabattle\";\nimport { displayInfo } from \"../../actions/messages\";\nimport { openModal } from \"../../reducers/modals\";\nimport \"./SeaBattle.scss\";\nimport { clearMessages } from \"../../reducers/messages\";\n\n// ------------------------------------------------------------------\n\nexport const SeaBattle: FC = () => {\n\tconst dispatch = useDispatch<Dispatch>();\n\tconst { t } = useTranslation();\n\tconst [previousMapIndex, setPreviousMapIndex] = useState<number>(-1);\n\tconst [boatIndex, setSelectedBoatIndex] = useState<number>(-1);\n\tconst [opponentIndex, setSelectedOpponent] = useState<number>(0);\n\tconst [weaponType, setSelectedWeaponType] = useState<SeaBattleWeaponType>(\n\t\t\"bullet1\"\n\t);\n\n\tconst userId = useSelector<RootState, string>(\n\t\tstate => state.user.access.userId\n\t);\n\n\tconst extra = useSelector<RootState, string>(\n\t\tstate => state.room.info?.extra || \"\"\n\t);\n\n\tconst {\n\t\tboat,\n\t\tcurrentMapIndex,\n\t\topponentMaps,\n\t\tplayerMap,\n\t\tplayerMapIndex\n\t} = extractBattleInfo({\n\t\textra,\n\t\tuserId,\n\t\tboatIndex\n\t});\n\n\tconst onJoinBattle = useCallback(() => {\n\t\tdispatch(joinBattle());\n\t}, [dispatch]);\n\n\tconst onMove = useCallback(\n\t\t(movement: SeaBattleMovementType) => {\n\t\t\tdispatch(\n\t\t\t\tmoveBoat({\n\t\t\t\t\tboatIndex,\n\t\t\t\t\tmovement\n\t\t\t\t})\n\t\t\t);\n\t\t},\n\t\t[dispatch, boatIndex]\n\t);\n\n\tconst onKeyDown = useCallback(\n\t\t(e: KeyboardEvent) => {\n\t\t\tif (\n\t\t\t\te.repeat ||\n\t\t\t\t(e.keyCode !== KEY_UP &&\n\t\t\t\t\te.keyCode !== KEY_DOWN &&\n\t\t\t\t\te.keyCode !== KEY_LEFT &&\n\t\t\t\t\te.keyCode !== KEY_RIGHT)\n\t\t\t) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\te.preventDefault(); // to prevent scrolling with keyboard\n\t\t\tif (!boat) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tonMove(\n\t\t\t\tSeaBattleKeyboardMoveMappings[AngleToDirection(boat.angle)][\n\t\t\t\t\te.keyCode\n\t\t\t\t]\n\t\t\t);\n\t\t},\n\t\t[onMove, boat]\n\t);\n\n\tconst onConnectUser = useCallback(\n\t\t() => dispatch(openModal({ type: \"CreateUser\", props: {} })),\n\t\t[dispatch]\n\t);\n\n\tconst onOpponentCellClick = useCallback(\n\t\t(position: SeaBattlePosition) => {\n\t\t\tif (!opponentMaps || opponentMaps.length === 0) {\n\t\t\t\tdispatch(displayInfo(\"games.no_opponents_to_attack\"));\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (!weaponType) {\n\t\t\t\tdispatch(displayInfo(\"games.seabattle.no_weapon_selected\"));\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tdispatch(attackOpponent({ opponentIndex, position, weaponType }));\n\t\t},\n\t\t[dispatch, opponentIndex, opponentMaps, weaponType]\n\t);\n\n\tuseEffect(() => {\n\t\tdocument.addEventListener(\"keydown\", onKeyDown);\n\n\t\treturn () => {\n\t\t\tdocument.removeEventListener(\"keydown\", onKeyDown);\n\t\t};\n\t}, [onKeyDown]);\n\n\tuseEffect(() => {\n\t\tif (previousMapIndex !== currentMapIndex) {\n\t\t\tdispatch(clearMessages(PLAYER_TURN_MESSAGE_TAG));\n\t\t\tif (currentMapIndex === playerMapIndex) {\n\t\t\t\tif (playerMap?.status === \"ko\") {\n\t\t\t\t\tdispatch(\n\t\t\t\t\t\tdisplayInfo(\"games.seabattle.you_have_been_killed\")\n\t\t\t\t\t);\n\t\t\t\t} else if (opponentMaps && opponentMaps.length > 0) {\n\t\t\t\t\t// More than one player...\n\t\t\t\t\tdispatch(\n\t\t\t\t\t\tdisplayInfo(\"games.seabattle.player_turn\", {\n\t\t\t\t\t\t\tautoclear: false,\n\t\t\t\t\t\t\tclosable: false,\n\t\t\t\t\t\t\ttag: PLAYER_TURN_MESSAGE_TAG,\n\t\t\t\t\t\t\tweight: 1000000\n\t\t\t\t\t\t})\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tdispatch(\n\t\t\t\t\tdisplayInfo(\"games.seabattle.opponent_turn\", {\n\t\t\t\t\t\tautoclear: false,\n\t\t\t\t\t\tclosable: false,\n\t\t\t\t\t\ttag: PLAYER_TURN_MESSAGE_TAG,\n\t\t\t\t\t\tweight: 1000000\n\t\t\t\t\t})\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t\tsetPreviousMapIndex(currentMapIndex);\n\t}, [\n\t\tcurrentMapIndex,\n\t\tdispatch,\n\t\topponentMaps,\n\t\tplayerMap,\n\t\tplayerMapIndex,\n\t\tpreviousMapIndex\n\t]);\n\n\treturn (\n\t\t<div className=\"SeaBattle\">\n\t\t\t<div className=\"SeaBattlePlayer current\">\n\t\t\t\t<SeaBattlePlayerControls\n\t\t\t\t\tboat={boat}\n\t\t\t\t\tdisabled={!boat}\n\t\t\t\t\tonMoveForward={() => onMove(\"move-forward\")}\n\t\t\t\t\tonMoveBackward={() => onMove(\"move-backward\")}\n\t\t\t\t\tonRotateLeft={() => onMove(\"rotate-left\")}\n\t\t\t\t\tonRotateRight={() => onMove(\"rotate-right\")}\n\t\t\t\t/>\n\t\t\t\t{playerMap ? (\n\t\t\t\t\t<Map\n\t\t\t\t\t\tmap={playerMap}\n\t\t\t\t\t\thideFleet={false}\n\t\t\t\t\t\tselectedBoatIndex={boatIndex}\n\t\t\t\t\t\tonSelectBoatIndex={setSelectedBoatIndex}\n\t\t\t\t\t/>\n\t\t\t\t) : (\n\t\t\t\t\t<div className=\"SeaBattleJoin\">\n\t\t\t\t\t\t{opponentMaps &&\n\t\t\t\t\t\topponentMaps.length >= MAX_PLAYER_COUNT ? (\n\t\t\t\t\t\t\t<span>{t(\"games.max_players_count\")}</span>\n\t\t\t\t\t\t) : !userId ? (\n\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t<span>{t(\"games.connect_to_join\")}</span>\n\t\t\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\t\t\ticon=\"sign-in\"\n\t\t\t\t\t\t\t\t\ttitle={t(\"users.connect\")}\n\t\t\t\t\t\t\t\t\tsize=\"L\"\n\t\t\t\t\t\t\t\t\tdisplayTitle={true}\n\t\t\t\t\t\t\t\t\tonClick={onConnectUser}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t<span>{t(\"games.watch_or_join\")}</span>\n\t\t\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\t\t\ticon=\"sign-in\"\n\t\t\t\t\t\t\t\t\ttitle={t(\"games.seabattle.join_battle\")}\n\t\t\t\t\t\t\t\t\tsize=\"L\"\n\t\t\t\t\t\t\t\t\tdisplayTitle={true}\n\t\t\t\t\t\t\t\t\tonClick={onJoinBattle}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</div>\n\t\t\t\t)}\n\t\t\t</div>\n\t\t\t<div className=\"SeaBattlePlayer other\">\n\t\t\t\t<SeaBattleOpponentControls\n\t\t\t\t\topponentsCount={opponentMaps?.length || 0}\n\t\t\t\t\topponentIndex={opponentIndex}\n\t\t\t\t\tonSelectPreviousOpponent={\n\t\t\t\t\t\topponentMaps && opponentMaps.length > 0\n\t\t\t\t\t\t\t? () =>\n\t\t\t\t\t\t\t\t\tsetSelectedOpponent(\n\t\t\t\t\t\t\t\t\t\topponentIndex === 0\n\t\t\t\t\t\t\t\t\t\t\t? opponentMaps.length - 1\n\t\t\t\t\t\t\t\t\t\t\t: opponentIndex - 1\n\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t: void 0\n\t\t\t\t\t}\n\t\t\t\t\tonSelectNextOpponent={\n\t\t\t\t\t\topponentMaps && opponentMaps.length > 0\n\t\t\t\t\t\t\t? () =>\n\t\t\t\t\t\t\t\t\tsetSelectedOpponent(\n\t\t\t\t\t\t\t\t\t\t(opponentIndex + 1) %\n\t\t\t\t\t\t\t\t\t\t\topponentMaps?.length\n\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t: void 0\n\t\t\t\t\t}\n\t\t\t\t\tonSelectWeaponType={setSelectedWeaponType}\n\t\t\t\t\tweapons={playerMap?.weapons || {}}\n\t\t\t\t\tweaponType={weaponType}\n\t\t\t\t/>\n\t\t\t\t<Map\n\t\t\t\t\tmap={\n\t\t\t\t\t\topponentMaps && opponentMaps.length > 0\n\t\t\t\t\t\t\t? opponentMaps[opponentIndex]\n\t\t\t\t\t\t\t: void 0\n\t\t\t\t\t}\n\t\t\t\t\thideFleet={true}\n\t\t\t\t\tonCellClick={onOpponentCellClick}\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t);\n};\n","export const KEY_UP = 38;\nexport const KEY_DOWN = 40;\nexport const KEY_LEFT = 37;\nexport const KEY_RIGHT = 39;\n","import { RootState } from \"../reducers\";\n\n// ------------------------------------------------------------------\n\nexport const selectMessages = (state: RootState) =>\n\tObject.values(state.messages).sort((m1, m2) =>\n\t\tm1.weight !== m2.weight ? m1.weight - m2.weight : m1.stamp - m2.stamp\n\t);\n","import React, { FC } from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { useTranslation } from \"react-i18next\";\nimport classNames from \"classnames\";\nimport { TransitionGroup, CSSTransition } from \"react-transition-group\";\n//\nimport { Message } from \"../../utils/messages\";\nimport { selectMessages } from \"../../selectors/messages\";\nimport { RootState } from \"../../reducers\";\nimport { IconButton } from \"../Common/IconButton\";\nimport { Dispatch } from \"../../actions\";\nimport { removeMessage } from \"../../reducers/messages\";\nimport \"./Messages.scss\";\n\n// ------------------------------------------------------------------\n\nexport const Messages: FC<{\n\tclassName?: string;\n\tbottomPosition?: string;\n}> = ({ className, bottomPosition }) => {\n\tconst { t } = useTranslation();\n\tconst dispatch = useDispatch<Dispatch>();\n\tconst messages = useSelector<RootState, Message[]>(selectMessages);\n\treturn (\n\t\t<div\n\t\t\tclassName={classNames(\"Messages\", className)}\n\t\t\tstyle={{ bottom: bottomPosition }}>\n\t\t\t<TransitionGroup>\n\t\t\t\t{messages.map(({ closable, extra, id, text, type }) => (\n\t\t\t\t\t<CSSTransition\n\t\t\t\t\t\tkey={id}\n\t\t\t\t\t\tclassNames=\"Message\"\n\t\t\t\t\t\ttimeout={{ enter: 200, exit: 200 }}>\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclassName={classNames(\n\t\t\t\t\t\t\t\t\"Message\",\n\t\t\t\t\t\t\t\t\"Message-\" + type\n\t\t\t\t\t\t\t)}>\n\t\t\t\t\t\t\t<div className=\"MessageBody\">\n\t\t\t\t\t\t\t\t{text ? t(text) : null}\n\t\t\t\t\t\t\t\t{extra ? extra() : null}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t{closable ? (\n\t\t\t\t\t\t\t\t<div className=\"MessageActions\">\n\t\t\t\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\t\t\t\ticon=\"close\"\n\t\t\t\t\t\t\t\t\t\ttitle={t(\"clear\")}\n\t\t\t\t\t\t\t\t\t\tonClick={() =>\n\t\t\t\t\t\t\t\t\t\t\tdispatch(removeMessage(id))\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t) : null}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</CSSTransition>\n\t\t\t\t))}\n\t\t\t</TransitionGroup>\n\t\t</div>\n\t);\n};\n","import React, { FC, useEffect } from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { useLocation, useParams } from \"react-router-dom\";\nimport classNames from \"classnames\";\nimport qs from \"qs\";\n//\nimport { Head } from \"../components/Room/Head\";\nimport { Queue } from \"../components/Room/Queue\";\nimport { RoomControls } from \"../components/Room/RoomControls\";\nimport { RootState } from \"../reducers\";\nimport { CombinedColor } from \"../utils/colorpicker\";\nimport { exitRoom, enterRoom } from \"../actions/room\";\nimport { Dispatch } from \"../actions\";\nimport { RoomInfo } from \"../utils/rooms\";\nimport { SeaBattle } from \"./games/SeaBattle\";\nimport \"./Room.scss\";\nimport { Messages } from \"../components/Common/Messages\";\n\n// ------------------------------------------------------------------\n\nexport const Room: FC = () => {\n\tconst dispatch = useDispatch<Dispatch>();\n\tconst { fg, bg } = useSelector<RootState, CombinedColor>(\n\t\tstate => state.room.color\n\t);\n\tconst info = useSelector<RootState, RoomInfo | null>(\n\t\tstate => state.room.info\n\t);\n\n\tconst { search } = useLocation();\n\tconst { db_id, room_id } = useParams<{\n\t\tdb_id: string;\n\t\troom_id: string;\n\t}>();\n\n\tconst { secret } = qs.parse(search.substr(1)) as {\n\t\tsecret?: string;\n\t};\n\n\tuseEffect(() => {\n\t\tdispatch(enterRoom(db_id, room_id, secret || \"\"));\n\n\t\treturn () => {\n\t\t\tdispatch(exitRoom());\n\t\t};\n\t}, [dispatch, db_id, room_id, secret]);\n\n\tuseEffect(() => {\n\t\tdocument.body.className = fg;\n\t\tdocument.body.style.backgroundColor = `rgb(${bg.r}, ${bg.g}, ${bg.b})`;\n\t}, [bg, fg]);\n\n\treturn (\n\t\t<div className={classNames(\"Room\")}>\n\t\t\t<Head />\n\t\t\t{(() => {\n\t\t\t\tif (!info) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\t\t\t\tswitch (info.type) {\n\t\t\t\t\tcase \"blind\":\n\t\t\t\t\t\treturn null;\n\t\t\t\t\tcase \"dj\":\n\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t<Queue />\n\t\t\t\t\t\t\t\t<RoomControls\n\t\t\t\t\t\t\t\t\textended={true}\n\t\t\t\t\t\t\t\t\tpropagate={true}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t<Messages\n\t\t\t\t\t\t\t\t\tclassName=\"QueueMessages\"\n\t\t\t\t\t\t\t\t\tbottomPosition=\"120px\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t);\n\t\t\t\t\tcase \"seabattle\":\n\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t<SeaBattle />\n\t\t\t\t\t\t\t\t<RoomControls\n\t\t\t\t\t\t\t\t\textended={false}\n\t\t\t\t\t\t\t\t\tpropagate={false}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t<Messages\n\t\t\t\t\t\t\t\t\tclassName=\"SeaBattleMessages\"\n\t\t\t\t\t\t\t\t\tbottomPosition=\"50px\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t})()}\n\t\t</div>\n\t);\n};\n","import { encode, decode } from \"./encoder\";\n\n// ------------------------------------------------------------------\n\nexport type UserInfo = {\n\tname: string;\n\tonline: boolean;\n\tstatus: string;\n\ttimestamp: number;\n};\n\nexport type UserAccess = {\n\tdbId: string;\n\tuserId: string;\n\tsecret: string;\n};\n\n// ------------------------------------------------------------------\n\nexport const loadUserAccess = (): UserAccess => {\n\tconst res: UserAccess = {\n\t\tdbId: \"\",\n\t\tuserId: \"\",\n\t\tsecret: \"\"\n\t};\n\tconst s = localStorage.getItem(\"U\");\n\tif (s) {\n\t\ttry {\n\t\t\tconst d = decode<UserAccess>(s);\n\t\t\tif (\n\t\t\t\ttypeof d.dbId === \"string\" &&\n\t\t\t\ttypeof d.userId === \"string\" &&\n\t\t\t\ttypeof d.secret === \"string\"\n\t\t\t) {\n\t\t\t\tres.dbId = d.dbId;\n\t\t\t\tres.userId = d.userId;\n\t\t\t\tres.secret = d.secret;\n\t\t\t\tconsole.debug(\"Loaded user access: \", res);\n\t\t\t}\n\t\t} catch (err) {}\n\t}\n\treturn res;\n};\n\nexport const deleteUserAccess = () => {\n\tlocalStorage.removeItem(\"U\");\n};\n\nexport const saveUserAccess = (access: UserAccess) =>\n\tlocalStorage.setItem(\"U\", encode<UserAccess>(access));\n","import { Reducer } from \"redux\";\nimport { AxiosError } from \"axios\";\nimport {\n\tdeleteUserAccess,\n\tsaveUserAccess,\n\tloadUserAccess,\n\tUserAccess,\n\tUserInfo\n} from \"../utils/users\";\nimport { FirebaseUser } from \"../utils/firebase\";\nimport { createAction } from \"../actions\";\n\n// ------------------------------------------------------------------\n\ntype UserAction =\n\t| ReturnType<typeof fetching>\n\t| ReturnType<typeof error>\n\t| ReturnType<typeof resetUser>\n\t| ReturnType<typeof setUser>;\n\nexport const fetching = () => createAction(\"user/FETCHING\");\nexport const error = (error: AxiosError) => createAction(\"user/ERROR\", error);\nexport const resetUser = () => createAction(\"user/RESET\");\nexport const setUser = (values: Partial<UserData>) =>\n\tcreateAction(\"user/SET\", values);\n\n// ------------------------------------------------------------------\n\nexport type UserData = {\n\tuser: ReturnType<typeof FirebaseUser> | null;\n\taccess: UserAccess;\n\tinfo: UserInfo | null;\n};\n\nexport type State = UserData & {\n\tfetching: boolean;\n\terror: null | AxiosError;\n};\n\nconst INITIAL_STATE: State = {\n\taccess: { dbId: \"\", userId: \"\", secret: \"\" },\n\terror: null,\n\tfetching: false,\n\tinfo: null,\n\tuser: null\n};\n\n// ------------------------------------------------------------------\n\nexport const userReducer: Reducer<State, UserAction> = (\n\tstate = { ...INITIAL_STATE, access: loadUserAccess() },\n\taction: UserAction\n): State => {\n\tswitch (action.type) {\n\t\tcase \"user/FETCHING\":\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tfetching: true,\n\t\t\t\terror: null\n\t\t\t};\n\t\tcase \"user/ERROR\":\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tfetching: false,\n\t\t\t\terror: action.payload\n\t\t\t};\n\t\tcase \"user/SET\": {\n\t\t\tconst copy = {\n\t\t\t\t...state,\n\t\t\t\t...action.payload,\n\t\t\t\tfetching: false,\n\t\t\t\terror: null\n\t\t\t};\n\t\t\tsaveUserAccess(copy.access);\n\t\t\treturn copy;\n\t\t}\n\t\tcase \"user/RESET\":\n\t\t\tdeleteUserAccess();\n\t\t\treturn INITIAL_STATE;\n\t\tdefault:\n\t\t\treturn state;\n\t}\n};\n","import { v4 } from \"uuid\";\n//\nimport { AsyncAction, ActionOptions } from \".\";\nimport { UserInfo } from \"../utils/users\";\nimport { FirebaseUser } from \"../utils/firebase\";\nimport { displayError } from \"./messages\";\nimport { extractErrorMessage } from \"../utils/messages\";\nimport { setUser, resetUser } from \"../reducers/user\";\n\n// ------------------------------------------------------------------\n\nexport const createUser = (\n\tdbId: string,\n\tname: string,\n\tsecret: string,\n\toptions?: ActionOptions\n): AsyncAction => async dispatch => {\n\ttry {\n\t\tconsole.debug(\"[User] Creating...\");\n\t\tconst userId = v4();\n\t\tawait FirebaseUser({ dbId, userId, secret }).update({ name });\n\t\tdispatch(connectUser(dbId, userId, secret, options));\n\t} catch (err) {\n\t\tdispatch(displayError(extractErrorMessage(err)));\n\t}\n};\n\n// ------------------------------------------------------------------\n\nlet FIREBASE_CB: any = null;\n\nexport const connectUser = (\n\tdbId: string,\n\tuserId: string,\n\tsecret: string,\n\toptions?: ActionOptions\n): AsyncAction => async (dispatch, getState) => {\n\tconst {\n\t\tuser: { user }\n\t} = getState();\n\tif (user && user.dbId === dbId && user.userId === userId) {\n\t\t// Nothing to do\n\t\treturn;\n\t}\n\tdispatch(disconnectUser());\n\ttry {\n\t\tconsole.debug(\"[User] Connecting...\", { dbId, userId, secret });\n\t\tconst newUser = FirebaseUser({ dbId, userId, secret });\n\t\tdispatch(\n\t\t\tsetUser({\n\t\t\t\taccess: { dbId, userId, secret },\n\t\t\t\tuser: newUser,\n\t\t\t\tinfo: await newUser.wait()\n\t\t\t})\n\t\t);\n\t\tFIREBASE_CB = newUser.subscribe(\n\t\t\t(snapshot: firebase.database.DataSnapshot) => {\n\t\t\t\tconst newInfo = snapshot.val() as UserInfo | null;\n\t\t\t\tconsole.debug(\"[User] Received user update...\", newInfo);\n\t\t\t\tdispatch(setUser({ user: newUser, info: newInfo }));\n\t\t\t}\n\t\t);\n\t\tif (options && options.onSuccess) {\n\t\t\toptions.onSuccess();\n\t\t}\n\t} catch (err) {\n\t\tdispatch(displayError(extractErrorMessage(err)));\n\t\tdispatch(disconnectUser());\n\t}\n};\n\nexport const disconnectUser = (): AsyncAction => async (dispatch, getState) => {\n\tconst {\n\t\tuser: {\n\t\t\taccess: { dbId, userId, secret },\n\t\t\tuser\n\t\t}\n\t} = getState();\n\tif (!dbId && !userId && !secret && !user) {\n\t\t// Nothing to do\n\t\treturn;\n\t}\n\tconsole.debug(\"[User] Disconnecting...\", { dbId, userId, secret });\n\tif (user) {\n\t\tuser.unsubscribe(FIREBASE_CB);\n\t\tFIREBASE_CB = null;\n\t}\n\tdispatch(resetUser());\n};\n\nexport const reconnectUser = (): AsyncAction => async (dispatch, getState) => {\n\tconst {\n\t\tuser: {\n\t\t\taccess: { dbId, userId, secret }\n\t\t}\n\t} = getState();\n\tif (!dbId || !userId || !secret) {\n\t\t// Nothing to do\n\t\treturn;\n\t}\n\tconsole.debug(\"[User] Reconnecting...\", { dbId, userId, secret });\n\tdispatch(connectUser(dbId, userId, secret));\n};\n","import React, { FC, useCallback, useEffect } from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { Link } from \"react-router-dom\";\nimport { useTranslation } from \"react-i18next\";\n//\nimport { IconButton } from \"../components/Common/IconButton\";\nimport { RootState } from \"../reducers\";\nimport { openModal } from \"../reducers/modals\";\nimport { disconnectUser } from \"../actions/user\";\nimport { clearMessages } from \"../reducers/messages\";\nimport { Messages } from \"../components/Common/Messages\";\nimport \"./Splash.scss\";\n\n// ------------------------------------------------------------------\n\nexport const Splash: FC = () => {\n\tconst dispatch = useDispatch();\n\tconst loggedIn = useSelector<RootState, boolean>(\n\t\tstate => !!state.user.access.dbId && !!state.user.access.userId\n\t);\n\tconst { t } = useTranslation();\n\n\tconst onCreateRoom = useCallback(\n\t\t() => dispatch(openModal({ type: \"CreateRoom\", props: null })),\n\t\t[dispatch]\n\t);\n\n\tconst onCreateUser = useCallback(\n\t\t() => dispatch(openModal({ type: \"CreateUser\", props: {} })),\n\t\t[dispatch]\n\t);\n\n\tconst onConnectUser = useCallback(\n\t\t() => dispatch(openModal({ type: \"ConnectUser\", props: {} })),\n\t\t[dispatch]\n\t);\n\n\tconst onDisconnect = useCallback(() => dispatch(disconnectUser()), [\n\t\tdispatch\n\t]);\n\n\tconst onShowHelp = useCallback(\n\t\t() => dispatch(openModal({ type: \"Help\", props: null })),\n\t\t[dispatch]\n\t);\n\n\tuseEffect(() => {\n\t\tdispatch(clearMessages());\n\t}, [dispatch]);\n\n\t/*\n\t<div className=\"PoweredWith\">\n\t\t<span>{t(\"splash.powered_with\")}</span>\n\t\t<a\n\t\t\thref=\"https://www.deezer.com\"\n\t\t\ttarget=\"_blank\"\n\t\t\trel=\"noopener noreferrer\">\n\t\t\t<img\n\t\t\t\tsrc=\"/images/deezer.svg\"\n\t\t\t\theight=\"20px\"\n\t\t\t\ttitle=\"Deezer\"\n\t\t\t\talt=\"Deezer Logo\"\n\t\t\t/>\n\t\t</a>\n\t</div>\n\t*/\n\n\treturn (\n\t\t<>\n\t\t\t<div className=\"Splash\">\n\t\t\t\t<div className=\"Top\">\n\t\t\t\t\t<Link className=\"Logo\" to=\"/\">\n\t\t\t\t\t\t<img\n\t\t\t\t\t\t\tsrc=\"/images/logo.png\"\n\t\t\t\t\t\t\ttitle=\"Party\"\n\t\t\t\t\t\t\talt=\"Party Logo\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\tParty\n\t\t\t\t\t</Link>\n\t\t\t\t\t<div className=\"Description\">{t(\"splash.description\")}</div>\n\t\t\t\t</div>\n\t\t\t\t<div className=\"Middle\">\n\t\t\t\t\t<div className=\"Menu\">\n\t\t\t\t\t\t{loggedIn ? (\n\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t<div className=\"MenuItem\">\n\t\t\t\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\t\t\t\tonClick={onCreateRoom}\n\t\t\t\t\t\t\t\t\t\ticon=\"play\"\n\t\t\t\t\t\t\t\t\t\tsize=\"XL\"\n\t\t\t\t\t\t\t\t\t\ttitle={t(\"rooms.create\")}\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t<div className=\"MenuItem\">\n\t\t\t\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\t\t\t\tonClick={onCreateUser}\n\t\t\t\t\t\t\t\t\t\ticon=\"user-plus\"\n\t\t\t\t\t\t\t\t\t\tsize=\"XL\"\n\t\t\t\t\t\t\t\t\t\ttitle={t(\"users.create\")}\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div className=\"MenuItem\">\n\t\t\t\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\t\t\t\tonClick={onConnectUser}\n\t\t\t\t\t\t\t\t\t\ticon=\"sign-in\"\n\t\t\t\t\t\t\t\t\t\tsize=\"XL\"\n\t\t\t\t\t\t\t\t\t\ttitle={t(\"users.connect\")}\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div className=\"Bottom\">\n\t\t\t\t\t<div className=\"Menu\">\n\t\t\t\t\t\t{loggedIn ? (\n\t\t\t\t\t\t\t<div className=\"MenuItem\">\n\t\t\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\t\t\ticon=\"sign-out\"\n\t\t\t\t\t\t\t\t\tonClick={onDisconnect}\n\t\t\t\t\t\t\t\t\tsize=\"M\"\n\t\t\t\t\t\t\t\t\ttitle={t(\"users.disconnect\")}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t<div className=\"MenuItem\">\n\t\t\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\t\t\ticon=\"question-circle\"\n\t\t\t\t\t\t\t\t\tonClick={onShowHelp}\n\t\t\t\t\t\t\t\t\tsize=\"L\"\n\t\t\t\t\t\t\t\t\ttitle={t(\"help.help\")}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<Messages />\n\t\t</>\n\t);\n};\n","import React, { FC, FormEvent, ReactNode, useCallback } from \"react\";\nimport classNames from \"classnames\";\nimport { useTranslation } from \"react-i18next\";\n//\nimport { IconButton } from \"../Common/IconButton\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { RootState } from \"../../reducers\";\nimport { Dispatch } from \"../../actions\";\nimport { popModal, closeModal } from \"../../reducers/modals\";\n\n// ------------------------------------------------------------------\n\nexport const Modal: FC<{\n\tchildren: ReactNode;\n\tclassName?: string;\n\ttitle: string;\n\trenderFoot?: () => React.ReactNode;\n\tonSubmit?: () => void;\n}> = ({ children, className, title, renderFoot, onSubmit }) => {\n\tconst dispatch = useDispatch<Dispatch>();\n\tconst { t } = useTranslation();\n\tconst has_prev_modal = useSelector<RootState, boolean>(\n\t\tstate => state.modals.stack.length > 1\n\t);\n\n\tconst onClose = useCallback(() => dispatch(closeModal()), [dispatch]);\n\tconst onPop = useCallback(() => dispatch(popModal()), [dispatch]);\n\n\treturn (\n\t\t<form\n\t\t\tclassName={classNames(\"Modal\", className)}\n\t\t\tonSubmit={(event: FormEvent<HTMLFormElement>) => {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tif (onSubmit) {\n\t\t\t\t\tonSubmit();\n\t\t\t\t}\n\t\t\t}}>\n\t\t\t<div className=\"ModalHead\">\n\t\t\t\t<IconButton\n\t\t\t\t\tkind=\"special\"\n\t\t\t\t\tclassName={classNames(\"ModalHeadBack\", {\n\t\t\t\t\t\thidden: !has_prev_modal\n\t\t\t\t\t})}\n\t\t\t\t\ticon=\"angle-left\"\n\t\t\t\t\ttitle=\"Back\"\n\t\t\t\t\tonClick={onPop}\n\t\t\t\t/>\n\t\t\t\t<div className=\"ModalTitle\">{title}</div>\n\t\t\t\t<IconButton\n\t\t\t\t\tkind=\"special\"\n\t\t\t\t\tclassName=\"ModalHeadClose\"\n\t\t\t\t\tonClick={onClose}\n\t\t\t\t\ttitle={t(\"cancel\")}\n\t\t\t\t\ticon=\"times\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<div className=\"ModalBody\">{children}</div>\n\t\t\t<div className=\"ModalFoot\">{renderFoot && renderFoot()}</div>\n\t\t</form>\n\t);\n};\n","import React, { FC, ReactNode } from \"react\";\nimport classNames from \"classnames\";\n//\nimport { Modal } from \"./Modal\";\nimport \"./FormModal.scss\";\n\n// ------------------------------------------------------------------\n\nexport const FormModal: FC<{\n\tchildren: ReactNode;\n\tclassName?: string;\n\tonSubmit: () => void;\n\trenderButtons: () => React.ReactNode;\n\ttitle: string;\n}> = ({ children, className, renderButtons, title, onSubmit }) => (\n\t<Modal\n\t\tclassName={classNames(\"FormModal\", className)}\n\t\ttitle={title}\n\t\trenderFoot={renderButtons}\n\t\tonSubmit={onSubmit}>\n\t\t{children}\n\t</Modal>\n);\n","import React, { FC } from \"react\";\nimport { useTranslation } from \"react-i18next\";\n//\nimport { IconButton } from \"./IconButton\";\n\n// ------------------------------------------------------------------\n\nexport const CancelButton: FC<{ onClick: () => void }> = ({ onClick }) => {\n\tconst { t } = useTranslation();\n\treturn (\n\t\t<IconButton\n\t\t\tonClick={onClick}\n\t\t\ttitle={t(\"cancel\")}\n\t\t\tkind=\"default\"\n\t\t\ticon=\"ban\"\n\t\t/>\n\t);\n};\n","import React, { FC, useCallback } from \"react\";\nimport { useTranslation } from \"react-i18next\";\n//\nimport { FormModal } from \"../Modals/FormModal\";\nimport { IconButton } from \"../Common/IconButton\";\nimport { CancelButton } from \"../Common/CancelButton\";\nimport { useDispatch } from \"react-redux\";\nimport { Dispatch } from \"../../actions\";\nimport { popModal } from \"../../reducers/modals\";\n\n// ------------------------------------------------------------------\n\nexport type ConfirmModalProps = {\n\tquestion: string;\n\tonCanceled?: () => void;\n\tonConfirmed: () => void;\n};\n\nexport const ConfirmModal: FC<ConfirmModalProps> = ({\n\tquestion,\n\tonCanceled,\n\tonConfirmed\n}) => {\n\tconst dispatch = useDispatch<Dispatch>();\n\tconst { t } = useTranslation();\n\n\tconst onCancel = useCallback(() => {\n\t\tdispatch(popModal());\n\t\tif (onCanceled) {\n\t\t\tonCanceled();\n\t\t}\n\t}, [dispatch, onCanceled]);\n\n\treturn (\n\t\t<FormModal\n\t\t\ttitle={t(\"confirm\")}\n\t\t\tonSubmit={onConfirmed}\n\t\t\trenderButtons={() => (\n\t\t\t\t<>\n\t\t\t\t\t<IconButton\n\t\t\t\t\t\ttitle={t(\"cancel\")}\n\t\t\t\t\t\tkind=\"primary\"\n\t\t\t\t\t\ticon=\"plus\"\n\t\t\t\t\t\ttype=\"submit\"\n\t\t\t\t\t/>\n\t\t\t\t\t<CancelButton onClick={onCancel} />\n\t\t\t\t</>\n\t\t\t)}>\n\t\t\t{question}\n\t\t</FormModal>\n\t);\n};\n","import React, { FC, forwardRef, useCallback } from \"react\";\nimport { useDispatch } from \"react-redux\";\nimport { useTranslation } from \"react-i18next\";\n//\nimport { copyToClipboard } from \"../../utils/clipboard\";\nimport { IconButton } from \"../Common/IconButton\";\nimport { displaySuccess } from \"../../actions/messages\";\n\n// ------------------------------------------------------------------\n\nexport const ModalField = ({ children }: { children?: React.ReactNode }) => (\n\t<div className=\"ModalField\">{children}</div>\n);\n\n// ------------------------------------------------------------------\n\nexport const InputField = forwardRef(\n\t(\n\t\tprops: { label: string } & React.DetailedHTMLProps<\n\t\t\tReact.InputHTMLAttributes<HTMLInputElement>,\n\t\t\tHTMLInputElement\n\t\t>,\n\t\tref: React.Ref<HTMLInputElement>\n\t) => (\n\t\t<ModalField>\n\t\t\t<div className=\"XXX\">\n\t\t\t\t<label htmlFor={props.id}>{props.label}</label>\n\t\t\t\t<input ref={ref} {...props} />\n\t\t\t</div>\n\t\t</ModalField>\n\t)\n);\n\n// ------------------------------------------------------------------\n\nexport const SECRET_FIELD_SIZE = 36;\n\nexport const SecretField: FC<{\n\tid: string;\n\tlabel: string;\n\tonChange: (value: string) => void;\n\tplaceholder: string;\n\tvalue: string;\n}> = ({ id, label, onChange, placeholder, value }) => {\n\tconst dispatch = useDispatch();\n\tconst { t } = useTranslation();\n\n\tconst onCopyToClipboard = useCallback(async () => {\n\t\tawait copyToClipboard(value);\n\t\tdispatch(displaySuccess(\"secret_copied_to_clipboard\"));\n\t}, [dispatch, value]);\n\n\treturn (\n\t\t<ModalField>\n\t\t\t<div className=\"XXX\">\n\t\t\t\t<label htmlFor={id}>{label}</label>\n\t\t\t\t<div\n\t\t\t\t\tstyle={{\n\t\t\t\t\t\tdisplay: \"flex\",\n\t\t\t\t\t\tflexDirection: \"row\",\n\t\t\t\t\t\tjustifyContent: \"space-between\"\n\t\t\t\t\t}}>\n\t\t\t\t\t<input\n\t\t\t\t\t\tstyle={{\n\t\t\t\t\t\t\tflexGrow: 1,\n\t\t\t\t\t\t\tmarginRight: \"0.5rem\"\n\t\t\t\t\t\t}}\n\t\t\t\t\t\tid={id}\n\t\t\t\t\t\ttype=\"password\"\n\t\t\t\t\t\tautoComplete=\"password\"\n\t\t\t\t\t\tplaceholder={placeholder}\n\t\t\t\t\t\tmaxLength={SECRET_FIELD_SIZE}\n\t\t\t\t\t\tminLength={SECRET_FIELD_SIZE}\n\t\t\t\t\t\trequired={true}\n\t\t\t\t\t\tvalue={value}\n\t\t\t\t\t\tonChange={e => onChange(e.target.value)}\n\t\t\t\t\t/>\n\t\t\t\t\t<IconButton\n\t\t\t\t\t\ticon=\"clipboard\"\n\t\t\t\t\t\tonClick={onCopyToClipboard}\n\t\t\t\t\t\tsize=\"M\"\n\t\t\t\t\t\ttitle={t(\"copy_to_clipboard\")}\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</ModalField>\n\t);\n};\n\n// ------------------------------------------------------------------\n\nexport const SelectField = forwardRef(\n\t(\n\t\tprops: {\n\t\t\tlabel: string;\n\t\t\toptions: Array<{ id: string; label: string }>;\n\t\t} & React.DetailedHTMLProps<\n\t\t\tReact.InputHTMLAttributes<HTMLSelectElement>,\n\t\t\tHTMLSelectElement\n\t\t>,\n\t\tref: React.Ref<HTMLSelectElement>\n\t) => (\n\t\t<ModalField>\n\t\t\t<div className=\"XXX\">\n\t\t\t\t<label htmlFor={props.id}>{props.label}</label>\n\t\t\t\t<select ref={ref} {...props}>\n\t\t\t\t\t{props.options\n\t\t\t\t\t\t.sort((a, b) => a.label.localeCompare(b.label))\n\t\t\t\t\t\t.map(option => (\n\t\t\t\t\t\t\t<option key={option.id} value={option.id}>\n\t\t\t\t\t\t\t\t{option.label}\n\t\t\t\t\t\t\t</option>\n\t\t\t\t\t\t))}\n\t\t\t\t</select>\n\t\t\t</div>\n\t\t</ModalField>\n\t)\n);\n","import React, { FC, useRef, useState, useEffect, useCallback } from \"react\";\nimport { useDispatch } from \"react-redux\";\nimport { useTranslation } from \"react-i18next\";\n//\nimport { FormModal } from \"../Modals/FormModal\";\nimport { IconButton } from \"../Common/IconButton\";\nimport { CancelButton } from \"../Common/CancelButton\";\nimport { popModal } from \"../../reducers/modals\";\nimport { displayError } from \"../../actions/messages\";\nimport { connectUser } from \"../../actions/user\";\nimport { Dispatch, ActionOptions } from \"../../actions\";\nimport { SECRET_FIELD_SIZE, InputField } from \"../Modals/ModalFields\";\nimport { selectUserDatabaseId } from \"../../config/firebase\";\n\n// ------------------------------------------------------------------\n\nexport type ConnectUserModalProps = { options?: ActionOptions };\n\nexport const ConnectUserModal: FC<ConnectUserModalProps> = ({ options }) => {\n\tconst dispatch = useDispatch<Dispatch>();\n\tconst [userId, setUserId] = useState(\"\");\n\tconst [secret, setSecret] = useState(\"\");\n\tconst userIdRef = useRef<HTMLInputElement>(null);\n\tconst { t } = useTranslation();\n\n\tuseEffect(() => {\n\t\tif (userIdRef.current) {\n\t\t\tuserIdRef.current.focus();\n\t\t}\n\t}, [userIdRef]);\n\n\tconst onClose = useCallback(() => dispatch(popModal()), [dispatch]);\n\n\tconst onConnect = useCallback(() => {\n\t\tif (userId.trim().length === 0) {\n\t\t\tdispatch(displayError(\"users.id_is_invalid\"));\n\t\t\treturn;\n\t\t}\n\t\tif (secret.trim().length === 0) {\n\t\t\tdispatch(displayError(\"users.secret_is_invalid\"));\n\t\t\treturn;\n\t\t}\n\t\tdispatch(\n\t\t\tconnectUser(selectUserDatabaseId(), userId, secret, {\n\t\t\t\tonSuccess: () => {\n\t\t\t\t\tif (options && options.onSuccess) {\n\t\t\t\t\t\toptions.onSuccess();\n\t\t\t\t\t}\n\t\t\t\t\tdispatch(popModal());\n\t\t\t\t}\n\t\t\t})\n\t\t);\n\t}, [dispatch, userId, secret, options]);\n\n\treturn (\n\t\t<FormModal\n\t\t\ttitle={t(\"users.connection\")}\n\t\t\tonSubmit={onConnect}\n\t\t\trenderButtons={() => (\n\t\t\t\t<>\n\t\t\t\t\t<IconButton\n\t\t\t\t\t\tdisabled={\n\t\t\t\t\t\t\tuserId.trim().length === 0 ||\n\t\t\t\t\t\t\tuserId.length !== 36 ||\n\t\t\t\t\t\t\tsecret.length !== SECRET_FIELD_SIZE\n\t\t\t\t\t\t}\n\t\t\t\t\t\ttitle={t(\"users.connect\")}\n\t\t\t\t\t\tkind=\"primary\"\n\t\t\t\t\t\ticon=\"sign-in\"\n\t\t\t\t\t\ttype=\"submit\"\n\t\t\t\t\t/>\n\t\t\t\t\t<CancelButton onClick={onClose} />\n\t\t\t\t</>\n\t\t\t)}>\n\t\t\t<InputField\n\t\t\t\tid=\"modal-userId\"\n\t\t\t\tlabel={t(\"users.id\")}\n\t\t\t\ttype=\"text\"\n\t\t\t\tplaceholder={t(\"users.id_placeholder\")}\n\t\t\t\tmaxLength={36}\n\t\t\t\tminLength={36}\n\t\t\t\trequired={true}\n\t\t\t\tvalue={userId}\n\t\t\t\tref={userIdRef}\n\t\t\t\tonChange={e => setUserId(e.target.value)}\n\t\t\t/>\n\t\t\t<InputField\n\t\t\t\tid=\"modal-secret\"\n\t\t\t\tlabel={t(\"users.secret\")}\n\t\t\t\ttype=\"password\"\n\t\t\t\tautoComplete=\"password\"\n\t\t\t\tplaceholder={t(\"users.secret_placeholder\")}\n\t\t\t\tmaxLength={36}\n\t\t\t\tminLength={36}\n\t\t\t\trequired={true}\n\t\t\t\tvalue={secret}\n\t\t\t\tonChange={e => setSecret(e.target.value)}\n\t\t\t/>\n\t\t</FormModal>\n\t);\n};\n","import React, { FC, useState, useRef, useEffect, useCallback } from \"react\";\nimport { useDispatch } from \"react-redux\";\nimport { useTranslation } from \"react-i18next\";\nimport { v4 } from \"uuid\";\n//\nimport { FormModal } from \"../Modals/FormModal\";\nimport { IconButton } from \"../Common/IconButton\";\nimport { CancelButton } from \"../Common/CancelButton\";\nimport {\n\tInputField,\n\tSecretField,\n\tSECRET_FIELD_SIZE,\n\tSelectField\n} from \"../Modals/ModalFields\";\nimport { Dispatch } from \"../../actions\";\nimport { popModal } from \"../../reducers/modals\";\nimport { createRoom } from \"../../actions/room\";\nimport { displayError } from \"../../actions/messages\";\nimport { RoomType, RoomTypes, DEFAULT_ROOM_TYPE } from \"../../utils/rooms\";\nimport { selectRoomDatabaseId } from \"../../config/firebase\";\n\n// ------------------------------------------------------------------\n\nlet ROOM_COUNTER = 1;\n\n// ------------------------------------------------------------------\n\nexport const CreateRoomModal: FC = () => {\n\tconst dispatch = useDispatch<Dispatch>();\n\tconst [name, setName] = useState(\"\");\n\tconst [secret, setSecret] = useState(v4());\n\tconst [type, setType] = useState<RoomType>(DEFAULT_ROOM_TYPE);\n\tconst nameRef = useRef<HTMLInputElement>(null);\n\tconst { t } = useTranslation();\n\n\tuseEffect(() => {\n\t\tsetName(`${t(\"rooms.room\")} ${ROOM_COUNTER}`);\n\t\tif (nameRef.current) {\n\t\t\tnameRef.current.focus();\n\t\t}\n\t}, [t, nameRef]);\n\n\tconst onClose = useCallback(() => dispatch(popModal()), [dispatch]);\n\n\tconst onCreate = useCallback(() => {\n\t\tif (name.trim().length === 0) {\n\t\t\tdispatch(displayError(\"rooms.name_is_invalid\"));\n\t\t\treturn;\n\t\t}\n\t\tif (secret.trim().length === 0) {\n\t\t\tdispatch(displayError(\"rooms.secret_is_invalid\"));\n\t\t\treturn;\n\t\t}\n\t\tdispatch(\n\t\t\tcreateRoom(selectRoomDatabaseId(), name, secret, type, {\n\t\t\t\tonSuccess: () => {\n\t\t\t\t\tdispatch(popModal());\n\t\t\t\t}\n\t\t\t})\n\t\t);\n\t\tROOM_COUNTER++;\n\t}, [dispatch, name, secret, type]);\n\n\treturn (\n\t\t<FormModal\n\t\t\ttitle={t(\"rooms.room_creation\")}\n\t\t\tonSubmit={onCreate}\n\t\t\trenderButtons={() => (\n\t\t\t\t<>\n\t\t\t\t\t<IconButton\n\t\t\t\t\t\tdisabled={\n\t\t\t\t\t\t\tname.trim().length === 0 ||\n\t\t\t\t\t\t\tsecret.length !== SECRET_FIELD_SIZE\n\t\t\t\t\t\t}\n\t\t\t\t\t\ttitle={t(\"rooms.create\")}\n\t\t\t\t\t\tkind=\"primary\"\n\t\t\t\t\t\ticon=\"sign-in\"\n\t\t\t\t\t\ttype=\"submit\"\n\t\t\t\t\t/>\n\t\t\t\t\t<CancelButton onClick={onClose} />\n\t\t\t\t</>\n\t\t\t)}>\n\t\t\t<InputField\n\t\t\t\tid=\"modal-name\"\n\t\t\t\tlabel={t(\"rooms.name\")}\n\t\t\t\ttype=\"text\"\n\t\t\t\tplaceholder={t(\"rooms.name_placeholder\")}\n\t\t\t\tmaxLength={100}\n\t\t\t\tminLength={2}\n\t\t\t\trequired={true}\n\t\t\t\tvalue={name}\n\t\t\t\tref={nameRef}\n\t\t\t\tonChange={e => setName(e.target.value)}\n\t\t\t/>\n\t\t\t<SecretField\n\t\t\t\tid=\"modal-secret\"\n\t\t\t\tlabel={t(\"rooms.key\")}\n\t\t\t\tplaceholder={t(\"rooms.key_placeholder\")}\n\t\t\t\tvalue={secret}\n\t\t\t\tonChange={setSecret}\n\t\t\t/>\n\t\t\t<SelectField\n\t\t\t\tid=\"modal-type\"\n\t\t\t\tlabel={t(\"rooms.type\")}\n\t\t\t\tplaceholder={t(\"rooms.type_placeholder\")}\n\t\t\t\toptions={RoomTypes.map(type => ({\n\t\t\t\t\tid: type,\n\t\t\t\t\tlabel: t(`rooms.types.${type}`)\n\t\t\t\t}))}\n\t\t\t\tvalue={type}\n\t\t\t\tonChange={e => setType(e.target.value as RoomType)}\n\t\t\t/>\n\t\t</FormModal>\n\t);\n};\n","import React, { FC, useState, useEffect, useRef, useCallback } from \"react\";\nimport { useDispatch } from \"react-redux\";\nimport { useTranslation } from \"react-i18next\";\nimport { v4 } from \"uuid\";\n//\nimport { FormModal } from \"../Modals/FormModal\";\nimport { IconButton } from \"../Common/IconButton\";\nimport { CancelButton } from \"../Common/CancelButton\";\nimport {\n\tSecretField,\n\tSECRET_FIELD_SIZE,\n\tInputField\n} from \"../Modals/ModalFields\";\nimport { popModal } from \"../../reducers/modals\";\nimport { displayError } from \"../../actions/messages\";\nimport { createUser } from \"../../actions/user\";\nimport { Dispatch, ActionOptions } from \"../../actions\";\nimport { selectUserDatabaseId } from \"../../config/firebase\";\n\n// ------------------------------------------------------------------\n\nlet USER_COUNTER = 1;\n\n// ------------------------------------------------------------------\n\nexport type CreateUserModalProps = { options?: ActionOptions };\n\nexport const CreateUserModal: FC<CreateUserModalProps> = ({ options }) => {\n\tconst dispatch = useDispatch<Dispatch>();\n\tconst [name, setName] = useState(\"\");\n\tconst [secret, setSecret] = useState(v4());\n\tconst nameRef = useRef<HTMLInputElement>(null);\n\tconst { t } = useTranslation();\n\n\tuseEffect(() => {\n\t\tsetName(`${t(\"users.user\")} ${USER_COUNTER}`);\n\t\tif (nameRef.current) {\n\t\t\tnameRef.current.focus();\n\t\t}\n\t}, [t, nameRef]);\n\n\tconst onClose = useCallback(() => dispatch(popModal()), [dispatch]);\n\n\tconst onCreate = useCallback(() => {\n\t\tif (name.trim().length === 0) {\n\t\t\tdispatch(displayError(\"users.name_is_invalid\"));\n\t\t\treturn;\n\t\t}\n\t\tif (secret.trim().length === 0) {\n\t\t\tdispatch(displayError(\"users.secret_is_invalid\"));\n\t\t\treturn;\n\t\t}\n\t\tdispatch(\n\t\t\tcreateUser(selectUserDatabaseId(), name, secret, {\n\t\t\t\tonSuccess: () => {\n\t\t\t\t\tif (options && options.onSuccess) {\n\t\t\t\t\t\toptions.onSuccess();\n\t\t\t\t\t}\n\t\t\t\t\tdispatch(popModal());\n\t\t\t\t}\n\t\t\t})\n\t\t);\n\t\tUSER_COUNTER++;\n\t}, [dispatch, name, secret, options]);\n\n\treturn (\n\t\t<FormModal\n\t\t\ttitle={t(\"users.user_creation\")}\n\t\t\tonSubmit={onCreate}\n\t\t\trenderButtons={() => (\n\t\t\t\t<>\n\t\t\t\t\t<IconButton\n\t\t\t\t\t\tdisabled={\n\t\t\t\t\t\t\tname.trim().length === 0 ||\n\t\t\t\t\t\t\tsecret.length !== SECRET_FIELD_SIZE\n\t\t\t\t\t\t}\n\t\t\t\t\t\ttitle={t(\"users.create\")}\n\t\t\t\t\t\tkind=\"primary\"\n\t\t\t\t\t\ticon=\"sign-in\"\n\t\t\t\t\t\ttype=\"submit\"\n\t\t\t\t\t/>\n\t\t\t\t\t<CancelButton onClick={onClose} />\n\t\t\t\t</>\n\t\t\t)}>\n\t\t\t<InputField\n\t\t\t\tid=\"modal-name\"\n\t\t\t\tlabel={t(\"users.name\")}\n\t\t\t\ttype=\"text\"\n\t\t\t\tplaceholder={t(\"users.name_placeholder\")}\n\t\t\t\tmaxLength={100}\n\t\t\t\tminLength={2}\n\t\t\t\trequired={true}\n\t\t\t\tvalue={name}\n\t\t\t\tref={nameRef}\n\t\t\t\tonChange={e => setName(e.target.value)}\n\t\t\t/>\n\t\t\t<SecretField\n\t\t\t\tid=\"modal-secret\"\n\t\t\t\tlabel={t(\"users.secret\")}\n\t\t\t\tplaceholder={t(\"users.secret_placeholder\")}\n\t\t\t\tvalue={secret}\n\t\t\t\tonChange={newSecret => setSecret(newSecret)}\n\t\t\t/>\n\t\t</FormModal>\n\t);\n};\n","import React, { FC, useCallback } from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport { useDispatch } from \"react-redux\";\n//\nimport { Modal } from \"../Modals/Modal\";\nimport { openModal } from \"../../reducers/modals\";\nimport { Dispatch } from \"../../actions\";\nimport { IconButton } from \"../Common/IconButton\";\nimport \"./HelpModal.scss\";\n\n// ------------------------------------------------------------------\n\nexport const HelpModal: FC = () => {\n\tconst { t } = useTranslation();\n\tconst dispatch = useDispatch<Dispatch>();\n\n\tconst onCreateRoom = useCallback(\n\t\t() => dispatch(openModal({ type: \"CreateRoom\", props: null })),\n\t\t[dispatch]\n\t);\n\n\tconst onJoinRoom = useCallback(\n\t\t() => dispatch(openModal({ type: \"JoinRoom\", props: null })),\n\t\t[dispatch]\n\t);\n\n\tconst onCreateUser = useCallback(\n\t\t() => dispatch(openModal({ type: \"CreateUser\", props: {} })),\n\t\t[dispatch]\n\t);\n\n\tconst onConnectUser = useCallback(\n\t\t() => dispatch(openModal({ type: \"ConnectUser\", props: {} })),\n\t\t[dispatch]\n\t);\n\n\treturn (\n\t\t<Modal className=\"HelpModal\" title={t(\"help.help\")}>\n\t\t\t<div className=\"HelpModalSection\">\n\t\t\t\t<div className=\"HelpModalSectionTitle\">{t(\"help.rules\")}</div>\n\t\t\t\t<ul>\n\t\t\t\t\t<li>\n\t\t\t\t\t\t{t(\"help.rule1\")}&nbsp;\n\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\ticon=\"user-plus\"\n\t\t\t\t\t\t\tsize=\"S\"\n\t\t\t\t\t\t\ttitle=\"\"\n\t\t\t\t\t\t\tonClick={onCreateUser}\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<br />\n\t\t\t\t\t\t{t(\"help.rule1b\")}&nbsp;\n\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\ticon=\"sign-in\"\n\t\t\t\t\t\t\tsize=\"S\"\n\t\t\t\t\t\t\ttitle=\"\"\n\t\t\t\t\t\t\tonClick={onConnectUser}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</li>\n\t\t\t\t\t<li>\n\t\t\t\t\t\t{t(\"help.rule2\")}&nbsp;\n\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\ticon=\"play\"\n\t\t\t\t\t\t\tsize=\"S\"\n\t\t\t\t\t\t\ttitle=\"\"\n\t\t\t\t\t\t\tonClick={onCreateRoom}\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<br />\n\t\t\t\t\t\t{t(\"help.rule2b\")}&nbsp;\n\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\ticon=\"sign-in\"\n\t\t\t\t\t\t\tsize=\"S\"\n\t\t\t\t\t\t\ttitle=\"\"\n\t\t\t\t\t\t\tonClick={onJoinRoom}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</li>\n\t\t\t\t</ul>\n\t\t\t</div>\n\n\t\t\t<div className=\"HelpModalSection\">\n\t\t\t\t<div className=\"HelpModalSectionTitle\">{t(\"help.notes\")}</div>\n\t\t\t\t<ul>\n\t\t\t\t\t<li>{t(\"help.note1\")}</li>\n\t\t\t\t\t<li>{t(\"help.note2\")}</li>\n\t\t\t\t</ul>\n\t\t\t</div>\n\t\t</Modal>\n\t);\n};\n","import React, { FC, ReactNode } from \"react\";\n//\nimport { Media } from \"../../utils/medias\";\nimport { ModalField } from \"../Modals/ModalFields\";\nimport { IconButton } from \"../Common/IconButton\";\n\n// ------------------------------------------------------------------\n\nexport const SearchResultCategory: FC<{\n\titems: Media[];\n\tlabel: string;\n\tonViewMore: () => void;\n\tcb: (item: Media) => ReactNode;\n}> = ({ items, label, onViewMore, cb }) =>\n\titems.length > 0 ? (\n\t\t<>\n\t\t\t<ModalField>\n\t\t\t\t<div className=\"XXX\">\n\t\t\t\t\t<label>{label}</label>\n\t\t\t\t</div>\n\t\t\t</ModalField>\n\t\t\t{items.map(item => (\n\t\t\t\t<ModalField key={item.id}>\n\t\t\t\t\t<div className=\"SearchResultItem\">{cb(item)}</div>\n\t\t\t\t</ModalField>\n\t\t\t))}\n\t\t\t<ModalField>\n\t\t\t\t<div className=\"XXX\">\n\t\t\t\t\t<IconButton\n\t\t\t\t\t\ticon=\"ellipsis-h\"\n\t\t\t\t\t\tonClick={onViewMore}\n\t\t\t\t\t\ttitle=\"View more...\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</ModalField>\n\t\t</>\n\t) : null;\n","import React, { FC, useRef, useState, useEffect, useCallback } from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { useTranslation } from \"react-i18next\";\n//\nimport { FormModal } from \"../Modals/FormModal\";\nimport { IconButton } from \"../Common/IconButton\";\nimport { CancelButton } from \"../Common/CancelButton\";\nimport { searchMedias } from \"../../utils/providers\";\nimport { Media } from \"./Medias\";\nimport {\n\tMEDIA_TYPE_DEFINITIONS,\n\tMediaType,\n\tProviderType\n} from \"../../utils/medias\";\nimport { SearchResults } from \"../../utils/providers\";\nimport { SearchResultCategory } from \"./SearchResultCategory\";\nimport { Dispatch } from \"../../actions\";\nimport { popModal } from \"../../reducers/modals\";\nimport { previewMedia } from \"../../actions/medias\";\nimport { isRoomLocked } from \"../../selectors/room\";\nimport { RootState } from \"../../reducers\";\nimport { ModalField } from \"../Modals/ModalFields\";\nimport { PREVIEW_PLAYER } from \"../../utils/player\";\nimport { appendToQueue } from \"../../actions/queue\";\nimport \"./SearchModal.scss\";\n\n// ------------------------------------------------------------------\n\nconst SEARCH_RESULTS_COUNT = 5;\nconst VIEW_MORE_RESULTS_COUNT = 50;\n\n// ------------------------------------------------------------------\n\nexport const SearchModal: FC = () => {\n\tconst dispatch = useDispatch<Dispatch>();\n\tconst { t } = useTranslation();\n\tconst queryRef = useRef<HTMLInputElement>(null);\n\tconst locked = useSelector<RootState, boolean>(isRoomLocked);\n\tconst [playingMediaId, setPlayingMediaId] = useState(\"\");\n\tconst [playingMediaProvider, setPlayingMediaProvider] = useState<\n\t\tProviderType\n\t>(\"deezer\");\n\tconst [playingMediaType, setPlayingMediaType] = useState<MediaType>(\n\t\t\"track\"\n\t);\n\tconst [query, setQuery] = useState(\"\");\n\tconst [results, setResults] = useState<SearchResults>({\n\t\t// keys are ProviderType\n\t\tdeezer: {\n\t\t\t// keys are MediaType\n\t\t\talbum: [],\n\t\t\tplaylist: [],\n\t\t\ttrack: []\n\t\t}\n\t});\n\n\tconst onClose = useCallback(() => dispatch(popModal()), [dispatch]);\n\n\tconst onSearch = useCallback(async () => {\n\t\tif (query.trim().length > 0) {\n\t\t\tsetResults(\n\t\t\t\tawait searchMedias(query, {\n\t\t\t\t\tlimit: SEARCH_RESULTS_COUNT\n\t\t\t\t})\n\t\t\t);\n\t\t}\n\t}, [query]);\n\n\tconst onSelect = useCallback(\n\t\t(provider: ProviderType, type: MediaType, id: string) =>\n\t\t\tdispatch(appendToQueue([{ provider, type, id }])),\n\t\t[dispatch]\n\t);\n\n\tconst onStartPreview = useCallback(\n\t\t(provider: ProviderType, type: MediaType, id: string) => {\n\t\t\tdispatch(previewMedia({ provider, type, id }));\n\t\t\tsetPlayingMediaId(id);\n\t\t\tsetPlayingMediaProvider(provider);\n\t\t\tsetPlayingMediaType(type);\n\t\t},\n\t\t[dispatch]\n\t);\n\n\tconst onStopPreview = useCallback(async () => {\n\t\tconsole.debug(\"Stop previewing...\");\n\t\tawait PREVIEW_PLAYER.stop();\n\t\tsetPlayingMediaId(\"\");\n\t\tsetPlayingMediaProvider(\"deezer\");\n\t\tsetPlayingMediaType(\"track\");\n\t}, []);\n\n\tconst onViewMore = useCallback(\n\t\tasync (type: MediaType) => {\n\t\t\tsetResults(\n\t\t\t\tawait searchMedias(\n\t\t\t\t\tquery,\n\t\t\t\t\t{\n\t\t\t\t\t\tlimit: VIEW_MORE_RESULTS_COUNT\n\t\t\t\t\t},\n\t\t\t\t\ttype\n\t\t\t\t)\n\t\t\t);\n\t\t},\n\t\t[query, setResults]\n\t);\n\n\tuseEffect(() => {\n\t\tif (queryRef.current) {\n\t\t\tqueryRef.current.focus();\n\t\t}\n\t\treturn () => {\n\t\t\tconsole.debug(\"Stop previewing...\");\n\t\t\t/*await*/ PREVIEW_PLAYER.stop();\n\t\t};\n\t}, [dispatch]);\n\n\treturn (\n\t\t<FormModal\n\t\t\tclassName=\"SearchModal\"\n\t\t\ttitle={t(\"medias.medias_search\")}\n\t\t\tonSubmit={onSearch}\n\t\t\trenderButtons={() => (\n\t\t\t\t<>\n\t\t\t\t\t<IconButton\n\t\t\t\t\t\tdisabled={query.trim().length === 0}\n\t\t\t\t\t\ttitle={t(\"medias.search\")}\n\t\t\t\t\t\tkind=\"primary\"\n\t\t\t\t\t\ticon=\"search\"\n\t\t\t\t\t\ttype=\"submit\"\n\t\t\t\t\t/>\n\t\t\t\t\t<CancelButton onClick={onClose} />\n\t\t\t\t</>\n\t\t\t)}>\n\t\t\t<ModalField>\n\t\t\t\t<input\n\t\t\t\t\tid=\"modal-query\"\n\t\t\t\t\ttype=\"text\"\n\t\t\t\t\tplaceholder={t(\"medias.search_placeholder\")}\n\t\t\t\t\tmaxLength={100}\n\t\t\t\t\tminLength={2}\n\t\t\t\t\trequired={true}\n\t\t\t\t\tvalue={query}\n\t\t\t\t\tref={queryRef}\n\t\t\t\t\tonChange={e => setQuery(e.target.value)}\n\t\t\t\t/>\n\t\t\t</ModalField>\n\t\t\t{MEDIA_TYPE_DEFINITIONS.map(({ label, provider, type }) => (\n\t\t\t\t<SearchResultCategory\n\t\t\t\t\tkey={type}\n\t\t\t\t\tlabel={t(label)}\n\t\t\t\t\titems={results[provider][type]}\n\t\t\t\t\tonViewMore={() => onViewMore(type)}\n\t\t\t\t\tcb={media => (\n\t\t\t\t\t\t<Media\n\t\t\t\t\t\t\tactions={\n\t\t\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\t\t\tdisabled={locked}\n\t\t\t\t\t\t\t\t\ttitle={t(\"medias.add\")}\n\t\t\t\t\t\t\t\t\ticon=\"plus\"\n\t\t\t\t\t\t\t\t\tonClick={() =>\n\t\t\t\t\t\t\t\t\t\tonSelect(provider, type, media.id)\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tmedia={media}\n\t\t\t\t\t\t\tplayable={true}\n\t\t\t\t\t\t\tplaying={\n\t\t\t\t\t\t\t\tplayingMediaProvider === provider &&\n\t\t\t\t\t\t\t\tplayingMediaType === type &&\n\t\t\t\t\t\t\t\tplayingMediaId === media.id\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tonPlay={() =>\n\t\t\t\t\t\t\t\tonStartPreview(provider, type, media.id)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tonStop={onStopPreview}\n\t\t\t\t\t\t/>\n\t\t\t\t\t)}\n\t\t\t\t/>\n\t\t\t))}\n\t\t</FormModal>\n\t);\n};\n","import React, { FC, useState, useRef, useEffect, useCallback } from \"react\";\nimport { useDispatch } from \"react-redux\";\nimport { useTranslation } from \"react-i18next\";\n//\nimport { FormModal } from \"../Modals/FormModal\";\nimport { IconButton } from \"../Common/IconButton\";\nimport { CancelButton } from \"../Common/CancelButton\";\nimport { InputField, SelectField } from \"../Modals/ModalFields\";\nimport { Dispatch } from \"../../actions\";\nimport { popModal } from \"../../reducers/modals\";\nimport { displayError } from \"../../actions/messages\";\nimport { enterRoom } from \"../../actions/room\";\nimport config, { selectRoomDatabaseId } from \"../../config/firebase\";\n\n// ------------------------------------------------------------------\n\nexport const JoinRoomModal: FC = () => {\n\tconst dispatch = useDispatch<Dispatch>();\n\tconst [serverId, setServerId] = useState(selectRoomDatabaseId());\n\tconst [roomId, setRoomId] = useState(\"\");\n\tconst roomIdRef = useRef<HTMLInputElement>(null);\n\tconst { t } = useTranslation();\n\n\tuseEffect(() => {\n\t\tif (roomIdRef.current) {\n\t\t\troomIdRef.current.focus();\n\t\t}\n\t}, [roomIdRef]);\n\n\tconst onClose = useCallback(() => dispatch(popModal()), [dispatch]);\n\n\tconst onJoin = useCallback(() => {\n\t\tif (serverId.trim().length === 0) {\n\t\t\tdispatch(displayError(\"rooms.id_is_invalid\"));\n\t\t\treturn;\n\t\t}\n\t\tif (roomId.trim().length === 0) {\n\t\t\tdispatch(displayError(\"rooms.id_is_invalid\"));\n\t\t\treturn;\n\t\t}\n\t\tdispatch(\n\t\t\tenterRoom(serverId, roomId, \"\", {\n\t\t\t\tonSuccess: () => {\n\t\t\t\t\tdispatch(popModal());\n\t\t\t\t}\n\t\t\t})\n\t\t);\n\t}, [dispatch, roomId, serverId]);\n\n\treturn (\n\t\t<FormModal\n\t\t\ttitle={t(\"rooms.room_join\")}\n\t\t\tonSubmit={onJoin}\n\t\t\trenderButtons={() => (\n\t\t\t\t<>\n\t\t\t\t\t<IconButton\n\t\t\t\t\t\tdisabled={\n\t\t\t\t\t\t\troomId.trim().length === 0 || roomId.length !== 36\n\t\t\t\t\t\t}\n\t\t\t\t\t\ttitle={t(\"rooms.join\")}\n\t\t\t\t\t\tkind=\"primary\"\n\t\t\t\t\t\ticon=\"sign-in\"\n\t\t\t\t\t\ttype=\"submit\"\n\t\t\t\t\t/>\n\t\t\t\t\t<CancelButton onClick={onClose} />\n\t\t\t\t</>\n\t\t\t)}>\n\t\t\t<SelectField\n\t\t\t\tid=\"modal-serverId\"\n\t\t\t\tlabel={t(\"rooms.server_id\")}\n\t\t\t\tplaceholder={t(\"rooms.server_id_placeholder\")}\n\t\t\t\toptions={config.dbIDs\n\t\t\t\t\t.sort((s1, s2) => s1.localeCompare(s2))\n\t\t\t\t\t.map(serverId => ({\n\t\t\t\t\t\tid: serverId,\n\t\t\t\t\t\tlabel: serverId\n\t\t\t\t\t}))}\n\t\t\t\tvalue={serverId}\n\t\t\t\tonChange={e => setServerId(e.target.value)}\n\t\t\t/>\n\t\t\t<InputField\n\t\t\t\tid=\"modal-roomId\"\n\t\t\t\tlabel={t(\"rooms.id\")}\n\t\t\t\ttype=\"text\"\n\t\t\t\tplaceholder={t(\"rooms.id_placeholder\")}\n\t\t\t\tmaxLength={36}\n\t\t\t\tminLength={36}\n\t\t\t\trequired={true}\n\t\t\t\tvalue={roomId}\n\t\t\t\tref={roomIdRef}\n\t\t\t\tonChange={e => setRoomId(e.target.value)}\n\t\t\t/>\n\t\t</FormModal>\n\t);\n};\n","import React, { FC, useRef, useState, useEffect, useCallback } from \"react\";\nimport { useDispatch } from \"react-redux\";\nimport { useTranslation } from \"react-i18next\";\n//\nimport { FormModal } from \"../Modals/FormModal\";\nimport { IconButton } from \"../Common/IconButton\";\nimport { CancelButton } from \"../Common/CancelButton\";\nimport { Dispatch, ActionOptions } from \"../../actions\";\nimport { popModal } from \"../../reducers/modals\";\nimport { unlockRoom } from \"../../actions/room\";\nimport { SECRET_FIELD_SIZE, InputField } from \"../Modals/ModalFields\";\n\n// ------------------------------------------------------------------\n\nexport type UnlockRoomModalProps = { options?: ActionOptions };\n\nexport const UnlockRoomModal: FC<UnlockRoomModalProps> = ({ options }) => {\n\tconst dispatch = useDispatch<Dispatch>();\n\tconst [secret, setSecret] = useState(\"\");\n\tconst secretRef = useRef<HTMLInputElement>(null);\n\tconst { t } = useTranslation();\n\n\tuseEffect(() => {\n\t\tif (secretRef.current) {\n\t\t\tsecretRef.current.focus();\n\t\t}\n\t}, [secretRef]);\n\n\tconst onClose = useCallback(() => dispatch(popModal()), [dispatch]);\n\n\tconst onUnlock = useCallback(() => {\n\t\tdispatch(\n\t\t\tunlockRoom(secret, {\n\t\t\t\tonSuccess: () => {\n\t\t\t\t\tif (options && options.onSuccess) {\n\t\t\t\t\t\toptions.onSuccess();\n\t\t\t\t\t}\n\t\t\t\t\tdispatch(popModal());\n\t\t\t\t}\n\t\t\t})\n\t\t);\n\t}, [dispatch, secret, options]);\n\n\treturn (\n\t\t<FormModal\n\t\t\ttitle={t(\"rooms.room_unlocking\")}\n\t\t\tonSubmit={onUnlock}\n\t\t\trenderButtons={() => (\n\t\t\t\t<>\n\t\t\t\t\t<IconButton\n\t\t\t\t\t\tdisabled={secret.length !== SECRET_FIELD_SIZE}\n\t\t\t\t\t\ttitle={t(\"rooms.unlock\")}\n\t\t\t\t\t\tkind=\"primary\"\n\t\t\t\t\t\ticon=\"unlock\"\n\t\t\t\t\t\ttype=\"submit\"\n\t\t\t\t\t/>\n\t\t\t\t\t<CancelButton onClick={onClose} />\n\t\t\t\t</>\n\t\t\t)}>\n\t\t\t<InputField\n\t\t\t\tid=\"modal-secret\"\n\t\t\t\tlabel={t(\"rooms.key\")}\n\t\t\t\ttype=\"password\"\n\t\t\t\tautoComplete=\"password\"\n\t\t\t\tplaceholder={t(\"rooms.key_placeholder\")}\n\t\t\t\tmaxLength={36}\n\t\t\t\tminLength={36}\n\t\t\t\trequired={true}\n\t\t\t\tvalue={secret}\n\t\t\t\tref={secretRef}\n\t\t\t\tonChange={e => setSecret(e.target.value)}\n\t\t\t/>\n\t\t</FormModal>\n\t);\n};\n","import React, { FC, MouseEvent, useState, useEffect, useCallback } from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { CSSTransition } from \"react-transition-group\";\n//\nimport { Dispatch } from \"../../actions\";\nimport { RootState } from \"../../reducers\";\nimport { ModalPrereq, popModal } from \"../../reducers/modals\";\nimport { ConfirmModal } from \"./ConfirmModal\";\nimport { ConnectUserModal } from \"../Users/ConnectUserModal\";\nimport { CreateRoomModal } from \"../Room/CreateRoomModal\";\nimport { CreateUserModal } from \"..//Users/CreateUserModal\";\nimport { HelpModal } from \"./HelpModal\";\nimport { SearchModal } from \"..//Room/SearchModal\";\nimport { JoinRoomModal } from \"../Room/JoinRoomModal\";\nimport { UnlockRoomModal } from \"../Room/UnlockRoomModal\";\nimport \"./index.scss\";\n\n// ------------------------------------------------------------------\n\nconst TRANSITION_TIMEOUT = 300;\n\n// ------------------------------------------------------------------\n\nexport const getModal = (prereq?: ModalPrereq) => {\n\tif (prereq) {\n\t\tswitch (prereq.type) {\n\t\t\tcase \"Confirm\":\n\t\t\t\treturn <ConfirmModal {...prereq.props} />;\n\t\t\tcase \"ConnectUser\":\n\t\t\t\treturn <ConnectUserModal {...prereq.props} />;\n\t\t\tcase \"CreateRoom\":\n\t\t\t\treturn <CreateRoomModal />;\n\t\t\tcase \"CreateUser\":\n\t\t\t\treturn <CreateUserModal {...prereq.props} />;\n\t\t\tcase \"Help\":\n\t\t\t\treturn <HelpModal />;\n\t\t\tcase \"JoinRoom\":\n\t\t\t\treturn <JoinRoomModal />;\n\t\t\tcase \"Search\":\n\t\t\t\treturn <SearchModal />;\n\t\t\tcase \"UnlockRoom\":\n\t\t\t\treturn <UnlockRoomModal {...prereq.props} />;\n\t\t}\n\t}\n\treturn null;\n};\n\n// ------------------------------------------------------------------\n\nexport const Modals: FC = () => {\n\tconst dispatch = useDispatch<Dispatch>();\n\tconst prereq = useSelector<RootState, ModalPrereq | undefined>(state =>\n\t\tstate.modals.stack.length > 0\n\t\t\t? state.modals.stack[state.modals.stack.length - 1]\n\t\t\t: void 0\n\t);\n\n\tconst [currPrereq, setCurrPrereq] = useState<ModalPrereq | undefined>(\n\t\tvoid 0\n\t);\n\tconst [prevPrereq, setPrevPrereq] = useState<ModalPrereq | undefined>(\n\t\tvoid 0\n\t);\n\n\tconst onPopModal = useCallback(() => dispatch(popModal()), [dispatch]);\n\n\tuseEffect(() => {\n\t\tconst keyDown = (e: KeyboardEvent) => {\n\t\t\tif (e.keyCode === 27) {\n\t\t\t\tonPopModal();\n\t\t\t}\n\t\t};\n\n\t\tdocument.addEventListener(\"keydown\", keyDown);\n\n\t\treturn () => {\n\t\t\tdocument.removeEventListener(\"keydown\", keyDown);\n\t\t};\n\t}, [onPopModal]);\n\n\tuseEffect(() => {\n\t\t// Hide current modal before showing new one (if there is a new one)\n\t\tsetCurrPrereq(void 0);\n\t\tsetPrevPrereq(prereq);\n\t}, [prereq]);\n\n\tuseEffect(() => {\n\t\tif (prereq) {\n\t\t\tsetTimeout(() => {\n\t\t\t\tsetCurrPrereq(prereq);\n\t\t\t}, TRANSITION_TIMEOUT);\n\t\t}\n\t}, [prereq]);\n\n\tconst modal = getModal(currPrereq || prevPrereq);\n\treturn (\n\t\t<CSSTransition\n\t\t\tin={!!currPrereq}\n\t\t\ttimeout={TRANSITION_TIMEOUT}\n\t\t\tunmountOnExit={true}>\n\t\t\t<div\n\t\t\t\tclassName=\"ModalOverlay\"\n\t\t\t\tonClick={e => {\n\t\t\t\t\t// Clicking overlay will close current modal\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t\tonPopModal();\n\t\t\t\t}}>\n\t\t\t\t{modal && (\n\t\t\t\t\t<div\n\t\t\t\t\t\tclassName=\"ModalWrapper\"\n\t\t\t\t\t\trole=\"dialog\"\n\t\t\t\t\t\tonClick={(e: MouseEvent) => {\n\t\t\t\t\t\t\t// Clicking wrapper modal will not progagate to overlay which would close current modal\n\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t}}>\n\t\t\t\t\t\t{modal}\n\t\t\t\t\t</div>\n\t\t\t\t)}\n\t\t\t</div>\n\t\t</CSSTransition>\n\t);\n};\n","import React, { FC, useEffect } from \"react\";\nimport { useDispatch } from \"react-redux\";\nimport { Redirect, Route, Switch } from \"react-router-dom\";\n//\nimport { Room } from \"./Room\";\nimport { Splash } from \"./Splash\";\nimport { Modals } from \"../components/Modals\";\nimport { reconnectUser } from \"../actions/user\";\nimport { Dispatch } from \"../actions\";\nimport \"./App.scss\";\n\n// ------------------------------------------------------------------\n\nexport const App: FC = () => {\n\tconst dispatch = useDispatch<Dispatch>();\n\n\tuseEffect(() => {\n\t\tdispatch(reconnectUser());\n\t}, [dispatch]);\n\n\treturn (\n\t\t<div className=\"App\">\n\t\t\t<Modals />\n\t\t\t<Switch>\n\t\t\t\t<Route\n\t\t\t\t\texact={true}\n\t\t\t\t\tpath=\"/room/:db_id/:room_id\"\n\t\t\t\t\tcomponent={Room}\n\t\t\t\t/>\n\t\t\t\t<Route exact={true} path=\"/\" component={Splash} />\n\t\t\t\t<Redirect to=\"/\" />\n\t\t\t</Switch>\n\t\t</div>\n\t);\n};\n","export default {\n\taudio: {\n\t\terrors: {\n\t\t\tcannot_decode_audio_data: \"Audio buffer cannot be decoded\",\n\t\t\tcannot_load_audio_buffer: \"Audio buffer loading failed\"\n\t\t}\n\t},\n\tsplash: {\n\t\tCGU: \"CGU\",\n\t\tpowered_with: \"Powered with\",\n\t\tdescription: \"Collaborative & Musical Experimentations\"\n\t},\n\thelp: {\n\t\thelp: \"Help\",\n\t\trules: \"Rules\",\n\t\trule1: \"Create an user account\",\n\t\trule1b: \"or connect\",\n\t\trule2: \"Create a room\",\n\t\trule2b: \"or join one\",\n\t\tnotes: \"Notes\",\n\t\tnote1:\n\t\t\t\"A room is protected with a secret: it can be accessed without its secret but then no action can be done in it.\",\n\t\tnote2: \"No personal data is accessed or stored.\"\n\t},\n\tusers: {\n\t\terrors: {\n\t\t\tinvalid: \"User is invalid\"\n\t\t},\n\t\tuser: \"User\",\n\t\tconfirm_disconnect: \"Are you sure you want to disconnect?\",\n\t\tconnect: \"Connect\",\n\t\tconnection: \"Connection\",\n\t\tcreate: \"Create a user\",\n\t\tdisconnect: \"Disconnect\",\n\t\tid: \"User ID\",\n\t\tid_is_invalid: \"ID is invalid\",\n\t\tid_placeholder: \"User ID...\",\n\t\tname_is_invalid: \"Name is invalid\",\n\t\tname_placeholder: \"User Name...\",\n\t\tname: \"User Name\",\n\t\tsecret_is_invalid: \"Secret is invalid\",\n\t\tsecret_placeholder: \"User Secret...\",\n\t\tsecret: \"User Secret\",\n\t\tuser_creation: \"User Registration\",\n\t\tnot_connected: \"No user is identified\"\n\t},\n\tgames: {\n\t\tseabattle: {\n\t\t\tmovement_not_possible: \"This movement is not possible!\",\n\t\t\tmovement_not_possible_because_hitted: \"A hitted boat cannot move!\",\n\t\t\topponent_index: \"Opponent {{index}}\",\n\t\t\tjoin_battle: \"Join the battle\",\n\t\t\topponent_already_killed:\n\t\t\t\t\"All opponent boats have already been killed\",\n\t\t\tship_already_hitted: \"Boat is already hitten at this position\",\n\t\t\tship_already_killed: \"Boat has already been killed\",\n\t\t\thitted_opponent: \"You've hitted opponent boat\",\n\t\t\tkilled_opponent: \"You've killed all opponent boats\",\n\t\t\tkilled_opponent_boat: \"You've killed opponent boat\",\n\t\t\tmissed_opponent: \"You've missed opponent boat\",\n\t\t\tno_weapon_selected: \"Select a weapon to attack\",\n\t\t\tweapon_not_available: \"Selected weapon is not available\",\n\t\t\tnot_your_turn: \"This is not your turn\",\n\t\t\topponent_turn: \"It's your opponent turn to play\",\n\t\t\tplayer_turn: \"It's your turn to move or attack\",\n\t\t\tyou_have_been_killed: \"All your boats have been killed\"\n\t\t},\n\t\tmax_players_count: \"Maximum players number has been already reached\",\n\t\tno_opponents: \"No opponents\",\n\t\tno_opponents_to_attack: \"There is no opponent to attack...\",\n\t\tconnect_to_join: \"You have to connect to join...\",\n\t\twatch_or_join: \"You can watch or...\"\n\t},\n\trooms: {\n\t\terrors: {\n\t\t\tinvalid: \"Room is invalid\",\n\t\t\tlocked: \"Room is locked\"\n\t\t},\n\t\ttypes: {\n\t\t\tblind: \"Blind Test\",\n\t\t\tdj: \"DJ\",\n\t\t\tseabattle: \"Sea Battle\"\n\t\t},\n\t\tclear: \"Clear all tracks\",\n\t\tconfirm_clear: \"Are you sure you want to remove all tracks?\",\n\t\tconfirm_exit: \"Are you sure you want to leave the room?\",\n\t\tconfirm_lock: \"Are you sure you want to lock the room?\",\n\t\tcopy_link: \"Copy Room Link to Clipboard\",\n\t\tcreate: \"Create a room\",\n\t\tempty: \"It's empty here, you should add some tracks...\",\n\t\tempty_for_now: \"It's empty here, the owner has to fill it..\",\n\t\texit: \"Exit Room\",\n\t\tid: \"Room ID\",\n\t\tid_placeholder: \"Room ID...\",\n\t\tserver_id: \"Server ID\",\n\t\tserver_id_placeholder: \"Server ID...\",\n\t\tkey_placeholder: \"Room Key...\",\n\t\ttype_placeholder: \"Room Type...\",\n\t\tkey: \"Room Key\",\n\t\ttype: \"Room Type\",\n\t\tjoin: \"Join a Room\",\n\t\tlink_copied_to_clipboard: \"Room link has been copied to clipboard\",\n\t\tloading: \"Loading...\",\n\t\tlocked: \"Locked (click to unlock)\",\n\t\tname_is_invalid: \"Name is invalid\",\n\t\tname_placeholder: \"Room Name...\",\n\t\tname: \"Room Name\",\n\t\troom_creation: \"Room Creation\",\n\t\troom_join: \"Room Access\",\n\t\troom_unlocking: \"Room Unlocking\",\n\t\troom: \"Room\",\n\t\tsecret_is_invalid: \"Secret is invalid\",\n\t\tunlock: \"Unlock\",\n\t\tunlocked: \"Unlocked (click to lock)\",\n\t\tmedia_count: \"{{count}} media\",\n\t\tmedia_count_plural: \"{{count}} medias\",\n\t\ttrack_count: \"{{count}} track\",\n\t\ttrack_count_plural: \"{{count}} tracks\"\n\t},\n\tmedias: {\n\t\tby: \"by {{artist}}\",\n\t\tadd: \"Add\",\n\t\tremove: \"Remove\",\n\t\tsearch: \"Search Media\",\n\t\tsearch_placeholder: \"Search...\",\n\t\tmedias_search: \"Media Search\",\n\t\talbums: \"Albums\",\n\t\tplaylists: \"Playlists\",\n\t\ttracks: \"Tracks\"\n\t},\n\tplayer: {\n\t\tbackward: \"Backward\",\n\t\tforward: \"Forward\",\n\t\tplay: \"Play\",\n\t\tplaying: \"Playing\",\n\t\tstop: \"Stop\"\n\t},\n\tcancel: \"Cancel\",\n\tclear: \"Clear\",\n\tcopy_to_clipboard: \"Copy to Clipboard\",\n\tsecret_copied_to_clipboard: \"Secret has been copied to clipboard\"\n};\n","export default {\n\taudio: {\n\t\terrors: {\n\t\t\tcannot_decode_audio_data: \"Le buffer audio ne peut pas tre dcod\",\n\t\t\tcannot_load_audio_buffer: \"Le buffer audio ne peut pas tre charg\"\n\t\t}\n\t},\n\tsplash: {\n\t\tCGU: \"CGU\",\n\t\tpowered_with: \"Utilise\",\n\t\tdescription: \"Exprimentations collaboratives et musicales\"\n\t},\n\thelp: {\n\t\thelp: \"Aide\",\n\t\trules: \"Rgles\",\n\t\trule1: \"Crez un compte utilisateur\",\n\t\trule1b: \"ou connectez-vous\",\n\t\trule2: \"Crez une salle\",\n\t\trule2b: \"ou rejoignez en une\",\n\t\tnotes: \"Notes\",\n\t\tnote1:\n\t\t\t\"Un salle est protge par un secret : elle peut-tre accde sans son secret mais aucune action ne pourra y tre ralise.\",\n\t\tnote2: \"Aucune donne personnelle n'est manipule ou stocke.\"\n\t},\n\tusers: {\n\t\terrors: {\n\t\t\tinvalid: \"L'utilisateur est invalide\"\n\t\t},\n\t\tuser: \"Utilisateur\",\n\t\tconfirm_disconnect: \"tes-vous sr(e) de vouloir vous dconnecter ?\",\n\t\tconnect: \"Se connecter\",\n\t\tconnection: \"Connexion\",\n\t\tcreate: \"Crer un utilisateur\",\n\t\tdisconnect: \"Se dconnecter\",\n\t\tid: \"Identifiant\",\n\t\tid_is_invalid: \"L'identifiant est invalide\",\n\t\tid_placeholder: \"Identifiant...\",\n\t\tname_is_invalid: \"Le nom est invalide\",\n\t\tname_placeholder: \"Nom...\",\n\t\tname: \"Nom\",\n\t\tsecret_is_invalid: \"Le secret est invalide\",\n\t\tsecret_placeholder: \"Secret...\",\n\t\tsecret: \"Secret\",\n\t\tuser_creation: \"Cration d'un utilisateur\",\n\t\tnot_connected: \"Aucun utilisateur identifi\"\n\t},\n\tgames: {\n\t\tseabattle: {\n\t\t\tmovement_not_possible: \"Ce dplacement est impossible !\",\n\t\t\tmovement_not_possible_because_hitted:\n\t\t\t\t\"Un bateau touch ne peut plus se dplacer !\",\n\t\t\topponent_index: \"Adversaire {{index}}\",\n\t\t\tjoin_battle: \"Participer  la bataille\",\n\t\t\topponent_already_killed:\n\t\t\t\t\"Tous les bateaux de l'ennemi ont dj t tus\",\n\t\t\tship_already_hitted: \"Le bateau est touch touch  cette position\",\n\t\t\tship_already_killed: \"Le bateau a dj t tu\",\n\t\t\thitted_opponent: \"Vous avez touch un bateau ennemi\",\n\t\t\tkilled_opponent: \"Vous avez tu tous les bateaux de l'ennemi\",\n\t\t\tkilled_opponent_boat: \"Vous avez tu un bateau ennemi\",\n\t\t\tmissed_opponent: \"Vous n'avez pas touch de bateau ennemi\",\n\t\t\tno_weapon_selected: \"Slectionnez une arme pour attaquer\",\n\t\t\tweapon_not_available: \"L'arme slectionne n'est plus disponible\",\n\t\t\tnot_your_turn: \"Ce n'est pas  votre tour de jouer\",\n\t\t\topponent_turn: \"C'est au tour de votre adversaire de jouer\",\n\t\t\tplayer_turn: \"C'est  votre tour de bouger ou d'attaquer\",\n\t\t\tyou_have_been_killed: \"Tous vos bateaux ont t tus\"\n\t\t},\n\t\tmax_players_count: \"Le nombre maximal de joueurs est dj atteint\",\n\t\tno_opponents: \"Aucun ennemi\",\n\t\tno_opponents_to_attack: \"Il n'y aucun ennemi  attaquer ...\",\n\t\tconnect_to_join: \"Vous devez vous connecter pour participer ...\",\n\t\twatch_or_join: \"Vous pouvez regarder ou ...\"\n\t},\n\trooms: {\n\t\terrors: {\n\t\t\tinvalid: \"La salle est invalide\",\n\t\t\tlocked: \"La salle est verrouille\"\n\t\t},\n\t\ttypes: {\n\t\t\tblind: \"Blind Test\",\n\t\t\tdj: \"DJ\",\n\t\t\tseabattle: \"Bataille Navale\"\n\t\t},\n\t\tclear: \"Supprimer toutes les pistes\",\n\t\tconfirm_clear:\n\t\t\t\"tes-vous sr(e) de vouloir supprimer toutes les pistes ?\",\n\t\tconfirm_exit: \"tes-vous sr(e) de vouloir quitter la salle ?\",\n\t\tconfirm_lock: \"tes-vous sr(e) de vouloir verrouiller la salle ?\",\n\t\tcopy_link: \"Copier le lien de la salle dans le presse-papier\",\n\t\tcreate: \"Crer une salle\",\n\t\tempty: \"Cette salle est vide, vous devriez ajouter quelques pistes...\",\n\t\tempty_for_now: \"Cette salle est pour le moment vide...\",\n\t\texit: \"Quitter la salle\",\n\t\tid: \"Identifiant de la salle\",\n\t\tid_placeholder: \"Identifiant de la salle...\",\n\t\tserver_id: \"Identifiant du serveur\",\n\t\tserver_id_placeholder: \"Identifiant du serveur...\",\n\t\tkey_placeholder: \"Clef...\",\n\t\ttype_placeholder: \"Type...\",\n\t\tkey: \"Clef\",\n\t\ttype: \"Type\",\n\t\tjoin: \"Rejoindre une salle\",\n\t\tloading: \"Chargement...\",\n\t\tlink_copied_to_clipboard:\n\t\t\t\"Le lien de la salle a t copi dans le presse-papier\",\n\t\tlocked: \"Verrouille (cliquer pour dverrouiller)\",\n\t\tname_is_invalid: \"Le nom est invalide\",\n\t\tname_placeholder: \"Nom...\",\n\t\tname: \"Nom\",\n\t\troom: \"Salle\",\n\t\troom_creation: \"Cration d'une salle\",\n\t\troom_join: \"Rejoindre une salle\",\n\t\troom_unlocking: \"Dverrouillage de la salle\",\n\t\tsecret_is_invalid: \"Le secret is invalide\",\n\t\tunlock: \"Dverrouiller\",\n\t\tunlocked: \"Dverrouille (cliquer pour verrouiller)\",\n\t\tmedia_count: \"{{count}} media\",\n\t\tmedia_count_plural: \"{{count}} medias\",\n\t\ttrack_count: \"{{count}} piste\",\n\t\ttrack_count_plural: \"{{count}} pistes\"\n\t},\n\tmedias: {\n\t\tby: \"par {{artist}}\",\n\t\tadd: \"Ajouter\",\n\t\tremove: \"Supprimer\",\n\t\tsearch: \"Chercher des mdias\",\n\t\tsearch_placeholder: \"Recherche...\",\n\t\tmedias_search: \"Recherche de mdias\",\n\t\talbums: \"Albums\",\n\t\tplaylists: \"Playlists\",\n\t\ttracks: \"Pistes\"\n\t},\n\tplayer: {\n\t\tbackward: \"Piste prcdente\",\n\t\tforward: \"Piste suivante\",\n\t\tplay: \"Lire\",\n\t\tplaying: \"En cours de lecture\",\n\t\tstop: \"Arrter\"\n\t},\n\tcancel: \"Annuler\",\n\tclear: \"Supprimer\",\n\tcopy_to_clipboard: \"Copier dans le presse-papier\",\n\tsecret_copied_to_clipboard: \"Le secret a t copi dans le presse-papier\"\n};\n","import i18next from \"i18next\";\nimport { initReactI18next } from \"react-i18next\";\n//\nimport en from \"../locales/en\";\nimport fr from \"../locales/fr\";\n\n// --------------------------------------------------------------\n\ntype Language = \"en\" | \"fr\";\n\n// --------------------------------------------------------------\n\nexport const changeLanguage = (language: Language) =>\n\ti18next.changeLanguage(language);\n\n// --------------------------------------------------------------\n\nexport const initLocales = async (): Promise<void> =>\n\tnew Promise((resolve, reject) => {\n\t\tconsole.debug(\"Initializing language...\", {\n\t\t\tcurrent: navigator.language || (navigator as any).userLanguage\n\t\t});\n\t\ti18next.use(initReactI18next).init(\n\t\t\t{\n\t\t\t\tfallbackLng: \"en\",\n\t\t\t\tlng: navigator.language || (navigator as any).userLanguage,\n\t\t\t\tresources: {\n\t\t\t\t\ten: { translation: en },\n\t\t\t\t\t\"en-US\": { translation: en },\n\t\t\t\t\tfr: { translation: fr },\n\t\t\t\t\t\"fr-FR\": { translation: fr }\n\t\t\t\t},\n\t\t\t\tinterpolation: {\n\t\t\t\t\tescapeValue: false, // react is already safe from xss\n\t\t\t\t\tformat: (value, format, lng) => {\n\t\t\t\t\t\t// if (format === \"uppercase\") return value.toUpperCase();\n\t\t\t\t\t\t// if (value instanceof Date) return moment(value).format(format);\n\t\t\t\t\t\treturn value;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\terror => {\n\t\t\t\tif (error) reject(error);\n\t\t\t\tresolve();\n\t\t\t}\n\t\t);\n\t});\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n\twindow.location.hostname === \"localhost\" ||\n\t\t// [::1] is the IPv6 localhost address.\n\t\twindow.location.hostname === \"[::1]\" ||\n\t\t// 127.0.0.0/8 are considered localhost for IPv4.\n\t\twindow.location.hostname.match(\n\t\t\t/^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n\t\t)\n);\n\nexport function register(config?: RegistrationOptions) {\n\tif (process.env.NODE_ENV === \"production\" && \"serviceWorker\" in navigator) {\n\t\tconsole.debug(\"PWA register 1\", process.env.PUBLIC_URL);\n\t\t// The URL constructor is available in all browsers that support SW.\n\t\tconst publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n\t\tif (publicUrl.origin !== window.location.origin) {\n\t\t\tconsole.debug(\"PWA register 2\");\n\t\t\t// Our service worker won't work if PUBLIC_URL is on a different origin\n\t\t\t// from what our page is served on. This might happen if a CDN is used to\n\t\t\t// serve assets; see https://github.com/facebook/create-react-app/issues/2374\n\t\t\treturn;\n\t\t}\n\n\t\twindow.addEventListener(\"load\", () => {\n\t\t\tconst swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\t\t\tconsole.debug(\"PWA register 3\");\n\t\t\tif (isLocalhost) {\n\t\t\t\tconsole.debug(\"PWA register 4\");\n\t\t\t\t// This is running on localhost. Let's check if a service worker still exists or not.\n\t\t\t\tcheckValidServiceWorker(swUrl, config);\n\n\t\t\t\t// Add some additional logging to localhost, pointing developers to the\n\t\t\t\t// service worker/PWA documentation.\n\t\t\t\tnavigator.serviceWorker.ready.then(() => {\n\t\t\t\t\tconsole.debug(\n\t\t\t\t\t\t\"This web app is being served cache-first by a service \" +\n\t\t\t\t\t\t\t\"worker. To learn more, visit https://bit.ly/CRA-PWA\"\n\t\t\t\t\t);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tconsole.debug(\"PWA register 5\");\n\t\t\t\t// Is not localhost. Just register service worker\n\t\t\t\tregisterValidSW(swUrl, config);\n\t\t\t}\n\t\t});\n\t}\n}\n\nfunction registerValidSW(swUrl: string, config?: RegistrationOptions) {\n\tconsole.debug(\"PWA registerValidSW 1\");\n\tnavigator.serviceWorker\n\t\t.register(swUrl)\n\t\t.then(registration => {\n\t\t\tconsole.debug(\"PWA registerValidSW 2\");\n\t\t\tregistration.onupdatefound = () => {\n\t\t\t\tconsole.debug(\"PWA registerValidSW 3\");\n\t\t\t\tconst installingWorker = registration.installing;\n\t\t\t\tif (installingWorker == null) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tconsole.debug(\"PWA registerValidSW 4\");\n\t\t\t\tinstallingWorker.onstatechange = () => {\n\t\t\t\t\tconsole.debug(\n\t\t\t\t\t\t\"PWA registerValidSW 5\",\n\t\t\t\t\t\tinstallingWorker.state\n\t\t\t\t\t);\n\t\t\t\t\tif (installingWorker.state === \"installed\") {\n\t\t\t\t\t\tif (navigator.serviceWorker.controller) {\n\t\t\t\t\t\t\tconsole.debug(\"PWA registerValidSW 6\");\n\t\t\t\t\t\t\t// At this point, the updated precached content has been fetched,\n\t\t\t\t\t\t\t// but the previous service worker will still serve the older\n\t\t\t\t\t\t\t// content until all client tabs are closed.\n\t\t\t\t\t\t\tconsole.debug(\n\t\t\t\t\t\t\t\t\"New content is available and will be used when all \" +\n\t\t\t\t\t\t\t\t\t\"tabs for this page are closed. See https://bit.ly/CRA-PWA.\"\n\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\t// Execute callback\n\t\t\t\t\t\t\tif (config && (config as any).onUpdate) {\n\t\t\t\t\t\t\t\t(config as any).onUpdate(registration);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconsole.debug(\"PWA registerValidSW 7\");\n\t\t\t\t\t\t\t// At this point, everything has been precached.\n\t\t\t\t\t\t\t// It's the perfect time to display a\n\t\t\t\t\t\t\t// \"Content is cached for offline use.\" message.\n\t\t\t\t\t\t\tconsole.debug(\"Content is cached for offline use.\");\n\n\t\t\t\t\t\t\t// Execute callback\n\t\t\t\t\t\t\tif (config && (config as any).onSuccess) {\n\t\t\t\t\t\t\t\t(config as any).onSuccess(registration);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t};\n\t\t})\n\t\t.catch(error => {\n\t\t\tconsole.error(\"Error during service worker registration:\", error);\n\t\t});\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: RegistrationOptions) {\n\tconsole.debug(\"PWA checkValidServiceWorker 1\");\n\t// Check if the service worker can be found. If it can't reload the page.\n\tfetch(swUrl, {\n\t\theaders: { \"Service-Worker\": \"script\" }\n\t})\n\t\t.then(response => {\n\t\t\t// Ensure service worker exists, and that we really are getting a JS file.\n\t\t\tconst contentType = response.headers.get(\"content-type\");\n\t\t\tconsole.debug(\n\t\t\t\t\"PWA checkValidServiceWorker 2\",\n\t\t\t\tcontentType,\n\t\t\t\tresponse.status\n\t\t\t);\n\t\t\tif (\n\t\t\t\tresponse.status === 404 ||\n\t\t\t\t(contentType != null &&\n\t\t\t\t\tcontentType.indexOf(\"javascript\") === -1)\n\t\t\t) {\n\t\t\t\t// No service worker found. Probably a different app. Reload the page.\n\t\t\t\tnavigator.serviceWorker.ready.then(registration => {\n\t\t\t\t\tregistration.unregister().then(() => {\n\t\t\t\t\t\twindow.location.reload();\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\t// Service worker found. Proceed as normal.\n\t\t\t\tregisterValidSW(swUrl, config);\n\t\t\t}\n\t\t})\n\t\t.catch(() => {\n\t\t\tconsole.debug(\n\t\t\t\t\"No internet connection found. App is running in offline mode.\"\n\t\t\t);\n\t\t});\n}\n\nexport function unregister() {\n\tif (\"serviceWorker\" in navigator) {\n\t\tnavigator.serviceWorker.ready\n\t\t\t.then(registration => {\n\t\t\t\tregistration.unregister();\n\t\t\t})\n\t\t\t.catch(error => {\n\t\t\t\tconsole.error(error.message);\n\t\t\t});\n\t}\n}\n","import { Reducer } from \"redux\";\nimport { AxiosError } from \"axios\";\n//\nimport { createAction } from \"../../actions\";\nimport { SeaBattleData } from \"../../utils/games/seabattle\";\n\n// ------------------------------------------------------------------\n\ntype SeaBattleAction =\n\t| ReturnType<typeof fetching>\n\t| ReturnType<typeof error>\n\t| ReturnType<typeof reset>\n\t| ReturnType<typeof set>;\n\nexport const fetching = () => createAction(\"games/seabattle/FETCHING\");\nexport const error = (error: AxiosError) =>\n\tcreateAction(\"games/seabattle/ERROR\", error);\nexport const reset = () => createAction(\"games/seabattle/RESET\", error);\nexport const set = (data: SeaBattleData) =>\n\tcreateAction(\"games/seabattle/SET\", data);\n\n// ------------------------------------------------------------------\n\nexport type State = {\n\tfetching: boolean;\n\terror: null | AxiosError;\n\tbattle: SeaBattleData;\n};\n\nconst INITIAL_STATE: State = {\n\terror: null,\n\tfetching: false,\n\tbattle: { currentMapIndex: 0, maps: [] }\n};\n\n// ------------------------------------------------------------------\n\nexport const seabattleReducer: Reducer<State, SeaBattleAction> = (\n\tstate = { ...INITIAL_STATE },\n\taction: SeaBattleAction\n): State => {\n\tswitch (action.type) {\n\t\tcase \"games/seabattle/FETCHING\":\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tfetching: true,\n\t\t\t\terror: null\n\t\t\t};\n\t\tcase \"games/seabattle/ERROR\":\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tfetching: false,\n\t\t\t\terror: action.payload\n\t\t\t};\n\t\tcase \"games/seabattle/SET\":\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tbattle: action.payload,\n\t\t\t\tfetching: false,\n\t\t\t\terror: null\n\t\t\t};\n\t\tcase \"games/seabattle/RESET\":\n\t\t\treturn INITIAL_STATE;\n\t\tdefault:\n\t\t\treturn state;\n\t}\n};\n","import { combineReducers } from \"redux\";\nimport { seabattleReducer as seabattle } from \"./seabattle\";\n\nexport type GamesState = ReturnType<typeof gamesReducer>;\n\nexport const gamesReducer = combineReducers({\n\tseabattle\n});\n","import { combineReducers } from \"redux\";\nimport { gamesReducer as games } from \"./games\";\nimport { mediasReducer as medias } from \"./medias\";\nimport { messagesReducer as messages } from \"./messages\";\nimport { modalsReducer as modals } from \"./modals\";\nimport { roomReducer as room } from \"./room\";\nimport { userReducer as user } from \"./user\";\n\nexport type RootState = ReturnType<typeof rootReducer>;\n\nexport const rootReducer = combineReducers({\n\tgames,\n\tmedias,\n\tmessages,\n\tmodals,\n\troom,\n\tuser\n});\n","import { composeWithDevTools } from \"redux-devtools-extension\";\nimport { applyMiddleware, createStore, compose } from \"redux\";\nimport thunk from \"redux-thunk\";\n//\nimport { rootReducer, RootState } from \"../reducers\";\nimport { QUEUE_PLAYER } from \"./player\";\n\n// ------------------------------------------------------------------\n\nexport const initStore = (initialState?: RootState) => {\n\tconst composeEnhancers =\n\t\tprocess.env.NODE_ENV === \"development\"\n\t\t\t? composeWithDevTools({})\n\t\t\t: compose;\n\n\tconst store = createStore(\n\t\trootReducer,\n\t\tinitialState,\n\t\tcomposeEnhancers(\n\t\t\tapplyMiddleware(\n\t\t\t\tthunk.withExtraArgument({\n\t\t\t\t\tplayer: QUEUE_PLAYER\n\t\t\t\t})\n\t\t\t)\n\t\t)\n\t);\n\n\treturn {\n\t\tdispatch: store.dispatch.bind(store),\n\t\tgetState: store.getState.bind(store),\n\t\tstore\n\t};\n};\n","import * as React from \"react\";\nimport * as ReactDOM from \"react-dom\";\nimport { Provider } from \"react-redux\";\nimport { Route, HashRouter } from \"react-router-dom\";\n//\nimport { App } from \"./pages/App\";\nimport { initLocales } from \"./utils/i18n\";\nimport { register as registerServiceWorker } from \"./serviceWorker\";\nimport { initStore } from \"./utils/redux\";\nimport \"./index.scss\";\n\n// ------------------------------------------------------------------\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nregisterServiceWorker();\n\n// ------------------------------------------------------------------\n\nconst init = async () => {\n\tinitLocales();\n\treturn initStore();\n};\n\n// ------------------------------------------------------------------\n\ninit().then(({ store }) => {\n\tReactDOM.render(\n\t\t<Provider store={store}>\n\t\t\t<HashRouter>\n\t\t\t\t<Route path=\"/\" component={App} />\n\t\t\t</HashRouter>\n\t\t</Provider>,\n\t\tdocument.getElementById(\"root\")\n\t);\n});\n","export const encode = <T>(data: T) =>\n\tBuffer.from(JSON.stringify(data)).toString(\"base64\");\n\nexport const decode = <T>(data: string) =>\n\tJSON.parse(Buffer.from(data, \"base64\").toString(\"ascii\")) as T;\n"],"sourceRoot":""}