(this["webpackJsonpparty-app"]=this["webpackJsonpparty-app"]||[]).push([[0],{107:function(e,t,r){},108:function(e,t,r){},109:function(e,t,r){},110:function(e,t,r){"use strict";r.r(t);var n=r(1),a=r.n(n),o=r(2),s=r(0),c=r.n(s),i=r(18),l=r(4),u=r(19),p=r(16),d=(r(68),r(14)),m=r(50),h=r(20),f=r(3);const b={fetching:!1,error:null,containers:{}},v=[],k={stack:[]},y={playing:!1,track_percent:0},g={position:0,trackIds:[]},E={fetching:!1,error:null,room:null,room_access:{id:"",secret:""},room_color:{fg:{r:0,g:0,b:0},bg:{r:255,g:255,b:255}},room_info:null},_={fetching:!1,error:null,tracks:{}},C={fetching:!1,error:null,user:null,user_access:(()=>{const e={id:"",secret:""},t=localStorage.getItem("U");if(t)try{const r=JSON.parse(atob(t));"string"===typeof r.i&&"string"===typeof r.s&&(e.id=r.i,e.secret=r.s,console.debug("Loaded user access: ",e))}catch(r){}return e})(),user_info:null},w=Object(d.combineReducers)({containers:(e=b,t)=>{switch(t.type){case"containers/FETCHING":return Object(f.a)({},e,{fetching:!0,error:null});case"containers/FETCHED":return Object(f.a)({},e,{fetching:!1,error:null});case"containers/ERROR":return Object(f.a)({},e,{fetching:!1,error:t.payload});case"containers/SET_CONTAINERS":{const o=Object(f.a)({},e,{containers:Object(f.a)({},e.containers)});var r,n=Object(h.a)(t.payload);try{for(n.s();!(r=n.n()).done;){const e=r.value;o.containers["".concat(e.type,"|").concat(e.id)]=e}}catch(a){n.e(a)}finally{n.f()}return o}case"containers/RESET":return b;default:return e}},messages:(e=v,t)=>{switch(t.type){case"message/ADD":return[t.payload,...e];case"message/REMOVE":return e.filter(e=>e.id!==t.payload);case"message/RESET":return v;default:return e}},modals:(e=k,t)=>{switch(t.type){case"modals/OPEN":return Object(f.a)({},e,{stack:[t.payload]});case"modals/CLOSE":return Object(f.a)({},e,{stack:[]});case"modals/PUSH":return Object(f.a)({},e,{stack:[...e.stack,t.payload]});case"modals/POP":const r=[...e.stack];return r.pop(),Object(f.a)({},e,{stack:r});default:return e}},player:(e=y,t)=>{switch(t.type){case"player/START":return Object(f.a)({},e,{playing:!0});case"player/STOP":return Object(f.a)({},e,{playing:!1});case"player/SET_TRACK_PERCENT":return Object(f.a)({},e,{track_percent:t.payload});case"player/RESET":return y;default:return e}},queue:(e=g,t)=>{switch(t.type){case"queue/SET":return Object(f.a)({},e,{position:t.payload.position,trackIds:t.payload.trackIds});default:return e}},rooms:(e=E,t)=>{switch(t.type){case"rooms/FETCHING":return Object(f.a)({},e,{fetching:!0,error:null});case"rooms/FETCHED":return Object(f.a)({},e,{fetching:!1,error:null});case"rooms/ERROR":return Object(f.a)({},e,{fetching:!1,error:t.payload});case"rooms/SET_ROOM":return Object(f.a)({},e,{room:t.payload.room,room_info:t.payload.info});case"rooms/SET_ROOM_ACCESS":return Object(f.a)({},e,{room_access:t.payload});case"rooms/SET_ROOM_COLOR":return Object(f.a)({},e,{room_color:t.payload});case"rooms/RESET":return E;default:return e}},tracks:(e=_,t)=>{switch(t.type){case"tracks/FETCHING":return Object(f.a)({},e,{fetching:!0,error:null});case"tracks/FETCHED":return Object(f.a)({},e,{fetching:!1,error:null});case"tracks/ERROR":return Object(f.a)({},e,{fetching:!1,error:t.payload});case"tracks/SET_TRACKS":{const o=Object(f.a)({},e,{tracks:Object(f.a)({},e.tracks)});var r,n=Object(h.a)(t.payload);try{for(n.s();!(r=n.n()).done;){const e=r.value;o.tracks[e.id]=e}}catch(a){n.e(a)}finally{n.f()}return o}case"tracks/RESET":return _;default:return e}},users:(e=C,t)=>{switch(t.type){case"users/FETCHING":return Object(f.a)({},e,{fetching:!0,error:null});case"users/FETCHED":return Object(f.a)({},e,{fetching:!1,error:null});case"users/ERROR":return Object(f.a)({},e,{fetching:!1,error:t.payload});case"users/SET_USER":return Object(f.a)({},e,{user:t.payload.user,user_info:t.payload.info});case"users/SET_USER_ACCESS":return(({id:e,secret:t})=>{localStorage.setItem("U",btoa(JSON.stringify({i:e,s:t})))})(t.payload),Object(f.a)({},e,{user_access:Object(f.a)({},t.payload)});case"users/RESET":return C;default:return e}}});var x=r(51),S=r(5),O=r(7),j=r.n(O),R=r(55),N=r.n(R);r(81);class T extends s.Component{constructor(...e){super(...e),this.render=()=>{const e=this.props,t=e.className,r=e.color,n=e.icon,a=e.size,o=void 0===a?"M":a,s=e.title;return c.a.createElement(N.a,{className:j()("Icon",t,o),name:n,style:{color:r},title:s})}}}var M=T;r(82);class P extends s.Component{constructor(...e){super(...e),this.render=()=>{const e=this.props,t=e.className,r=e.color,n=e.disabled,a=void 0!==n&&n,o=e.displayTitle,s=void 0!==o&&o,i=e.icon,l=e.kind,u=void 0===l?"default":l,p=e.onClick,d=e.size,m=e.title,h=e.type,f=void 0===h?"button":h;return c.a.createElement("button",{type:f,"aria-label":m,className:j()("IconButton",t,u,d,{clickable:!a&&(!!p||"submit"===f)}),onClick:a?void 0:p,title:m},c.a.createElement(M,{color:r,icon:i,size:d}),s&&c.a.createElement("div",{className:j()("IconButtonTitle",d)},m))}}}const q=({onClick:e})=>c.a.createElement(P,{onClick:e,title:"Cancel",kind:"default",icon:"ban"});var I=P;const L=function(){var e=Object(o.a)(a.a.mark((function e(t){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise(e=>{const r=document.createElement("textarea");r.value=t,r.setAttribute("readonly",""),r.style.position="absolute",r.style.left="-9999px",document.body.appendChild(r);const n=document.getSelection();if(null!==n){const e=n.rangeCount>0&&n.getRangeAt(0);r.select(),document.execCommand("copy"),!1!==e&&(n.removeAllRanges(),n.addRange(e))}document.body.removeChild(r),e()});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();r(83);class A extends s.Component{constructor(...e){var t;super(...e),t=this,this.render=()=>{const e=this.props,t=e.locked,r=e.room,n=e.onLock,a=e.onUnlock,o=e.t;return c.a.createElement("div",{className:"Head"},c.a.createElement("div",{className:"RoomStatus"},t?c.a.createElement(I,{icon:"lock",onClick:a,size:"M",title:o("rooms.locked")}):c.a.createElement(I,{icon:"unlock",onClick:n,size:"M",title:o("rooms.unlocked")})),c.a.createElement("div",{className:"RoomName"},r?r.name:""),c.a.createElement("div",{className:"RoomLink"},c.a.createElement(I,{icon:"link",onClick:this.onCopyLink,size:"M",title:o("rooms.copy_link")})))},this.onCopyLink=Object(o.a)(a.a.mark((function e(){var r;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.props.t,e.next=3,L(document.location.href.split("?")[0]);case 3:t.props.onMessage(r("rooms.link_copied_to_clipboard"));case 4:case"end":return e.stop()}}),e)})))}}var U=Object(S.b)()(A);const D=e=>e.rooms.room_info,F=e=>!e.rooms.room_access.secret;function z(e,t){return void 0===t?{type:e}:{type:e,payload:t}}const B=e=>z("modals/OPEN",e),G=()=>z("modals/POP");var H=r(111);let K=0;const V=(e,t,r=5e3)=>n=>{const a=K++;n(z("message/ADD",{id:a,stamp:(new Date).getTime(),text:t,type:e})),setTimeout(()=>n((e=>z("message/REMOVE",e))(a)),r)},W=(e,t)=>r=>{var n;r(V("error",t?"".concat(e,": ").concat((n=t).response&&n.response.data&&n.response.data.message?n.response.data.message:n.message):e,3e3))};var J=r(17);r(84);const Q={databaseURL:"https://test-rl-7ffe8.firebaseio.com"};console.debug(Q);var X=Q;const Y=J.initializeApp(X),Z=J.database(Y),$=Z.ref("members"),ee=Z.ref("rooms"),te=Z.ref("users"),re=(e,t)=>{const r=ee.child(e),n=r.child("info"),s=$.child(e);let c=t||"";console.debug("INIT SECRET",c);let i={name:"dummy",queue:{},queue_position:0,timestamp:0,type:"dj"};return{getInfo:()=>i,id:e,isLocked:()=>!c,setSecret:e=>{console.debug("SETTING SECRET",e),c=e},wait:function(){var e=Object(o.a)(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((e,t)=>{n.once("value",r=>{const n=r.val();n?(i=n,e(i)):t(new Error("Room is invalid"))})}));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),subscribeInfo:e=>{n.on("value",e)},subscribeMembers:(e,t)=>{s.on("child_added",e),s.on("child_removed",t)},unsubscribeInfo:e=>{n.off("value",e)},unsubscribeMembers:(e,t)=>{s.off("child_added",e),s.off("child_removed",t)},update:function(){var e=Object(o.a)(a.a.mark((function e({name:t,queue:n,queue_position:o}){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0!==t&&(i.name=t),void 0!==n&&(i.queue=n),void 0!==o&&(i.queue_position=o),e.next=5,r.set({info:Object(f.a)({},i,{timestamp:J.database.ServerValue.TIMESTAMP}),secret:c});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}},ne=(e,t)=>{const r=te.child(e),n=r.child("info");let s=null,c=t||"",i={name:"dummy",online:!1,room_id:"",status:"",timestamp:0};const l=function(){var e=Object(o.a)(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((e,t)=>{n.once("value",r=>{const n=r.val();n?(i=n,e(i)):t(new Error("User is invalid"))})}));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),u=function(){var e=Object(o.a)(a.a.mark((function e({name:t,room_id:n}){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0!==t&&(i.name=t),void 0!==n&&(i.room_id=n),e.next=4,r.set({info:Object(f.a)({},i,{online:!0,status:"online",timestamp:J.database.ServerValue.TIMESTAMP}),secret:c});case 4:p();case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),p=()=>{r.onDisconnect().cancel(),r.onDisconnect().set({info:Object(f.a)({},i,{online:!1,room_id:"",status:"disconnected",timestamp:J.database.ServerValue.TIMESTAMP}),secret:c})};return{id:e,enter:function(){var t=Object(o.a)(a.a.mark((function t(r){return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!s){t.next=4;break}return t.next=3,s.remove();case 3:s=null;case 4:return t.next=6,u({room_id:r.id});case 6:return s=$.child(r.id).child(e),s.onDisconnect().remove(),t.next=10,s.set({timestamp:J.database.ServerValue.TIMESTAMP});case 10:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),exit:function(){var e=Object(o.a)(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!s){e.next=4;break}return e.next=3,s.remove();case 3:s=null;case 4:return e.next=6,u({room_id:""});case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),isLocked:()=>!c,setSecret:e=>{c=e},wait:l,subscribeInfo:e=>{n.on("value",e)},unsubscribeInfo:e=>{n.off("value",e)},update:u,getInfo:()=>i}},ae=(e,t)=>z("queue/SET",{position:t,trackIds:e}),oe=()=>function(){var e=Object(o.a)(a.a.mark((function e(t,r){var n,o;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r(),!(o=n.rooms.room)||o.isLocked()){e.next=14;break}return e.prev=2,console.debug("Clearing queue..."),e.next=6,o.update({queue:{},queue_position:0});case 6:e.next=12;break;case 8:e.prev=8,e.t0=e.catch(2),t(W("Cannot clear queue")),t(xe());case 12:e.next=15;break;case 14:t(W("Room is locked"));case 15:case"end":return e.stop()}}),e,null,[[2,8]])})));return function(t,r){return e.apply(this,arguments)}}(),se=e=>function(){var t=Object(o.a)(a.a.mark((function t(r,n){var o,s,c;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=n(),!((s=o.rooms.room)&&!s.isLocked()&&e.length>0)){t.next=16;break}return t.prev=2,console.debug("Appending queue...",{trackIds:e}),c={},[...n().queue.trackIds,...e].forEach((e,t)=>{c[t]={id:e,type:"deezer"}}),t.next=8,s.update({queue:c});case 8:t.next=14;break;case 10:t.prev=10,t.t0=t.catch(2),r(W("Cannot append in queue")),r(xe());case 14:t.next=17;break;case 16:r(W("Room is locked"));case 17:case"end":return t.stop()}}),t,null,[[2,10]])})));return function(e,r){return t.apply(this,arguments)}}(),ce=e=>function(){var t=Object(o.a)(a.a.mark((function t(r,n){var o,s,c,i,l,u,p,d;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=n(),s=o.queue,c=s.trackIds,i=s.position,!(l=o.rooms.room)||l.isLocked()){t.next=20;break}if(!(e<c.length)){t.next=18;break}return t.prev=3,console.debug("Removing from queue...",{index:e}),u=i%c.length,p={},(d=[...n().queue.trackIds]).splice(e,1),d.forEach((e,t)=>{p[t]={id:e,type:"deezer"}}),t.next=12,l.update({queue:p,queue_position:e<u?i-1:i});case 12:t.next=18;break;case 14:t.prev=14,t.t0=t.catch(3),r(W("Cannot remove from queue")),r(xe());case 18:t.next=21;break;case 20:r(W("Room is locked"));case 21:case"end":return t.stop()}}),t,null,[[3,14]])})));return function(e,r){return t.apply(this,arguments)}}(),ie=e=>function(){var t=Object(o.a)(a.a.mark((function t(r,n){var o,s;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=n(),!(s=o.rooms.room)||s.isLocked()){t.next=14;break}return t.prev=2,console.debug("Set queue position...",{position:e}),t.next=6,s.update({queue_position:e});case 6:t.next=12;break;case 8:t.prev=8,t.t0=t.catch(2),r(W("Cannot set queue position")),r(xe());case 12:t.next=15;break;case 14:r(W("Room is locked"));case 15:case"end":return t.stop()}}),t,null,[[2,8]])})));return function(e,r){return t.apply(this,arguments)}}(),le=()=>function(){var e=Object(o.a)(a.a.mark((function e(t,r){var n,o,s,c;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=r(),o=n.queue,s=o.position,(c=o.trackIds).length>0&&(console.debug("Moving backward..."),t(ie(s>0?s-1:c.length-1)));case 2:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),ue=()=>function(){var e=Object(o.a)(a.a.mark((function e(t,r){var n,o,s;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=r(),o=n.queue,s=o.position,o.trackIds.length>0&&(console.debug("Moving forward..."),t(ie(s+1)));case 2:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),pe=e=>z("tracks/SET_TRACKS",e),de=(e,t,r)=>r.indexOf(e)===t,me=(e,t,r)=>function(){var n=Object(o.a)(a.a.mark((function n(o,s,{deezer:c,previewPlayer:i}){var l,u,p,d,m,h;return a.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!(e.length>0)){n.next=23;break}if(n.prev=1,l=s(),u=l.tracks.tracks,p=e.filter(e=>!u[e]).filter(de),d=[],!(p.length>0)){n.next=11;break}return console.debug("Loading track...",{trackIds:p}),n.next=9,Promise.all(p.map(e=>c.loadTrack(e)));case 9:d=n.sent,o(pe(d));case 11:if(t&&(console.debug("Enqueuing track...",{trackIds:e}),o(se(e))),!r){n.next=18;break}return m=e[0],h=u[m]||d.find(e=>e.id.toString()===m),console.debug("Previewing track...",{track:h,trackId:m}),n.next=18,i.play(0,h.preview,0);case 18:n.next=23;break;case 20:n.prev=20,n.t0=n.catch(1),o(W("Cannot load track",n.t0));case 23:case"end":return n.stop()}}),n,null,[[1,20]])})));return function(e,t,r){return n.apply(this,arguments)}}(),he=(e,t,r,n)=>function(){var s=Object(o.a)(a.a.mark((function o(s,c,{deezer:i}){var l,u,p;return a.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(a.prev=0,l=c(),u="".concat(e,"|").concat(t),p=l.containers.containers[u]){a.next=17;break}console.debug("Loading container...",{containerId:t,containerType:e}),a.t0=e,a.next="album"===a.t0?9:"playlist"===a.t0?13:17;break;case 9:return a.next=11,i.loadAlbum(t);case 11:return p=a.sent,a.abrupt("break",17);case 13:return a.next=15,i.loadPlaylist(t);case 15:return p=a.sent,a.abrupt("break",17);case 17:p&&(s(z("containers/SET_CONTAINERS",[p])),p.tracks&&p.tracks.data.length>0&&(s(pe(p.tracks.data)),r&&(console.debug("Enqueuing container..."),s(se(p.tracks.data.map(e=>e.id.toString())))),n&&(console.debug("Previewing container..."),s(me([p.tracks.data[0].id.toString()],!1,!0))))),a.next=23;break;case 20:a.prev=20,a.t1=a.catch(0),s(W("Cannot load container",a.t1));case 23:case"end":return a.stop()}}),o,null,[[0,20]])})));return function(e,t,r){return s.apply(this,arguments)}}(),fe=(e,t)=>function(){var r=Object(o.a)(a.a.mark((function r(n){return a.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:console.debug("Previewing container...",{containerType:e,containerId:t}),n(he(e,t,!1,!0));case 2:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}();var be=r(9),ve=Object(be.b)();const ke=(e,t)=>z("rooms/SET_ROOM",{info:t,room:e}),ye=(e,t)=>z("rooms/SET_ROOM_ACCESS",{id:e,secret:t}),ge=e=>z("rooms/SET_ROOM_COLOR",e),Ee=(e,t)=>function(){var r=Object(o.a)(a.a.mark((function r(n){var o;return a.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,o=Object(H.a)(),console.debug("Creating room...",{id:o,secret:t}),r.next=5,re(o,t).update({name:e});case 5:n(Ce(o,t)),r.next=11;break;case 8:r.prev=8,r.t0=r.catch(0),n(W("Cannot create room",r.t0));case 11:case"end":return r.stop()}}),r,null,[[0,8]])})));return function(e){return r.apply(this,arguments)}}();let _e=null;const Ce=(e,t)=>function(){var r=Object(o.a)(a.a.mark((function r(n,o){var s,c,i;return a.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(s=o(),(c=s.rooms.room)&&c.id===e){r.next=23;break}return n(we()),r.prev=3,console.debug("Entering room...",{id:e,secret:t}),i=re(e,t),r.t0=n,r.t1=ke,r.t2=i,r.next=11,i.wait();case 11:r.t3=r.sent,r.t4=(0,r.t1)(r.t2,r.t3),(0,r.t0)(r.t4),n(ye(e,t)),_e=e=>{const t=e.val();let r=[];t.queue&&(r=Object.entries(t.queue).sort((e,t)=>Number(e[0])-Number(t[0])).map(e=>e[1].id),n(me(r,!1,!1))),n(ae(r,t.queue_position)),n(ke(i,t))},i.subscribeInfo(_e),ve.push("/room/".concat(e,"?key=").concat(t)),r.next=23;break;case 20:r.prev=20,r.t5=r.catch(3),n(W("Cannot join room",r.t5));case 23:case"end":return r.stop()}}),r,null,[[3,20]])})));return function(e,t){return r.apply(this,arguments)}}(),we=()=>function(){var e=Object(o.a)(a.a.mark((function e(t,r){var n,o;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=r(),(o=n.rooms.room)&&(console.debug("Exiting room..."),o.unsubscribeInfo(_e),_e=null,t(ke(null,null)),t(ye("","")));case 2:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),xe=()=>function(){var e=Object(o.a)(a.a.mark((function e(t,r){var n,o,s,c;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=r(),o=n.rooms,s=o.room,c=o.room_access.id,s&&s.id===c&&(console.debug("Locking room...",{id:c}),s.setSecret(""),t(ye(c,"")));case 2:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),Se=e=>function(){var t=Object(o.a)(a.a.mark((function t(r,n){var o,s,c,i;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:o=n(),s=o.rooms,c=s.room,i=s.room_access.id,c&&c.id===i&&(console.debug("Unlocking room...",{id:i,secret:e}),c.setSecret(e),r(ye(i,e)));case 2:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}(),Oe=(e,t,r)=>function(){var n=Object(o.a)(a.a.mark((function n(o){return a.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:t&&o(he(e,t,!0,!1)),r&&o(me([r],!0,!1));case 2:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}();var je=Object(l.b)(e=>({locked:F(e),room:D(e)}),e=>({onLock:()=>e(xe()),onMessage:t=>e(V("info",t)),onUnlock:()=>e(B({type:"UnlockRoom",props:null}))}))(U);r(86);class Re extends s.Component{constructor(...e){super(...e),this.render=()=>{const e=this.props,t=e.playable,r=e.playing,n=e.image,a=e.onPlay,o=e.onStop,s=e.t;return t?c.a.createElement("div",{className:j()("Cover",{playing:r}),style:{backgroundImage:"url('".concat(n,"')")},onClick:r?o:a},r?c.a.createElement(M,{icon:"pause",title:s("player.stop")}):c.a.createElement(M,{icon:"play",title:s("player.play")})):c.a.createElement("div",{className:j()("Cover",{playing:r}),style:{backgroundImage:"url('".concat(n,"')")}},r?c.a.createElement(M,{icon:"music",title:s("player.playing")}):null)}}}var Ne=Object(S.b)()(Re);r(87);class Te extends s.Component{constructor(...e){super(...e),this.render=()=>{const e=this.props,t=e.actions,r=e.album,n=e.playable,a=e.playing,o=e.onPlay,s=e.onStop,i=e.t;return c.a.createElement("div",{className:"Media Album"},t,c.a.createElement(Ne,{playable:n,playing:a,image:r.cover_small,onPlay:o,onStop:s}),c.a.createElement("div",{className:"Metas"},c.a.createElement("div",{className:"Meta AlbumTitle"},c.a.createElement("a",{href:r.link,target:"_blank",rel:"noopener noreferrer"},r.title)),c.a.createElement("div",{className:"Meta AlbumArtistName"},c.a.createElement("a",{href:r.artist.link,target:"_blank",rel:"noopener noreferrer"},i("medias.by",{artist:r.artist.name})))))}}}const Me=Object(S.b)()(Te);class Pe extends s.Component{constructor(...e){super(...e),this.render=()=>{const e=this.props,t=e.actions,r=e.playlist,n=e.playable,a=e.playing,o=e.onPlay,s=e.onStop;return c.a.createElement("div",{className:"Media Playlist"},t,c.a.createElement(Ne,{playable:n,playing:a,image:r.picture_small,onPlay:o,onStop:s}),c.a.createElement("div",{className:"Metas"},c.a.createElement("div",{className:"Meta PlaylistTitle"},c.a.createElement("a",{href:r.link,target:"_blank",rel:"noopener noreferrer"},r.title))))}}}const qe=Object(S.b)()(Pe);class Ie extends s.Component{constructor(...e){super(...e),this.render=()=>{const e=this.props,t=e.actions,r=e.track,n=e.playable,a=e.playing,o=e.onPlay,s=e.onStop,i=e.t;return c.a.createElement("div",{className:"Media Track"},t,c.a.createElement(Ne,{playable:n,playing:a,image:r.album.cover_small,onPlay:o,onStop:s}),c.a.createElement("div",{className:"Metas"},c.a.createElement("div",{className:"Meta TrackTitle"},c.a.createElement("a",{href:r.link,target:"_blank",rel:"noopener noreferrer"},r.title)),c.a.createElement("div",{className:"Meta TrackArtistName"},c.a.createElement("a",{href:r.artist.link,target:"_blank",rel:"noopener noreferrer"},i("medias.by",{artist:r.artist.name})))))}}}const Le=Object(S.b)()(Ie);r(88);class Ae extends s.Component{constructor(...e){super(...e),this.render=()=>{const e=this.props,t=e.locked,r=e.playing,n=e.trackIndex,a=e.tracks,o=e.onPlay,s=e.onRemove,i=e.onSearch,l=e.onStop,u=e.t;return c.a.createElement("div",{className:"Queue"},a.length>0?a.map((e,a)=>c.a.createElement("div",{className:"QueueItem",key:a},c.a.createElement(Le,{track:e,playable:!t,playing:r&&n===a,onPlay:()=>o(a),onStop:l,actions:t?null:c.a.createElement(I,{title:u("medias.remove"),icon:"trash",onClick:()=>s(a)})}))):c.a.createElement("div",{className:"QueueEmpty"},c.a.createElement(I,{title:"...",icon:"shower",onClick:i,size:"L"}),c.a.createElement("span",{onClick:i},u("rooms.empty"))))}}}var Ue=Object(S.b)()(Ae);const De=(e,t)=>{const r=[],n=e.tracks.tracks;var a,o=Object(h.a)(t);try{for(o.s();!(a=o.n()).done;){const e=n[a.value];e&&r.push(e)}}catch(s){o.e(s)}finally{o.f()}return r};var Fe=r(28),ze=r(35);const Be={},Ge={bg:{r:255,g:255,b:255},fg:{r:0,g:0,b:0}},He=function(){var e=Object(o.a)(a.a.mark((function e(t){var r,n,o,s;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=Ge,!t){e.next=18;break}if(r=Be[t]){e.next=18;break}return e.prev=4,e.next=7,ze.read(t);case 7:return n=e.sent,e.next=10,n.resize(1,1).getPixelColor(0,0);case 10:o=e.sent,s=ze.intToRGBA(o),Be[t]=r={bg:s,fg:.299*s.r+.587*s.g+.114*s.b>186?{r:0,g:0,b:0}:{r:255,g:255,b:255}},e.next=18;break;case 15:e.prev=15,e.t0=e.catch(4),console.debug("An error prevented colorpicking",e.t0);case 18:return e.abrupt("return",r);case 19:case"end":return e.stop()}}),e,null,[[4,15]])})));return function(t){return e.apply(this,arguments)}}(),Ke=e=>z("player/SET_TRACK_PERCENT",e);let Ve=null,We=null;const Je=(e,t,r)=>{let n=-1;return t!==r&&(console.debug("Detected play change...",{playingPosition:t,queuePosition:r,isPlaying:e.isPlaying()}),n=e.isPlaying()?r:t>=0?t:r),n},Qe=(e,t,r)=>{Ve=setTimeout(Object(o.a)(a.a.mark((function n(){var o,s,c,i,l,u,p,d,m,h,f,b;return a.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(o=t(),s=o.queue,c=s.position,i=s.trackIds,l=o.tracks.tracks,!(i.length>0)){n.next=18;break}if(u=r.getPlayingPosition(),!((p=Je(r,u,c))>=0)){n.next=15;break}return d=p%i.length,m=l[i[d]],console.debug("Applying play change...",{nextPosition:p,nextIndex:d,nextTrack:m}),e(ie(p)),n.next=11,Promise.all([He(m.album.cover_small),r.play(p,m.preview,0)]);case 11:h=n.sent,f=Object(Fe.a)(h,1),b=f[0],e(ge(b));case 15:Qe(e,t,r),n.next=20;break;case 18:console.debug("No more tracks in queue..."),e(Ze());case 20:case"end":return n.stop()}}),n)}))),250)},Xe=(e,t,r)=>{We=setTimeout(Object(o.a)(a.a.mark((function n(){var o;return a.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:o=t(),o.queue.trackIds.length>0&&(e(Ke(r.getTrackPercent())),Xe(e,t,r));case 2:case"end":return n.stop()}}),n)}))),200)},Ye=()=>function(){var e=Object(o.a)(a.a.mark((function e(t,r,{queuePlayer:n}){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Ve||We||(Qe(t,r,n),Xe(t,r,n),t(z("player/START")));case 1:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),Ze=()=>function(){var e=Object(o.a)(a.a.mark((function e(t,r,{queuePlayer:n}){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Ve||!We){e.next=9;break}return clearTimeout(Ve),Ve=null,clearTimeout(We),We=null,e.next=7,n.stop();case 7:t(z("player/STOP")),t(Ke(0));case 9:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),$e=e=>function(){var t=Object(o.a)(a.a.mark((function t(r,n,{deezer:o,previewPlayer:s}){var c,i;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,c=n(),i=c.tracks.tracks[e]){t.next=9;break}return console.debug("Loading track...",{trackId:e}),t.next=7,o.loadTrack(e);case 7:i=t.sent,r(pe([i]));case 9:return console.debug("Start previewing..."),t.next=12,s.play(0,i.preview,0);case 12:t.next=17;break;case 14:t.prev=14,t.t0=t.catch(0),r(W("Cannot load track",t.t0));case 17:case"end":return t.stop()}}),t,null,[[0,14]])})));return function(e,r,n){return t.apply(this,arguments)}}(),et=()=>function(){var e=Object(o.a)(a.a.mark((function e(t,r,{previewPlayer:n}){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.debug("Stop previewing..."),e.next=3,n.stop();case 3:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}();var tt=Object(l.b)(e=>({locked:F(e),playing:e.player.playing,trackIndex:e.queue.position%e.queue.trackIds.length,tracks:De(e,e.queue.trackIds)}),e=>({onPlay:t=>{e(Ye()),e(ie(t))},onRemove:t=>e(ce(t)),onSearch:()=>e(B({type:"Search",props:null})),onStop:()=>e(Ze())}))(Ue);r(89);class rt extends s.Component{constructor(...e){super(...e),this.render=()=>{const e=this.props,t=e.playing,r=e.value;return c.a.createElement("div",{className:j()("Progress",{playing:t})},c.a.createElement("progress",{max:100,value:100*r}))}}}var nt=rt;var at=Object(l.b)(e=>({playing:e.player.playing,value:e.player.track_percent}),e=>({}))(nt);r(90);class ot extends s.Component{constructor(...e){super(...e),this.render=()=>{const e=this.props,t=e.onMoveBackward,r=e.onMoveForward,n=e.onPlay,a=e.onSearch,o=e.onStop,s=e.tracksCount,i=e.locked,l=e.playing,u=e.t;return c.a.createElement("div",{className:"Controls"},c.a.createElement("div",{className:"ControlsSet"},c.a.createElement("div",{className:"Control"},c.a.createElement(I,{disabled:i||0===s,icon:"step-backward",onClick:t,size:"M",title:u("player.backward")})),c.a.createElement("div",{className:"Control"},l?c.a.createElement(I,{disabled:i||0===s,onClick:o,icon:"pause",title:u("player.stop"),size:"L"}):c.a.createElement(I,{disabled:i||0===s,onClick:n,icon:"play",size:"L",title:u("player.play")})),c.a.createElement("div",{className:"Control"},c.a.createElement(I,{disabled:i||0===s,icon:"step-forward",onClick:r,size:"M",title:u("player.forward")}))),c.a.createElement(at,null),c.a.createElement("div",{className:"ControlsSet"},c.a.createElement("div",{className:"Control"},c.a.createElement(I,{disabled:i||0===s,onClick:this.onClear,icon:"trash",title:u("rooms.clear")})),c.a.createElement("div",{className:"Control"},c.a.createElement(I,{onClick:a,icon:"search",title:u("medias.search")})),c.a.createElement("div",{className:"Control"},c.a.createElement(I,{onClick:this.onExit,icon:"sign-out",title:u("rooms.exit")}))))},this.onClear=()=>{const e=this.props.t;window.confirm(e("rooms.confirm_clear"))&&this.props.onClear()},this.onExit=()=>{const e=this.props.t;window.confirm(e("rooms.confirm_exit"))&&ve.push("/")}}}var st=Object(S.b)()(ot);var ct=Object(l.b)(e=>({tracksCount:e.queue.trackIds.length,locked:F(e),playing:e.player.playing}),e=>({onClear:()=>{e(oe()),e(Ze())},onMoveBackward:()=>e(le()),onMoveForward:()=>e(ue()),onPlay:()=>e(Ye()),onSearch:()=>e(B({type:"Search",props:null})),onStop:()=>e(Ze())}))(st);r(91);class it extends s.Component{constructor(...e){super(...e),this.componentDidMount=()=>{this.props.onEnter()},this.componentWillUnmount=()=>{this.props.onExit()},this.render=()=>{const e=this.props.color,t=e.fg,r=e.bg;return c.a.createElement("div",{className:"Room",style:{color:"rgb(".concat(t.r,", ").concat(t.g,", ").concat(t.b,")"),backgroundColor:"rgb(".concat(r.r,", ").concat(r.g,", ").concat(r.b,")")}},c.a.createElement(je,null),c.a.createElement(tt,null),c.a.createElement(ct,null))}}}var lt=Object(p.g)(it);var ut=Object(l.b)((e,t)=>({color:e.rooms.room_color}),(e,t)=>{const r=x.parse(t.location.search.substr(1)).key;return{onEnter:()=>e(Ce(t.match.params.room_id,r||"")),onExit:()=>e(we())}})(lt);r(93);class pt extends s.Component{constructor(...e){super(...e),this.render=()=>{const e=this.props,t=e.loggedIn,r=e.onCreateRoom,n=e.onConnectUser,a=e.t;return c.a.createElement("div",{className:"Splash"},c.a.createElement("div",{className:"Top"},c.a.createElement("div",{className:"Logo"},c.a.createElement(u.b,{to:"/"},"Party")),c.a.createElement("div",{className:"PoweredWith"},c.a.createElement("span",null,a("splash.powered_with")),c.a.createElement("a",{href:"https://www.deezer.com",target:"_blank",rel:"noopener noreferrer"},c.a.createElement("img",{src:"/images/deezer.svg",height:"20px",title:"Deezer",alt:"Deezer Logo"})))),c.a.createElement("div",{className:"Middle"},c.a.createElement("div",{className:"Menu"},t?c.a.createElement("div",{className:"MenuItem"},c.a.createElement(I,{displayTitle:!0,icon:"plus",onClick:r,size:"L",title:a("rooms.create_room")})):c.a.createElement(s.Fragment,null,c.a.createElement("div",{className:"MenuItem"},c.a.createElement(I,{displayTitle:!0,onClick:n,icon:"sign-in",size:"L",title:a("users.connect")}))))),c.a.createElement("div",{className:"Bottom"},c.a.createElement("div",{className:"Menu"},t?c.a.createElement("div",{className:"MenuItem"},c.a.createElement(I,{displayTitle:!0,icon:"sign-out",onClick:this.onDisconnect,size:"M",title:a("users.disconnect")})):c.a.createElement("div",{className:"MenuItem"},c.a.createElement(I,{displayTitle:!0,icon:"info",onClick:()=>{},size:"M",title:a("splash.CGU")})))))},this.onDisconnect=()=>{window.confirm(this.props.t("users.confirm_disconnect"))&&this.props.onDisconnectUser()}}}var dt=Object(S.b)()(pt);const mt=e=>e.users.user_info,ht=(e,t)=>z("users/SET_USER",{info:t,user:e}),ft=(e,t)=>z("users/SET_USER_ACCESS",{id:e,secret:t}),bt=(e,t)=>function(){var r=Object(o.a)(a.a.mark((function r(n){var o;return a.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,console.debug("Creating user..."),o=Object(H.a)(),r.next=5,ne(o,t).update({name:e});case 5:n(kt(o,t)),r.next=11;break;case 8:r.prev=8,r.t0=r.catch(0),n(W("Cannot create user",r.t0));case 11:case"end":return r.stop()}}),r,null,[[0,8]])})));return function(e){return r.apply(this,arguments)}}();let vt=null;const kt=(e,t)=>function(){var r=Object(o.a)(a.a.mark((function r(n,o){var s,c,i;return a.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(s=o(),(c=s.users.user)&&c.id===e){r.next=23;break}return n(yt()),r.prev=3,console.debug("Connection user...",{id:e,secret:t}),i=ne(e),r.t0=n,r.t1=ht,r.t2=i,r.next=11,i.wait();case 11:r.t3=r.sent,r.t4=(0,r.t1)(r.t2,r.t3),(0,r.t0)(r.t4),n(ft(e,t)),vt=e=>{const t=e.val();n(ht(i,t))},i.subscribeInfo(vt),r.next=23;break;case 19:r.prev=19,r.t5=r.catch(3),n(W("Cannot connect user",r.t5)),n(ft("",""));case 23:case"end":return r.stop()}}),r,null,[[3,19]])})));return function(e,t){return r.apply(this,arguments)}}(),yt=()=>function(){var e=Object(o.a)(a.a.mark((function e(t,r){var n,o;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=r(),(o=n.users.user)&&(console.debug("Disconnecting user..."),o.unsubscribeInfo(vt),vt=null,ht(null,null),t(ft("","")));case 2:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),gt=()=>function(){var e=Object(o.a)(a.a.mark((function e(t,r){var n,o,s,c;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=r(),o=n.users.user_access,s=o.id,c=o.secret,s&&c&&(console.debug("Reconnecting user...",{id:s,secret:c}),t(kt(s,c)));case 2:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}();var Et=Object(l.b)(e=>({loggedIn:!!e.users.user_access.id,user:mt(e)}),e=>({onCreateRoom:()=>e(B({type:"CreateRoom",props:null})),onConnectUser:()=>e(B({type:"CreateUser",props:null})),onDisconnectUser:()=>e(yt())}))(dt),_t=r(23);class Ct extends s.Component{constructor(...e){super(...e),this.render=()=>{const e=this.props,t=e.children,r=e.className,n=e.title,a=e.renderFoot,o=e.onClose,s=e.onPop,i=e.has_prev_modal;return c.a.createElement("form",{className:j()("Modal",r),onSubmit:this.onSubmit},c.a.createElement("div",{className:"ModalHead"},c.a.createElement(I,{kind:"special",className:j()("ModalHeadBack",{hidden:!i}),icon:"angle-left",title:"Back",onClick:s}),c.a.createElement("div",{className:"ModalTitle"},n),c.a.createElement(I,{kind:"special",className:"ModalHeadClose",onClick:o,title:"Cancel",icon:"times"})),c.a.createElement("div",{className:"ModalBody"},t),c.a.createElement("div",{className:"ModalFoot"},a&&a()))},this.onSubmit=e=>{e.preventDefault(),this.props.onSubmit&&this.props.onSubmit()}}}var wt=Object(S.b)()(Ct);var xt=Object(l.b)(e=>({has_prev_modal:e.modals.stack.length>1}),e=>({onClose:()=>e(G()),onPop:()=>e(G())}))(wt);r(94);class St extends s.Component{constructor(...e){super(...e),this.render=()=>{const e=this.props,t=e.children,r=e.className,n=e.renderButtons,a=e.title,o=e.onSubmit;return c.a.createElement(xt,{className:j()("FormModal",r),title:a,renderFoot:n,onSubmit:o},t)}}}var Ot=St;class jt extends s.Component{constructor(...e){super(...e),this.idRef=Object(s.createRef)(),this.state={id:"",secret:""},this.render=()=>{const e=this.props.t,t=this.state,r=t.id,n=t.secret;return c.a.createElement(Ot,{title:e("users.connection"),onSubmit:this.onConnect,renderButtons:this.renderButtons},c.a.createElement("div",{className:"ModalField"},c.a.createElement("label",{htmlFor:"modal-id"},e("users.user_id")),c.a.createElement("input",{id:"modal-id",type:"text",placeholder:e("users.user_id_placeholder"),maxLength:36,minLength:36,required:!0,value:r,ref:this.idRef,onChange:e=>{this.setState({id:e.target.value})}})),c.a.createElement("div",{className:"ModalField"},c.a.createElement("label",{htmlFor:"modal-secret"},e("users.user_secret")),c.a.createElement("input",{id:"modal-secret",type:"password",placeholder:e("users.user_secret_placeholder"),maxLength:36,minLength:36,required:!0,value:n,onChange:e=>{this.setState({secret:e.target.value})}})))},this.renderButtons=()=>{const e=this.props.t;return c.a.createElement(s.Fragment,null,c.a.createElement(I,{title:e("users.connect"),kind:"primary",icon:"sign-in",type:"submit"}),c.a.createElement(q,{onClick:this.props.onClose}),c.a.createElement(I,{title:e("users.create_user"),kind:"default",icon:"plus",onClick:this.props.onToggle}))},this.onConnect=()=>{const e=this.props,t=e.onClose,r=e.onConnect,n=e.onError,a=e.t,o=this.state,s=o.id,c=o.secret;0!==s.trim().length?0!==c.trim().length?(r(s,c),t()):n(a("users.user_secret_is_invalid")):n(a("users.user_id_is_invalid"))}}componentDidMount(){this.idRef.current&&this.idRef.current.focus()}}var Rt=Object(S.b)()(jt);var Nt=Object(l.b)(e=>({}),e=>({onClose:()=>e(G()),onConnect:(t,r)=>e(kt(t,r)),onError:t=>e(W(t)),onToggle:()=>e(B({type:"CreateUser",props:null}))}))(Rt);class Tt extends s.Component{constructor(...e){var t;super(...e),t=this,this.render=()=>{const e=this.props,t=e.id,r=e.label,n=e.onChange,a=e.placeholder,o=e.value;return c.a.createElement("div",{className:"ModalField"},c.a.createElement("label",{htmlFor:t},r),c.a.createElement("div",{style:{display:"flex",flexDirection:"row",justifyContent:"space-between"}},c.a.createElement("input",{style:{flexGrow:1,marginRight:"0.5rem"},id:t,type:"password",placeholder:a,maxLength:36,minLength:36,required:!0,value:o,onChange:e=>n(e.target.value)}),c.a.createElement(I,{icon:"clipboard",onClick:this.onCopyToClipboard,size:"M",title:"Copy to Clipboard"})))},this.onCopyToClipboard=Object(o.a)(a.a.mark((function e(){var r,n,o,s;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.props,n=r.onMessage,o=r.value,s=r.t,e.next=3,L(o);case 3:n(s("secret_copied_to_clipboard"));case 4:case"end":return e.stop()}}),e)})))}}var Mt=Object(S.b)()(Tt);var Pt=Object(l.b)(e=>({}),e=>({onMessage:t=>e(V("info",t))}))(Mt);let qt=1;class It extends s.Component{constructor(...e){super(...e),this.nameRef=Object(s.createRef)(),this.state={name:"",secret:Object(H.a)()},this.render=()=>{const e=this.props.t,t=this.state,r=t.name,n=t.secret;return c.a.createElement(Ot,{title:e("rooms.room_creation"),onSubmit:this.onCreate,renderButtons:this.renderButtons},c.a.createElement("div",{className:"ModalField"},c.a.createElement("label",{htmlFor:"modal-name"},e("rooms.room_name")),c.a.createElement("input",{id:"modal-name",type:"text",placeholder:e("rooms.room_name_placeholder"),maxLength:100,minLength:2,required:!0,value:r,ref:this.nameRef,onChange:e=>this.setState({name:e.target.value})})),c.a.createElement(Pt,{id:"modal-secret",label:e("rooms.room_key"),placeholder:e("rooms.room_key_placeholder"),value:n,onChange:e=>this.setState({secret:e})}))},this.renderButtons=()=>{const e=this.props.t;return c.a.createElement(s.Fragment,null,c.a.createElement(I,{title:e("rooms.create_room"),kind:"primary",icon:"plus",type:"submit"}),c.a.createElement(q,{onClick:this.props.onClose}))},this.onCreate=()=>{const e=this.props,t=e.onClose,r=e.onCreate,n=e.onError,a=e.t,o=this.state,s=o.name,c=o.secret;0!==s.trim().length?0!==c.trim().length?(r(s,c),t(),qt++):n(a("rooms.room_secret_is_invalid")):n(a("rooms.room_name_is_invalid"))}}componentDidMount(){this.setState({name:"".concat(this.props.t("rooms.room")," ").concat(qt)}),this.nameRef.current&&this.nameRef.current.focus()}}var Lt=Object(S.b)()(It);var At=Object(l.b)(e=>({}),e=>({onClose:()=>e(G()),onCreate:(t,r)=>e(Ee(t,r)),onError:t=>e(W(t))}))(Lt);let Ut=1;class Dt extends s.Component{constructor(...e){super(...e),this.nameRef=Object(s.createRef)(),this.state={name:"",secret:Object(H.a)()},this.render=()=>{const e=this.props.t,t=this.state,r=t.name,n=t.secret;return c.a.createElement(Ot,{title:e("users.user_creation"),onSubmit:this.onCreate,renderButtons:this.renderButtons},c.a.createElement("div",{className:"ModalField"},c.a.createElement("label",{htmlFor:"modal-name"},e("users.user_name")),c.a.createElement("input",{id:"modal-name",type:"text",placeholder:e("users.user_name_placeholder"),maxLength:100,minLength:2,required:!0,value:r,ref:this.nameRef,onChange:e=>this.setState({name:e.target.value})})),c.a.createElement(Pt,{id:"modal-secret",label:e("users.user_secret"),placeholder:e("users.user_secret_placeholder"),value:n,onChange:e=>this.setState({secret:e})}))},this.renderButtons=()=>{const e=this.props.t;return c.a.createElement(s.Fragment,null,c.a.createElement(I,{title:e("users.create_user"),kind:"primary",icon:"plus",type:"submit"}),c.a.createElement(q,{onClick:this.props.onClose}),c.a.createElement(I,{title:e("users.connect"),kind:"default",icon:"sign-in",onClick:this.props.onToggle}))},this.onCreate=()=>{const e=this.props,t=e.onClose,r=e.onCreate,n=e.onError,a=e.t,o=this.state,s=o.name,c=o.secret;0!==s.trim().length?0!==c.trim().length?(r(s,c),t(),Ut++):n(a("users.user_secret_is_invalid")):n(a("users.user_name_is_invalid"))}}componentDidMount(){this.setState({name:"".concat(this.props.t("users.user")," ").concat(Ut)}),this.nameRef.current&&this.nameRef.current.focus()}}var Ft=Object(S.b)()(Dt);var zt=Object(l.b)(e=>({}),e=>({onClose:()=>e(G()),onCreate:(t,r)=>e(bt(t,r)),onError:t=>e(W(t)),onToggle:()=>e(B({type:"ConnectUser",props:null}))}))(Ft),Bt=r(57),Gt=r.n(Bt);const Ht=(()=>{const e=e=>new Promise((t,r)=>{Gt()(e,void 0,(e,n)=>{e?r(new Error(e.message)):t(n)})}),t=function(){var t=Object(o.a)(a.a.mark((function t(r,n){var o;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=n?"".concat("https://api.deezer.com","/").concat(r,"?").concat(n,"&output=jsonp&callback="):"".concat("https://api.deezer.com","/").concat(r,"?output=jsonp&callback="),t.next=3,e(o);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}(),r=(e,r)=>t("search/".concat(e),"q=".concat(encodeURIComponent(r))),n=(e,r)=>t("/".concat(e,"/").concat(r)),s=e=>r("album",e),c=e=>r("playlist",e),i=e=>r("track",e);return{searchAll:function(){var e=Object(o.a)(a.a.mark((function e(t){var r,n,o,l,u;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([s(t),c(t),i(t)]);case 2:return r=e.sent,n=Object(Fe.a)(r,3),o=n[0],l=n[1],u=n[2],e.abrupt("return",{albums:o,playlists:l,tracks:u});case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),loadAlbum:function(){var e=Object(o.a)(a.a.mark((function e(t){var r;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n("album",t);case 2:return(r=e.sent).tracks.data.forEach(e=>{e.album=r,e.artist.link="https://www.deezer.com/artist/".concat(e.artist.id)}),e.abrupt("return",r);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),loadPlaylist:e=>n("playlist",e),loadTrack:e=>n("track",e)}})();var Kt=({items:e,label:t,cb:r})=>e.length>0?c.a.createElement(s.Fragment,null,c.a.createElement("div",{className:"ModalField"},c.a.createElement("label",null,t)),e.slice(0,5).map(e=>c.a.createElement("div",{key:e.id,className:"ModalField"},c.a.createElement("div",{className:"SearchResultItem"},r(e))))):null;r(98);class Vt extends s.Component{constructor(...e){var t;super(...e),t=this,this.queryRef=Object(s.createRef)(),this.state={mediaId:0,mediaType:"track",query:"",results:{albums:{data:[],total:0},playlists:{data:[],total:0},tracks:{data:[],total:0}}},this.render=()=>{const e=this.props.t;return c.a.createElement(Ot,{className:"SearchModal",title:e("medias.medias_search"),onSubmit:this.onSearch,renderButtons:this.renderButtons},this.renderInputs(),this.renderResults())},this.renderButtons=()=>{const e=this.props.t;return c.a.createElement(s.Fragment,null,c.a.createElement(I,{title:e("medias.search"),kind:"primary",icon:"search",type:"submit"}),c.a.createElement(q,{onClick:this.props.onClose}))},this.renderInputs=()=>{const e=this.props.t,t=this.state.query;return c.a.createElement("div",{className:"ModalField"},c.a.createElement("input",{id:"modal-query",type:"text",placeholder:e("medias.search_placeholder"),maxLength:100,minLength:2,required:!0,value:t,ref:this.queryRef,onChange:e=>{this.setState({query:e.target.value})}}))},this.renderResults=()=>{const e=this.props,t=e.locked,r=e.t,n=this.state,a=n.mediaId,o=n.mediaType,i=n.results,l=i.albums,u=i.playlists,p=i.tracks;return c.a.createElement(s.Fragment,null,c.a.createElement(Kt,{label:"Albums",type:"album",items:l.data,cb:e=>c.a.createElement(Me,{actions:t?null:c.a.createElement(I,{title:r("medias.add"),icon:"plus",onClick:()=>this.onSelect("album",e.id)}),album:e,playable:!0,playing:"album"===o&&a===e.id,onPlay:()=>this.onStartPreview("album",e.id),onStop:()=>this.onStopPreview()})}),c.a.createElement(Kt,{label:"Playlists",type:"playlist",items:u.data,cb:e=>c.a.createElement(qe,{actions:t?null:c.a.createElement(I,{title:"Add",icon:"plus",onClick:()=>this.onSelect("playlist",e.id)}),playlist:e,playable:!0,playing:"playlist"===o&&a===e.id,onPlay:()=>this.onStartPreview("playlist",e.id),onStop:()=>this.onStopPreview()})}),c.a.createElement(Kt,{label:"Tracks",type:"track",items:p.data,cb:e=>c.a.createElement(Le,{actions:t?null:c.a.createElement(I,{title:"Add",icon:"plus",onClick:()=>this.onSelect("track",e.id)}),track:e,playable:!0,playing:"track"===o&&a===e.id,onPlay:()=>this.onStartPreview("track",e.id),onStop:()=>this.onStopPreview()})}))},this.onSearch=Object(o.a)(a.a.mark((function e(){var r;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((r=t.state.query).trim().length>0)){e.next=8;break}return e.t0=t,e.next=5,Ht.searchAll(r);case 5:e.t1=e.sent,e.t2={results:e.t1},e.t0.setState.call(e.t0,e.t2);case 8:case"end":return e.stop()}}),e)}))),this.onSelect=(e,t)=>this.props.onSelect(e,t.toString()),this.onStartPreview=(e,t)=>{this.props.onStartPreview(e,t.toString()),this.setState({mediaId:t,mediaType:e})},this.onStopPreview=()=>{this.props.onStopPreview(),this.setState({mediaId:0,mediaType:"track"})}}componentDidMount(){this.queryRef.current&&this.queryRef.current.focus()}componentWillUnmount(){this.props.onStopPreview()}}var Wt=Object(S.b)()(Vt);var Jt=Object(l.b)(e=>({locked:F(e)}),e=>({onClose:()=>e(G()),onSelect:(t,r)=>e("track"===t?Oe("album","",r):Oe(t,r,"")),onStartPreview:(t,r)=>{e("track"===t?$e(r):fe(t,r))},onStopPreview:()=>e(et())}))(Wt);class Qt extends s.Component{constructor(...e){super(...e),this.secretRef=Object(s.createRef)(),this.state={secret:""},this.render=()=>{const e=this.props.t,t=this.state.secret;return c.a.createElement(Ot,{title:e("rooms.room_unlock"),onSubmit:this.onUnlock,renderButtons:this.renderButtons},c.a.createElement("div",{className:"ModalField"},c.a.createElement("label",{htmlFor:"modal-secret"},e("rooms.room_key")),c.a.createElement("input",{id:"modal-secret",type:"password",placeholder:e("rooms.room_key_placeholder"),maxLength:36,minLength:36,required:!0,value:t,ref:this.secretRef,onChange:e=>{this.setState({secret:e.target.value})}})))},this.renderButtons=()=>{const e=this.props.t;return c.a.createElement(s.Fragment,null,c.a.createElement(I,{title:e("rooms.unlock"),kind:"primary",icon:"key",type:"submit"}),c.a.createElement(q,{onClick:this.props.onClose}))},this.onUnlock=()=>{const e=this.props,t=e.onClose;(0,e.onUnlock)(this.state.secret),t()}}componentDidMount(){this.secretRef.current&&this.secretRef.current.focus()}}var Xt=Object(S.b)()(Qt);var Yt=Object(l.b)(e=>({}),e=>({onClose:()=>e(G()),onUnlock:t=>e(Se(t))}))(Xt);r(99);class Zt extends s.Component{constructor(...e){super(...e),this.state={curr_prereq:void 0,prev_prereq:void 0},this.componentDidMount=()=>{document.addEventListener("keydown",this.onKeyDown)},this.componentWillUnmount=()=>{document.removeEventListener("keydown",this.onKeyDown)},this.componentDidUpdate=e=>{const t=e.prereq,r=this.props.prereq;t!==r&&this.setState({curr_prereq:void 0,prev_prereq:t},()=>{r&&setTimeout(()=>{this.setState({curr_prereq:r})},300)})},this.render=()=>{const e=this.state,t=e.curr_prereq,r=e.prev_prereq,n=t||r;let a=null;return n&&(a=(e=>{switch(e.type){case"ConnectUser":return c.a.createElement(Nt,null);case"CreateRoom":return c.a.createElement(At,null);case"CreateUser":return c.a.createElement(zt,null);case"Search":return c.a.createElement(Jt,null);case"UnlockRoom":return c.a.createElement(Yt,null)}})(n)),c.a.createElement(_t.CSSTransition,{in:!!t,timeout:300,unmountOnExit:!0},c.a.createElement("div",{className:"ModalOverlay",onClick:this.onClickOverlay},a&&c.a.createElement("div",{className:"ModalWrapper",role:"dialog",onClick:this.onClickWrapper},a)))},this.onClickOverlay=e=>{e.stopPropagation(),this.props.onCloseModal()},this.onClickWrapper=e=>{e.stopPropagation()},this.onKeyDown=e=>{27===e.keyCode&&this.props.onCloseModal()}}}var $t=Zt;var er=Object(l.b)(e=>({prereq:e.modals.stack.length>0?e.modals.stack[e.modals.stack.length-1]:void 0}),e=>({onCloseModal:()=>e(G())}))($t);r(107);class tr extends c.a.Component{constructor(...e){super(...e),this.render=()=>c.a.createElement("div",{className:"Messages"},c.a.createElement(_t.TransitionGroup,null,this.props.messages.map(e=>this.renderMessage(e))))}renderMessage(e){return c.a.createElement(_t.CSSTransition,{key:e.id,classNames:"Message",timeout:{enter:200,exit:200}},c.a.createElement("div",{className:j()("Message","Message-"+e.type)},e.text))}}var rr=tr;const nr=e=>e.messages.sort((e,t)=>e.stamp-t.stamp);var ar=Object(l.b)(e=>({messages:nr(e)}))(rr);r(108);class or extends s.Component{constructor(...e){var t;super(...e),t=this,this.componentDidMount=Object(o.a)(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.props.onReconnect();case 1:case"end":return e.stop()}}),e)}))),this.render=()=>c.a.createElement("div",{className:"App"},c.a.createElement(er,null),c.a.createElement(p.d,null,c.a.createElement(p.b,{exact:!0,path:"/room/:room_id",component:ut}),c.a.createElement(p.b,{exact:!0,path:"/",component:Et}),c.a.createElement(p.a,{to:"/"})),c.a.createElement(ar,null))}}var sr=or;var cr=Object(l.b)(e=>({}),e=>({onReconnect:()=>e(gt())}))(sr);let ir=null;const lr=()=>(ir||(ir=new(window.AudioContext||window.webkitAudioContext)),ir),ur=e=>new Promise((t,r)=>lr().decodeAudioData(e,t,r)),pr=e=>new Promise((t,r)=>{const n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="arraybuffer",n.addEventListener("error",()=>r(new Error("Audio buffer loading failed")),!1),n.addEventListener("load",Object(o.a)(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.t0=t,e.next=4,ur(n.response);case 4:e.t1=e.sent,(0,e.t0)(e.t1),e.next=12;break;case 8:e.prev=8,e.t2=e.catch(0),console.debug("An error occurred while decoding audio data"),r(e.t2);case 12:case"end":return e.stop()}}),e,null,[[0,8]])}))),!1),n.send()});(()=>{const e=()=>{document.removeEventListener("click",e),document.removeEventListener("touchstart",e),console.debug("Fixing audio context...");const t=lr();var r=t.createBuffer(1,1,22050),n=t.createBufferSource();n.buffer=r,n.connect(t.destination),n.start(0)};document.addEventListener("click",e),document.addEventListener("touchstart",e)})();const dr=e=>{let t=null,r=null,n=null,s=null,c="",i=null,l=0,u=-1;const p=()=>{if(!n){const e=lr();n=e.destination,r=e.createGain(),r.gain.value=1,r.connect(n),n=r,t=e.createAnalyser(),t.fftSize=128,t.connect(n),n=t}return n},d=function(){var e=Object(o.a)(a.a.mark((function e(t){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c===t){e.next=6;break}return console.debug("Loading audio...",{url:t}),e.next=4,pr(t);case 4:s=e.sent,c=t;case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),m=function(){var t=Object(o.a)(a.a.mark((function t(r,n,o){return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,h();case 2:return t.next=4,d(n);case 4:console.debug("Starting audio...",{position:r,url:n}),u=r,i=lr().createBufferSource(),i.buffer=s,i.loop=!1,i.loopStart=0,i.loopEnd=0,i.onended=()=>{console.debug("Audio terminated..."),i=null,e&&u++},i.playbackRate.value=1,i.connect(p()),i.start(0,o),l=lr().currentTime;case 16:case"end":return t.stop()}}),t)})));return function(e,r,n){return t.apply(this,arguments)}}(),h=function(){var e=Object(o.a)(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(e=>{null!==i?(console.debug("Stopping audio..."),i.onended=()=>{console.debug("Forced audio termination..."),e()},i.stop(),i=null,l=0,u=-1):e()}));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return{analyserNode:t,gainNode:r,getPlayingPosition:()=>u,getTrackPercent:()=>{var e;return s&&i?(lr().currentTime-l)/(null===(e=s)||void 0===e?void 0:e.duration):0},isPlaying:()=>!!i,play:m,stop:h}};var mr=r(38),hr={splash:{CGU:"CGU",powered_with:"Powered with"},users:{user:"User",confirm_disconnect:"Are you sure you want to disconnect?",connect:"Connect",connection:"Connection",create_user:"Create a user",disconnect:"Disconnect",user_creation:"User Registration",user_id_is_invalid:"ID is invalid",user_id_placeholder:"User ID...",user_id:"User ID",user_name_is_invalid:"Name is invalid",user_name_placeholder:"User Name...",user_name:"User Name",user_secret_is_invalid:"Secret is invalid",user_secret_placeholder:"User Secret...",user_secret:"User Secret"},rooms:{room:"Room",empty:"It's empty here, you should add some tracks...",copy_link:"Copy Room Link to Clipboard",link_copied_to_clipboard:"Room link has been copied to clipboard",locked:"Locked (click to unlock)",unlocked:"Unlocked (click to lock)",clear:"Clear all tracks",confirm_clear:"Are you sure you want to remove all tracks?",confirm_exit:"Are you sure you want to leave the room?",exit:"Exit Room",unlock:"Unlock",create_room:"Create a room",room_creation:"Room Creation",room_key:"Room Key",room_key_placeholder:"Room Key...",room_name:"Room Name",room_name_placeholderl:"Room Name...",room_name_is_invalid:"Name is invalid",room_secret_is_invalid:"Secret is invalid",room_unlock:"Room Unlocking"},medias:{by:"by {{artist}}",add:"Add",remove:"Remove",search:"Search Media",search_placeholder:"Search...",medias_search:"Media Search"},player:{backward:"Backward",forward:"Forward",play:"Play",playing:"Playing",stop:"Stop"},secret_copied_to_clipboard:"Secret has been copied to clipboard"},fr={splash:{CGU:"CGU",powered_with:"boost\xe9 avec"},users:{user:"Utilisateur",confirm_disconnect:"\xcates-vous s\xfbr(e) de vouloir vous d\xe9connecter ?",connect:"Se connecter",connection:"Connexion",create_user:"Cr\xe9er un utilisateur",disconnect:"Se d\xe9connecter",user_creation:"Cr\xe9ation d'un utilisateur",user_id_is_invalid:"L'identifiant est invalide",user_id_placeholder:"Identifiant...",user_id:"Identifiant",user_name_is_invalid:"Le nom est invalide",user_name_placeholder:"Nom...",user_name:"Nom",user_secret_is_invalid:"Le secret est invalide",user_secret_placeholder:"Secret...",user_secret:"Secret"},rooms:{room:"Pi\xe8ce",empty:"Cette pi\xe8ce est vide, vous devriez ajouter quelques pistes...",copy_link:"Copier le lien de la pi\xe8ce dans le presse-papier",link_copied_to_clipboard:"Le lien de la pi\xe8ce a \xe9t\xe9 copi\xe9 dans le presse-papier",locked:"Verrouill\xe9e (cliquer pour d\xe9verrouiller)",unlocked:"D\xe9verrouill\xe9e (cliquer pour verrouiller)",clear:"Supprimer toutes les pistes",confirm_clear:"\xcates-vous s\xfbr(e) de vouloir supprimer toutes les pistes ?",confirm_exit:"\xcates-vous s\xfbr(e) de vouloir quitter la pi\xe8ce ?",exit:"Quitter la pi\xe8ce",unlock:"D\xe9verrouiller",create_room:"Cr\xe9er une pi\xe8ce",room_creation:"Cr\xe9ation d'une pi\xe8ce",room_key:"Clef",room_key_placeholder:"Clef...",room_name:"Nom",room_name_placeholderl:"Nom...",room_name_is_invalid:"Le nom est invalide",room_secret_is_invalid:"Le secret is invalide",room_unlock:"D\xe9verrouillage de la pi\xe8ce"},medias:{by:"par {{artist}}",add:"Ajouter",remove:"Supprimer",search:"Chercher des m\xe9dias",search_placeholder:"Recherche...",medias_search:"Recherche de m\xe9dias"},player:{backward:"Piste pr\xe9c\xe9dente",forward:"Piste suivante",play:"Lire",playing:"En cours de lecture",stop:"Arr\xeater"},secret_copied_to_clipboard:"Le secret a \xe9t\xe9 copi\xe9 dans le presse-papier"};const br=function(){var e=Object(o.a)(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((e,t)=>{console.log("Initializing language..."),mr.a.use(S.a).init({fallbackLng:"en",lng:navigator.language||navigator.userLanguage,resources:{"en-US":{translation:hr},"fr-FR":{translation:fr}},interpolation:{escapeValue:!1,format:(e,t,r)=>e}},r=>{r&&t(r),e()})}));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();r(109);(function(){var e=Object(o.a)(a.a.mark((function e(){var t,r,n,o,s;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=d.compose,r=Ht,n=dr(!0),o=dr(!1),br(),s=Object(d.createStore)(w,t(Object(d.applyMiddleware)(m.a.withExtraArgument({deezer:r,queuePlayer:n,previewPlayer:o})))),e.abrupt("return",s);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()().then(e=>{i.render(s.createElement(l.a,{store:e},s.createElement(u.a,null,s.createElement(p.b,{path:"/",component:cr}))),document.getElementById("root"))})},58:function(e,t,r){e.exports=r(110)},81:function(e,t,r){},82:function(e,t,r){},83:function(e,t,r){},86:function(e,t,r){},87:function(e,t,r){},88:function(e,t,r){},89:function(e,t,r){},90:function(e,t,r){},91:function(e,t,r){},93:function(e,t,r){},94:function(e,t,r){},98:function(e,t,r){},99:function(e,t,r){}},[[58,1,2]]]);
//# sourceMappingURL=main.73060d3c.chunk.js.map