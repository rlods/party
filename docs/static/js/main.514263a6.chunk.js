(this["webpackJsonpparty-app"]=this["webpackJsonpparty-app"]||[]).push([[0],{10:function(e,t,a){"use strict";(function(e){a.d(t,"b",(function(){return r})),a.d(t,"a",(function(){return n}));const r=t=>e.from(JSON.stringify(t)).toString("base64"),n=t=>JSON.parse(e.from(t,"base64").toString("ascii"))}).call(this,a(88).Buffer)},100:function(e,t,a){},101:function(e,t,a){},102:function(e,t,a){},103:function(e,t,a){},104:function(e,t,a){},105:function(e,t,a){},106:function(e,t,a){},114:function(e,t,a){},115:function(e,t,a){},117:function(e,t,a){},118:function(e,t,a){"use strict";a.r(t);var r=a(1),n=a.n(r),o=a(2),c=a(0),s=a.n(c),l=a(22),i=a(3),u=a(21),d=a(20),p=a(8),m=a.n(p),b=a(52),f=a.n(b),y=a(5),v=a(56),g=a.n(v);a(82);const k=s.a.memo(({className:e,color:t,icon:a,size:r="M",title:n})=>s.a.createElement(g.a,{className:m()("Icon",e,r),name:a,style:{color:t},title:n}));a(83);const h=s.a.memo(({className:e,color:t,disabled:a=!1,displayTitle:r=!1,icon:n,kind:o="default",onClick:c,size:l,title:i,type:u="button"})=>s.a.createElement("button",{type:u,"aria-label":i,className:m()("IconButton",e,o,{clickable:!a&&(!!c||"submit"===u)}),onClick:a?void 0:c,title:i},s.a.createElement(k,{color:t,icon:n,size:l}),r&&s.a.createElement("div",{className:m()("IconButtonTitle",l)},i))),x=function(){var e=Object(o.a)(n.a.mark((function e(t){return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise(e=>{const a=document.createElement("textarea");a.value=t,a.setAttribute("readonly",""),a.style.position="absolute",a.style.left="-9999px",document.body.appendChild(a);const r=document.getSelection();if(null!==r){const e=r.rangeCount>0&&r.getRangeAt(0);a.select(),document.execCommand("copy"),!1!==e&&(r.removeAllRanges(),r.addRange(e))}document.body.removeChild(a),e()});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),E=e=>e.room.info,j=e=>!!e.room.room,O=e=>!e.room.access.secret,w=e=>null!==e.room.info&&e.room.info.playing;var _=a(4),C=a(6);function S(e,t){return void 0===t?{type:e}:{type:e,payload:t}}const I=e=>S("message/REMOVE",{id:e}),N={};let M=0;const R=(e,{autoclear:t=!0,duration:a=3e3,extra:r,tag:n,text:o,weight:c=0})=>(s,l)=>{const i=l().messages,u=Object.entries(i).find(([e,t])=>t.tag===n&&t.text===o);let d=0;if(u){const e=Object(C.a)(u,2),t=e[0],a=e[1];console.log("REUSING"),d=Number(t),a.timer&&clearTimeout(a.timer)}else d=M++;s(((e,t,a)=>S("message/ADD",{timer:a,id:e,message:t}))(d,{extra:r,id:d,stamp:(new Date).getTime(),tag:n,text:o,type:e,weight:c},t?setTimeout(()=>s(I(d)),a):void 0))},P=(e,t)=>R("error",Object(_.a)({text:e},t)),T=(e,t)=>R("info",Object(_.a)({text:e},t)),L=(e,t)=>R("success",Object(_.a)({text:e},t)),A=(e,t,a)=>()=>{window.confirm(e)?t():a&&a()};var B=a(15);const z=e=>{const t=[],a=e.medias.medias,r=e.room.tracks;var n,o=Object(B.a)(r);try{for(o.s();!(n=o.n()).done;){const e=n.value,r=a[e.provider][e.type][e.id];r?t.push(r):t.push(null)}}catch(c){o.e(c)}finally{o.f()}return t},F=e=>e.room.tracks.length;a(84);const U=()=>{const e=Object(i.b)(),t=Object(y.b)().t,a=Object(d.g)(),r=Object(i.c)(E),l=Object(i.c)(e=>e.room.medias.length),u=Object(i.c)(F),p=Object(c.useCallback)(Object(o.a)(n.a.mark((function t(){return n.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,x(document.location.href.split("?")[0]);case 2:e(L("rooms.link_copied_to_clipboard"));case 3:case"end":return t.stop()}}),t)}))),[e]),m=Object(c.useCallback)(()=>{e(A(t("rooms.confirm_exit"),()=>{a.push("/")}))},[t,e,a]);return s.a.createElement("div",{className:"Head"},s.a.createElement("div",{className:"HeadInner"},s.a.createElement("div",{className:"RoomLink"},s.a.createElement(h,{icon:"link",onClick:p,size:"M",title:t("rooms.copy_link")})),s.a.createElement("div",{className:"RoomMeta"},r?s.a.createElement(s.a.Fragment,null,s.a.createElement("div",{className:"RoomName",title:"".concat(t("rooms.media_count",{count:l})," / ").concat(t("rooms.track_count",{count:u}))},r.name)):null),s.a.createElement("div",{className:"RoomExit"},s.a.createElement(h,{onClick:m,icon:"sign-out",size:"M",title:t("rooms.exit")}))))},q=s.a.memo(({size:e})=>s.a.createElement(k,{className:"rotating",icon:"circle-o-notch",size:e,title:"Loading"}));a(86);const W=s.a.memo(({playable:e,playing:t,image:a,onPlay:r,onStop:n})=>{const o=Object(y.b)().t;return e?s.a.createElement("div",{className:m()("Cover",{playable:e,playing:t}),style:a?{backgroundImage:"url('".concat(a,"')")}:{},onClick:t?n:r},t?s.a.createElement(k,{icon:"pause",size:"S",title:o("player.stop")}):s.a.createElement(k,{icon:"play",size:"S",title:o("player.play")})):s.a.createElement("div",{className:m()("Cover",{playing:t}),style:a?{backgroundImage:"url('".concat(a,"')")}:{}},t?s.a.createElement(k,{icon:"music",size:"S",title:o("player.playing")}):null)});a(87);const D=e=>s.a.createElement(V,{media:e,playable:!1,playing:!0}),V=s.a.memo(({actions:e,media:t,playable:a,playing:r,onPlay:n,onStop:o})=>{const c=Object(y.b)().t;return t?"album"===t.type?s.a.createElement("div",{className:"Media Album"},s.a.createElement(W,{playable:a,playing:r,image:t.picture_small,onPlay:n,onStop:o}),s.a.createElement("div",{className:"Metas"},s.a.createElement("div",{className:"Meta AlbumTitle"},s.a.createElement("a",{href:t.link,target:"_blank",rel:"noopener noreferrer"},t.title)),s.a.createElement("div",{className:"Meta AlbumArtist"},s.a.createElement("a",{href:t.artist.link,target:"_blank",rel:"noopener noreferrer"},c("medias.by",{artist:t.artist.name})))),e?s.a.createElement("div",{className:"Actions"},e):null):"playlist"===t.type?s.a.createElement("div",{className:"Media Playlist"},s.a.createElement(W,{playable:a,playing:r,image:t.picture_small,onPlay:n,onStop:o}),s.a.createElement("div",{className:"Metas"},s.a.createElement("div",{className:"Meta PlaylistTitle"},s.a.createElement("a",{href:t.link,target:"_blank",rel:"noopener noreferrer"},t.title)),s.a.createElement("div",{className:"Meta PlaylistCreator"},s.a.createElement("a",{href:t.user.link,target:"_blank",rel:"noopener noreferrer"},c("medias.by",{artist:t.user.name})))),e?s.a.createElement("div",{className:"Actions"},e):null):"track"===t.type?s.a.createElement("div",{className:"Media Track"},s.a.createElement(W,{playable:a&&!!t.preview,playing:r,image:t.album.picture_small,onPlay:n,onStop:o}),s.a.createElement("div",{className:"Metas"},s.a.createElement("div",{className:"Meta TrackTitle"},s.a.createElement("a",{href:t.link,target:"_blank",rel:"noopener noreferrer"},t.title)),s.a.createElement("div",{className:"Meta TrackArtist"},s.a.createElement("a",{href:t.artist.link,target:"_blank",rel:"noopener noreferrer"},c("medias.by",{artist:t.artist.name})))),e?s.a.createElement("div",{className:"Actions"},e):null):null:s.a.createElement("div",{className:"Media"},s.a.createElement(W,{playable:a,playing:r,image:"",onPlay:n,onStop:o}),s.a.createElement("div",{className:"Metas"},s.a.createElement(q,{size:"M"})),e?s.a.createElement("div",{className:"Actions"},e):null)}),H=s.a.memo(({locked:e,track:t,playing:a,onPlay:r,onRemove:n,onStop:o})=>{const c=Object(y.b)().t;return s.a.createElement("div",{className:"QueueItem"},s.a.createElement(V,{media:t,playable:!!t&&!e,playing:a,onPlay:r,onStop:o,actions:s.a.createElement(h,{disabled:e,title:c("medias.remove"),icon:"trash",onClick:n})}))});var X=a(119),G=a(10);const J=e=>new Promise(t=>setTimeout(t,e)),Q=["E","S","W","N"],Y=e=>{return(t=Q)[((a=e)<0?a%t.length+t.length:a)%t.length];var t,a},Z={boat1:{x:6,y:6},boat2:{x:6,y:6},boat3:{x:6,y:6}},K={hitted1:{x:4,y:4},hitted2:{x:4,y:4},missed:{x:4,y:4}},$={hitted1:{x:10,y:10},hitted2:{x:10,y:10},missed:{x:10,y:10}},ee=["bullet1","bullet2","bullet3","mine"],te={bullet1:{x:12,y:16},bullet2:{x:12,y:16},bullet3:{x:12,y:16},mine:{x:12,y:12}},ae={boat1:4,boat2:3,boat3:2},re=(e,t)=>{if(e.maps.find(e=>e.userId===t))return;console.debug("[SeaBattle] Genering fleet...",{userId:t});let a=0;const r=[];Object.entries(ae).reverse().forEach(([e,t])=>{for(let n=0;n<t;++n)r.push({hits:[],type:e,angle:0,position:{x:0,y:a++},status:"ok"})}),e.maps.push({fleet:r,hits:[],opponentsWeapons:[],userId:t,weapons:{bullet1:100,bullet2:6,bullet3:3,mine:3}})},ne=(e,t)=>Object.values(e).filter(e=>e.userId!==t),oe=(e,t)=>{var a;return(null===(a=e.maps[e.currentMapIndex])||void 0===a?void 0:a.userId)===t},ce=e=>{e.currentMapIndex=(e.currentMapIndex+1)%e.maps.length},se=["dj","seabattle"],le=(e,t)=>{const a={};return[...e,...t].forEach(({id:e,provider:t,type:r},n)=>{a[n]={id:e,provider:t,type:r}}),a},ie=(e,t,a)=>{if(t<0||t>=e.length)throw new Error("Media index is out of range");const r={},n=[...e];return n.splice(t,a),n.forEach(({id:e,provider:t,type:a},n)=>{r[n]={id:e,provider:t,type:a}}),r},ue=(e,t)=>{switch(t){case"blind":case"dj":return"";case"seabattle":return Object(G.b)((e=>{console.debug("[SeaBattle] Genering battle...");const t={currentMapIndex:0,maps:[]};return re(t,e),t})(e))}};var de=a(24);a(92);const pe={dbIDs:"7ffe8".split("|"),dbPrefix:"test-rl-"},me=pe.dbIDs[0],be=pe.dbIDs[0];var fe=pe;const ye={},ve=e=>{let t=ye[e];if(!t){console.debug("[Firebase] Creating app",{dbId:e});const a="https://".concat(fe.dbPrefix).concat(e,".firebaseio.com"),r=de.initializeApp({databaseURL:a}),n=de.database(r);ye[e]=t={app:r,database:n,rooms:n.ref("rooms"),users:n.ref("users")}}return t},ge=({dbId:e,roomId:t,secret:a})=>{const r=ve(e).rooms.child(t),c=r.child("info");let s=a||"";return{dbId:e,roomId:t,isLocked:()=>!s,setSecret:e=>{console.debug("[Firebase] Setting room secret",{oldSecret:s,newSecret:e}),s=e},wait:function(){var e=Object(o.a)(n.a.mark((function e(){return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((e,t)=>{console.debug("[Firebase] Waiting room..."),c.once("value",a=>{const r=a.val();r?e(r):t(new Error("rooms.errors.invalid"))})}));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),subscribe:e=>(console.debug("[Firebase] Subscribing room..."),c.on("value",e)),unsubscribe:e=>{console.debug("[Firebase] Unsubscribing room..."),c.off("value",e)},update:function(){var e=Object(o.a)(n.a.mark((function e({extra:t,name:a,playing:o,playmode:c,queue:l,queue_position:i,type:u}){return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.debug("[Firebase] Updating room...",{extra:!!t,name:a,playing:o,playmode:c,queue:l,queue_position:i}),e.next=3,r.set({info:{extra:t,name:a,playing:o,playmode:c,queue:l,queue_position:i,timestamp:de.database.ServerValue.TIMESTAMP,type:u},secret:s});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}},ke=({dbId:e,userId:t,secret:a})=>{const r=ve(e).users.child(t),c=r.child("info");let s=a||"",l={name:"dummy",online:!1,status:"",timestamp:0};const i=function(){var e=Object(o.a)(n.a.mark((function e(){return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((e,t)=>{console.debug("[Firebase] Waiting user..."),c.once("value",a=>{const r=a.val();r?(l=r,e(r)):t(new Error("users.errors.invalid"))})}));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),u=function(){var e=Object(o.a)(n.a.mark((function e({name:t}){return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.debug("[Firebase] Updating user...",{name:t}),void 0!==t&&(l.name=t),e.next=4,r.set({info:Object(_.a)({},l,{online:!0,status:"online",timestamp:de.database.ServerValue.TIMESTAMP}),secret:s});case 4:d();case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),d=()=>{console.debug("[Firebase] Installing user disconnect..."),r.onDisconnect().cancel(),r.onDisconnect().set({info:Object(_.a)({},l,{online:!1,status:"disconnected",timestamp:de.database.ServerValue.TIMESTAMP}),secret:s})};return{dbId:e,userId:t,isLocked:()=>!s,setSecret:e=>{console.debug("[Firebase] Setting user secret...",{oldSecret:s,newSecret:e}),s=e},wait:i,subscribe:e=>(console.debug("[Firebase] Subscribing user..."),c.on("value",e)),unsubscribe:e=>{console.debug("[Firebase] Unsubscribing user..."),c.off("value",e)},update:u}},he=e=>e.response&&e.response.data&&e.response.data.message?e.response.data.message:e.message;var xe=a(39);const Ee=function(){var e=Object(o.a)(n.a.mark((function e(t){var a,r,o,c,s,l;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,xe.read(t);case 2:return a=e.sent,e.next=5,a.resize(1,1).getPixelColor(0,0);case 5:return r=e.sent,o=xe.intToRGBA(r),c=o.r,s=o.g,l=o.b,e.abrupt("return",{r:c,g:s,b:l});case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),je={},Oe={bg:{r:255,g:255,b:255},fg:"dark"},we=function(){var e=Object(o.a)(n.a.mark((function e(t){var a,r,o,c,s;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=Oe,!t){e.next=18;break}if(a=je[t]){e.next=18;break}return e.prev=4,e.next=7,Ee(t);case 7:r=e.sent,o=r.r,c=r.g,s=r.b,je[t]=a={bg:{r:o,g:c,b:s},fg:.299*o+.587*c+.114*s>186?"dark":"light"},e.next=18;break;case 14:e.prev=14,e.t0=e.catch(4),console.error("An error prevented colorpicking",e.t0),je[t]=a=Oe;case 18:return e.abrupt("return",a);case 19:case"end":return e.stop()}}),e,null,[[4,14]])})));return function(t){return e.apply(this,arguments)}}(),_e=[];let Ce=null;const Se=()=>(Ce||(console.debug("[Audio] Creating context"),Ce=new(window.AudioContext||window.webkitAudioContext)),Ce),Ie=()=>Se().currentTime,Ne=e=>new Promise((t,a)=>Se().decodeAudioData(e,t,a)),Me=e=>new Promise((t,a)=>{const r=new XMLHttpRequest;r.open("GET",e,!0),r.responseType="arraybuffer",r.addEventListener("error",()=>a(new Error("audio.errors.cannot_load_audio_buffer")),!1),r.addEventListener("load",Object(o.a)(n.a.mark((function o(){return n.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.t0=t,n.next=4,Ne(r.response);case 4:n.t1=n.sent,(0,n.t0)(n.t1),n.next=12;break;case 8:n.prev=8,n.t2=n.catch(0),console.debug("[Audio] An error occurred while decoding data",{error:n.t2,url:e}),a(new Error("audio.errors.cannot_decode_audio_data"));case 12:case"end":return n.stop()}}),o,null,[[0,8]])}))),!1),r.send()}),Re=function(){var e=Object(o.a)(n.a.mark((function e(t){var a,r;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new Error("URL is invalid");case 2:if(a=null,!((r=_e.findIndex(e=>e.url===t))>=0)){e.next=9;break}console.debug("[Audio] Reusing cached buffer...",{url:t}),a=_e.splice(r,1)[0].buffer,e.next=13;break;case 9:return console.debug("[Audio] Loading buffer...",{url:t}),e.next=12,Me(t);case 12:a=e.sent;case 13:return _e.push({buffer:a,url:t}),_e.splice(10),e.abrupt("return",a);case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();(()=>{const e=()=>{document.removeEventListener("click",e),document.removeEventListener("touchstart",e),console.debug("[Audio] Fixing context...");const t=Se();var a=t.createBuffer(1,1,22050),r=t.createBufferSource();r.buffer=a,r.connect(t.destination),r.start(0)};document.addEventListener("click",e),document.addEventListener("touchstart",e)})();const Pe=()=>Math.floor(1e6*Math.random()),Te=()=>{let e=null,t=null,a=null,r=0,c=null,s=0,l="",i=-1;const u=()=>(a||(a=Se().destination,t=Se().createGain(),t.gain.value=1,t.connect(a),a=t,e=Se().createAnalyser(),e.fftSize=128,e.connect(a),a=e),a),d=function(){var e=Object(o.a)(n.a.mark((function e(t,a,o,d,m){var b;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p();case 2:return e.next=4,Re(o);case 4:b=e.sent,console.debug("[Player] Starting audio...",{trackPosition:t,trackId:a,trackUrl:o}),r=b.duration,l=a,i=t,c=Se().createBufferSource(),c.buffer=b,c.loop=!1,c.loopStart=0,c.loopEnd=0,c.onended=()=>{console.debug("[Player] Audio terminated..."),r=0,c=null,s=0,l="","shuffle"===(null===m||void 0===m?void 0:m.playmode)?i+=Pe():i++},c.playbackRate.value=1,c.connect(u()),c.start(0,d),s=Ie();case 19:case"end":return e.stop()}}),e)})));return function(t,a,r,n,o){return e.apply(this,arguments)}}(),p=()=>new Promise(e=>{null!==c?(console.debug("[Player] Stopping play..."),c.onended=()=>{console.debug("[Player] Forced audio termination..."),e()},c.stop(),r=0,c=null,s=0,l="",i=-1):e()});return{getPlayingTrackID:()=>l,getPlayingTrackPercent:()=>c?(Ie()-s)/r:0,getPlayingTrackPosition:()=>i,isPlaying:()=>!!c,play:d,stop:p}},Le=(e,t,a,r,n,o)=>{if(!e||0===n.length)return-1;let c=-1;return r!==o?t?a!==n[o].id&&(c=o):c=r>=0?r:o:a!==n[o].id&&(c=o),c},Ae=Te(),Be=Te();var ze=a(58),Fe=a.n(ze);const Ue="https://www.deezer.com",qe=e=>({artist:{id:e.artist.id.toString(),name:e.artist.name,link:"".concat(Ue,"/artist/").concat(e.artist.id),picture_big:e.artist.picture_big,picture_small:e.artist.picture_small},id:e.id.toString(),link:"".concat(Ue,"/album/").concat(e.id),picture_big:e.cover_big,picture_small:e.cover_small,provider:"deezer",title:e.title,tracks:void 0!==e.tracks?e.tracks.data.filter(e=>e.readable&&e.preview).map(t=>De(t,e)):[],type:"album"}),We=(e,t)=>({id:e.id.toString(),link:"".concat(Ue,"/playlist/").concat(e.id),picture_big:e.picture_big,picture_small:e.picture_small,provider:"deezer",title:e.title,tracks:void 0!==e.tracks?e.tracks.data.filter(e=>e.readable&&e.preview).map(e=>De(e,e.album)):[],type:"playlist",user:{id:t.id.toString(),link:"".concat(Ue,"/profile/").concat(t.id),name:t.name}}),De=(e,t)=>({album:{id:t.id.toString(),link:"".concat(Ue,"/album/").concat(t.id),title:t.title,picture_big:t.cover_big,picture_small:t.cover_small},artist:{id:e.artist.id.toString(),name:e.artist.name,link:"".concat(Ue,"/artist/").concat(e.artist.id),picture_big:e.artist.picture_big,picture_small:e.artist.picture_small},duration:e.duration,id:e.id.toString(),link:"".concat(Ue,"/track/").concat(e.id),preview:e.preview,provider:"deezer",title:e.title,type:"track"}),Ve=(()=>{const e=(e,t)=>(console.debug("[Deezer] Requesting... ",{path:e,qs:t}),((e,t)=>new Promise((a,r)=>{Fe()(t?"".concat(e,"?").concat(t,"&output=jsonp&callback="):"".concat(e,"?output=jsonp&callback="),void 0,(e,t)=>{e?r(new Error(e.message)):a(t)})}))("".concat("https://api.deezer.com","/").concat(e),t)),t=(t,a,r)=>e("search/".concat(t),"q=".concat(encodeURIComponent(a)).concat(r&&r.limit?"&limit=".concat(r.limit):"")),a=function(){var t=Object(o.a)(n.a.mark((function t(a,r){var c,s,l;return n.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return c=[],s=[],l=[],t.next=5,Promise.all(r.map(function(){var t=Object(o.a)(n.a.mark((function t(r){var o;return n.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e("".concat(a,"/").concat(r));case 2:if((o=t.sent).error){t.next=6;break}return l.push(o),t.abrupt("return");case 6:if(4!==o.error.code){t.next=9;break}return c.push(r),t.abrupt("return");case 9:console.error("[Deezer] An error occured while loading ".concat(a,":"),o.error),s.push(r);case 11:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()));case 5:return t.abrupt("return",{delayedIds:c,failedIds:s,loadedMedias:l});case 6:case"end":return t.stop()}}),t)})));return function(e,a){return t.apply(this,arguments)}}(),r=function(){var e=Object(o.a)(n.a.mark((function e(t,r){var o,c,s,l,i,u;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=!0,c=[],s=[...r];case 3:if(!(s.length>0)){e.next=18;break}if(o){e.next=8;break}return console.debug("[Deezer] Handling rate limit delayed batch...",{remainingIds:s}),e.next=8,J(5e3);case 8:return e.next=10,a(t,s);case 10:l=e.sent,i=l.delayedIds,u=l.loadedMedias,c.push(...u),s=i,o=!1,e.next=3;break;case 18:return e.abrupt("return",c);case 19:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}();return{searchAlbums:function(){var e=Object(o.a)(n.a.mark((function e(a,r){return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==a.trim().length){e.next=2;break}return e.abrupt("return",[]);case 2:return e.next=4,t("album",a,r);case 4:return e.abrupt("return",e.sent.data.map(qe));case 5:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),searchPlaylists:function(){var e=Object(o.a)(n.a.mark((function e(a,r){return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==a.trim().length){e.next=2;break}return e.abrupt("return",[]);case 2:return e.next=4,t("playlist",a,r);case 4:return e.abrupt("return",e.sent.data.filter(e=>e.public).map(e=>We(e,e.user)));case 5:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),searchTracks:function(){var e=Object(o.a)(n.a.mark((function e(a,r){return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==a.trim().length){e.next=2;break}return e.abrupt("return",[]);case 2:return e.next=4,t("track",a,r);case 4:return e.abrupt("return",e.sent.data.filter(e=>e.readable&&e.preview).map(e=>De(e,e.album)));case 5:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),loadAlbums:function(){var e=Object(o.a)(n.a.mark((function e(t){var a;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==t.length){e.next=2;break}return e.abrupt("return",[]);case 2:return console.debug("[Deezer] Loading albums...",{ids:t}),e.next=5,r("album",t);case 5:return a=e.sent,e.abrupt("return",a.map(qe));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),loadPlaylists:function(){var e=Object(o.a)(n.a.mark((function e(t){var a;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==t.length){e.next=2;break}return e.abrupt("return",[]);case 2:return console.debug("[Deezer] Loading playlists...",{ids:t}),e.next=5,r("playlist",t);case 5:return a=e.sent,e.abrupt("return",a.map(e=>We(e,e.creator)));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),loadTracks:function(){var e=Object(o.a)(n.a.mark((function e(t){var a;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==t.length){e.next=2;break}return e.abrupt("return",[]);case 2:return console.debug("[Deezer] Loading tracks...",{ids:t}),e.next=5,r("track",t);case 5:return a=e.sent,e.abrupt("return",a.map(e=>De(e,e.album)));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}})(),He=function(){var e=Object(o.a)(n.a.mark((function e(t){var a,r,o,c,s,l,i,u,d;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a={deezer:{album:[],playlist:[],track:[]}},r=Object(B.a)(t);try{for(r.s();!(o=r.n()).done;)c=o.value,a[c.provider][c.type].push(c.id)}catch(n){r.e(n)}finally{r.f()}return e.next=5,Ve.loadAlbums(a.deezer.album);case 5:return e.t0=e.sent,e.next=8,Ve.loadPlaylists(a.deezer.playlist);case 8:return e.t1=e.sent,e.next=11,Ve.loadTracks(a.deezer.track);case 11:e.t2=e.sent,e.t3={album:e.t0,playlist:e.t1,track:e.t2},s={deezer:e.t3},l=[],i=Object(B.a)(t);try{for(i.s();!(u=i.n()).done;)c=u.value,(d=s[c.provider][c.type].find(e=>e.id===c.id))&&l.push(d)}catch(n){i.e(n)}finally{i.f()}return e.abrupt("return",l);case 18:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Xe=function(){var e=Object(o.a)(n.a.mark((function e(t,a){var r,o,c,s,l,i;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.filter(e=>!a[e.provider][e.type][e.id]).filter((e,t,a)=>t===a.findIndex(t=>t.id===e.id&&t.provider===e.provider&&t.type===e.type)),e.next=3,He(r);case 3:o=e.sent,c=[],s=Object(B.a)(o);try{for(s.s();!(l=s.n()).done;)i=l.value,c.push(i),"track"!==i.type&&c.push(...i.tracks)}catch(n){s.e(n)}finally{s.f()}return e.abrupt("return",{newMedias:o,newMediasAndTracks:c});case 8:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),Ge=function(){var e=Object(o.a)(n.a.mark((function e(t,a,r){var o,c,s,l,i,u;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r){e.next=9;break}return e.next=3,Promise.all([Ve.searchAlbums(t,a),Ve.searchPlaylists(t,a),Ve.searchTracks(t,a)]);case 3:return o=e.sent,c=Object(C.a)(o,3),s=c[0],l=c[1],i=c[2],e.abrupt("return",{deezer:{album:s,playlist:l,track:i}});case 9:u={deezer:{album:[],playlist:[],track:[]}},e.t0=r,e.next="album"===e.t0?13:"playlist"===e.t0?17:"track"===e.t0?21:25;break;case 13:return e.next=15,Ve.searchAlbums(t,a);case 15:return u.deezer.album=e.sent,e.abrupt("break",25);case 17:return e.next=19,Ve.searchPlaylists(t,a);case 19:return u.deezer.playlist=e.sent,e.abrupt("break",25);case 21:return e.next=23,Ve.searchTracks(t,a);case 23:return u.deezer.track=e.sent,e.abrupt("break",25);case 25:return e.abrupt("return",u);case 26:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}(),Je=e=>S("medias/SET",e),Qe={error:null,fetching:!1,medias:{deezer:{album:{},playlist:{},track:{}}}},Ye=e=>S("room/SET",e),Ze={access:{dbId:"",roomId:"",secret:""},color:{fg:"dark",bg:{r:255,g:255,b:255}},error:null,fetching:!1,info:null,medias:[],room:null,tracks:[]},Ke=[{label:"medias.albums",provider:"deezer",type:"album"},{label:"medias.playlists",provider:"deezer",type:"playlist"},{label:"medias.tracks",provider:"deezer",type:"track"}],$e=(e,t)=>t[e.provider][e.type][e.id],et=(e,t,a)=>$e(e,t)||((e,t)=>t.find(t=>t.id===e.id&&t.provider===e.provider&&t.type===e.type))(e,a),tt=(e,t,a)=>{const r=et(e,t,a);return r?"track"===r.type?r:r.tracks&&r.tracks.length>0?r.tracks[0]:null:null},at=(e,t,a)=>{const r=[];var n,o=Object(B.a)(e);try{for(o.s();!(n=o.n()).done;){const e=n.value;if("track"===e.type){r.push({contextId:e.id,contextType:e.type,id:e.id,provider:e.provider,type:e.type});continue}const o=et(e,t,a);if(!o)throw new Error("Media is unknown");if("track"!==o.type&&o.tracks&&o.tracks.length>0){var c,s=Object(B.a)(o.tracks);try{for(s.s();!(c=s.n()).done;){const e=c.value;r.push({contextId:o.id,contextType:o.type,id:e.id,provider:e.provider,type:e.type})}}catch(l){s.e(l)}finally{s.f()}}}}catch(l){o.e(l)}finally{o.f()}return r},rt=(e,t,a)=>{if(t<0)throw new Error("Track index is out of range");let r=0;for(let n=0;n<e.length;++n){const o=e[n];if("track"===o.type){if(t===r)return{mediaFirstTrackIndex:t,mediaIndex:n,mediaSize:1};r++}else{const e=$e(o,a);if(!e)throw new Error("Media is unknown");if("track"!==e.type&&e.tracks&&e.tracks.length>0){const a=r;for(let o=0;o<e.tracks.length;++o){if(t===r)return{mediaFirstTrackIndex:a,mediaIndex:n,mediaSize:e.tracks.length};r++}}}}throw new Error("Track index is out of range")},nt=e=>function(){var t=Object(o.a)(n.a.mark((function t(a){return n.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",a(R("info",{duration:5e3,extra:()=>D(e),weight:1e3})));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),ot=e=>function(){var t=Object(o.a)(n.a.mark((function t(a,r){var o,c,s,l,i;return n.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,o=r(),c=o.medias.medias,t.next=4,Xe([e],c);case 4:if(s=t.sent,l=s.newMedias,i=tt(e,c,l)){t.next=9;break}throw new Error("[Medias] Cannot find track to preview...");case 9:return console.debug("[Medias] Previewing track...",{track:i}),t.next=12,Be.play(0,i.id,i.preview,0);case 12:t.next=17;break;case 14:t.prev=14,t.t0=t.catch(0),a(P(he(t.t0)));case 17:case"end":return t.stop()}}),t,null,[[0,14]])})));return function(e,a){return t.apply(this,arguments)}}();var ct=a(11),st=Object(ct.b)();const lt=e=>S("modals/OPEN",e),it=()=>S("modals/POP"),ut={stack:[]},dt={dj:{playing:!1,playmode:"default",queue:{}},seabattle:{playing:!0,playmode:"shuffle",queue:{0:{id:"301013",provider:"deezer",type:"album"},1:{id:"7358507",provider:"deezer",type:"album"},2:{id:"558976",provider:"deezer",type:"album"},3:{id:"87375582",provider:"deezer",type:"album"}}}},pt=(e,t,a,r)=>function(){var c=Object(o.a)(n.a.mark((function o(c,s){var l,i,u;return n.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(l=s(),i=l.user.access.userId){n.next=5;break}return console.debug("[SeaBattle] Not connected"),c(lt({type:"CreateUser",props:null})),n.abrupt("return");case 5:return n.prev=5,u=Object(X.a)(),console.debug("[Room] Creating...",{roomId:u,secret:a}),n.next=10,ge({dbId:e,roomId:u,secret:a}).update(Object(_.a)({extra:ue(i,r),name:t,queue_position:0,type:r},dt[r]));case 10:c(mt(e,u,a)),n.next=16;break;case 13:n.prev=13,n.t0=n.catch(5),c(P(he(n.t0)));case 16:case"end":return n.stop()}}),o,null,[[5,13]])})));return function(e,t){return c.apply(this,arguments)}}(),mt=(e,t,a)=>function(){var r=Object(o.a)(n.a.mark((function r(o,c){var s,l,i;return n.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(s=c(),!(l=s.room.room)||l.dbId!==e||l.roomId!==t){r.next=3;break}return r.abrupt("return");case 3:return o(bt()),r.prev=4,console.debug("[Room] Entering...",{roomId:t,secret:a}),i=ge({dbId:e,roomId:t,secret:a}),r.t0=o,r.t1=Ye,r.t2={dbId:e,roomId:t,secret:a},r.t3=i,r.next=13,i.wait();case 13:r.t4=r.sent,r.t5={access:r.t2,room:r.t3,info:r.t4},r.t6=(0,r.t1)(r.t5),(0,r.t0)(r.t6),o(gt(i)),o(xt()),st.push("/room/".concat(e,"/").concat(t,"?secret=").concat(a)),r.next=25;break;case 22:r.prev=22,r.t7=r.catch(4),o(P(he(r.t7)));case 25:case"end":return r.stop()}}),r,null,[[4,22]])})));return function(e,t){return r.apply(this,arguments)}}(),bt=()=>function(){var e=Object(o.a)(n.a.mark((function e(t,a){var r,o;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=a(),o=r.room.room){e.next=3;break}return e.abrupt("return");case 3:console.debug("[Room] Exiting..."),t(Et()),t(kt(o)),t(S("room/RESET"));case 7:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),ft=()=>function(){var e=Object(o.a)(n.a.mark((function e(t,a){var r,o,c,s,l,i,u;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=a(),o=r.room,c=o.room,s=o.access,l=s.dbId,i=s.roomId,u=s.secret,c&&c.dbId===l&&c.roomId===i&&u){e.next=3;break}return e.abrupt("return");case 3:console.debug("[Room] Locking...",{dbId:l,roomId:i}),c.setSecret(""),t(Ye({access:{dbId:l,roomId:i,secret:""}}));case 6:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),yt=e=>function(){var t=Object(o.a)(n.a.mark((function t(a,r){var o,c,s,l,i,u,d;return n.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=r(),c=o.room,s=c.room,l=c.access,i=l.dbId,u=l.roomId,d=l.secret,s&&s.dbId===i&&s.roomId===u&&d!==e){t.next=3;break}return t.abrupt("return");case 3:console.debug("[Room] Unlocking...",{dbId:i,roomId:u,secret:e}),s.setSecret(e),a(Ye({access:{dbId:i,roomId:u,secret:e}}));case 6:case"end":return t.stop()}}),t)})));return function(e,a){return t.apply(this,arguments)}}();let vt=null;const gt=e=>function(){var t=Object(o.a)(n.a.mark((function t(a,r,{player:c}){return n.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(console.debug("[Room] Watching..."),!vt){t.next=3;break}return t.abrupt("return");case 3:vt=e.subscribe(function(){var t=Object(o.a)(n.a.mark((function t(o){var c,s,l,i,u,d,p,m;return n.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(c=r(),s=c.medias.medias,l=o.val(),console.debug("[Room] Received room update...",{newInfo:l}),l){t.next=5;break}return t.abrupt("return");case 5:if(i=[],l.queue&&(i=Object.entries(l.queue).sort((e,t)=>Number(e[0])-Number(t[0])).map(e=>e[1])),u=[],!(i.length>0)){t.next=16;break}return t.next=11,Xe(i,s);case 11:d=t.sent,p=d.newMedias,(m=d.newMediasAndTracks).length>0&&a(Je(m)),u=at(i,s,p);case 16:a(Ye({info:l,medias:i,room:e,tracks:u}));case 17:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());case 4:case"end":return t.stop()}}),t)})));return function(e,a,r){return t.apply(this,arguments)}}(),kt=e=>Object(o.a)(n.a.mark((function t(){return n.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(vt){t.next=2;break}return t.abrupt("return");case 2:console.debug("Unwatching room..."),e.unsubscribe(vt),vt=null;case 5:case"end":return t.stop()}}),t)})));let ht=null;const xt=()=>function(){var e=Object(o.a)(n.a.mark((function e(t,a,{player:r}){return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:ht||(console.debug("[Room] Watching player... ********************"),jt(t,a,r,250));case 1:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}(),Et=()=>function(){var e=Object(o.a)(n.a.mark((function e(t,a,{player:r}){return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return ht&&(console.debug("[Room] Unwatching player... ********************"),clearTimeout(ht),ht=null),e.next=3,r.stop();case 3:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}(),jt=(e,t,a,r)=>{ht=setTimeout(Object(o.a)(n.a.mark((function o(){var c,s,l,i,u,d,p,m,b,f,y;return n.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(c=t(),s=c.room,l=s.info,i=s.tracks,u=c.medias.medias,!l){n.next=23;break}if(!((d=Le(l.playing,a.isPlaying(),a.getPlayingTrackID(),a.getPlayingTrackPosition()%i.length,i,l.queue_position))>=0)){n.next=22;break}return p=i[d],m=u[p.provider][p.type][p.id],console.debug("Detected play change...",{nextTrack:m,nextTrackIndex:d}),n.prev=7,n.next=10,Promise.all([we(m.album.picture_small),a.play(d,m.id,m.preview,0,{playmode:l.playmode})]);case 10:b=n.sent,f=Object(C.a)(b,1),y=f[0],e(nt(m)),e(Ye({color:y,info:Object(_.a)({},l,{queue_position:d})})),n.next=20;break;case 17:n.prev=17,n.t0=n.catch(7),e(P(he(n.t0)));case 20:n.next=23;break;case 22:l.playing||a.stop();case 23:jt(e,t,a,r);case 24:case"end":return n.stop()}}),o,null,[[7,17]])}))),r)},Ot=()=>function(){var e=Object(o.a)(n.a.mark((function e(t,a){var r,o,c,s;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=a(),o=r.room,c=o.info,(s=o.room)&&!s.isLocked()&&c){e.next=4;break}return t(P("rooms.error.locked")),e.abrupt("return");case 4:if(!c.playing){e.next=6;break}return e.abrupt("return");case 6:return e.prev=6,console.debug("[Player] Starting..."),e.next=10,s.update(Object(_.a)({},c,{playing:!0}));case 10:e.next=16;break;case 12:e.prev=12,e.t0=e.catch(6),t(P(he(e.t0))),t(ft());case 16:case"end":return e.stop()}}),e,null,[[6,12]])})));return function(t,a){return e.apply(this,arguments)}}(),wt=()=>function(){var e=Object(o.a)(n.a.mark((function e(t,a){var r,o,c,s;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=a(),o=r.room,c=o.info,(s=o.room)&&!s.isLocked()&&c){e.next=4;break}return t(P("rooms.error.locked")),e.abrupt("return");case 4:if(c.playing){e.next=6;break}return e.abrupt("return");case 6:return e.prev=6,console.debug("[Player] Stopping..."),e.next=10,s.update(Object(_.a)({},c,{playing:!1}));case 10:e.next=16;break;case 12:e.prev=12,e.t0=e.catch(6),t(P(he(e.t0))),t(ft());case 16:case"end":return e.stop()}}),e,null,[[6,12]])})));return function(t,a){return e.apply(this,arguments)}}(),_t=()=>function(){var e=Object(o.a)(n.a.mark((function e(t,a){var r,o,c,s;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=a(),o=r.room,c=o.info,(s=o.room)&&!s.isLocked()&&c){e.next=4;break}return t(P("rooms.error.locked")),e.abrupt("return");case 4:return e.prev=4,console.debug("[Queue] Clearing medias..."),e.next=8,s.update(Object(_.a)({},c,{playing:!1,queue:{},queue_position:0}));case 8:e.next=14;break;case 10:e.prev=10,e.t0=e.catch(4),t(P(he(e.t0))),t(ft());case 14:case"end":return e.stop()}}),e,null,[[4,10]])})));return function(t,a){return e.apply(this,arguments)}}(),Ct=e=>function(){var t=Object(o.a)(n.a.mark((function t(a,r){var o,c,s,l,i;return n.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=r(),c=o.room,s=c.info,l=c.medias,(i=c.room)&&!i.isLocked()&&s){t.next=4;break}return a(P("rooms.error.locked")),t.abrupt("return");case 4:if(0!==e.length){t.next=6;break}return t.abrupt("return");case 6:return t.prev=6,console.debug("[Queue] Appending medias...",{newMedias:e}),t.next=10,i.update(Object(_.a)({},s,{queue:le(l,e)}));case 10:t.next=16;break;case 12:t.prev=12,t.t0=t.catch(6),a(P(he(t.t0))),a(ft());case 16:case"end":return t.stop()}}),t,null,[[6,12]])})));return function(e,a){return t.apply(this,arguments)}}(),St=e=>function(){var t=Object(o.a)(n.a.mark((function t(a,r){var o,c,s,l,i,u,d,p,m,b,f,y,v;return n.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=r(),c=o.medias.medias,s=o.room,l=s.info,i=s.medias,u=s.room,d=s.tracks,u&&!u.isLocked()&&l){t.next=4;break}return a(P("rooms.error.locked")),t.abrupt("return");case 4:if(p=rt(i,e,c),m=p.mediaFirstTrackIndex,b=p.mediaIndex,f=p.mediaSize,!(b<0)){t.next=7;break}return t.abrupt("return");case 7:if(y=l.queue_position,t.prev=8,console.debug("[Queue] Removing track...",{playingTrackIndex:y,removedMediaIndex:b,removedTrackCount:f,removedTrackIndex:e,removedMediaFirstTrackIndex:m}),v=ie(i,b,1),0!==Object.keys(v).length){t.next=17;break}return console.debug("[Queue] Removing last media..."),t.next=15,u.update(Object(_.a)({},l,{playing:!1,queue:{},queue_position:0}));case 15:t.next=29;break;case 17:if(!(y<e)){t.next=22;break}return t.next=20,u.update(Object(_.a)({},l,{queue:v}));case 20:t.next=29;break;case 22:if(!(y>=m&&y<m+f)){t.next=27;break}return t.next=25,u.update(Object(_.a)({},l,{queue:v,queue_position:m+f===d.length?m-1:m}));case 25:t.next=29;break;case 27:return t.next=29,u.update(Object(_.a)({},l,{queue:v,queue_position:y-f}));case 29:t.next=35;break;case 31:t.prev=31,t.t0=t.catch(8),a(P(he(t.t0))),a(ft());case 35:case"end":return t.stop()}}),t,null,[[8,31]])})));return function(e,a){return t.apply(this,arguments)}}(),It=e=>function(){var t=Object(o.a)(n.a.mark((function t(a,r){var o,c,s,l,i;return n.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=r(),c=o.room,s=c.info,(l=c.room)&&!l.isLocked()&&s){t.next=4;break}return a(P("rooms.error.locked")),t.abrupt("return");case 4:if((i=s.queue_position)!==e){t.next=7;break}return t.abrupt("return");case 7:return t.prev=7,console.debug("[Queue] Set position...",{oldTrackIndex:i,newTrackIndex:e}),t.next=11,l.update(Object(_.a)({},s,{playing:!0,queue_position:e}));case 11:t.next=17;break;case 13:t.prev=13,t.t0=t.catch(7),a(P(he(t.t0))),a(ft());case 17:case"end":return t.stop()}}),t,null,[[7,13]])})));return function(e,a){return t.apply(this,arguments)}}(),Nt=()=>function(){var e=Object(o.a)(n.a.mark((function e(t,a){var r,o,c,s;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=a(),o=r.room,c=o.info,s=o.tracks,c&&0!==s.length){e.next=3;break}return e.abrupt("return");case 3:console.debug("[Queue] Moving backward..."),t(It(c.queue_position>0?c.queue_position-1:s.length-1));case 5:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),Mt=()=>function(){var e=Object(o.a)(n.a.mark((function e(t,a){var r,o,c,s;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=a(),o=r.room,c=o.info,s=o.tracks,c&&0!==s.length){e.next=3;break}return e.abrupt("return");case 3:"shuffle"===c.playmode?(console.debug("[Queue] Randomizing next track..."),t(It(Pe()%s.length))):(console.debug("[Queue] Moving forward..."),t(It((c.queue_position+1)%s.length)));case 4:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}();a(97);const Rt=()=>{const e=Object(i.b)(),t=Object(i.c)(j),a=Object(i.c)(O),r=Object(i.c)(w),n=Object(i.c)(e=>null!==e.room.info?e.room.info.queue_position:0),o=Object(i.c)(z),l=Object(c.useCallback)(t=>{e(Ot()),e(It(t))},[e]),u=Object(c.useCallback)(t=>e(St(t)),[e]),d=Object(c.useCallback)(()=>e(lt({type:"Search",props:null})),[e]),p=Object(c.useCallback)(()=>e(wt()),[e]);return s.a.createElement("div",{className:"Queue"},o.length>0?s.a.createElement(Tt,{locked:a,tracks:o,playing:r,playingIndex:n,onPlay:l,onRemove:u,onStop:p}):s.a.createElement(Pt,{loaded:t,locked:a,onSearch:d}))},Pt=s.a.memo(({loaded:e,locked:t,onSearch:a})=>{const r=Object(y.b)().t;return s.a.createElement("div",{className:"QueueEmpty"},e?s.a.createElement(s.a.Fragment,null,s.a.createElement(h,{title:"...",icon:"shower",onClick:a,size:"L"}),s.a.createElement("span",{onClick:a},r(t?"rooms.empty_for_now":"rooms.empty"))):s.a.createElement(s.a.Fragment,null,s.a.createElement(q,{size:"L"}),s.a.createElement("span",null,r("rooms.loading"))))}),Tt=s.a.memo(({locked:e,tracks:t,playing:a,playingIndex:r,onPlay:n,onRemove:o,onStop:c})=>s.a.createElement(s.a.Fragment,null,t.map((t,l)=>s.a.createElement(H,{key:l,locked:e,playing:a&&r===l,track:t,onPlay:()=>n(l),onRemove:()=>o(l),onStop:c}))));a(98);const Lt=({className:e,propagate:t,size:a})=>{const r=Object(i.b)(),n=Object(y.b)().t,o=Object(i.c)(O),l=Object(i.c)(w),u=Object(i.c)(e=>e.room.tracks.length),d=Object(i.c)(e=>e.room.info),p=Object(c.useCallback)(()=>r(Nt()),[r]),b=Object(c.useCallback)(()=>r(Mt()),[r]),f=Object(c.useCallback)(()=>r(Ot()),[r]),v=Object(c.useCallback)(()=>r(wt()),[r]),g=Object(c.useCallback)(()=>{d&&0!==u&&r(Ye({info:Object(_.a)({},d,{playing:!0,queue_position:Pe()%u})}))},[r,d,u]),k=Object(c.useCallback)(()=>{},[]),x=Object(c.useCallback)(()=>{d&&0!==u&&r(Ye({info:Object(_.a)({},d,{playing:!0,queue_position:Pe()%u})}))},[r,d,u]),E=Object(c.useCallback)(()=>{d&&r(Ye({info:Object(_.a)({},d,{playing:!1})}))},[r,d]);return s.a.createElement("div",{className:m()("AudioPlayerControls",e)},s.a.createElement("div",{className:"Control"},s.a.createElement(h,{disabled:o||0===u||"shuffle"===(null===d||void 0===d?void 0:d.playmode),icon:"step-backward",onClick:t?p:k,size:a||"M",title:n("player.backward")})),s.a.createElement("div",{className:"Control"},l?s.a.createElement(h,{disabled:o||0===u,onClick:t?v:E,icon:"pause",title:n("player.stop"),size:a||"L"}):s.a.createElement(h,{disabled:o||0===u,onClick:t?f:x,icon:"play",size:a||"L",title:n("player.play")})),s.a.createElement("div",{className:"Control"},s.a.createElement(h,{disabled:o||0===u,icon:"step-forward",onClick:t?b:g,size:a||"M",title:n("player.forward")})))};a(99);const At=()=>{const e=Object(c.useState)(0),t=Object(C.a)(e,2),a=t[0],r=t[1];return Object(c.useEffect)(()=>{const e=setInterval(()=>{r(Ae.getPlayingTrackPercent())},250);return()=>{clearInterval(e)}},[r]),s.a.createElement("div",{className:"Progress"},s.a.createElement("progress",{max:100,value:100*a}))};a(100);const Bt=({extended:e,propagate:t})=>{const a=Object(i.b)(),r=Object(y.b)().t,n=Object(i.c)(e=>e.room.medias.length),o=Object(i.c)(O),l=Object(c.useCallback)(()=>{a(A(r("rooms.confirm_clear"),()=>{a(_t()),a(wt())}))},[a,r]),u=Object(c.useCallback)(()=>{a(A(r("rooms.confirm_lock"),()=>{a(ft())}))},[a,r]),d=Object(c.useCallback)(()=>{a(lt({type:"UnlockRoom",props:null}))},[a]),p=Object(c.useCallback)(()=>a(lt({type:"Search",props:null})),[a]);return s.a.createElement("div",{className:"RoomControls"},s.a.createElement("div",{className:"ControlsInner"},e?s.a.createElement(s.a.Fragment,null,s.a.createElement(Lt,{className:"ControlsSet",propagate:t}),s.a.createElement(At,null),s.a.createElement("div",{className:"ControlsSet RoomControlsSet"},s.a.createElement("div",{className:"Control"},o?s.a.createElement(h,{icon:"lock",onClick:d,size:"M",title:r("rooms.locked")}):s.a.createElement(h,{icon:"unlock",onClick:u,size:"M",title:r("rooms.unlocked")})),s.a.createElement("div",{className:"Control"},s.a.createElement(h,{onClick:p,icon:"search",title:r("medias.search")})),s.a.createElement("div",{className:"Control"},s.a.createElement(h,{disabled:o||0===n,onClick:l,icon:"trash",title:r("rooms.clear")})))):s.a.createElement(Lt,{className:"ControlsSet",propagate:t,size:"S"})))},zt={boat1:{N:{x:0,y:0},E:{x:0,y:0},S:{x:0,y:0},W:{x:0,y:0}},boat2:{N:{x:0,y:-1},E:{x:1,y:0},S:{x:0,y:1},W:{x:-1,y:0}},boat3:{N:{x:0,y:-2},E:{x:2,y:0},S:{x:0,y:2},W:{x:-2,y:0}}},Ft={N:{38:"move-forward",40:"move-backward",37:"rotate-left",39:"rotate-right"},E:{38:"rotate-left",40:"rotate-right",37:"move-backward",39:"move-forward"},S:{38:"move-backward",40:"move-forward",37:"rotate-right",39:"rotate-left"},W:{38:"rotate-right",40:"rotate-left",37:"move-forward",39:"move-backward"}},Ut={N:{"move-forward":{x:0,y:-1},"move-backward":{x:0,y:1}},E:{"move-forward":{x:1,y:0},"move-backward":{x:-1,y:0}},S:{"move-forward":{x:0,y:1},"move-backward":{x:0,y:-1}},W:{"move-forward":{x:-1,y:0},"move-backward":{x:1,y:0}}},qt={boat1:1,boat2:2,boat3:3},Wt={N:{forward:"arrow-up",backward:"arrow-down"},E:{forward:"arrow-right",backward:"arrow-left"},S:{forward:"arrow-down",backward:"arrow-up"},W:{forward:"arrow-left",backward:"arrow-right"}},Dt=({boat:e,disabled:t=!1,onMoveBackward:a,onMoveForward:r,onRotateLeft:n,onRotateRight:o})=>{const c=Object(y.b)().t;return s.a.createElement("div",{className:"SeaBattlePlayerControls SeaBattleControls"},s.a.createElement(h,{disabled:t,icon:"rotate-left",title:c("Rotate Left"),onClick:n}),s.a.createElement(h,{disabled:t,icon:e?Wt[Y(e.angle)].backward:"arrow-down",title:c("Move Backward"),onClick:a}),s.a.createElement(h,{disabled:t,icon:e?Wt[Y(e.angle)].forward:"arrow-up",title:c("Move Forward"),onClick:r}),s.a.createElement(h,{disabled:t,icon:"rotate-right",title:c("Rotate Right"),onClick:o}))};var Vt=a(19);const Ht=({className:e,onClick:t,position:a,stopPropagation:r=!1,transform:n,type:o,visibility:c})=>s.a.createElement("use",Object.assign({onClick:e=>{r&&e.stopPropagation(),t&&t()},className:e,href:"#".concat(o),transform:n,visibility:c},a)),Xt=e=>{let t=e.type,a=e.visibility,r=Object(Vt.a)(e,["type","visibility"]);return s.a.createElement(Ht,{className:"SeaBattleCell",type:t,visibility:a,position:{x:40*r.position.x,y:40*r.position.y}})},Gt=e=>{let t=e.type,a=Object(Vt.a)(e,["type"]);return s.a.createElement(Ht,{className:"SeaBattleWeapon",type:t,position:{x:te[t].x+40*a.position.x,y:te[t].y+40*a.position.y}})},Jt=({weapons:e})=>s.a.createElement(s.a.Fragment,null,e.map((e,t)=>s.a.createElement(Gt,Object.assign({key:t},e)))),Qt=e=>{let t=e.type,a=Object(Vt.a)(e,["type"]);return s.a.createElement(Ht,{className:"SeaBattleHit",type:t,position:{x:$[t].x+40*a.position.x,y:$[t].y+40*a.position.y}})},Yt=({hits:e})=>s.a.createElement(s.a.Fragment,null,e.map((e,t)=>s.a.createElement(Qt,Object.assign({key:t},e)))),Zt=e=>{let t=e.boat,a=t.angle,r=t.hits,n=t.type,o=t.status,c=void 0===o?"ok":o,l=Object(Vt.a)(t,["angle","hits","type","status"]),i=e.hideFleet,u=e.onClick,d=e.selected;return s.a.createElement("g",{className:"SeaBattleBoatAnim",transform:"translate(".concat(Z[n].x+40*l.position.x,", ").concat(Z[n].y+40*l.position.y,") rotate(").concat(90*a,", 14, 14)")},i&&"ko"!==c?null:s.a.createElement(Ht,{className:m()("SeaBattleBoat",c,{clickable:!!u,selected:d}),onClick:u,stopPropagation:!0,position:{x:0,y:0},type:n}),r.map((e,t)=>s.a.createElement(Ht,{key:t,className:"SeaBattleHit",type:e.type,position:{x:K[e.type].x+40*e.position.x,y:K[e.type].y+40*e.position.y}})))},Kt=({fleet:e,hideFleet:t,selectedBoatIndex:a,onSelectBoatIndex:r})=>s.a.createElement(s.a.Fragment,null,e.map((e,n)=>s.a.createElement(Zt,{key:n,boat:e,hideFleet:t,onClick:r&&"ok"===e.status?()=>{r(n===a?-1:n)}:void 0,selected:n===a}))),$t=()=>s.a.createElement("defs",null,s.a.createElement("circle",{id:"missed",cx:"10",cy:"10",r:"8",fill:"#fff"}),s.a.createElement("circle",{id:"hitted1",cx:"10",cy:"10",r:"8",fill:"#e52524"}),s.a.createElement("circle",{id:"hitted2",cx:"10",cy:"10",r:"8",fill:"#ffcf02"}),s.a.createElement("polygon",{id:"crossed",points:"11.98 8.08 20.07 0 24 3.9 15.92 11.98 24 20.07 20.07 24 11.98 15.92 3.9 24 0 20.07 8.08 11.98 0 3.9 3.9 0 11.98 8.08",fillRule:"evenodd"}),s.a.createElement("path",{id:"cell",d:"M0,0V40H40V0ZM36,36H4V4H36Z"}),s.a.createElement("use",{id:"cell-selected",href:"#cell",fill:"#FF0"}),s.a.createElement("use",{id:"cell-selection",href:"#cell",fill:"#555"}),s.a.createElement("g",{id:"cell-crossed"},s.a.createElement("use",{href:"#cell",fill:"#e52524"}),s.a.createElement("use",{href:"#crossed",fill:"#e52524",x:"8",y:"8"})),s.a.createElement("path",{id:"bullet1",d:"M16,4C16,8.46,0,8,0,8V0S16-.46,16,4Z",fill:"#afafaf"}),s.a.createElement("path",{id:"bullet2",d:"M16,4C16,8.46,0,8,0,8V0S16-.46,16,4Z",fill:"#676766"}),s.a.createElement("path",{id:"bullet3",d:"M16,4C16,8.46,0,8,0,8V0S16-.46,16,4Z",fill:"#000000"}),s.a.createElement("path",{id:"mine",d:"M16,9V7H13.77a5.92,5.92,0,0,0-1-2.41L14.35,3,13,1.65,11.39,3.23A5.92,5.92,0,0,0,9,2.23V0H7V2.23a5.92,5.92,0,0,0-2.41,1L3,1.65,1.65,3,3.23,4.61A5.92,5.92,0,0,0,2.23,7H0V9H2.23a5.92,5.92,0,0,0,1,2.41L1.65,13,3,14.35l1.58-1.58a5.92,5.92,0,0,0,2.41,1V16H9V13.77a5.92,5.92,0,0,0,2.41-1L13,14.35,14.35,13l-1.58-1.58a5.92,5.92,0,0,0,1-2.41Z",fill:"#000000"}),s.a.createElement("path",{id:"boat1",d:"M28,14C28,19,14,28,14,28H0V0H14S28,9.05,28,14Z"}),s.a.createElement("path",{id:"boat2",d:"M68,14C68,19,51.89,28,51.89,28H0V0H51.89S68,9.05,68,14Z"}),s.a.createElement("path",{id:"boat3",d:"M108,14C108,19,91.24,28,91.24,28H0V0H91.24S108,9.05,108,14Z"}),s.a.createElement("pattern",{id:"sea-grid",width:"80",height:"80",patternUnits:"userSpaceOnUse"},s.a.createElement("g",null,s.a.createElement("rect",{width:40,height:40,fill:"#a6dbf8",x:"0",y:"0"}),s.a.createElement("rect",{width:40,height:40,fill:"#50a3db",x:40,y:"0"}),s.a.createElement("rect",{width:40,height:40,fill:"#50a3db",x:"0",y:40}),s.a.createElement("rect",{width:40,height:40,fill:"#a6dbf8",x:40,y:40})))),ea=(e,t)=>{const a=((e,{x:t,y:a})=>{var r=e.createSVGPoint();return r.x=t,r.y=a,{tx:(r=r.matrixTransform(e.getScreenCTM().inverse())).x,ty:r.y}})(e,t),r=a.tx,n=a.ty;return{x:Math.floor(r/40),y:Math.floor(n/40)}},ta=({hideFleet:e,onCellClick:t,map:{fleet:a,hits:r,opponentsWeapons:n}={fleet:[],hits:[],weapons:{},userId:"",opponentsWeapons:[]},selectedBoatIndex:o,onSelectBoatIndex:l})=>{const i=Object(c.useRef)(null),u=Object(c.useState)({x:0,y:0}),d=Object(C.a)(u,2),p=d[0],m=d[1],b=Object(c.useState)("hidden"),f=Object(C.a)(b,2),y=f[0],v=f[1],g=Object(c.useState)({x:0,y:0}),k=Object(C.a)(g,2),h=k[0],x=k[1],E=Object(c.useState)("hidden"),j=Object(C.a)(E,2),O=j[0],w=j[1],_=Object(c.useCallback)(e=>{const a=ea(i.current,e);p.x===a.x&&p.y===a.y?(m({x:0,y:0}),v("hidden")):(m(a),v("visible")),t&&t(a)},[t,p]),S=Object(c.useCallback)(()=>{w("hidden")},[]),I=Object(c.useCallback)(e=>{x(ea(i.current,e)),w("visible")},[]);return s.a.createElement("svg",{className:"SeaBattleMap",viewBox:"0 0 400 400",ref:i,onClick:e=>_({x:e.clientX,y:e.clientY}),onMouseLeave:S,onMouseMove:e=>I({x:e.clientX,y:e.clientY})},s.a.createElement($t,null),s.a.createElement("rect",{width:"400",height:"400",fill:"url(#sea-grid)"}),s.a.createElement(Xt,{type:"cell-selection",position:h,visibility:O}),s.a.createElement(Xt,{type:"cell-selected",position:p,visibility:y}),s.a.createElement(Jt,{weapons:n}),s.a.createElement(Kt,{hideFleet:e,fleet:a,selectedBoatIndex:o,onSelectBoatIndex:l}),s.a.createElement(Yt,{hits:r}))},aa=(e,t)=>e[t.y][t.x],ra=(e,t,a)=>{e[t.y][t.x]=a},na=e=>e.x>=0&&e.x<10&&e.y>=0&&e.y<10,oa=(e,t)=>{const a=Array(10).fill(null).map(e=>Array(10).fill(null));for(let r=0,n=e.length;r<n;++r){const n=e[r];if(t!==n)switch(Y(n.angle)){case"N":for(let e=0;e<qt[n.type];++e)ra(a,{x:n.position.x,y:n.position.y-e},{boatIndex:r,type:"boat"});break;case"E":for(let e=0;e<qt[n.type];++e)ra(a,{x:n.position.x+e,y:n.position.y},{boatIndex:r,type:"boat"});break;case"S":for(let e=0;e<qt[n.type];++e)ra(a,{x:n.position.x,y:n.position.y+e},{boatIndex:r,type:"boat"});break;case"W":for(let e=0;e<qt[n.type];++e)ra(a,{x:n.position.x-e,y:n.position.y},{boatIndex:r,type:"boat"})}}return a},ca=(e,t,a,r)=>((e,t,a)=>{if(!na(t))return!1;const r=qt[e.type]-1;switch(a){case"N":return na({x:t.x,y:t.y-r});case"E":return na({x:t.x+r,y:t.y});case"S":return na({x:t.x,y:t.y+r});case"W":return na({x:t.x-r,y:t.y})}})(t,a,r)?!!((e,t,a,r)=>{const n=oa(e,t),o=qt[t.type];switch(r){case"N":for(let e=0;e<o;++e){if(null!==aa(n,{x:a.x,y:a.y-e}))return!1}break;case"E":for(let e=0;e<o;++e){if(null!==aa(n,{x:a.x+e,y:a.y}))return!1}break;case"S":for(let e=0;e<o;++e){if(null!==aa(n,{x:a.x,y:a.y+e}))return!1}break;case"W":for(let e=0;e<o;++e){if(null!==aa(n,{x:a.x-e,y:a.y}))return!1}}return!0})(e,t,a,r)||(console.debug("[SeaBattle] Boat blocked by collision"),!1):(console.debug("[SeaBattle] Boat blocked by zone"),!1),sa=()=>function(){var e=Object(o.a)(n.a.mark((function e(t,a){var r,o,c,s,l,i;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=a(),o=r.room,c=o.info,s=o.room,l=r.user.access.userId,s&&!s.isLocked()&&c){e.next=4;break}return t(P("rooms.error.locked")),e.abrupt("return");case 4:if(l){e.next=8;break}return console.debug("[SeaBattle] Not connected"),t(lt({type:"CreateUser",props:null})),e.abrupt("return");case 8:if(e.prev=8,console.debug("[SeaBattle] Joining battle...",{userId:l}),i=Object(G.a)(c.extra),!i.maps.find(e=>e.userId===l)){e.next=14;break}return e.abrupt("return");case 14:if(!(Object.keys(i.maps).length>=3)){e.next=17;break}return t(P("games.max_players_count")),e.abrupt("return");case 17:return re(i,l),e.next=20,s.update(Object(_.a)({},c,{extra:Object(G.b)(i)}));case 20:e.next=25;break;case 22:e.prev=22,e.t0=e.catch(8),t(P(he(e.t0)));case 25:case"end":return e.stop()}}),e,null,[[8,22]])})));return function(t,a){return e.apply(this,arguments)}}(),la=({boatIndex:e,movement:t})=>function(){var a=Object(o.a)(n.a.mark((function a(r,o){var c,s,l,i,u,d,p,m,b,f,y,v,g,k,h,x,E;return n.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(c=o(),s=c.room,l=s.info,i=s.room,u=c.user.access.userId,i&&!i.isLocked()&&l){a.next=4;break}return r(P("rooms.error.locked")),a.abrupt("return");case 4:if(u){a.next=8;break}return console.debug("[SeaBattle] Not connected"),r(lt({type:"CreateUser",props:null})),a.abrupt("return");case 8:if(a.prev=8,d=Object(G.a)(l.extra),p=d.maps.find(e=>e.userId===u)){a.next=14;break}return console.debug("[SeaBattle] Cannot find map for current user"),a.abrupt("return");case 14:if(oe(d,u)){a.next=17;break}return r(P("games.seabattle.not_your_turn")),a.abrupt("return");case 17:if(m=p.fleet,!(e<0||e>=m.length)){a.next=21;break}return console.debug("[SeaBattle] No boat selected"),a.abrupt("return");case 21:if(b=m[e],f=b.angle,y=b.position,v=b.type,g=Y(f),k=Object(_.a)({},y),"move-forward"!==t&&"move-backward"!==t||(k.x+=Ut[g][t].x,k.y+=Ut[g][t].y),h=f,x=g,"rotate-left"!==t&&"rotate-right"!==t||("rotate-left"===t&&h--,"rotate-right"===t&&h++,x=Y(h),k.x+=zt[v][g].x,k.y+=zt[v][g].y),E=m[e],ca(m,E,k,x)){a.next=33;break}return console.debug("[SeaBattle] Movement is not possible...",{boatIndex:e,movement:t,oldDirection:g,newDirection:x,oldPosition:y,newPosition:k}),r(P("games.seabattle.movement_is_not_possible",{tag:"invalid_move"})),a.abrupt("return");case 33:return console.debug("[SeaBattle] Moving boat...",{boatIndex:e,movement:t,oldDirection:g,oldPosition:y,newDirection:x,newPosition:k}),E.angle=h,E.position=k,ce(d),a.next=39,i.update(Object(_.a)({},l,{extra:Object(G.b)(d)}));case 39:d.maps.length>1&&r(L("games.seabattle.you_played_your_turn",{tag:"invalid_move"})),a.next=45;break;case 42:a.prev=42,a.t0=a.catch(8),r(P(he(a.t0)));case 45:case"end":return a.stop()}}),a,null,[[8,42]])})));return function(e,t){return a.apply(this,arguments)}}(),ia=({opponentIndex:e,position:t,weaponType:a})=>function(){var r=Object(o.a)(n.a.mark((function r(o,c){var s,l,i,u,d,p,m,b,f,y,v,g;return n.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(s=c(),l=s.room,i=l.info,u=l.room,d=s.user.access.userId,u&&!u.isLocked()&&i){r.next=4;break}return o(P("rooms.error.locked")),r.abrupt("return");case 4:if(d){r.next=8;break}return console.debug("[SeaBattle] Not connected"),o(lt({type:"CreateUser",props:null})),r.abrupt("return");case 8:if(r.prev=8,p=Object(G.a)(i.extra),m=p.maps.find(e=>e.userId===d)){r.next=14;break}return console.debug("[SeaBattle] Cannot find map for current user"),r.abrupt("return");case 14:if(oe(p,d)){r.next=17;break}return o(P("games.seabattle.not_your_turn")),r.abrupt("return");case 17:if(!(m.weapons[a]<=0)){r.next=21;break}return o(T("games.seabattle.weapon_not_available")),r.abrupt("return");case 21:if(b=ne(p.maps,d),!(e<0||e>=b.length)){r.next=25;break}return console.debug("[SeaBattle] Cannot find opponent map"),r.abrupt("return");case 25:if((f=b[e]).userId!==d){r.next=29;break}return console.debug("[SeaBattle] Invalid opponent map"),r.abrupt("return");case 29:return console.debug("[SeaBattle] Attacking opponent...",{opponentIndex:e,position:t,weaponType:a}),y=oa(f.fleet),null===(v=aa(y,t))?(o(P("games.seabattle.missed_opponent")),f.hits.push({position:t,type:"missed"})):"boat"===v.type?(o(L("games.seabattle.hitted_opponent")),(g=f.fleet[v.boatIndex]).hits.push({position:{x:0,y:g.hits.length},type:"hitted1"})):o(L("games.seabattle.hitted_weapon")),m.weapons[a]--,ce(p),r.next=37,u.update(Object(_.a)({},i,{extra:Object(G.b)(p)}));case 37:p.maps.length>1&&o(L("games.seabattle.you_played_your_turn",{tag:"invalid_move"})),r.next=43;break;case 40:r.prev=40,r.t0=r.catch(8),o(P(he(r.t0)));case 43:case"end":return r.stop()}}),r,null,[[8,40]])})));return function(e,t){return r.apply(this,arguments)}}(),ua=({opponentsCount:e,opponentIndex:t,onSelectPreviousOpponent:a,onSelectNextOpponent:r})=>{const n=Object(y.b)().t;return e>0?s.a.createElement("div",{className:"SeaBattleOpponentSelection"},s.a.createElement(h,{disabled:e<=1,icon:"caret-left",title:"Previous enemy",onClick:a}),s.a.createElement("span",{className:"SeaBattleOpponentSelectionLabel"},n("games.seabattle.opponent_index",{index:"".concat(t+1," / ").concat(e)})),s.a.createElement(h,{disabled:e<=1,icon:"caret-right",title:"Next enemy",onClick:r})):s.a.createElement("div",{className:"SeaBattleOpponentSelection"},s.a.createElement("span",{className:"SeaBattleOpponentSelectionLabel"},n("games.no_opponents")))},da=({onSelect:e,weapons:t})=>{const a=Object(c.useRef)(null),r=Object(c.useState)(-1),n=Object(C.a)(r,2),o=n[0],l=n[1],i=Object(c.useState)("hidden"),u=Object(C.a)(i,2),d=u[0],p=u[1],m=Object(c.useState)(-1),b=Object(C.a)(m,2),f=b[0],y=b[1],v=Object(c.useState)("hidden"),g=Object(C.a)(v,2),k=g[0],h=g[1],x=Object(c.useCallback)(t=>{const r=ea(a.current,t).x;o===r?(l(-1),p("hidden"),e(void 0)):(l(r),p("visible"),e(ee[r]))},[e,o]),E=Object(c.useCallback)(()=>{h("hidden")},[]),j=Object(c.useCallback)(e=>{y(ea(a.current,e).x),h("visible")},[]);return s.a.createElement("svg",{className:"SeaBattleWeaponSelection",viewBox:"0 0 160 40",ref:a,onClick:e=>x({x:e.clientX,y:e.clientY}),onMouseLeave:E,onMouseMove:e=>j({x:e.clientX,y:e.clientY})},s.a.createElement($t,null),s.a.createElement("rect",{width:"400",height:"400",fill:"url(#sea-grid)"}),s.a.createElement(Xt,{type:"cell-selection",position:{x:f,y:0},visibility:k}),s.a.createElement(Xt,{type:"cell-selected",position:{x:o,y:0},visibility:d}),s.a.createElement(Jt,{weapons:ee.map((e,t)=>({opponentId:"",position:{x:t,y:0},type:e}))}),ee.map((e,a)=>s.a.createElement(Xt,{key:a,type:"cell-crossed",position:{x:a,y:0},visibility:t[e]?"hidden":"visible"})))},pa=({opponentsCount:e,opponentIndex:t,onSelectPreviousOpponent:a,onSelectNextOpponent:r,onSelectWeaponType:n,weapons:o})=>s.a.createElement("div",{className:"SeaBattleOpponentControls SeaBattleControls"},s.a.createElement(ua,{opponentsCount:e,opponentIndex:t,onSelectPreviousOpponent:a,onSelectNextOpponent:r}),s.a.createElement(da,{onSelect:n,weapons:o}));a(101);const ma=()=>{const e=Object(i.b)(),t=Object(y.b)().t,a=Object(c.useState)(-1),r=Object(C.a)(a,2),n=r[0],o=r[1],l=Object(c.useState)(0),u=Object(C.a)(l,2),d=u[0],p=u[1],m=Object(c.useState)(),b=Object(C.a)(m,2),f=b[0],v=b[1],g=Object(i.c)(e=>e.user.access.userId),k=(({extra:e,userId:t,boatIndex:a,weaponType:r})=>{let n=void 0,o=void 0,c=void 0;if(e){const r=Object(G.a)(e);t&&(c=r.maps.find(e=>e.userId===t),c&&a>=0&&a<c.fleet.length&&(n=c.fleet[a])),o=ne(r.maps,t)}return{boat:n,opponentMaps:o,playerMap:c}})({extra:Object(i.c)(e=>{var t;return(null===(t=e.room.info)||void 0===t?void 0:t.extra)||""}),userId:g,boatIndex:n,weaponType:f}),x=k.boat,E=k.opponentMaps,j=k.playerMap,O=Object(c.useCallback)(()=>{e(sa())},[e]),w=Object(c.useCallback)(t=>{e(la({boatIndex:n,movement:t}))},[e,n]),_=Object(c.useCallback)(e=>{e.repeat||38!==e.keyCode&&40!==e.keyCode&&37!==e.keyCode&&39!==e.keyCode||(e.preventDefault(),x&&w(Ft[Y(x.angle)][e.keyCode]))},[w,x]),S=Object(c.useCallback)(()=>e(lt({type:"CreateUser",props:null})),[e]),I=Object(c.useCallback)(t=>{E&&0!==E.length?e(f?ia({opponentIndex:d,position:t,weaponType:f}):T("games.seabattle.no_weapon_selected")):e(T("games.no_opponents_to_attack"))},[e,d,E,f]);return Object(c.useEffect)(()=>(document.addEventListener("keydown",_),()=>{document.removeEventListener("keydown",_)}),[_]),s.a.createElement("div",{className:"SeaBattle"},s.a.createElement("div",{className:"SeaBattlePlayer current"},s.a.createElement(Dt,{boat:x,disabled:!x,onMoveForward:()=>w("move-forward"),onMoveBackward:()=>w("move-backward"),onRotateLeft:()=>w("rotate-left"),onRotateRight:()=>w("rotate-right")}),j?s.a.createElement(ta,{map:j,hideFleet:!1,selectedBoatIndex:n,onSelectBoatIndex:o}):s.a.createElement("div",{className:"SeaBattleJoin"},E&&E.length>=3?s.a.createElement("span",null,t("games.max_players_count")):g?s.a.createElement(s.a.Fragment,null,s.a.createElement("span",null,t("games.watch_or_join")),s.a.createElement(h,{icon:"sign-in",title:t("games.seabattle.join_battle"),size:"L",displayTitle:!0,onClick:O})):s.a.createElement(s.a.Fragment,null,s.a.createElement("span",null,t("games.connect_to_join")),s.a.createElement(h,{icon:"sign-in",title:t("users.connect"),size:"L",displayTitle:!0,onClick:S})))),s.a.createElement("div",{className:"SeaBattlePlayer other"},s.a.createElement(pa,{opponentsCount:(null===E||void 0===E?void 0:E.length)||0,opponentIndex:d,onSelectPreviousOpponent:E&&E.length>0?()=>p(0===d?E.length-1:d-1):void 0,onSelectNextOpponent:E&&E.length>0?()=>p((d+1)%(null===E||void 0===E?void 0:E.length)):void 0,onSelectWeaponType:v,weapons:(null===j||void 0===j?void 0:j.weapons)||{}}),s.a.createElement(ta,{map:E&&E.length>0?E[d]:void 0,hideFleet:!0,onCellClick:I})))};a(102);const ba=()=>{const e=Object(i.b)(),t=Object(i.c)(e=>e.room.color),a=t.fg,r=t.bg,n=Object(i.c)(e=>e.room.info),o=Object(d.h)().search,l=Object(d.i)(),u=l.db_id,p=l.room_id,b=f.a.parse(o.substr(1)).secret;return Object(c.useEffect)(()=>(e(mt(u,p,b||"")),()=>{e(bt())}),[e,u,p,b]),Object(c.useEffect)(()=>{document.body.className=a,document.body.style.backgroundColor="rgb(".concat(r.r,", ").concat(r.g,", ").concat(r.b,")")},[r,a]),s.a.createElement("div",{className:m()("Room")},s.a.createElement(U,null),(()=>{if(!n)return null;switch(n.type){case"blind":return null;case"dj":return s.a.createElement(s.a.Fragment,null,s.a.createElement(Rt,null),s.a.createElement(Bt,{extended:!0,propagate:!0}));case"seabattle":return s.a.createElement(s.a.Fragment,null,s.a.createElement(ma,null),s.a.createElement(Bt,{extended:!1,propagate:!1}))}})())},fa=()=>{const e={dbId:"",userId:"",secret:""},t=localStorage.getItem("U");if(t)try{const a=Object(G.a)(t);"string"===typeof a.dbId&&"string"===typeof a.userId&&"string"===typeof a.secret&&(e.dbId=a.dbId,e.userId=a.userId,e.secret=a.secret,console.debug("Loaded user access: ",e))}catch(a){}return e},ya=e=>S("user/SET",e),va={access:{dbId:"",userId:"",secret:""},error:null,fetching:!1,info:null,user:null},ga=(e,t,a)=>function(){var r=Object(o.a)(n.a.mark((function r(o){var c;return n.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,console.debug("[User] Creating..."),c=Object(X.a)(),r.next=5,ke({dbId:e,userId:c,secret:a}).update({name:t});case 5:o(ha(e,c,a)),r.next=11;break;case 8:r.prev=8,r.t0=r.catch(0),o(P(he(r.t0)));case 11:case"end":return r.stop()}}),r,null,[[0,8]])})));return function(e){return r.apply(this,arguments)}}();let ka=null;const ha=(e,t,a)=>function(){var r=Object(o.a)(n.a.mark((function r(o,c){var s,l,i;return n.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(s=c(),!(l=s.user.user)||l.dbId!==e||l.userId!==t){r.next=3;break}return r.abrupt("return");case 3:return o(xa()),r.prev=4,console.debug("[User] Connecting...",{dbId:e,userId:t,secret:a}),i=ke({dbId:e,userId:t,secret:a}),r.t0=o,r.t1=ya,r.t2={dbId:e,userId:t,secret:a},r.t3=i,r.next=13,i.wait();case 13:r.t4=r.sent,r.t5={access:r.t2,user:r.t3,info:r.t4},r.t6=(0,r.t1)(r.t5),(0,r.t0)(r.t6),ka=i.subscribe(e=>{const t=e.val();console.debug("[User] Received user update...",t),o(ya({user:i,info:t}))}),r.next=24;break;case 20:r.prev=20,r.t7=r.catch(4),o(P(he(r.t7))),o(xa());case 24:case"end":return r.stop()}}),r,null,[[4,20]])})));return function(e,t){return r.apply(this,arguments)}}(),xa=()=>function(){var e=Object(o.a)(n.a.mark((function e(t,a){var r,o,c,s,l,i,u;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=a(),o=r.user,c=o.access,s=c.dbId,l=c.userId,i=c.secret,u=o.user,s||l||i||u){e.next=3;break}return e.abrupt("return");case 3:console.debug("[User] Disconnecting...",{dbId:s,userId:l,secret:i}),u&&(u.unsubscribe(ka),ka=null),t(S("user/RESET"));case 6:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),Ea=()=>function(){var e=Object(o.a)(n.a.mark((function e(t,a){var r,o,c,s,l;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=a(),o=r.user.access,c=o.dbId,s=o.userId,l=o.secret,c&&s&&l){e.next=3;break}return e.abrupt("return");case 3:console.debug("[User] Reconnecting...",{dbId:c,userId:s,secret:l}),t(ha(c,s,l));case 5:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}();a(103);const ja=()=>{const e=Object(i.b)(),t=Object(i.c)(e=>!!e.user.access.dbId&&!!e.user.access.userId),a=Object(y.b)().t,r=Object(c.useCallback)(()=>e(lt({type:"CreateRoom",props:null})),[e]),n=Object(c.useCallback)(()=>e(lt({type:"CreateUser",props:null})),[e]),o=Object(c.useCallback)(()=>e(xa()),[e]);return Object(c.useEffect)(()=>{var t;e(S("message/RESET",{tag:t}))},[e]),s.a.createElement("div",{className:"Splash"},s.a.createElement("div",{className:"Top"},s.a.createElement("div",{className:"Logo"},s.a.createElement(u.b,{to:"/"},"Party")),s.a.createElement("div",{className:"Description"},s.a.createElement("span",null,a("splash.description")))),s.a.createElement("div",{className:"Middle"},s.a.createElement("div",{className:"Menu"},t?s.a.createElement(s.a.Fragment,null,s.a.createElement("div",{className:"MenuItem"},s.a.createElement(h,{icon:"plus",onClick:r,size:"L",title:a("rooms.create")}))):s.a.createElement(s.a.Fragment,null,s.a.createElement("div",{className:"MenuItem"},s.a.createElement(h,{onClick:n,icon:"sign-in",size:"L",title:a("users.connect")}))))),s.a.createElement("div",{className:"Bottom"},s.a.createElement("div",{className:"Menu"},t?s.a.createElement("div",{className:"MenuItem"},s.a.createElement(h,{icon:"sign-out",onClick:o,size:"M",title:a("users.disconnect")})):s.a.createElement("div",{className:"MenuItem"},s.a.createElement(h,{icon:"info",onClick:()=>{},size:"M",title:a("splash.CGU")})))))};var Oa=a(27);const wa=({children:e,className:t,title:a,renderFoot:r,onSubmit:n})=>{const o=Object(i.b)(),l=Object(y.b)().t,u=Object(i.c)(e=>e.modals.stack.length>1),d=Object(c.useCallback)(()=>o(S("modals/CLOSE")),[o]),p=Object(c.useCallback)(()=>o(it()),[o]);return s.a.createElement("form",{className:m()("Modal",t),onSubmit:e=>{e.preventDefault(),n&&n()}},s.a.createElement("div",{className:"ModalHead"},s.a.createElement(h,{kind:"special",className:m()("ModalHeadBack",{hidden:!u}),icon:"angle-left",title:"Back",onClick:p}),s.a.createElement("div",{className:"ModalTitle"},a),s.a.createElement(h,{kind:"special",className:"ModalHeadClose",onClick:d,title:l("cancel"),icon:"times"})),s.a.createElement("div",{className:"ModalBody"},e),s.a.createElement("div",{className:"ModalFoot"},r&&r()))};a(104);const _a=({children:e,className:t,renderButtons:a,title:r,onSubmit:n})=>s.a.createElement(wa,{className:m()("FormModal",t),title:r,renderFoot:a,onSubmit:n},e),Ca=({onClick:e})=>{const t=Object(y.b)().t;return s.a.createElement(h,{onClick:e,title:t("cancel"),kind:"default",icon:"ban"})},Sa=({question:e,onCanceled:t,onConfirmed:a})=>{const r=Object(i.b)(),n=Object(y.b)().t,o=Object(c.useCallback)(()=>{r(it()),t&&t()},[r,t]);return s.a.createElement(_a,{title:n("confirm"),onSubmit:a,renderButtons:()=>s.a.createElement(s.a.Fragment,null,s.a.createElement(h,{title:n("cancel"),kind:"primary",icon:"plus",type:"submit"}),s.a.createElement(Ca,{onClick:o}))},e)},Ia=({children:e})=>s.a.createElement("div",{className:"ModalField"},e),Na=s.a.forwardRef((e,t)=>s.a.createElement(Ia,null,s.a.createElement("div",{className:"XXX"},s.a.createElement("label",{htmlFor:e.id},e.label),s.a.createElement("input",Object.assign({ref:t},e))))),Ma=({id:e,label:t,onChange:a,placeholder:r,value:l})=>{const u=Object(i.b)(),d=Object(y.b)().t,p=Object(c.useCallback)(Object(o.a)(n.a.mark((function e(){return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x(l);case 2:u(L("secret_copied_to_clipboard"));case 3:case"end":return e.stop()}}),e)}))),[u,l]);return s.a.createElement(Ia,null,s.a.createElement("div",{className:"XXX"},s.a.createElement("label",{htmlFor:e},t),s.a.createElement("div",{style:{display:"flex",flexDirection:"row",justifyContent:"space-between"}},s.a.createElement("input",{style:{flexGrow:1,marginRight:"0.5rem"},id:e,type:"password",autoComplete:"password",placeholder:r,maxLength:36,minLength:36,required:!0,value:l,onChange:e=>a(e.target.value)}),s.a.createElement(h,{icon:"clipboard",onClick:p,size:"M",title:d("copy_to_clipboard")}))))},Ra=s.a.forwardRef((e,t)=>s.a.createElement(Ia,null,s.a.createElement("div",{className:"XXX"},s.a.createElement("label",{htmlFor:e.id},e.label),s.a.createElement("select",Object.assign({ref:t},e),e.options.sort((e,t)=>e.label.localeCompare(t.label)).map(e=>s.a.createElement("option",{key:e.id,value:e.id},e.label)))))),Pa=()=>{const e=Object(i.b)(),t=Object(c.useState)(""),a=Object(C.a)(t,2),r=a[0],n=a[1],o=Object(c.useState)(""),l=Object(C.a)(o,2),u=l[0],d=l[1],p=Object(c.useRef)(null),m=Object(y.b)().t;Object(c.useEffect)(()=>{p.current&&p.current.focus()},[p]);const b=Object(c.useCallback)(()=>e(it()),[e]),f=Object(c.useCallback)(()=>{0!==r.trim().length?0!==u.trim().length?(e(ha(be,r,u)),e(it())):e(P("users.secret_is_invalid")):e(P("users.id_is_invalid"))},[e,r,u]),v=Object(c.useCallback)(()=>e(lt({type:"CreateUser",props:null})),[e]);return s.a.createElement(_a,{title:m("users.connection"),onSubmit:f,renderButtons:()=>s.a.createElement(s.a.Fragment,null,s.a.createElement(h,{disabled:0===r.trim().length||36!==r.length||36!==u.length,title:m("users.connect"),kind:"primary",icon:"sign-in",type:"submit"}),s.a.createElement(Ca,{onClick:b}),s.a.createElement(h,{title:m("users.create"),kind:"default",icon:"plus",onClick:v}))},s.a.createElement(Na,{id:"modal-userId",label:m("users.id"),type:"text",placeholder:m("users.id_placeholder"),maxLength:36,minLength:36,required:!0,value:r,ref:p,onChange:e=>n(e.target.value)}),s.a.createElement(Na,{id:"modal-secret",label:m("users.secret"),type:"password",autoComplete:"password",placeholder:m("users.secret_placeholder"),maxLength:36,minLength:36,required:!0,value:u,onChange:e=>d(e.target.value)}))};let Ta=1;const La=()=>{const e=Object(i.b)(),t=Object(c.useState)(""),a=Object(C.a)(t,2),r=a[0],n=a[1],o=Object(c.useState)(Object(X.a)()),l=Object(C.a)(o,2),u=l[0],d=l[1],p=Object(c.useState)("seabattle"),m=Object(C.a)(p,2),b=m[0],f=m[1],v=Object(c.useRef)(null),g=Object(y.b)().t;Object(c.useEffect)(()=>{n("".concat(g("rooms.room")," ").concat(Ta)),v.current&&v.current.focus()},[g,v]);const k=Object(c.useCallback)(()=>e(it()),[e]),x=Object(c.useCallback)(()=>{0!==r.trim().length?0!==u.trim().length?(e(pt(me,r,u,b)),e(it()),Ta++):e(P("rooms.secret_is_invalid")):e(P("rooms.name_is_invalid"))},[e,r,u,b]),E=Object(c.useCallback)(()=>e(lt({type:"JoinRoom",props:null})),[e]);return s.a.createElement(_a,{title:g("rooms.room_creation"),onSubmit:x,renderButtons:()=>s.a.createElement(s.a.Fragment,null,s.a.createElement(h,{disabled:0===r.trim().length||36!==u.length,title:g("rooms.create"),kind:"primary",icon:"plus",type:"submit"}),s.a.createElement(Ca,{onClick:k}),s.a.createElement(h,{title:g("rooms.join"),kind:"default",icon:"sign-in",onClick:E}))},s.a.createElement(Na,{id:"modal-name",label:g("rooms.name"),type:"text",placeholder:g("rooms.name_placeholder"),maxLength:100,minLength:2,required:!0,value:r,ref:v,onChange:e=>n(e.target.value)}),s.a.createElement(Ma,{id:"modal-secret",label:g("rooms.key"),placeholder:g("rooms.key_placeholder"),value:u,onChange:d}),s.a.createElement(Ra,{id:"modal-type",label:g("rooms.type"),placeholder:g("rooms.type_placeholder"),options:se.map(e=>({id:e,label:g("rooms.types.".concat(e))})),value:b,onChange:e=>f(e.target.value)}))};let Aa=1;const Ba=()=>{const e=Object(i.b)(),t=Object(c.useState)(""),a=Object(C.a)(t,2),r=a[0],n=a[1],o=Object(c.useState)(Object(X.a)()),l=Object(C.a)(o,2),u=l[0],d=l[1],p=Object(c.useRef)(null),m=Object(y.b)().t;Object(c.useEffect)(()=>{n("".concat(m("users.user")," ").concat(Aa)),p.current&&p.current.focus()},[m,p]);const b=Object(c.useCallback)(()=>e(it()),[e]),f=Object(c.useCallback)(()=>{0!==r.trim().length?0!==u.trim().length?(e(ga(be,r,u)),e(it()),Aa++):e(P("users.secret_is_invalid")):e(P("users.name_is_invalid"))},[e,r,u]),v=Object(c.useCallback)(()=>{e(lt({type:"ConnectUser",props:null}))},[e]);return s.a.createElement(_a,{title:m("users.user_creation"),onSubmit:f,renderButtons:()=>s.a.createElement(s.a.Fragment,null,s.a.createElement(h,{disabled:0===r.trim().length||36!==u.length,title:m("users.create"),kind:"primary",icon:"plus",type:"submit"}),s.a.createElement(Ca,{onClick:b}),s.a.createElement(h,{title:m("users.connect"),kind:"default",icon:"sign-in",onClick:v}))},s.a.createElement(Na,{id:"modal-name",label:m("users.name"),type:"text",placeholder:m("users.name_placeholder"),maxLength:100,minLength:2,required:!0,value:r,ref:p,onChange:e=>n(e.target.value)}),s.a.createElement(Ma,{id:"modal-secret",label:m("users.secret"),placeholder:m("users.secret_placeholder"),value:u,onChange:e=>d(e)}))},za=({items:e,label:t,onViewMore:a,cb:r})=>e.length>0?s.a.createElement(s.a.Fragment,null,s.a.createElement(Ia,null,s.a.createElement("div",{className:"XXX"},s.a.createElement("label",null,t))),e.map(e=>s.a.createElement(Ia,{key:e.id},s.a.createElement("div",{className:"SearchResultItem"},r(e)))),s.a.createElement(Ia,null,s.a.createElement("div",{className:"XXX"},s.a.createElement(h,{icon:"ellipsis-h",onClick:a,title:"View more..."})))):null;a(105);const Fa=()=>{const e=Object(i.b)(),t=Object(y.b)().t,a=Object(c.useRef)(null),r=Object(i.c)(O),l=Object(c.useState)(""),u=Object(C.a)(l,2),d=u[0],p=u[1],m=Object(c.useState)("deezer"),b=Object(C.a)(m,2),f=b[0],v=b[1],g=Object(c.useState)("track"),k=Object(C.a)(g,2),x=k[0],E=k[1],j=Object(c.useState)(""),w=Object(C.a)(j,2),_=w[0],S=w[1],I=Object(c.useState)({deezer:{album:[],playlist:[],track:[]}}),N=Object(C.a)(I,2),M=N[0],R=N[1],P=Object(c.useCallback)(()=>e(it()),[e]),T=Object(c.useCallback)(Object(o.a)(n.a.mark((function e(){return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(_.trim().length>0)){e.next=6;break}return e.t0=R,e.next=4,Ge(_,{limit:5});case 4:e.t1=e.sent,(0,e.t0)(e.t1);case 6:case"end":return e.stop()}}),e)}))),[_]),L=Object(c.useCallback)((t,a,r)=>e(Ct([{provider:t,type:a,id:r}])),[e]),A=Object(c.useCallback)((t,a,r)=>{e(ot({provider:t,type:a,id:r})),p(r),v(t),E(a)},[e]),B=Object(c.useCallback)(Object(o.a)(n.a.mark((function e(){return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.debug("Stop previewing..."),e.next=3,Be.stop();case 3:p(""),v("deezer"),E("track");case 6:case"end":return e.stop()}}),e)}))),[]),z=Object(c.useCallback)(function(){var e=Object(o.a)(n.a.mark((function e(t){return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=R,e.next=3,Ge(_,{limit:50},t);case 3:e.t1=e.sent,(0,e.t0)(e.t1);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[_,R]);return Object(c.useEffect)(()=>(a.current&&a.current.focus(),()=>{console.debug("Stop previewing..."),Be.stop()}),[e]),s.a.createElement(_a,{className:"SearchModal",title:t("medias.medias_search"),onSubmit:T,renderButtons:()=>s.a.createElement(s.a.Fragment,null,s.a.createElement(h,{disabled:0===_.trim().length,title:t("medias.search"),kind:"primary",icon:"search",type:"submit"}),s.a.createElement(Ca,{onClick:P}))},s.a.createElement(Ia,null,s.a.createElement("input",{id:"modal-query",type:"text",placeholder:t("medias.search_placeholder"),maxLength:100,minLength:2,required:!0,value:_,ref:a,onChange:e=>S(e.target.value)})),Ke.map(({label:e,provider:a,type:n})=>s.a.createElement(za,{key:n,label:t(e),items:M[a][n],onViewMore:()=>z(n),cb:e=>s.a.createElement(V,{actions:s.a.createElement(h,{disabled:r,title:t("medias.add"),icon:"plus",onClick:()=>L(a,n,e.id)}),media:e,playable:!0,playing:f===a&&x===n&&d===e.id,onPlay:()=>A(a,n,e.id),onStop:B})})))},Ua=()=>{const e=Object(i.b)(),t=Object(c.useState)(""),a=Object(C.a)(t,2),r=a[0],n=a[1],o=Object(c.useRef)(null),l=Object(y.b)().t;Object(c.useEffect)(()=>{o.current&&o.current.focus()},[o]);const u=Object(c.useCallback)(()=>e(it()),[e]),d=Object(c.useCallback)(()=>{0!==r.trim().length?(e(mt(me,r,"")),e(it())):e(P("rooms.id_is_invalid"))},[e,r]),p=Object(c.useCallback)(()=>e(lt({type:"CreateRoom",props:null})),[e]);return s.a.createElement(_a,{title:l("rooms.room_join"),onSubmit:d,renderButtons:()=>s.a.createElement(s.a.Fragment,null,s.a.createElement(h,{disabled:0===r.trim().length||36!==r.length,title:l("rooms.join"),kind:"primary",icon:"sign-in",type:"submit"}),s.a.createElement(Ca,{onClick:u}),s.a.createElement(h,{title:l("rooms.create"),kind:"default",icon:"plus",onClick:p}))},s.a.createElement(Na,{id:"modal-roomId",label:l("rooms.id"),type:"text",placeholder:l("rooms.id_placeholder"),maxLength:36,minLength:36,required:!0,value:r,ref:o,onChange:e=>n(e.target.value)}))},qa=()=>{const e=Object(i.b)(),t=Object(c.useState)(""),a=Object(C.a)(t,2),r=a[0],n=a[1],o=Object(c.useRef)(null),l=Object(y.b)().t;Object(c.useEffect)(()=>{o.current&&o.current.focus()},[o]);const u=Object(c.useCallback)(()=>e(it()),[e]),d=Object(c.useCallback)(()=>{e(yt(r)),e(it())},[e,r]);return s.a.createElement(_a,{title:l("rooms.room_unlocking"),onSubmit:d,renderButtons:()=>s.a.createElement(s.a.Fragment,null,s.a.createElement(h,{disabled:36!==r.length,title:l("rooms.unlock"),kind:"primary",icon:"unlock",type:"submit"}),s.a.createElement(Ca,{onClick:u}))},s.a.createElement(Na,{id:"modal-secret",label:l("rooms.key"),type:"password",autoComplete:"password",placeholder:l("rooms.key_placeholder"),maxLength:36,minLength:36,required:!0,value:r,ref:o,onChange:e=>n(e.target.value)}))};a(106);const Wa=()=>{const e=Object(i.b)(),t=Object(i.c)(e=>e.modals.stack.length>0?e.modals.stack[e.modals.stack.length-1]:void 0),a=Object(c.useState)(void 0),r=Object(C.a)(a,2),n=r[0],o=r[1],l=Object(c.useState)(void 0),u=Object(C.a)(l,2),d=u[0],p=u[1],m=Object(c.useCallback)(()=>e(it()),[e]);Object(c.useEffect)(()=>{const e=e=>{27===e.keyCode&&m()};return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}},[m]),Object(c.useEffect)(()=>{o(void 0),p(t)},[t,o,p]),Object(c.useEffect)(()=>{t&&setTimeout(()=>{o(t)},300)},[t,o]);const b=(e=>{if(e)switch(e.type){case"Confirm":return s.a.createElement(Sa,e.props);case"ConnectUser":return s.a.createElement(Pa,null);case"CreateRoom":return s.a.createElement(La,null);case"CreateUser":return s.a.createElement(Ba,null);case"JoinRoom":return s.a.createElement(Ua,null);case"Search":return s.a.createElement(Fa,null);case"UnlockRoom":return s.a.createElement(qa,null)}return null})(n||d);return s.a.createElement(Oa.CSSTransition,{in:!!n,timeout:300,unmountOnExit:!0},s.a.createElement("div",{className:"ModalOverlay",onClick:e=>{e.stopPropagation(),m()}},b&&s.a.createElement("div",{className:"ModalWrapper",role:"dialog",onClick:e=>{e.stopPropagation()}},b)))},Da=e=>Object.values(e.messages).sort((e,t)=>e.weight!==t.weight?e.weight-t.weight:e.stamp-t.stamp);a(114);const Va=()=>{const e=Object(y.b)().t,t=Object(i.b)(),a=Object(i.c)(Da);return s.a.createElement("div",{className:"Messages"},s.a.createElement(Oa.TransitionGroup,null,a.map(({extra:a,id:r,text:n,type:o})=>s.a.createElement(Oa.CSSTransition,{key:r,classNames:"Message",timeout:{enter:200,exit:200}},s.a.createElement("div",{className:m()("Message","Message-"+o)},s.a.createElement("div",{className:"MessageBody"},n?e(n):null,a?a():null),s.a.createElement("div",{className:"MessageActions"},s.a.createElement(h,{icon:"close",title:e("clear"),onClick:()=>t(I(r))})))))))};a(115);const Ha=()=>{const e=Object(i.b)();return Object(c.useEffect)(()=>{e(Ea())},[e]),s.a.createElement("div",{className:"App"},s.a.createElement(Wa,null),s.a.createElement(d.d,null,s.a.createElement(d.b,{exact:!0,path:"/room/:db_id/:room_id",component:ba}),s.a.createElement(d.b,{exact:!0,path:"/",component:ja}),s.a.createElement(d.a,{to:"/"})),s.a.createElement(Va,null))};var Xa=a(40),Ga={audio:{errors:{cannot_decode_audio_data:"Audio buffer cannot be decoded",cannot_load_audio_buffer:"Audio buffer loading failed"}},splash:{CGU:"CGU",powered_with:"Powered with",description:"Collaborative & Musical Games Experimentation"},users:{errors:{invalid:"User is invalid"},user:"User",confirm_disconnect:"Are you sure you want to disconnect?",connect:"Connect",connection:"Connection",create:"Create a user",disconnect:"Disconnect",id:"User ID",id_is_invalid:"ID is invalid",id_placeholder:"User ID...",name_is_invalid:"Name is invalid",name_placeholder:"User Name...",name:"User Name",secret_is_invalid:"Secret is invalid",secret_placeholder:"User Secret...",secret:"User Secret",user_creation:"User Registration",not_connected:"No user is identified"},games:{seabattle:{movement_is_not_possible:"This movement is not possible!",opponent_index:"Opponent {{index}}",join_battle:"Join the battle",missed_opponent:"You've missed opponent boat",hitted_opponent:"You've hitted opponent boat",no_weapon_selected:"Select a weapon to attack",weapon_not_available:"Selected weapon is not available",you_played_your_turn:"You played your turn",not_your_turn:"This is not your turn"},max_players_count:"Maximum players number has been already reached",no_opponents:"No opponents",no_opponents_to_attack:"There is no opponent to attack...",connect_to_join:"You have to connect to join...",watch_or_join:"You can watch or..."},rooms:{errors:{invalid:"Room is invalid",locked:"Room is locked"},types:{blind:"Blind Test",dj:"DJ",seabattle:"Sea Battle"},clear:"Clear all tracks",confirm_clear:"Are you sure you want to remove all tracks?",confirm_exit:"Are you sure you want to leave the room?",confirm_lock:"Are you sure you want to lock the room?",copy_link:"Copy Room Link to Clipboard",create:"Create a room",empty:"It's empty here, you should add some tracks...",empty_for_now:"It's empty here, the owner has to fill it..",exit:"Exit Room",id:"Room ID",id_placeholder:"Room ID...",key_placeholder:"Room Key...",type_placeholder:"Room Type...",key:"Room Key",type:"Room Type",join:"Join a Room",link_copied_to_clipboard:"Room link has been copied to clipboard",loading:"Loading...",locked:"Locked (click to unlock)",name_is_invalid:"Name is invalid",name_placeholder:"Room Name...",name:"Room Name",room_creation:"Room Creation",room_join:"Room Access",room_unlocking:"Room Unlocking",room:"Room",secret_is_invalid:"Secret is invalid",unlock:"Unlock",unlocked:"Unlocked (click to lock)",media_count:"{{count}} media",media_count_plural:"{{count}} medias",track_count:"{{count}} track",track_count_plural:"{{count}} tracks"},medias:{by:"by {{artist}}",add:"Add",remove:"Remove",search:"Search Media",search_placeholder:"Search...",medias_search:"Media Search",albums:"Albums",playlists:"Playlists",tracks:"Tracks"},player:{backward:"Backward",forward:"Forward",play:"Play",playing:"Playing",stop:"Stop"},cancel:"Cancel",clear:"Clear",copy_to_clipboard:"Copy to Clipboard",secret_copied_to_clipboard:"Secret has been copied to clipboard"},Ja={audio:{errors:{cannot_decode_audio_data:"Le buffer audio ne peut pas \xeatre d\xe9cod\xe9",cannot_load_audio_buffer:"Le buffer audio ne peut pas \xeatre charg\xe9"}},splash:{CGU:"CGU",powered_with:"Utilise",description:"Exp\xe9rimentation de jeux collaboratifs et musicaux"},users:{errors:{invalid:"L'utilisateur est invalide"},user:"Utilisateur",confirm_disconnect:"\xcates-vous s\xfbr(e) de vouloir vous d\xe9connecter ?",connect:"Se connecter",connection:"Connexion",create:"Cr\xe9er un utilisateur",disconnect:"Se d\xe9connecter",id:"Identifiant",id_is_invalid:"L'identifiant est invalide",id_placeholder:"Identifiant...",name_is_invalid:"Le nom est invalide",name_placeholder:"Nom...",name:"Nom",secret_is_invalid:"Le secret est invalide",secret_placeholder:"Secret...",secret:"Secret",user_creation:"Cr\xe9ation d'un utilisateur",not_connected:"Aucun utilisateur identifi\xe9"},games:{seabattle:{movement_is_not_possible:"Ce d\xe9placement est impossible !",opponent_index:"Ennemi {{index}}",join_battle:"Participer \xe0 la bataille",missed_opponent:"Vous avez rat\xe9 l'ennemi",hitted_opponent:"Vous avez touch\xe9 l'ennemi",no_weapon_selected:"S\xe9lectionnez une arme pour attaquer",weapon_not_available:"L'arme s\xe9lectionn\xe9e n'est plus disponible",you_played_your_turn:"Vous avez jou\xe9 votre tour",not_your_turn:"Ce n'est pas votre tour de jouer"},max_players_count:"Le nombre maximal de joueurs est d\xe9j\xe0 atteint",no_opponents:"Aucun ennemi",no_opponents_to_attack:"Il n'y aucun ennemi \xe0 attaquer ...",connect_to_join:"Vous devez vous connecter pour participer ...",watch_or_join:"Vous pouvez regarder ou ..."},rooms:{errors:{invalid:"La salle est invalide",locked:"La salle est verrouill\xe9e"},types:{blind:"Blind Test",dj:"DJ",seabattle:"Bataille Navale"},clear:"Supprimer toutes les pistes",confirm_clear:"\xcates-vous s\xfbr(e) de vouloir supprimer toutes les pistes ?",confirm_exit:"\xcates-vous s\xfbr(e) de vouloir quitter la salle ?",confirm_lock:"\xcates-vous s\xfbr(e) de vouloir verrouiller la salle ?",copy_link:"Copier le lien de la salle dans le presse-papier",create:"Cr\xe9er une salle",empty:"Cette salle est vide, vous devriez ajouter quelques pistes...",empty_for_now:"Cette salle est pour le moment vide...",exit:"Quitter la salle",id:"Identifiant",id_placeholder:"Identifiant...",key_placeholder:"Clef...",type_placeholder:"Type...",key:"Clef",type:"Type",join:"Rejoindre une salle",loading:"Chargement...",link_copied_to_clipboard:"Le lien de la salle a \xe9t\xe9 copi\xe9 dans le presse-papier",locked:"Verrouill\xe9e (cliquer pour d\xe9verrouiller)",name_is_invalid:"Le nom est invalide",name_placeholder:"Nom...",name:"Nom",room:"Salle",room_creation:"Cr\xe9ation d'une salle",room_join:"Rejoindre une salle",room_unlocking:"D\xe9verrouillage de la salle",secret_is_invalid:"Le secret is invalide",unlock:"D\xe9verrouiller",unlocked:"D\xe9verrouill\xe9e (cliquer pour verrouiller)",media_count:"{{count}} media",media_count_plural:"{{count}} medias",track_count:"{{count}} piste",track_count_plural:"{{count}} pistes"},medias:{by:"par {{artist}}",add:"Ajouter",remove:"Supprimer",search:"Chercher des m\xe9dias",search_placeholder:"Recherche...",medias_search:"Recherche de m\xe9dias",albums:"Albums",playlists:"Playlists",tracks:"Pistes"},player:{backward:"Piste pr\xe9c\xe9dente",forward:"Piste suivante",play:"Lire",playing:"En cours de lecture",stop:"Arr\xeater"},cancel:"Annuler",clear:"Supprimer",copy_to_clipboard:"Copier dans le presse-papier",secret_copied_to_clipboard:"Le secret a \xe9t\xe9 copi\xe9 dans le presse-papier"};const Qa=function(){var e=Object(o.a)(n.a.mark((function e(){return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((e,t)=>{console.debug("Initializing language...",{current:navigator.language||navigator.userLanguage}),Xa.a.use(y.a).init({fallbackLng:"en",lng:navigator.language||navigator.userLanguage,resources:{en:{translation:Ga},"en-US":{translation:Ga},fr:{translation:Ja},"fr-FR":{translation:Ja}},interpolation:{escapeValue:!1,format:(e,t,a)=>e}},a=>{a&&t(a),e()})}));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Ya=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function Za(e,t){console.debug("PWA registerValidSW 1"),navigator.serviceWorker.register(e).then(e=>{console.debug("PWA registerValidSW 2"),e.onupdatefound=()=>{console.debug("PWA registerValidSW 3");const a=e.installing;null!=a&&(console.debug("PWA registerValidSW 4"),a.onstatechange=()=>{console.debug("PWA registerValidSW 5",a.state),"installed"===a.state&&(navigator.serviceWorker.controller?(console.debug("PWA registerValidSW 6"),console.debug("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.debug("PWA registerValidSW 7"),console.debug("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}}).catch(e=>{console.error("Error during service worker registration:",e)})}a(116);var Ka=a(14),$a=a(59);const er={error:null,fetching:!1,battle:{currentMapIndex:0,maps:[]}},tr=Object(Ka.combineReducers)({seabattle:(e=Object(_.a)({},er),t)=>{switch(t.type){case"games/seabattle/FETCHING":return Object(_.a)({},e,{fetching:!0,error:null});case"games/seabattle/ERROR":return Object(_.a)({},e,{fetching:!1,error:t.payload});case"games/seabattle/SET":return Object(_.a)({},e,{battle:t.payload,fetching:!1,error:null});case"games/seabattle/RESET":return er;default:return e}}}),ar=Object(Ka.combineReducers)({games:tr,medias:(e=Qe,t)=>{switch(t.type){case"medias/FETCHING":return Object(_.a)({},e,{fetching:!0,error:null});case"medias/ERROR":return Object(_.a)({},e,{fetching:!1,error:t.payload});case"medias/SET":{const o=Object(_.a)({},e,{fetching:!1,error:null,medias:{deezer:{album:Object(_.a)({},e.medias.deezer.album),playlist:Object(_.a)({},e.medias.deezer.playlist),track:Object(_.a)({},e.medias.deezer.track)}}});var a,r=Object(B.a)(t.payload);try{for(r.s();!(a=r.n()).done;){const e=a.value;o.medias[e.provider][e.type][e.id]=e}}catch(n){r.e(n)}finally{r.f()}return o}case"medias/RESET":return Qe;default:return e}},messages:(e=N,t)=>{switch(t.type){case"message/ADD":return Object(_.a)({},e,{[t.payload.id]:Object(_.a)({timer:t.payload.timer},t.payload.message)});case"message/REMOVE":{const a=Object(_.a)({},e);return delete a[t.payload.id],a}case"message/RESET":{if(!t.payload.tag)return N;const a=Object(_.a)({},e);return Object.entries(e).forEach(([e,r])=>{r.tag===t.payload.tag&&delete a[e]}),a}default:return e}},modals:(e=ut,t)=>{switch(t.type){case"modals/OPEN":return Object(_.a)({},e,{stack:[t.payload]});case"modals/CLOSE":return Object(_.a)({},e,{stack:[]});case"modals/PUSH":return Object(_.a)({},e,{stack:[...e.stack,t.payload]});case"modals/POP":const a=[...e.stack];return a.pop(),Object(_.a)({},e,{stack:a});default:return e}},room:(e=Ze,t)=>{switch(t.type){case"room/FETCHING":return Object(_.a)({},e,{fetching:!0,error:null});case"room/ERROR":return Object(_.a)({},e,{fetching:!1,error:t.payload});case"room/SET":return Object(_.a)({},e,{},t.payload,{fetching:!1,error:null});case"room/RESET":return Ze;default:return e}},user:(e=Object(_.a)({},va,{access:fa()}),t)=>{switch(t.type){case"user/FETCHING":return Object(_.a)({},e,{fetching:!0,error:null});case"user/ERROR":return Object(_.a)({},e,{fetching:!1,error:t.payload});case"user/SET":{const a=Object(_.a)({},e,{},t.payload,{fetching:!1,error:null});return(({dbId:e,userId:t,secret:a})=>{localStorage.setItem("U",Object(G.b)({dbId:e,userId:t,secret:a}))})(a.access),a}case"user/RESET":return localStorage.removeItem("U"),va;default:return e}}}),rr=e=>{const t=Ka.compose,a=Object(Ka.createStore)(ar,e,t(Object(Ka.applyMiddleware)($a.a.withExtraArgument({player:Ae}))));return{dispatch:a.dispatch.bind(a),getState:a.getState.bind(a),store:a}};a(117);!function(e){if("serviceWorker"in navigator){if(console.debug("PWA register 1",""),new URL("",window.location.href).origin!==window.location.origin)return void console.debug("PWA register 2");window.addEventListener("load",()=>{const t="".concat("","/service-worker.js");console.debug("PWA register 3"),Ya?(console.debug("PWA register 4"),function(e,t){console.debug("PWA checkValidServiceWorker 1"),fetch(e,{headers:{"Service-Worker":"script"}}).then(a=>{const r=a.headers.get("content-type");console.debug("PWA checkValidServiceWorker 2",r,a.status),404===a.status||null!=r&&-1===r.indexOf("javascript")?navigator.serviceWorker.ready.then(e=>{e.unregister().then(()=>{window.location.reload()})}):Za(e,t)}).catch(()=>{console.debug("No internet connection found. App is running in offline mode.")})}(t,e),navigator.serviceWorker.ready.then(()=>{console.debug("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")})):(console.debug("PWA register 5"),Za(t,e))})}}(),function(){var e=Object(o.a)(n.a.mark((function e(){return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Qa(),e.abrupt("return",rr());case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()().then(({store:e})=>{l.render(c.createElement(i.a,{store:e},c.createElement(u.a,null,c.createElement(d.b,{path:"/",component:Ha}))),document.getElementById("root"))})},60:function(e,t,a){e.exports=a(118)},82:function(e,t,a){},83:function(e,t,a){},84:function(e,t,a){},86:function(e,t,a){},87:function(e,t,a){},97:function(e,t,a){},98:function(e,t,a){},99:function(e,t,a){}},[[60,1,2]]]);
//# sourceMappingURL=main.514263a6.chunk.js.map